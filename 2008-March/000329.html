<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Transform-svn] r385 - in dev/dev-2-4/src/com/flagstone/transform:	. test util
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/transform-svn/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:transform-svn%40lists.berlios.de?Subject=Re%3A%20%5BTransform-svn%5D%20r385%20-%20in%20dev/dev-2-4/src/com/flagstone/transform%3A%0A%09.%20test%20util&In-Reply-To=%3C200803261528.m2QFS8j3029023%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000320.html">
   <LINK REL="Next"  HREF="000321.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Transform-svn] r385 - in dev/dev-2-4/src/com/flagstone/transform:	. test util</H1>
    <B>smackay at mail.berlios.de</B> 
    <A HREF="mailto:transform-svn%40lists.berlios.de?Subject=Re%3A%20%5BTransform-svn%5D%20r385%20-%20in%20dev/dev-2-4/src/com/flagstone/transform%3A%0A%09.%20test%20util&In-Reply-To=%3C200803261528.m2QFS8j3029023%40sheep.berlios.de%3E"
       TITLE="[Transform-svn] r385 - in dev/dev-2-4/src/com/flagstone/transform:	. test util">smackay at mail.berlios.de
       </A><BR>
    <I>Wed Mar 26 16:28:08 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000320.html">[Transform-svn] r384 - in dev/dev-2-4/src/com/flagstone/transform:	. test util
</A></li>
        <LI>Next message: <A HREF="000321.html">[Transform-svn] r386 - dev/dev-2-4/src/com/flagstone/transform/util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#329">[ date ]</a>
              <a href="thread.html#329">[ thread ]</a>
              <a href="subject.html#329">[ subject ]</a>
              <a href="author.html#329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: smackay
Date: 2008-03-26 16:26:42 +0100 (Wed, 26 Mar 2008)
New Revision: 385

Modified:
   dev/dev-2-4/src/com/flagstone/transform/Codeable.java
   dev/dev-2-4/src/com/flagstone/transform/FSAction.java
   dev/dev-2-4/src/com/flagstone/transform/FSActionObject.java
   dev/dev-2-4/src/com/flagstone/transform/FSAudioData.java
   dev/dev-2-4/src/com/flagstone/transform/FSBitmapFill.java
   dev/dev-2-4/src/com/flagstone/transform/FSBounds.java
   dev/dev-2-4/src/com/flagstone/transform/FSButton.java
   dev/dev-2-4/src/com/flagstone/transform/FSButtonColorTransform.java
   dev/dev-2-4/src/com/flagstone/transform/FSButtonEvent.java
   dev/dev-2-4/src/com/flagstone/transform/FSButtonSound.java
   dev/dev-2-4/src/com/flagstone/transform/FSCall.java
   dev/dev-2-4/src/com/flagstone/transform/FSCharacter.java
   dev/dev-2-4/src/com/flagstone/transform/FSClipEvent.java
   dev/dev-2-4/src/com/flagstone/transform/FSCoder.java
   dev/dev-2-4/src/com/flagstone/transform/FSCoderException.java
   dev/dev-2-4/src/com/flagstone/transform/FSColor.java
   dev/dev-2-4/src/com/flagstone/transform/FSColorTransform.java
   dev/dev-2-4/src/com/flagstone/transform/FSCoordTransform.java
   dev/dev-2-4/src/com/flagstone/transform/FSCurve.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineButton.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineButton2.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineFont.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineFont2.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineImage.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineImage2.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage2.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage3.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineMorphShape.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineMovieClip.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineObject.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineShape.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineShape2.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineShape3.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineSound.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineText.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineText2.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineTextField.java
   dev/dev-2-4/src/com/flagstone/transform/FSDefineVideo.java
   dev/dev-2-4/src/com/flagstone/transform/FSDoAction.java
   dev/dev-2-4/src/com/flagstone/transform/FSEnableDebugger.java
   dev/dev-2-4/src/com/flagstone/transform/FSEnableDebugger2.java
   dev/dev-2-4/src/com/flagstone/transform/FSEnvelope.java
   dev/dev-2-4/src/com/flagstone/transform/FSExceptionHandler.java
   dev/dev-2-4/src/com/flagstone/transform/FSExport.java
   dev/dev-2-4/src/com/flagstone/transform/FSFontInfo.java
   dev/dev-2-4/src/com/flagstone/transform/FSFontInfo2.java
   dev/dev-2-4/src/com/flagstone/transform/FSFrame.java
   dev/dev-2-4/src/com/flagstone/transform/FSFrameLabel.java
   dev/dev-2-4/src/com/flagstone/transform/FSFree.java
   dev/dev-2-4/src/com/flagstone/transform/FSGetUrl.java
   dev/dev-2-4/src/com/flagstone/transform/FSGetUrl2.java
   dev/dev-2-4/src/com/flagstone/transform/FSGotoFrame.java
   dev/dev-2-4/src/com/flagstone/transform/FSGotoFrame2.java
   dev/dev-2-4/src/com/flagstone/transform/FSGotoLabel.java
   dev/dev-2-4/src/com/flagstone/transform/FSGradient.java
   dev/dev-2-4/src/com/flagstone/transform/FSGradientFill.java
   dev/dev-2-4/src/com/flagstone/transform/FSHeader.java
   dev/dev-2-4/src/com/flagstone/transform/FSIf.java
   dev/dev-2-4/src/com/flagstone/transform/FSImageBlock.java
   dev/dev-2-4/src/com/flagstone/transform/FSImport.java
   dev/dev-2-4/src/com/flagstone/transform/FSInitialize.java
   dev/dev-2-4/src/com/flagstone/transform/FSJPEGEncodingTable.java
   dev/dev-2-4/src/com/flagstone/transform/FSJump.java
   dev/dev-2-4/src/com/flagstone/transform/FSKerning.java
   dev/dev-2-4/src/com/flagstone/transform/FSLayer.java
   dev/dev-2-4/src/com/flagstone/transform/FSLimitScript.java
   dev/dev-2-4/src/com/flagstone/transform/FSLine.java
   dev/dev-2-4/src/com/flagstone/transform/FSLineStyle.java
   dev/dev-2-4/src/com/flagstone/transform/FSMorphBitmapFill.java
   dev/dev-2-4/src/com/flagstone/transform/FSMorphGradient.java
   dev/dev-2-4/src/com/flagstone/transform/FSMorphGradientFill.java
   dev/dev-2-4/src/com/flagstone/transform/FSMorphLineStyle.java
   dev/dev-2-4/src/com/flagstone/transform/FSMorphSolidFill.java
   dev/dev-2-4/src/com/flagstone/transform/FSMovie.java
   dev/dev-2-4/src/com/flagstone/transform/FSMovieObject.java
   dev/dev-2-4/src/com/flagstone/transform/FSNewFunction.java
   dev/dev-2-4/src/com/flagstone/transform/FSNewFunction2.java
   dev/dev-2-4/src/com/flagstone/transform/FSPlaceObject.java
   dev/dev-2-4/src/com/flagstone/transform/FSPlaceObject2.java
   dev/dev-2-4/src/com/flagstone/transform/FSProperty.java
   dev/dev-2-4/src/com/flagstone/transform/FSProtect.java
   dev/dev-2-4/src/com/flagstone/transform/FSPush.java
   dev/dev-2-4/src/com/flagstone/transform/FSQuicktimeMovie.java
   dev/dev-2-4/src/com/flagstone/transform/FSRegisterCopy.java
   dev/dev-2-4/src/com/flagstone/transform/FSRegisterIndex.java
   dev/dev-2-4/src/com/flagstone/transform/FSRegisterVariable.java
   dev/dev-2-4/src/com/flagstone/transform/FSRemoveObject.java
   dev/dev-2-4/src/com/flagstone/transform/FSRemoveObject2.java
   dev/dev-2-4/src/com/flagstone/transform/FSSerialNumber.java
   dev/dev-2-4/src/com/flagstone/transform/FSSetBackgroundColor.java
   dev/dev-2-4/src/com/flagstone/transform/FSSetTarget.java
   dev/dev-2-4/src/com/flagstone/transform/FSShape.java
   dev/dev-2-4/src/com/flagstone/transform/FSShapeObject.java
   dev/dev-2-4/src/com/flagstone/transform/FSShapeStyle.java
   dev/dev-2-4/src/com/flagstone/transform/FSShowFrame.java
   dev/dev-2-4/src/com/flagstone/transform/FSSolidFill.java
   dev/dev-2-4/src/com/flagstone/transform/FSSound.java
   dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamBlock.java
   dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamHead.java
   dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamHead2.java
   dev/dev-2-4/src/com/flagstone/transform/FSStartSound.java
   dev/dev-2-4/src/com/flagstone/transform/FSTabOrder.java
   dev/dev-2-4/src/com/flagstone/transform/FSTable.java
   dev/dev-2-4/src/com/flagstone/transform/FSTableIndex.java
   dev/dev-2-4/src/com/flagstone/transform/FSText.java
   dev/dev-2-4/src/com/flagstone/transform/FSUnknownAction.java
   dev/dev-2-4/src/com/flagstone/transform/FSUnknownObject.java
   dev/dev-2-4/src/com/flagstone/transform/FSVideo.java
   dev/dev-2-4/src/com/flagstone/transform/FSVideoData.java
   dev/dev-2-4/src/com/flagstone/transform/FSVideoFrame.java
   dev/dev-2-4/src/com/flagstone/transform/FSVideoMetaData.java
   dev/dev-2-4/src/com/flagstone/transform/FSVideoObject.java
   dev/dev-2-4/src/com/flagstone/transform/FSWaitForFrame.java
   dev/dev-2-4/src/com/flagstone/transform/FSWaitForFrame2.java
   dev/dev-2-4/src/com/flagstone/transform/FSWith.java
   dev/dev-2-4/src/com/flagstone/transform/Transform.java
   dev/dev-2-4/src/com/flagstone/transform/test/FSColorTest.java
   dev/dev-2-4/src/com/flagstone/transform/test/FSProtectTest.java
   dev/dev-2-4/src/com/flagstone/transform/test/FSScreenVideoPacketTest.java
   dev/dev-2-4/src/com/flagstone/transform/test/FSSetBackgroundColorTest.java
   dev/dev-2-4/src/com/flagstone/transform/test/FSShapeConstructorTest.java
   dev/dev-2-4/src/com/flagstone/transform/test/FSShowFrameTest.java
   dev/dev-2-4/src/com/flagstone/transform/test/FSSoundConstructorTest.java
   dev/dev-2-4/src/com/flagstone/transform/util/FSImageConstructor.java
   dev/dev-2-4/src/com/flagstone/transform/util/FSShapeConstructor.java
   dev/dev-2-4/src/com/flagstone/transform/util/FSSoundConstructor.java
Log:
Updated

Modified: dev/dev-2-4/src/com/flagstone/transform/Codeable.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/Codeable.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/Codeable.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -18,11 +18,36 @@
 	 * as offsets and flags that will be used when the object is encoded. This
 	 * allows the encoding process to take place in a single pass.
 	 * 
+	 * @param context an FSContext that allows information to be passed between 
+	 * objects to control how they are encoded.
+	 * 
 	 * @return the length in bytes of the object when it is encoded.
 	 */
 	public int length(FSContext context);
 
+	/**
+	 * Encode an object to the binary form.
+	 * 
+	 * @param coder an FSCoder object that is used to encode the object to its
+	 * binary form.
+	 * 
+	 * @param context an FSContext that allows information to be passed between 
+	 * objects to control how they are encoded.
+	 * 
+	 * @return the length in bytes of the object when it is encoded.
+	 */
 	public void encode(FSCoder coder, FSContext context);
 
+	/**
+	 * Decode an object from its binary form. 
+	 * 
+	 * @param coder an FSCoder object that is used to decode the object from its
+	 * binary form.
+	 * 
+	 * @param context an FSContext that allows information to be passed between 
+	 * objects to control how they are decoded.
+	 * 
+	 * @return the length in bytes of the object when it is encoded.
+	 */
 	public void decode(FSCoder coder, FSContext context);
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSAction.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSAction.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSAction.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -1,5 +1,5 @@
 /*
- * FSAction.java
+ * java
  * Transform
  * 
  * Copyright (c) 2001-2008 Flagstone Software Ltd. All rights reserved.
@@ -759,7 +759,7 @@
  * &lt;/p&gt;
  * 
  * &lt;pre&gt;
- * FSAction anAction = new FSAction(FSAction.Add);
+ * FSAction anAction = new FSAction(Add);
  * &lt;/pre&gt;
  * 
  * &lt;p&gt;
@@ -773,9 +773,9 @@
  * 
  * frameAction.add(new FSPush(1));
  * frameAction.add(new FSPush(2));
- * frameAction.add(new FSAction(FSAction.Add));
+ * frameAction.add(new FSAction(Add));
  * frameAction.add(new FSPush(3));
- * frameAction.add(new FSAction(FSAction.Multiply));
+ * frameAction.add(new FSAction(Multiply));
  * &lt;/pre&gt;
  * 
  * &lt;p&gt;
@@ -796,7 +796,7 @@
  * // Place the name on the stack then execute the function.
  * 
  * frameAction.add(new FSPush(&quot;FunctionName&quot;));
- * frameAction.add(new FSAction(FSAction.ExecuteFunction));
+ * frameAction.add(new FSAction(ExecuteFunction));
  * &lt;/pre&gt;
  * 
  * &lt;p&gt;
@@ -815,12 +815,12 @@
  * 
  * frameAction.add(new FSPush(&quot;_root&quot;));
  * frameAction.add(new FSPush(&quot;movieClip&quot;));
- * frameAction.add(new FSAction(FSAction.GetAttribute));
+ * frameAction.add(new FSAction(GetAttribute));
  * 
  * // Place the name of the method on the stack then execute it.
  * 
  * frameAction.add(new FSPush(&quot;gotoAndPlay&quot;));
- * frameAction.add(new FSAction(FSAction.ExecuteMethod));
+ * frameAction.add(new FSAction(ExecuteMethod));
  * &lt;/pre&gt;
  * 
  * &lt;p&gt;
@@ -834,92 +834,92 @@
 {
 	private static final FSAction[] actions =
 	{
-		new FSAction(FSAction.End), // 0;
+		new FSAction(End), // 0;
 		new FSAction(1),
 		new FSAction(2),
 		new FSAction(3),
-		new FSAction(FSAction.NextFrame), // 4;
-		new FSAction(FSAction.PrevFrame), // 5;
-		new FSAction(FSAction.Play), // 6;
-		new FSAction(FSAction.Stop), // 7;
-		new FSAction(FSAction.ToggleQuality), // 8;
-		new FSAction(FSAction.StopSounds), // 9;
-		new FSAction(FSAction.IntegerAdd), // 10;
-		new FSAction(FSAction.Subtract), // 11;
-		new FSAction(FSAction.Multiply), // 12;
-		new FSAction(FSAction.Divide), // 13;
-		new FSAction(FSAction.IntegerEquals), // 14;
-		new FSAction(FSAction.IntegerLess), // 15;
-		new FSAction(FSAction.And), // 16;
-		new FSAction(FSAction.Or), // 17;
-		new FSAction(FSAction.Not), // 18;
-		new FSAction(FSAction.StringEquals), // 19;
-		new FSAction(FSAction.StringLength), // 20;
-		new FSAction(FSAction.StringExtract), // 21;
+		new FSAction(NextFrame), // 4;
+		new FSAction(PrevFrame), // 5;
+		new FSAction(Play), // 6;
+		new FSAction(Stop), // 7;
+		new FSAction(ToggleQuality), // 8;
+		new FSAction(StopSounds), // 9;
+		new FSAction(IntegerAdd), // 10;
+		new FSAction(Subtract), // 11;
+		new FSAction(Multiply), // 12;
+		new FSAction(Divide), // 13;
+		new FSAction(IntegerEquals), // 14;
+		new FSAction(IntegerLess), // 15;
+		new FSAction(And), // 16;
+		new FSAction(Or), // 17;
+		new FSAction(Not), // 18;
+		new FSAction(StringEquals), // 19;
+		new FSAction(StringLength), // 20;
+		new FSAction(StringExtract), // 21;
 		new FSAction(22),
-		new FSAction(FSAction.Pop), // 23;
-		new FSAction(FSAction.ToInteger), // 24;
+		new FSAction(Pop), // 23;
+		new FSAction(ToInteger), // 24;
 		new FSAction(25),
 		new FSAction(26),
 		new FSAction(27),
-		new FSAction(FSAction.GetVariable), // 28;
-		new FSAction(FSAction.SetVariable), // 29;
+		new FSAction(GetVariable), // 28;
+		new FSAction(SetVariable), // 29;
 		new FSAction(30),
 		new FSAction(31),
-		new FSAction(FSAction.SetTarget2), // 32;
-		new FSAction(FSAction.StringAdd), // 33;
-		new FSAction(FSAction.GetProperty), // 34;
-		new FSAction(FSAction.SetProperty), // 35;
-		new FSAction(FSAction.CloneSprite), // 36;
-		new FSAction(FSAction.RemoveSprite), // 37;
-		new FSAction(FSAction.Trace), // 38;
-		new FSAction(FSAction.StartDrag), // 39;
-		new FSAction(FSAction.EndDrag), // 40;
-		new FSAction(FSAction.StringLess), // 41;
-		new FSAction(FSAction.Throw), // 42;
-		new FSAction(FSAction.Cast), // 43;
-		new FSAction(FSAction.Implements), // 44;
+		new FSAction(SetTarget2), // 32;
+		new FSAction(StringAdd), // 33;
+		new FSAction(GetProperty), // 34;
+		new FSAction(SetProperty), // 35;
+		new FSAction(CloneSprite), // 36;
+		new FSAction(RemoveSprite), // 37;
+		new FSAction(Trace), // 38;
+		new FSAction(StartDrag), // 39;
+		new FSAction(EndDrag), // 40;
+		new FSAction(StringLess), // 41;
+		new FSAction(Throw), // 42;
+		new FSAction(Cast), // 43;
+		new FSAction(Implements), // 44;
 		new FSAction(45),
 		new FSAction(46),
 		new FSAction(47),
-		new FSAction(FSAction.RandomNumber), // 48;
-		new FSAction(FSAction.MBStringLength), // 49;
-		new FSAction(FSAction.CharToAscii), // 50;
-		new FSAction(FSAction.AsciiToChar), // 51;
-		new FSAction(FSAction.GetTime), // 52;
-		new FSAction(FSAction.MBStringExtract), // 53;
-		new FSAction(FSAction.MBCharToAscii), // 54;
-		new FSAction(FSAction.MBAsciiToChar), // 55;
+		new FSAction(RandomNumber), // 48;
+		new FSAction(MBStringLength), // 49;
+		new FSAction(CharToAscii), // 50;
+		new FSAction(AsciiToChar), // 51;
+		new FSAction(GetTime), // 52;
+		new FSAction(MBStringExtract), // 53;
+		new FSAction(MBCharToAscii), // 54;
+		new FSAction(MBAsciiToChar), // 55;
 		new FSAction(56),
 		new FSAction(57),
-		new FSAction(FSAction.DeleteVariable), // 58;
-		new FSAction(FSAction.Delete), // 59;
-		new FSAction(FSAction.InitVariable), // 60;
-		new FSAction(FSAction.ExecuteFunction), // 61;
-		new FSAction(FSAction.Return), // 62;
-		new FSAction(FSAction.Modulo), // 63;
-		new FSAction(FSAction.NamedObject), // 64;
-		new FSAction(FSAction.NewVariable), // 65;
-		new FSAction(FSAction.NewArray), // 66;
-		new FSAction(FSAction.NewObject), // 67;
-		new FSAction(FSAction.GetType), // 68;
-		new FSAction(FSAction.GetTarget), // 69;
-		new FSAction(FSAction.Enumerate), // 70;
-		new FSAction(FSAction.Add), // 71;
-		new FSAction(FSAction.Less), // 72;
-		new FSAction(FSAction.Equals), // 73;
-		new FSAction(FSAction.ToNumber), // 74;
-		new FSAction(FSAction.ToString), // 75;
-		new FSAction(FSAction.Duplicate), // 76;
-		new FSAction(FSAction.Swap), // 77;
-		new FSAction(FSAction.GetAttribute), // 78;
-		new FSAction(FSAction.SetAttribute), // 79;
-		new FSAction(FSAction.Increment), // 80;
-		new FSAction(FSAction.Decrement), // 81;
-		new FSAction(FSAction.ExecuteMethod), // 82;
-		new FSAction(FSAction.NewMethod), // 83;
-		new FSAction(FSAction.InstanceOf), // 84;
-		new FSAction(FSAction.EnumerateObject), // 85;
+		new FSAction(DeleteVariable), // 58;
+		new FSAction(Delete), // 59;
+		new FSAction(InitVariable), // 60;
+		new FSAction(ExecuteFunction), // 61;
+		new FSAction(Return), // 62;
+		new FSAction(Modulo), // 63;
+		new FSAction(NamedObject), // 64;
+		new FSAction(NewVariable), // 65;
+		new FSAction(NewArray), // 66;
+		new FSAction(NewObject), // 67;
+		new FSAction(GetType), // 68;
+		new FSAction(GetTarget), // 69;
+		new FSAction(Enumerate), // 70;
+		new FSAction(Add), // 71;
+		new FSAction(Less), // 72;
+		new FSAction(Equals), // 73;
+		new FSAction(ToNumber), // 74;
+		new FSAction(ToString), // 75;
+		new FSAction(Duplicate), // 76;
+		new FSAction(Swap), // 77;
+		new FSAction(GetAttribute), // 78;
+		new FSAction(SetAttribute), // 79;
+		new FSAction(Increment), // 80;
+		new FSAction(Decrement), // 81;
+		new FSAction(ExecuteMethod), // 82;
+		new FSAction(NewMethod), // 83;
+		new FSAction(InstanceOf), // 84;
+		new FSAction(EnumerateObject), // 85;
 		new FSAction(86),
 		new FSAction(87),
 		new FSAction(88),
@@ -930,16 +930,16 @@
 		new FSAction(93),
 		new FSAction(94),
 		new FSAction(95),
-		new FSAction(FSAction.BitwiseAnd), // 96;
-		new FSAction(FSAction.BitwiseOr), // 97;
-		new FSAction(FSAction.BitwiseXOr), // 98;
-		new FSAction(FSAction.LogicalShiftLeft), // 99;
-		new FSAction(FSAction.ArithmeticShiftRight), // 100;
-		new FSAction(FSAction.LogicalShiftRight), // 101;
-		new FSAction(FSAction.StrictEquals), // 102;
-		new FSAction(FSAction.Greater), // 103;
-		new FSAction(FSAction.StringGreater), // 104;
-		new FSAction(FSAction.Extends), // 105;
+		new FSAction(BitwiseAnd), // 96;
+		new FSAction(BitwiseOr), // 97;
+		new FSAction(BitwiseXOr), // 98;
+		new FSAction(LogicalShiftLeft), // 99;
+		new FSAction(ArithmeticShiftRight), // 100;
+		new FSAction(LogicalShiftRight), // 101;
+		new FSAction(StrictEquals), // 102;
+		new FSAction(Greater), // 103;
+		new FSAction(StringGreater), // 104;
+		new FSAction(Extends), // 105;
 		new FSAction(106), new FSAction(107), new FSAction(108),
 		new FSAction(109), new FSAction(110), new FSAction(111),
 		new FSAction(112), new FSAction(113), new FSAction(114),
@@ -961,7 +961,7 @@
 	 */
 	public static FSAction End()
 	{
-		return actions[FSAction.End];
+		return actions[End];
 	}
 
 	/**
@@ -970,7 +970,7 @@
 	 */
 	public static FSAction NextFrame()
 	{
-		return actions[FSAction.NextFrame];
+		return actions[NextFrame];
 	}
 
 	/**
@@ -979,7 +979,7 @@
 	 */
 	public static FSAction PrevFrame()
 	{
-		return actions[FSAction.PrevFrame];
+		return actions[PrevFrame];
 	}
 
 	/**
@@ -988,7 +988,7 @@
 	 */
 	public static FSAction Play()
 	{
-		return actions[FSAction.Play];
+		return actions[Play];
 	}
 
 	/**
@@ -997,7 +997,7 @@
 	 */
 	public static FSAction Stop()
 	{
-		return actions[FSAction.Stop];
+		return actions[Stop];
 	}
 
 	/**
@@ -1006,7 +1006,7 @@
 	 */
 	public static FSAction ToggleQuality()
 	{
-		return actions[FSAction.ToggleQuality];
+		return actions[ToggleQuality];
 	}
 
 	/**
@@ -1015,515 +1015,658 @@
 	 */
 	public static FSAction StopSounds()
 	{
-		return actions[FSAction.StopSounds];
+		return actions[StopSounds];
 	}
 
 	// Flash 4
-	// / Factory method for generating an FSAction object representing a
-	// Subtract action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * Subtract action. 
+	 */
 	public static FSAction Subtract()
 	{
-		return actions[FSAction.Subtract];
+		return actions[Subtract];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// Multiply action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * Multiply action. 
+	 * */
 	public static FSAction Multiply()
 	{
-		return actions[FSAction.Multiply];
+		return actions[Multiply];
 	}
 
-	// / Factory method for generating an FSAction object representing a Divide
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Divide 
+	 * action. 
+	 */
 	public static FSAction Divide()
 	{
-		return actions[FSAction.Divide];
+		return actions[Divide];
 	}
 
-	// / Factory method for generating an FSAction object representing a And
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a And
+	 * action. 
+	 */
 	public static FSAction And()
 	{
-		return actions[FSAction.And];
+		return actions[And];
 	}
 
-	// / Factory method for generating an FSAction object representing a Or
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Or 
+	 * action. 
+	 */
 	public static FSAction Or()
 	{
-		return actions[FSAction.Or];
+		return actions[Or];
 	}
 
-	// / Factory method for generating an FSAction object representing a Not
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Not 
+	 * action. 
+	 */
 	public static FSAction Not()
 	{
-		return actions[FSAction.Not];
+		return actions[Not];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// StringEquals action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * StringEquals action. 
+	 */
 	public static FSAction StringEquals()
 	{
-		return actions[FSAction.StringEquals];
+		return actions[StringEquals];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// StringLength action.
+	/** 
+	 * Factory method for generating an FSAction object representing a 
+	 * StringLength action. 
+	 */
 	public static FSAction StringLength()
 	{
-		return actions[FSAction.StringLength];
+		return actions[StringLength];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// StringExtract action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * StringExtract action. 
+	 */
 	public static FSAction StringExtract()
 	{
-		return actions[FSAction.StringExtract];
+		return actions[StringExtract];
 	}
 
-	// / Factory method for generating an FSAction object representing a Pop
-	// action.
+	/**
+	 * Factory method for generating an FSAction object representing a Pop
+	 * action. 
+	 */
 	public static FSAction Pop()
 	{
-		return actions[FSAction.Pop];
+		return actions[Pop];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// ToInteger action.
+	/** 
+	 * Factory method for generating an FSAction object representing a 
+	 * ToInteger action. 
+	 */
 	public static FSAction ToInteger()
 	{
-		return actions[FSAction.ToInteger];
+		return actions[ToInteger];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// GetVariable action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * GetVariable action. 
+	 */
 	public static FSAction GetVariable()
 	{
-		return actions[FSAction.GetVariable];
+		return actions[GetVariable];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// SetVariable action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * SetVariable action. 
+	 */
 	public static FSAction SetVariable()
 	{
-		return actions[FSAction.SetVariable];
+		return actions[SetVariable];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// SetTarget2 action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * SetTarget2 action. 
+	 */
 	public static FSAction SetTarget2()
 	{
-		return actions[FSAction.SetTarget2];
+		return actions[SetTarget2];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// StringAdd action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * StringAdd action. 
+	 */
 	public static FSAction StringAdd()
 	{
-		return actions[FSAction.StringAdd];
+		return actions[StringAdd];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// GetProperty action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * GetProperty action. 
+	 */
 	public static FSAction GetProperty()
 	{
-		return actions[FSAction.GetProperty];
+		return actions[GetProperty];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// SetProperty action.
+	/** 
+	 * Factory method for generating an FSAction object representing a 
+	 * SetProperty action. 
+	 */
 	public static FSAction SetProperty()
 	{
-		return actions[FSAction.SetProperty];
+		return actions[SetProperty];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// CloneSprite action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * CloneSprite action. 
+	 */
 	public static FSAction CloneSprite()
 	{
-		return actions[FSAction.CloneSprite];
+		return actions[CloneSprite];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// RemoveSprite action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * RemoveSprite action. 
+	 */
 	public static FSAction RemoveSprite()
 	{
-		return actions[FSAction.RemoveSprite];
+		return actions[RemoveSprite];
 	}
 
-	// / Factory method for generating an FSAction object representing a Trace
-	// action.
+	/** Factory method for generating an FSAction object representing a Trace
+	 * action. 
+	 */
 	public static FSAction Trace()
 	{
-		return actions[FSAction.Trace];
+		return actions[Trace];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// StartDrag action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * StartDrag action. 
+	 */
 	public static FSAction StartDrag()
 	{
-		return actions[FSAction.StartDrag];
+		return actions[StartDrag];
 	}
 
-	// / Factory method for generating an FSAction object representing a EndDrag
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a EndDrag
+	 * action. 
+	 */
 	public static FSAction EndDrag()
 	{
-		return actions[FSAction.EndDrag];
+		return actions[EndDrag];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// StringLess action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * StringLess action. 
+	 */
 	public static FSAction StringLess()
 	{
-		return actions[FSAction.StringLess];
+		return actions[StringLess];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// RandomNumber action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * RandomNumber action.
+	 */
 	public static FSAction RandomNumber()
 	{
-		return actions[FSAction.RandomNumber];
+		return actions[RandomNumber];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// MBStringLength action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * MBStringLength action. 
+	 */
 	public static FSAction MBStringLength()
 	{
-		return actions[FSAction.MBStringLength];
+		return actions[MBStringLength];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// CharToAscii action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * CharToAscii action.
+	 */
 	public static FSAction CharToAscii()
 	{
-		return actions[FSAction.CharToAscii];
+		return actions[CharToAscii];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// AsciiToChar action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * AsciiToChar action. 
+	 */
 	public static FSAction AsciiToChar()
 	{
-		return actions[FSAction.AsciiToChar];
+		return actions[AsciiToChar];
 	}
 
-	// / Factory method for generating an FSAction object representing a GetTime
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a GetTime
+	 * action. 
+	 */
 	public static FSAction GetTime()
 	{
-		return actions[FSAction.GetTime];
+		return actions[GetTime];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// MBStringExtract action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * MBStringExtract action. 
+	 */
 	public static FSAction MBStringExtract()
 	{
-		return actions[FSAction.MBStringExtract];
+		return actions[MBStringExtract];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// MBCharToAscii action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * MBCharToAscii action. 
+	 */
 	public static FSAction MBCharToAscii()
 	{
-		return actions[FSAction.MBCharToAscii];
+		return actions[MBCharToAscii];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// MBAsciiToChar action.
+	/**
+	 * Factory method for generating an FSAction object representing a
+	 * MBAsciiToChar action. 
+	 */
 	public static FSAction MBAsciiToChar()
 	{
-		return actions[FSAction.MBAsciiToChar];
+		return actions[MBAsciiToChar];
 	}
 
 	// Flash 5
-	// / Factory method for generating an FSAction object representing a
-	// DeleteVariable action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * DeleteVariable action. 
+	 */
 	public static FSAction DeleteVariable()
 	{
-		return actions[FSAction.DeleteVariable];
+		return actions[DeleteVariable];
 	}
 
-	// / Factory method for generating an FSAction object representing a Delete
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Delete
+	 *  action. 
+	 */
 	public static FSAction Delete()
 	{
-		return actions[FSAction.Delete];
+		return actions[Delete];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// InitVariable action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * InitVariable action. 
+	 */
 	public static FSAction InitVariable()
 	{
-		return actions[FSAction.InitVariable];
+		return actions[InitVariable];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// ExecuteFunction action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * ExecuteFunction action. 
+	 */
 	public static FSAction ExecuteFunction()
 	{
-		return actions[FSAction.ExecuteFunction];
+		return actions[ExecuteFunction];
 	}
 
-	// / Factory method for generating an FSAction object representing a Return
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Return
+	 * action. 
+	 */
 	public static FSAction Return()
 	{
-		return actions[FSAction.Return];
+		return actions[Return];
 	}
 
-	// / Factory method for generating an FSAction object representing a Modulo
-	// action.
+	/**
+	 * Factory method for generating an FSAction object representing a Modulo
+	 * action. 
+	 */
 	public static FSAction Modulo()
 	{
-		return actions[FSAction.Modulo];
+		return actions[Modulo];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// NamedObject action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * NamedObject action. 
+	 */
 	public static FSAction NamedObject()
 	{
-		return actions[FSAction.NamedObject];
+		return actions[NamedObject];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// NewVariable action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * NewVariable action. 
+	 */
 	public static FSAction NewVariable()
 	{
-		return actions[FSAction.NewVariable];
+		return actions[NewVariable];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// NewArray action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * NewArray action. 
+	 */
 	public static FSAction NewArray()
 	{
-		return actions[FSAction.NewArray];
+		return actions[NewArray];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// NewObject action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * NewObject action. 
+	 */
 	public static FSAction NewObject()
 	{
-		return actions[FSAction.NewObject];
+		return actions[NewObject];
 	}
 
-	// / Factory method for generating an FSAction object representing a GetType
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a GetType
+	 * action. 
+	 */
 	public static FSAction GetType()
 	{
-		return actions[FSAction.GetType];
+		return actions[GetType];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// GetTarget action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * GetTarget action. 
+	 */
 	public static FSAction GetTarget()
 	{
-		return actions[FSAction.GetTarget];
+		return actions[GetTarget];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// Enumerate action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * Enumerate action. 
+	 */
 	public static FSAction Enumerate()
 	{
-		return actions[FSAction.Enumerate];
+		return actions[Enumerate];
 	}
 
-	// / Factory method for generating an FSAction object representing a Add
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Add
+	 * action. 
+	 */
 	public static FSAction Add()
 	{
-		return actions[FSAction.Add];
+		return actions[Add];
 	}
 
-	// / Factory method for generating an FSAction object representing a Less
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Less
+	 * action. 
+	 */
 	public static FSAction Less()
 	{
-		return actions[FSAction.Less];
+		return actions[Less];
 	}
 
-	// / Factory method for generating an FSAction object representing a Equals
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Equals
+	 * action. 
+	 */
 	public static FSAction Equals()
 	{
-		return actions[FSAction.Equals];
+		return actions[Equals];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// ToNumber action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * ToNumber action. 
+	 */
 	public static FSAction ToNumber()
 	{
-		return actions[FSAction.ToNumber];
+		return actions[ToNumber];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// ToString action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * ToString action. 
+	 */
 	public static FSAction ToString()
 	{
-		return actions[FSAction.ToString];
+		return actions[ToString];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// Duplicate action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * Duplicate action. 
+	 */
 	public static FSAction Duplicate()
 	{
-		return actions[FSAction.Duplicate];
+		return actions[Duplicate];
 	}
 
-	// / Factory method for generating an FSAction object representing a Swap
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Swap
+	 * action. 
+	 */
 	public static FSAction Swap()
 	{
-		return actions[FSAction.Swap];
+		return actions[Swap];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// GetAttribute action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * GetAttribute action. 
+	 */
 	public static FSAction GetAttribute()
 	{
-		return actions[FSAction.GetAttribute];
+		return actions[GetAttribute];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// SetAttribute action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * SetAttribute action. 
+	 */
 	public static FSAction SetAttribute()
 	{
-		return actions[FSAction.SetAttribute];
+		return actions[SetAttribute];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// Increment action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * Increment action. 
+	 */
 	public static FSAction Increment()
 	{
-		return actions[FSAction.Increment];
+		return actions[Increment];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// Decrement action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * Decrement action. 
+	 */
 	public static FSAction Decrement()
 	{
-		return actions[FSAction.Decrement];
+		return actions[Decrement];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// ExecuteMethod action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * ExecuteMethod action. 
+	 */
 	public static FSAction ExecuteMethod()
 	{
-		return actions[FSAction.ExecuteMethod];
+		return actions[ExecuteMethod];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// NewMethod action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * NewMethod action. 
+	 */
 	public static FSAction NewMethod()
 	{
-		return actions[FSAction.NewMethod];
+		return actions[NewMethod];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// BitwiseAnd action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * BitwiseAnd action. 
+	 */
 	public static FSAction BitwiseAnd()
 	{
-		return actions[FSAction.BitwiseAnd];
+		return actions[BitwiseAnd];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// BitwiseOr action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * BitwiseOr action. 
+	 */
 	public static FSAction BitwiseOr()
 	{
-		return actions[FSAction.BitwiseOr];
+		return actions[BitwiseOr];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// BitwiseXOr action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * BitwiseXOr action. 
+	 */
 	public static FSAction BitwiseXOr()
 	{
-		return actions[FSAction.BitwiseXOr];
+		return actions[BitwiseXOr];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// LogicalShiftLeft action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * LogicalShiftLeft action. 
+	 */
 	public static FSAction LogicalShiftLeft()
 	{
-		return actions[FSAction.LogicalShiftLeft];
+		return actions[LogicalShiftLeft];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// ArithmeticShiftRight action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * ArithmeticShiftRight action. 
+	 */
 	public static FSAction ArithmeticShiftRight()
 	{
-		return actions[FSAction.ArithmeticShiftRight];
+		return actions[ArithmeticShiftRight];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// LogicalShiftRight action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * LogicalShiftRight action. 
+	 */
 	public static FSAction LogicalShiftRight()
 	{
-		return actions[FSAction.LogicalShiftRight];
+		return actions[LogicalShiftRight];
 	}
 
 	// Flash 6
-	// / Factory method for generating an FSAction object representing a
-	// InstanceOf action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * InstanceOf action. 
+	 */
 	public static FSAction InstanceOf()
 	{
-		return actions[FSAction.InstanceOf];
+		return actions[InstanceOf];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// EnumerateObject action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * EnumerateObject action. 
+	 */
 	public static FSAction EnumerateObject()
 	{
-		return actions[FSAction.EnumerateObject];
+		return actions[EnumerateObject];
 	}
 
-	// / Factory method for generating an FSAction object representing a Greater
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Greater
+	 * action. 
+	 */
 	public static FSAction Greater()
 	{
-		return actions[FSAction.Greater];
+		return actions[Greater];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// StringGreater action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * StringGreater action. 
+	 */
 	public static FSAction StringGreater()
 	{
-		return actions[FSAction.StringGreater];
+		return actions[StringGreater];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// StrictEquals action.
+	/** 
+	 * Factory method for generating an FSAction object representing a
+	 * StrictEquals action. 
+	 */
 	public static FSAction StrictEquals()
 	{
-		return actions[FSAction.StrictEquals];
+		return actions[StrictEquals];
 	}
 
 	// Flash 7
-	// / Factory method for generating an FSAction object representing a Cast
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Cast 
+	 * action. 
+	 */
 	public static FSAction Cast()
 	{
-		return actions[FSAction.Cast];
+		return actions[Cast];
 	}
 
-	// / Factory method for generating an FSAction object representing a
-	// Implements action.
+	/** 
+	 * Factory method for generating an FSAction object representing an 
+	 * Implements action. 
+	 */
 	public static FSAction Implements()
 	{
-		return actions[FSAction.Implements];
+		return actions[Implements];
 	}
 
-	// / Factory method for generating an FSAction object representing a Throw
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Throw
+	 * action. 
+	 */
 	public static FSAction Throw()
 	{
-		return actions[FSAction.Throw];
+		return actions[Throw];
 	}
 
-	// / Factory method for generating an FSAction object representing a Extends
-	// action.
+	/** 
+	 * Factory method for generating an FSAction object representing a Extends
+	 * action. 
+	 */
 	public static FSAction Extends()
 	{
-		return actions[FSAction.Extends];
+		return actions[Extends];
 	}
 
 	/**
@@ -1558,6 +1701,6 @@
 	 */
 	public FSAction(FSAction obj)
 	{
-		super(obj);
+		super(obj.type);
 	}
 }
\ No newline at end of file

Modified: dev/dev-2-4/src/com/flagstone/transform/FSActionObject.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSActionObject.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSActionObject.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -47,6 +47,9 @@
  * getType() method is essential when examining FSAction objects which represent
  * a large number byte-codes which perform stack-based operations such as add,
  * subtract, etc.
+ * 
+ * The registerClass() method allows you to write your own decode for actions 
+ * not currently supported by the framework.
  */
 public abstract class FSActionObject implements Cloneable, Codeable
 {
@@ -72,232 +75,232 @@
 	public static final int StopSounds = 9;
 
 	// Flash 4
-	// / Type identifying an IntegerAdd stack-based action.
+	/** Type identifying an IntegerAdd stack-based action. */
 	public static final int IntegerAdd = 10;
 
-	// / Type identifying a Subtract stack-based action.
+	/** Type identifying a Subtract stack-based action. */
 	public static final int Subtract = 11;
 
-	// / Type identifying a Multiply stack-based action.
+	/** Type identifying a Multiply stack-based action. */
 	public static final int Multiply = 12;
 
-	// / Type identifying a Divide stack-based action.
+	/** Type identifying a Divide stack-based action. */
 	public static final int Divide = 13;
 
-	// / Type identifying an IntegerEquals stack-based action.
+	/** Type identifying an IntegerEquals stack-based action. */
 	public static final int IntegerEquals = 14;
 
-	// / Type identifying an IntegerLess stack-based action.
+	/** Type identifying an IntegerLess stack-based action. */
 	public static final int IntegerLess = 15;
 
-	// / Type identifying an And stack-based action.
+	/** Type identifying an And stack-based action. */
 	public static final int And = 16;
 
-	// / Type identifying an Or stack-based action.
+	/** Type identifying an Or stack-based action. */
 	public static final int Or = 17;
 
-	// / Type identifying a Not stack-based action.
+	/** Type identifying a Not stack-based action. */
 	public static final int Not = 18;
 
-	// / Type identifying a StringEquals stack-based action.
+	/** Type identifying a StringEquals stack-based action. */
 	public static final int StringEquals = 19;
 
-	// / Type identifying a StringLength stack-based action.
+	/** Type identifying a StringLength stack-based action. */
 	public static final int StringLength = 20;
 
-	// / Type identifying a StringExtract stack-based action.
+	/** Type identifying a StringExtract stack-based action. */
 	public static final int StringExtract = 21;
 
-	// / Type identifying a Pop stack-based action.
+	/** Type identifying a Pop stack-based action. */
 	public static final int Pop = 23;
 
-	// / Type identifying a ToInteger stack-based action.
+	/** Type identifying a ToInteger stack-based action. */
 	public static final int ToInteger = 24;
 
-	// / Type identifying a GetVariable stack-based action.
+	/** Type identifying a GetVariable stack-based action. */
 	public static final int GetVariable = 28;
 
-	// / Type identifying a SetVariable stack-based action.
+	/** Type identifying a SetVariable stack-based action. */
 	public static final int SetVariable = 29;
 
-	// / Type identifying a SetTarget2 stack-based action.
+	/** Type identifying a SetTarget2 stack-based action. */
 	public static final int SetTarget2 = 32;
 
-	// / Type identifying a StringAdd stack-based action.
+	/** Type identifying a StringAdd stack-based action. */
 	public static final int StringAdd = 33;
 
-	// / Type identifying a GetProperty stack-based action.
+	/** Type identifying a GetProperty stack-based action. */
 	public static final int GetProperty = 34;
 
-	// / Type identifying a SetProperty stack-based action.
+	/** Type identifying a SetProperty stack-based action. */
 	public static final int SetProperty = 35;
 
-	// / Type identifying a CloneSprite stack-based action.
+	/** Type identifying a CloneSprite stack-based action. */
 	public static final int CloneSprite = 36;
 
-	// / Type identifying a RemoveSprite stack-based action.
+	/** Type identifying a RemoveSprite stack-based action. */
 	public static final int RemoveSprite = 37;
 
-	// / Type identifying a Trace stack-based action.
+	/** Type identifying a Trace stack-based action. */
 	public static final int Trace = 38;
 
-	// / Type identifying a StartDrag stack-based action.
+	/** Type identifying a StartDrag stack-based action. */
 	public static final int StartDrag = 39;
 
-	// / Type identifying a EndDrag stack-based action.
+	/** Type identifying a EndDrag stack-based action. */
 	public static final int EndDrag = 40;
 
-	// / Type identifying a StringLess stack-based action.
+	/** Type identifying a StringLess stack-based action. */
 	public static final int StringLess = 41;
 
-	// / Type identifying a RandomNumber stack-based action.
+	/** Type identifying a RandomNumber stack-based action. */
 	public static final int RandomNumber = 48;
 
-	// / Type identifying a MBStringLength stack-based action.
+	/** Type identifying a MBStringLength stack-based action. */
 	public static final int MBStringLength = 49;
 
-	// / Type identifying a CharToAscii stack-based action.
+	/** Type identifying a CharToAscii stack-based action. */
 	public static final int CharToAscii = 50;
 
-	// / Type identifying a AsciiToChar stack-based action.
+	/** Type identifying a AsciiToChar stack-based action. */
 	public static final int AsciiToChar = 51;
 
-	// / Type identifying a GetTime stack-based action.
+	/** Type identifying a GetTime stack-based action. */
 	public static final int GetTime = 52;
 
-	// / Type identifying an MBStringExtract stack-based action.
+	/** Type identifying an MBStringExtract stack-based action. */
 	public static final int MBStringExtract = 53;
 
-	// / Type identifying an MBCharToAscii stack-based action.
+	/** Type identifying an MBCharToAscii stack-based action. */
 	public static final int MBCharToAscii = 54;
 
-	// / Type identifying an MBAsciiToChar stack-based action.
+	/** Type identifying an MBAsciiToChar stack-based action. */
 	public static final int MBAsciiToChar = 55;
 
 	// Flash 5
-	// / Type identifying a DeleteVariable stack-based action.
+	/** Type identifying a DeleteVariable stack-based action. */
 	public static final int DeleteVariable = 58;
 
-	// / Type identifying a Delete stack-based action.
+	/** Type identifying a Delete stack-based action. */
 	public static final int Delete = 59;
 
-	// / Type identifying a InitVariable stack-based action.
+	/** Type identifying a InitVariable stack-based action. */
 	public static final int InitVariable = 60;
 
-	// / Type identifying a ExecuteFunction stack-based action.
+	/** Type identifying a ExecuteFunction stack-based action. */
 	public static final int ExecuteFunction = 61;
 
-	// / Type identifying a Return stack-based action.
+	/** Type identifying a Return stack-based action. */
 	public static final int Return = 62;
 
-	// / Type identifying a Modulo stack-based action.
+	/** Type identifying a Modulo stack-based action. */
 	public static final int Modulo = 63;
 
-	// / Type identifying a NamedObject stack-based action.
+	/** Type identifying a NamedObject stack-based action. */
 	public static final int NamedObject = 64;
 
-	// / Type identifying a NewVariable stack-based action.
+	/** Type identifying a NewVariable stack-based action. */
 	public static final int NewVariable = 65;
 
-	// / Type identifying a NewArray stack-based action.
+	/** Type identifying a NewArray stack-based action. */
 	public static final int NewArray = 66;
 
-	// / Type identifying a NewObject stack-based action.
+	/** Type identifying a NewObject stack-based action. */
 	public static final int NewObject = 67;
 
-	// / Type identifying a GetType stack-based action.
+	/** Type identifying a GetType stack-based action. */
 	public static final int GetType = 68;
 
-	// / Type identifying a GetTarget stack-based action.
+	/** Type identifying a GetTarget stack-based action. */
 	public static final int GetTarget = 69;
 
-	// / Type identifying an Enumerate stack-based action.
+	/** Type identifying an Enumerate stack-based action. */
 	public static final int Enumerate = 70;
 
-	// / Type identifying an Add stack-based action.
+	/** Type identifying an Add stack-based action. */
 	public static final int Add = 71;
 
-	// / Type identifying a Less stack-based action.
+	/** Type identifying a Less stack-based action. */
 	public static final int Less = 72;
 
-	// / Type identifying an Equals stack-based action.
+	/** Type identifying an Equals stack-based action. */
 	public static final int Equals = 73;
 
-	// / Type identifying a ToNumber stack-based action.
+	/** Type identifying a ToNumber stack-based action. */
 	public static final int ToNumber = 74;
 
-	// / Type identifying a ToString stack-based action.
+	/** Type identifying a ToString stack-based action. */
 	public static final int ToString = 75;
 
-	// / Type identifying a Duplicate stack-based action.
+	/** Type identifying a Duplicate stack-based action. */
 	public static final int Duplicate = 76;
 
-	// / Type identifying a Swap stack-based action.
+	/** Type identifying a Swap stack-based action. */
 	public static final int Swap = 77;
 
-	// / Type identifying a GetAttribute stack-based action.
+	/** Type identifying a GetAttribute stack-based action. */
 	public static final int GetAttribute = 78;
 
-	// / Type identifying a SetAttribute stack-based action.
+	/** Type identifying a SetAttribute stack-based action. */
 	public static final int SetAttribute = 79;
 
-	// / Type identifying an Increment stack-based action.
+	/** Type identifying an Increment stack-based action. */
 	public static final int Increment = 80;
 
-	// / Type identifying a Decrement stack-based action.
+	/** Type identifying a Decrement stack-based action. */
 	public static final int Decrement = 81;
 
-	// / Type identifying an ExecuteMethod stack-based action.
+	/** Type identifying an ExecuteMethod stack-based action. */
 	public static final int ExecuteMethod = 82;
 
-	// / Type identifying a NewMethod stack-based action.
+	/** Type identifying a NewMethod stack-based action. */
 	public static final int NewMethod = 83;
 
-	// / Type identifying a BitwiseAnd stack-based action.
+	/** Type identifying a BitwiseAnd stack-based action. */
 	public static final int BitwiseAnd = 96;
 
-	// / Type identifying a BitwiseOr stack-based action.
+	/** Type identifying a BitwiseOr stack-based action. */
 	public static final int BitwiseOr = 97;
 
-	// / Type identifying a BitwiseXOr stack-based action.
+	/** Type identifying a BitwiseXOr stack-based action. */
 	public static final int BitwiseXOr = 98;
 
-	// / Type identifying a LogicalShiftLeft stack-based action.
+	/** Type identifying a LogicalShiftLeft stack-based action. */
 	public static final int LogicalShiftLeft = 99;
 
-	// / Type identifying an ArithmeticShiftRight stack-based action.
+	/** Type identifying an ArithmeticShiftRight stack-based action. */
 	public static final int ArithmeticShiftRight = 100;
 
-	// / Type identifying a LogicalShiftRight stack-based action.
+	/** Type identifying a LogicalShiftRight stack-based action. */
 	public static final int LogicalShiftRight = 101;
 
 	// Flash 6
-	// / Type identifying an InstanceOf stack-based action.
+	/** Type identifying an InstanceOf stack-based action. */
 	public static final int InstanceOf = 84;
 
-	// / Type identifying an EnumerateObject stack-based action.
+	/** Type identifying an EnumerateObject stack-based action. */
 	public static final int EnumerateObject = 85;
 
-	// / Type identifying a StrictEquals stack-based action.
+	/** Type identifying a StrictEquals stack-based action. */
 	public static final int StrictEquals = 102;
 
-	// / Type identifying a Greater stack-based action.
+	/** Type identifying a Greater stack-based action. */
 	public static final int Greater = 103;
 
-	// / Type identifying a StringGreater stack-based action.
+	/** Type identifying a StringGreater stack-based action. */
 	public static final int StringGreater = 104;
 
 	// Flash 7
-	// / Type identifying a Throw stack-based action.
+	/** Type identifying a Throw stack-based action. */
 	public static final int Throw = 42;
 
-	// / Type identifying a Cast stack-based action.
+	/** Type identifying a Cast stack-based action. */
 	public static final int Cast = 43;
 
-	// / Type identifying an Implements stack-based action.
+	/** Type identifying an Implements stack-based action. */
 	public static final int Implements = 44;
 
-	// / Type identifying an Extends stack-based action.
+	/** Type identifying an Extends stack-based action. */
 	public static final int Extends = 105;
 
 	/** Type identifying a GotoFrame action. */
@@ -307,61 +310,63 @@
 	public static final int GetUrl = 131;
 
 	// Flash 3
-	// / Type identifying a WaitForFrame action.
+	/** Type identifying a WaitForFrame action. */
 	public static final int WaitForFrame = 138;
 
-	// / Type identifying a SetTarget action.
+	/** Type identifying a SetTarget action. */
 	public static final int SetTarget = 139;
 
-	// / Type identifying a GotoLabel action.
+	/** Type identifying a GotoLabel action. */
 	public static final int GotoLabel = 140;
 
 	// Flash 4
-	// / Type identifying a WaitForFrame2 action.
+	/** Type identifying a WaitForFrame2 action. */
 	public static final int WaitForFrame2 = 141;
 
-	// / Type identifying a Push action.
+	/** Type identifying a Push action. */
 	public static final int Push = 150;
 
-	// / Type identifying a Jump action.
+	/** Type identifying a Jump action. */
 	public static final int Jump = 153;
 
-	// / Type identifying a GetUrl2 action.
+	/** Type identifying a GetUrl2 action. */
 	public static final int GetUrl2 = 154;
 
-	// / Type identifying an If action.
+	/** Type identifying an If action. */
 	public static final int If = 157;
 
-	// / Type identifying a Call action.
+	/** Type identifying a Call action. */
 	public static final int Call = 158;
 
-	// / Type identifying a GotoFrame2 action.
+	/** Type identifying a GotoFrame2 action. */
 	public static final int GotoFrame2 = 159;
 
 	// Flash 5
-	// / Type identifying a RegisterCopy action.
+	/** Type identifying a RegisterCopy action. */
 	public static final int RegisterCopy = 135;
 
-	// / Type identifying a Table action.
+	/** Type identifying a Table action. */
 	public static final int Table = 136;
 
-	// / Type identifying a With action.
+	/** Type identifying a With action. */
 	public static final int With = 148;
 
-	// / Type identifying a NewFunction action.
+	/** Type identifying a NewFunction action. */
 	public static final int NewFunction = 155;
 
 	// Flash 7
-	// / Type identifying a NewFunction2 action.
+	/** Type identifying a NewFunction2 action. */
 	public static final int NewFunction2 = 142;
 
-	// / Type identifying a ExceptionHandler action.
+	/** Type identifying a ExceptionHandler action. */
 	public static final int ExceptionHandler = 143;
 
 	static String[] name =
 	{
 		&quot;End&quot;, // 0
-		&quot;&quot;, &quot;&quot;, &quot;&quot;,
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;,
 		&quot;NextFrame&quot;, // 4;
 		&quot;PrevFrame&quot;, // 5;
 		&quot;Play&quot;, // 6;
@@ -380,13 +385,16 @@
 		&quot;StringEquals&quot;, // 19;
 		&quot;StringLength&quot;, // 20;
 		&quot;StringExtract&quot;, // 21;
-		&quot;&quot;,
+		&quot;Unknown&quot;,
 		&quot;Pop&quot;, // 23;
 		&quot;ToInteger&quot;, // 24;
-		&quot;&quot;, &quot;&quot;, &quot;&quot;,
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;,
 		&quot;GetVariable&quot;, // 28;
 		&quot;SetVariable&quot;, // 29;
-		&quot;&quot;, &quot;&quot;,
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;,
 		&quot;SetTarget2&quot;, // 32;
 		&quot;StringAdd&quot;, // 33;
 		&quot;GetProperty&quot;, // 34;
@@ -400,7 +408,9 @@
 		&quot;Throw&quot;, // 42;
 		&quot;Cast&quot;, // 43;
 		&quot;Implements&quot;, // 44;
-		&quot;&quot;, &quot;&quot;, &quot;&quot;,
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;,
 		&quot;RandomNumber&quot;, // 48;
 		&quot;MBStringLength&quot;, // 49;
 		&quot;CharToAscii&quot;, // 50;
@@ -409,7 +419,8 @@
 		&quot;MBStringExtract&quot;, // 53;
 		&quot;MBCharToAscii&quot;, // 54;
 		&quot;MBAsciiToChar&quot;, // 55;
-		&quot;&quot;, &quot;&quot;,
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;,
 		&quot;DeleteVariable&quot;, // 58;
 		&quot;Delete&quot;, // 59;
 		&quot;InitVariable&quot;, // 60;
@@ -438,7 +449,16 @@
 		&quot;NewMethod&quot;, // 83;
 		&quot;InstanceOf&quot;, // 84;
 		&quot;EnumerateObject&quot;, // 85;
-		&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;,
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;,
 		&quot;BitwiseAnd&quot;, // 96;
 		&quot;BitwiseOr&quot;, // 97;
 		&quot;BitwiseXOr&quot;, // 98;
@@ -449,49 +469,222 @@
 		&quot;Greater&quot;, // 103;
 		&quot;StringGreater&quot;, // 104;
 		&quot;Extends&quot;, // 105;
-		&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;,
-		&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, // 127
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;,
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, 
+		&quot;Unknown&quot;, // 127
 	};
 
-	static FSActionObject decodeAction(FSCoder coder, FSContext context)
+	/**
+	 * Create a copy of an array of actions.
+	 * 
+	 * Use this method if you are writing a plug-in class that contains an array
+	 * of actions.
+	 * 
+	 * @param array the array to be copied.
+	 * @return a copy of the array.
+	 */
+	public static ArrayList&lt;FSActionObject&gt; copy(ArrayList&lt;FSActionObject&gt; array)
 	{
-		FSActionObject anAction = null;
+		if (array == null) {
+			return null;
+		}
+		
+		ArrayList&lt;FSActionObject&gt; copy = new ArrayList&lt;FSActionObject&gt;(array.size());
 
-		int objStart = coder.getPointer();
-		int type = coder.scanWord(1, false);
+		for (Iterator&lt;FSActionObject&gt; i = array.iterator(); i.hasNext();)
+			copy.add((FSActionObject) i.next().clone());
+
+		return copy;
+	}
+	
+	/**
+	 * Calculate the length an array of actions when encoded to their binary 
+	 * format.
+	 * 
+	 * Use this method if you are writing a plug-in class that contains an array
+	 * of actions.
+	 *  
+	 * @param context the context created by the parent movie and passed to 
+	 * your plug-in class.
+	 * 
+	 * @param array an array of actions.
+	 * 
+	 * @return the length in bytes of the encoded binary data.
+	 */
+	public static int length(FSContext context, ArrayList&lt;FSActionObject&gt; array)
+	{
+		if (array == null) {
+			return 0;
+		}
+		
+		FSActionObject action = null;
 		int length = 0;
-		int start = coder.getPointer() + 8;
-		int next = start;
+		
+		for (Iterator&lt;FSActionObject&gt; i=array.iterator(); i.hasNext();)
+		{
+			action = i.next();
 
-		if (type &gt; 128)
+			length += action.length(context);
+			length += (action.type &gt; 128) ? 3 : 1;
+		}
+
+		if (array.size() == 0 || action.getType() != FSAction.End) {
+			length += 1;
+		}
+
+		return length;
+	}
+
+	/**
+	 * Encode an array of actions.
+	 * 
+	 * If an error occurs while encoding it will be recored in the context. When
+	 * control returns to the parent movie an exception will be thrown. Note that
+	 * encoding continues when an error occurs. If possible an encoded flash file
+	 * will be generated to simplify debugging.
+	 * 
+	 * Use this method if you are writing a plug-in class that contains an array
+	 * of actions.
+	 *  
+	 * @param coder the FSCoder where the binary representation of the actions 
+	 * will be written.
+	 * 
+	 * @param context the context created by the parent movie and passed to 
+	 * your plug-in class.
+	 * 
+	 * @param array the array of actions to encode.
+	 */
+	public static void encode(FSCoder coder, FSContext context, ArrayList&lt;FSActionObject&gt; array)
+	{
+		if (array == null) {
+			return;
+		}
+
+		FSActionObject action = null;
+		int start;
+		int next;
+		int delta;
+
+		for (Iterator&lt;FSActionObject&gt; i = array.iterator(); i.hasNext();)
 		{
-			coder.adjustPointer(8);
-			length = coder.scanWord(2, false);
-			start = coder.getPointer() + 16;
-			next = start + (length &lt;&lt; 3);
-			coder.adjustPointer(-8);
+			action = i.next();
+
+			start = coder.getPointer();
+			next = start + (action.type &gt; 128 ? 24 : 8);
+			next = next + (action.length &lt;&lt; 3);
+
+			action.encode(coder, context);
+
+			delta = (coder.getPointer() - next) &gt;&gt; 3;
+
+			if (delta != 0)
+			{
+				context.codingError = true;
+				context.typeInError = action.getType();
+				context.startOfError = start &gt;&gt;&gt; 3;
+				context.expectedLength = (next - start) &gt;&gt;&gt; 3;
+				context.delta = delta;
+			}
+			coder.setPointer(next);
 		}
+		
+		if (array.size() == 0 || action.type != FSAction.End) {
+			coder.writeWord(0, 1);
+		}
+	}
 
+	/**
+	 * Encode an action.
+	 * 
+	 * If an error occurs while encoding it will be recored in the context. When
+	 * control returns to the parent movie an exception will be thrown. Note that
+	 * encoding continues when an error occurs. If possible an encoded flash file
+	 * will be generated to simplify debugging.
+	 * 
+	 * @param coder the FSCoder where the binary representation of the actions 
+	 * will be written.
+	 * 
+	 * @param context the context created by the parent movie and passed to 
+	 * your plug-in class.
+	 * 
+	 * @param an action to encode.
+	 */
+	public static void encode(FSCoder coder, FSContext context, FSActionObject action)
+	{
+		int start = coder.getPointer();
+		int next = start + (action.type &gt; 128 ? 24 : 8);
+		next = next + (action.length &lt;&lt; 3);
+
+		action.encode(coder, context);
+
+		int delta = (coder.getPointer() - next) &gt;&gt; 3;
+
+		if (delta != 0)
+		{
+			context.codingError = true;
+			context.typeInError = action.getType();
+			context.startOfError = start &gt;&gt;&gt; 3;
+			context.expectedLength = (next - start) &gt;&gt;&gt; 3;
+			context.delta = delta;
+		}
+	}
+
+	/**
+	 * Decode an action.
+	 * 
+	 * If an error occurs while encoding it will be recored in the context. When
+	 * control returns to the parent movie an exception will be thrown.
+	 * 
+	 * @param coder the FSCoder where the binary representation of the actions 
+	 * will be written.
+	 * 
+	 * @param context the context created by the parent movie and passed to 
+	 * your plug-in class.
+	 * 
+	 * @param the action object.
+	 */
+	public static FSActionObject decodeAction(FSCoder coder, FSContext context)
+	{
+		int type = coder.readByte();
+		
+		if (type &lt; 128) {
+			return FSAction.getInstance(type);
+		}
+		
+		FSActionObject anAction;
+		
+		int start = coder.getPointer() - 8;
+		int length = coder.readWord(2, false);
+		int next = coder.getPointer() + (length &lt;&lt; 3);
+		coder.adjustPointer(-24);
+
 		switch (type)
 		{
-			case FSAction.End:
-			case FSAction.NextFrame:
-			case FSAction.PrevFrame:
-			case FSAction.Play:
-			case FSAction.Stop:
-			case FSAction.ToggleQuality:
-			case FSAction.StopSounds:
-				anAction = FSAction.getInstance(type);
-				coder.adjustPointer(8);
-				break;
 			case FSActionObject.GetUrl:
 				anAction = new FSGetUrl(coder, context);
 				break;
-			// Flash 3
 			case FSActionObject.GotoFrame:
 				anAction = new FSGotoFrame(coder, context);
 				break;
-			// Flash 4
 			case FSActionObject.GotoLabel:
 				anAction = new FSGotoLabel(coder, context);
 				break;
@@ -501,43 +694,6 @@
 			case FSActionObject.WaitForFrame:
 				anAction = new FSWaitForFrame(coder, context);
 				break;
-			case FSAction.IntegerAdd:
-			case FSAction.Subtract:
-			case FSAction.IntegerEquals:
-			case FSAction.IntegerLess:
-			case FSAction.Multiply:
-			case FSAction.Divide:
-			case FSAction.And:
-			case FSAction.Or:
-			case FSAction.Not:
-			case FSAction.StringEquals:
-			case FSAction.StringLength:
-			case FSAction.StringExtract:
-			case FSAction.Pop:
-			case FSAction.ToInteger:
-			case FSAction.GetVariable:
-			case FSAction.SetVariable:
-			case FSAction.SetTarget2:
-			case FSAction.StringAdd:
-			case FSAction.GetProperty:
-			case FSAction.SetProperty:
-			case FSAction.CloneSprite:
-			case FSAction.RemoveSprite:
-			case FSAction.Trace:
-			case FSAction.StartDrag:
-			case FSAction.EndDrag:
-			case FSAction.StringLess:
-			case FSAction.RandomNumber:
-			case FSAction.MBStringLength:
-			case FSAction.CharToAscii:
-			case FSAction.AsciiToChar:
-			case FSAction.GetTime:
-			case FSAction.MBStringExtract:
-			case FSAction.MBCharToAscii:
-			case FSAction.MBAsciiToChar:
-				anAction = FSAction.getInstance(type);
-				coder.adjustPointer(8);
-				break;
 			case FSActionObject.Call:
 				anAction = FSCall.getInstance();
 				coder.setPointer(next);
@@ -560,42 +716,6 @@
 			case FSActionObject.GotoFrame2:
 				anAction = new FSGotoFrame2(coder, context);
 				break;
-			// Flash 5
-			case FSAction.Add:
-			case FSAction.Equals:
-			case FSAction.Less:
-			case FSAction.Modulo:
-			case FSAction.Enumerate:
-			case FSAction.Duplicate:
-			case FSAction.Swap:
-			case FSAction.ExecuteMethod:
-			case FSAction.NewMethod:
-			case FSAction.ExecuteFunction:
-			case FSAction.GetAttribute:
-			case FSAction.SetAttribute:
-			case FSAction.Increment:
-			case FSAction.Decrement:
-			case FSAction.LogicalShiftLeft:
-			case FSAction.LogicalShiftRight:
-			case FSAction.ArithmeticShiftRight:
-			case FSAction.BitwiseAnd:
-			case FSAction.BitwiseOr:
-			case FSAction.BitwiseXOr:
-			case FSAction.NamedObject:
-			case FSAction.NewArray:
-			case FSAction.NewObject:
-			case FSAction.DeleteVariable:
-			case FSAction.Delete:
-			case FSAction.Return:
-			case FSAction.ToNumber:
-			case FSAction.ToString:
-			case FSAction.GetType:
-			case FSAction.GetTarget:
-			case FSAction.NewVariable:
-			case FSAction.InitVariable:
-				anAction = FSAction.getInstance(type);
-				coder.adjustPointer(8);
-				break;
 			case FSActionObject.Table:
 				anAction = new FSTable(coder, context);
 				length = anAction.length;
@@ -614,23 +734,6 @@
 				length = anAction.length;
 				next = start + (length &lt;&lt; 3);
 				break;
-			// Flash 6
-			case FSAction.InstanceOf:
-			case FSAction.EnumerateObject:
-			case FSAction.Greater:
-			case FSAction.StringGreater:
-			case FSAction.StrictEquals:
-				anAction = FSAction.getInstance(type);
-				coder.adjustPointer(8);
-				break;
-			// Flash 7
-			case FSAction.Cast:
-			case FSAction.Extends:
-			case FSAction.Implements:
-			case FSAction.Throw:
-				anAction = FSAction.getInstance(type);
-				coder.adjustPointer(8);
-				break;
 			case FSActionObject.ExceptionHandler:
 				anAction = new FSExceptionHandler(coder, context);
 				break;
@@ -640,22 +743,22 @@
 				next = start + (length &lt;&lt; 3);
 				break;
 			default:
-				Integer key = new Integer(type);
-
-				if (table.containsKey(key))
+				if (table.containsKey(type))
 				{
 					try
 					{
-						Class&lt;FSActionObject&gt; obj = table.get(key);
+						Class&lt;FSActionObject&gt; obj = table.get(type);
 						anAction = (FSActionObject) obj.newInstance();
 						anAction.decode(coder, context);
 						length = anAction.length;
-						next = start + (length &lt;&lt; 3);
-					} catch (Exception e)
+						next = start + 24 + (length &lt;&lt; 3);
+					} 
+					catch (Exception e)
 					{
 						anAction = new FSUnknownAction(coder, context);
 					}
-				} else
+				} 
+				else
 				{
 					anAction = new FSUnknownAction(coder, context);
 				}
@@ -667,9 +770,9 @@
 		if (delta != 0)
 		{
 			context.codingError = true;
-			context.typeInError = anAction.getType();
-			context.startOfError = objStart &gt;&gt;&gt; 3;
-			context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
+			context.typeInError = type;
+			context.startOfError = start &gt;&gt;&gt; 3;
+			context.expectedLength = length+3;
 			context.delta = delta;
 		}
 
@@ -677,19 +780,27 @@
 
 		return anAction;
 	}
-
-	static ArrayList&lt;FSActionObject&gt; decodeActions(byte[] encodedActions)
+	
+	/**
+	 * Decode an array of actions with a pre-defined length. 
+	 * 
+	 * The length is specified rather than waiting until an End action is decoded
+	 * as some Flash files contain End actions embedded in the middle of the 
+	 * sequence - possibly as a means of obfuscation.
+	 * 
+	 * Use this method if you are writing a plug-in class that contains an array
+	 * of actions.
+	 *  
+	 * @param coder the FSCoder where the binary representation of the actions 
+	 * will be written.
+	 * 
+	 * @param context the context created by the parent movie and passed to 
+	 * your plug-in class.
+	 * 
+	 * @param length the number of bytes to decode.
+	 */
+	public static ArrayList&lt;FSActionObject&gt; decodeActions(FSCoder coder, FSContext context, int length)
 	{
-		FSCoder coder = new FSCoder(FSCoder.LITTLE_ENDIAN, encodedActions);
-		FSContext context = new FSContext();
-		
-		int length = encodedActions.length;
-
-		return decodeActions(coder, context, length);
-	}
-
-	static ArrayList&lt;FSActionObject&gt; decodeActions(FSCoder coder, FSContext context, int length)
-	{
 		ArrayList&lt;FSActionObject&gt; array = new ArrayList&lt;FSActionObject&gt;();
 		int start;
 
@@ -702,74 +813,29 @@
 		return array;
 	}
 
-	static void encode(FSCoder coder, FSContext context, ArrayList&lt;FSActionObject&gt; array)
+	/**
+	 * Decode an array of actions.
+	 * 
+	 * This method is used to implement lazy-decoding of arrays of actions. When
+	 * the parent object is decoded the actions are left as binary data. If an
+	 * attempt is made to access the actions array then the binary data is 
+	 * decoded.
+	 * 
+	 * Use this method if you are writing a plug-in class and want to implement
+	 * lazy-decoding of actions. See FSDoAction for more information.
+	 * 
+	 * @param data the encoded actions.
+	 * 
+	 * @return an array containing the decoded action objects.
+	 */
+	public static ArrayList&lt;FSActionObject&gt; decodeActions(byte[] data)
 	{
-		if (array != null)
-		{
-			FSActionObject action;
-			int start;
-			int next;
-			int delta;
-
-			for (Iterator&lt;FSActionObject&gt; i = array.iterator(); i.hasNext();)
-			{
-				action = i.next();
-
-				start = coder.getPointer();
-				next = start + ((action.getType() &gt; 128) ? 24 : 8);
-				next = next + (action.getLength() &lt;&lt; 3);
-
-				action.encode(coder, context);
-
-				delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-				if (delta != 0)
-				{
-					context.codingError = true;
-					context.typeInError = action.getType();
-					context.startOfError = start &gt;&gt;&gt; 3;
-					context.expectedLength = (next - start) &gt;&gt;&gt; 3;
-					context.delta = delta;
-				}
-				coder.setPointer(next);
-			}
-		}
+		return decodeActions(new FSCoder(data), new FSContext(), data.length);
 	}
 
-	static ArrayList&lt;FSActionObject&gt; copy(ArrayList&lt;FSActionObject&gt; array)
-	{
-		ArrayList&lt;FSActionObject&gt; copy = null;
+	private static HashMap&lt;Integer, Class&lt;FSActionObject&gt;&gt; table = 
+		new HashMap&lt;Integer, Class&lt;FSActionObject&gt;&gt;();
 
-		if (array != null)
-		{
-			copy = new ArrayList&lt;FSActionObject&gt;(array.size());
-
-			for (Iterator&lt;FSActionObject&gt; i = array.iterator(); i.hasNext();)
-				copy.add((FSActionObject) i.next().clone());
-		}
-		return copy;
-	}
-
-	static int length(ArrayList&lt;FSActionObject&gt; array)
-	{
-		int length = 0;
-		FSActionObject action;
-
-		if (array != null)
-		{
-			for (Iterator&lt;FSActionObject&gt; i = array.iterator(); i.hasNext();)
-			{
-				action = i.next();
-
-				length += action.getLength();
-				length += (action.getType() &gt; 128) ? 3 : 1;
-			}
-		}
-		return length;
-	}
-
-	private static HashMap&lt;Integer, Class&lt;FSActionObject&gt;&gt; table = new HashMap&lt;Integer, Class&lt;FSActionObject&gt;&gt;();
-
 	/**
 	 * This method allows you to extend the Transform framework by adding new
 	 * classes to decode the actions that are not currently supported.
@@ -777,7 +843,8 @@
 	 * To add support for a new action simply sub-class FSActionObject and
 	 * implement the following methods:
 	 * 
-	 * public int length(FSContext context) public void encode(FSCoder coder, FSContext context) public
+	 * public int length(FSContext context) 
+	 * public void encode(FSCoder coder, FSContext context) public
 	 * void decode(FSCoder coder, FSContext context)
 	 * 
 	 * In addition you must implement the nullary or empty constructor so that
@@ -789,7 +856,7 @@
 	 * be decoded by calling the decode() method.
 	 * 
 	 * If no object has been registered then the data structure will be decoded
-	 * as an FSBinaryAction.
+	 * as an FSUnknownAction.
 	 * 
 	 * @param type
 	 *            the type used to identify the type of action encoded in the
@@ -805,7 +872,6 @@
 	}
 
 	protected int type;
-
 	protected int length;
 
 	protected FSActionObject(int aType)
@@ -813,12 +879,6 @@
 		type = aType;
 	}
 
-	protected FSActionObject(FSActionObject obj)
-	{
-		type = obj.type;
-		length = obj.length;
-	}
-
 	/**
 	 * Gets the code used that identifies the type of the action when it is
 	 * encoded.
@@ -831,22 +891,6 @@
 	}
 
 	/**
-	 * Length is used to calculate the then of the action when it is encoded to
-	 * the binary Flash file format. This method can be used to calculate the
-	 * size of offsets and jumps for FSIf and FSJump actions.
-	 * 
-	 * @return the length of the encoded action in bytes.
-	 */
-	public int getLength()
-	{
-		int encodedLength = (type &gt; 128) ? 3 : 1;
-
-		encodedLength += length(new FSContext());
-
-		return encodedLength;
-	}
-
-	/**
 	 * Creates a deep copy of the entire object.
 	 * 
 	 * @return a copy of the object.
@@ -872,6 +916,7 @@
 	 * 
 	 * @param obj
 	 *            the reference object with which to compare.
+
 	 * @return true if this object would be identical to anObject when encoded.
 	 */
 	public boolean equals(Object obj)

Modified: dev/dev-2-4/src/com/flagstone/transform/FSAudioData.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSAudioData.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSAudioData.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -48,7 +48,7 @@
  * 
  * &lt;tr&gt;
  * &lt;td&gt;format&lt;/td&gt;
- * &lt;td&gt;The format of the sound data - PCM, ADPCM, MP3, NATIVE_PCM or
+ * &lt;td&gt;The format of the sound data - NATIVE_PCM, ADPCM, MP3, NELLYMOSER_8K or
  * NELLYMOSER.&lt;/td&gt;
  * &lt;/tr&gt;
  * 
@@ -84,19 +84,19 @@
  * big-endian byte order will not be played correctly when listened to on a
  * platform which supports little-endian byte order.&lt;/li&gt;
  * 
- * &lt;li&gt;PCM - uncompressed Pulse Code Modulated: samples are either 1 or 2 bytes
- * with the latter presented in Little-Endian byte order. This ensures that
- * sounds can be played across different platforms.&lt;/li&gt;
- * 
  * &lt;li&gt;ADPCM - compressed ADaptive Pulse Code Modulated: samples are encoded
  * and compressed by comparing the difference between successive sound sample
  * which dramatically reduces the size of the encoded sound when compared to the
- * uncompressed PCM formats. Use this format whenever possible.&lt;/li&gt;
+ * uncompressed PCM formats. Use this format or MP3 whenever possible.&lt;/li&gt;
  * 
  * &lt;li&gt;MP3 - compressed MPEG Audio Layer-3.&lt;/li&gt;
  * 
+ * &lt;li&gt;NELLYMOSER_8K - compressed Nellymoser Asao format at 8KHz supporting low 
+ * bit-rate sound for improved synchronisation between the sound and frame rate of
+ * movies. This format is not supported in SWF files.&lt;/li&gt;
+ * 
  * &lt;li&gt;NELLYMOSER - compressed Nellymoser Asao format supporting low bit-rate
- * sound for improving synchronisation between the sound and frame rate of
+ * sound for improved synchronisation between the sound and frame rate of
  * movies.&lt;/li&gt;
  * &lt;/ul&gt;
  * 
@@ -114,8 +114,15 @@
 	private int playbackRate;
 	private int playbackChannels;
 	private int playbackSampleSize;
-	private byte[] soundData;
+	private byte[] data;
 
+	/**
+	 * Construct an FSAudioData object and initialise it from encoded data.
+	 * 
+	 * @param coder
+	 *            an FSCoder object containing an FSAudioData encoded as binary
+	 *            data.
+	 */
 	public FSAudioData(FSCoder coder, FSContext context)
 	{
 		super(FSVideoObject.AudioData, 0);
@@ -131,7 +138,7 @@
 	 *            will be played..
 	 * @param aFormat
 	 *            the encoding format for the sound, either FSSound.NATIVE_PCM,
-	 *            FSSound.PCM, FSSound.ADPCM, FSSound.MP3 or FSSound.NELLYMOSER.
+	 *            FSSound.ADPCM, FSSound.MP3, FSSound.NELLYMOSER_8K or FSSound.NELLYMOSER.
 	 * @param rate
 	 *            the number of samples per second that the sound is played at,
 	 *            either 5512, 11025, 22050 or 44100.
@@ -139,10 +146,15 @@
 	 *            the number of channels in the sound, either 1 (Mono) or 2
 	 *            (Stereo).
 	 * @param sampleSize
-	 *            the size of an uncompressed sound sample in bits, either 8 or
-	 *            16.
+	 *            the size of an uncompressed sound sample in bytes, either 1 or
+	 *            2.
 	 * @param bytes
 	 *            the sound data.
+	 * 
+	 * @throws IllegalArgumentException if the play back rate is not either 5512, 11025, 22050 or 44100.
+	 * @throws IllegalArgumentException if the number of channels is not 1 or 2.
+	 * @throws IllegalArgumentexception if the sample size is not either 8 or 16.
+	 * @throws NullPointerException if the sound data is null.
 	 */
 	public FSAudioData(int timestamp, int aFormat, int rate, int channels, int sampleSize, byte[] bytes)
 	{
@@ -155,8 +167,8 @@
 	}
 
 	/**
-	 * Gets the compression format used, either FSSound.NATIVE_PCM, FSSound.PCM,
-	 * FSSound.ADPCM, FSSound.MP3 or FSSound.NELLYMOSER.
+	 * Gets the compression format used, either FSSound.NATIVE_PCM, FSSound.ADPCM, 
+	 * FSSound.MP3, FSSound.NELLYMOSER_8K or FSSound.NELLYMOSER.
 	 * 
 	 * @return a constant defining the type of compression.
 	 */
@@ -166,8 +178,8 @@
 	}
 
 	/**
-	 * Sets the encoding format used, either FSSound.NATIVE_PCM, FSSound.PCM,
-	 * FSSound.ADPCM, FSSound.MP3 or FSSound.NELLYMOSER.
+	 * Sets the encoding format used, either FSSound.NATIVE_PCM, FSSound.ADPCM,
+	 * FSSound.MP3, FSSound.NELLYMOSER_8K or FSSound.NELLYMOSER.
 	 * 
 	 * @param encoding
 	 *            the format for the sound.
@@ -179,7 +191,7 @@
 
 	/**
 	 * Gets the rate at which the sound will be played, in Hertz: 5512, 11025,
-	 * 22050 or 44100. Note that the playback rate for Nellymoser encoded audio
+	 * 22050 or 44100. Note that the playback rate for NELLYMOSER_8K encoded audio
 	 * is fixed at 8Khz so the playback rate attribute has no effect.
 	 * 
 	 * @return the rate at which the sound was sampled.
@@ -195,14 +207,21 @@
 	 * 
 	 * @param rate
 	 *            the rate at which the sounds is played in Hz.
+	 *           
+	 * @throws IllegalArgumentException if the play back rate is not either 5512, 11025, 22050 or 44100.
 	 */
 	public void setPlaybackRate(int rate)
 	{
+		if (rate != 5512 &amp;&amp; rate != 11025 &amp;&amp; rate != 22050 &amp;&amp; rate != 44100) {
+			throw new IllegalArgumentException(&quot;Playback rate must be one of: 5512, 11025, 22050 or 44100 Hertz.&quot;);
+		}
 		playbackRate = rate;
 	}
 
 	/**
-	 * Gets the number of sound channels, 1 (Mono) or 2 (Stereo).
+	 * Gets the number of sound channels, 1 (Mono) or 2 (Stereo). Both 
+	 * NELLYMOSER_8K and NELLYMOSER are encoded as mono so the playbackChannels
+	 * attribute has no effect.
 	 * 
 	 * @return the number of channels.
 	 */
@@ -217,9 +236,14 @@
 	 * @param channels
 	 *            the number of channels in the sound, either 1 (Mono) or 2
 	 *            (Stereo).
+	 *           
+	 * @throws IllegalArgumentException if the number of channels is not 1 or 2.
 	 */
 	public void setPlaybackChannels(int channels)
 	{
+		if (channels &lt; 1 || channels &gt; 2) {
+			throw new IllegalArgumentException(&quot;Number of channels must be 1 or 2.&quot;);
+		}
 		playbackChannels = channels;
 	}
 
@@ -238,9 +262,14 @@
 	 * 
 	 * @param sampleSize
 	 *            the size of sound samples in bytes.
+	 *           
+	 * @throws IllegalArgumentexception if the sample size is not either 1 or 2.
 	 */
 	public void setPlaybackSampleSize(int sampleSize)
 	{
+		if (sampleSize &lt; 1 || sampleSize &gt; 2) {
+			throw new IllegalArgumentException(&quot;Sample size must be 1 or 2 bytes.&quot;);
+		}
 		playbackSampleSize = sampleSize;
 	}
 
@@ -251,7 +280,7 @@
 	 */
 	public byte[] getSoundData()
 	{
-		return soundData;
+		return data;
 	}
 
 	/**
@@ -260,26 +289,21 @@
 	 * @param bytes
 	 *            the sound data.
 	 * 
-	 * @throws NullPointerException if the argument is null.
+	 * @throws NullPointerException if the sound data is null.
 	 */
 	public void setSoundData(byte[] bytes)
 	{
 		if (bytes == null) {
 			throw new NullPointerException(&quot;Sound data cannot be null&quot;);
 		}
-		soundData = bytes;
+		data = bytes;
 	}
 
 	public Object clone()
 	{
 		FSAudioData obj = (FSAudioData)super.clone();
-
-		obj.soundData = new byte[soundData.length];
+		obj.data = copy(data);
 		
-		for (int i=0; i&lt;soundData.length; i++) {
-			obj.soundData[i] = soundData[i];
-		}
-
 		return obj;
 	}
 
@@ -289,19 +313,13 @@
 
 		if (super.equals(anObject))
 		{
-			FSAudioData typedObject = (FSAudioData) anObject;
+			FSAudioData audio = (FSAudioData) anObject;
 
-			result = format == typedObject.format;
-			result = result &amp;&amp; playbackRate == typedObject.playbackRate;
-			result = result &amp;&amp; playbackChannels == typedObject.playbackChannels;
-			result = result &amp;&amp; playbackSampleSize == typedObject.playbackSampleSize;
-			
-			result = result &amp;&amp; soundData.length == typedObject.soundData.length;
-
-			if (result)
-				for (int i=0; i&lt;soundData.length; i++)
-					if (soundData[i] != typedObject.soundData[i])
-						result = false;
+			result = format == audio.format;
+			result = result &amp;&amp; playbackRate == audio.playbackRate;
+			result = result &amp;&amp; playbackChannels == audio.playbackChannels;
+			result = result &amp;&amp; playbackSampleSize == audio.playbackSampleSize;
+			result = result &amp;&amp; equals(data, audio.data);
 		}
 		return result;
 	}
@@ -316,7 +334,7 @@
 		buffer.append(&quot;playbackRate = &quot;).append(playbackRate).append(&quot;; &quot;);
 		buffer.append(&quot;playbackChannels = &quot;).append(playbackChannels).append(&quot;; &quot;);
 		buffer.append(&quot;playbackSampleSize = &quot;).append(playbackSampleSize).append(&quot;; &quot;);
-		buffer.append(&quot;}&quot;);
+		buffer.append(&quot;data = &lt;data&gt;; }&quot;);
 		
 		return buffer.toString();
 	}
@@ -325,7 +343,7 @@
 	{
 		super.length(context);
 
-		length += 1 + soundData.length;
+		length += 1 + data.length;
 
 		return length;
 	}
@@ -353,7 +371,7 @@
 		}
 		coder.writeBits(playbackSampleSize - 1, 1);
 		coder.writeBits(playbackChannels - 1, 1);
-		coder.writeBytes(soundData);
+		coder.writeBytes(data);
 	}
 
 	public void decode(FSCoder coder, FSContext context)
@@ -380,7 +398,7 @@
 
 		playbackSampleSize = coder.readBits(1, false) + 1;
 		playbackChannels = coder.readBits(1, false) + 1;
-		soundData = new byte[length - 1];
-		coder.readBytes(soundData);
+		data = new byte[length - 1];
+		coder.readBytes(data);
 	}
 }
\ No newline at end of file

Modified: dev/dev-2-4/src/com/flagstone/transform/FSBitmapFill.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSBitmapFill.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSBitmapFill.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -158,7 +158,7 @@
 
 	/**
 	 * Construct an FSBitmapFill object an initialise it with values decoded
-	 * from an encoded FSBitmapFill object.
+	 * from binary data.
 	 * 
 	 * @param coder
 	 *            an FSCoder object containing an FSBitmapFill encoded as binary
@@ -187,6 +187,9 @@
 	 * @param aTransform
 	 *            an FSCoordTransform object that changes the appearance of the
 	 *            image.
+	 *            
+	 * @throws IllegalArgumentException if the argument is not in the range 1..65535.          
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public FSBitmapFill(int aType, int anIdentifier, FSCoordTransform aTransform)
 	{
@@ -254,7 +257,7 @@
 	 *            an FSCoordTransform object that changes the appearance and
 	 *            location of the image inside the shape.
 	 *          
-	 * @throws NullPointerException if the argument is null.
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public void setTransform(FSCoordTransform aTransform)
 	{
@@ -302,16 +305,13 @@
 	public int length(FSContext context)
 	{
 		int length = super.length(context);
-
 		length += 2 + transform.length(context);
-
 		return length;
 	}
 
 	public void encode(FSCoder coder, FSContext context)
 	{
 		super.encode(coder, context);
-
 		coder.writeWord(identifier, 2);
 		transform.encode(coder, context);
 	}
@@ -319,7 +319,6 @@
 	public void decode(FSCoder coder, FSContext context)
 	{
 		super.decode(coder, context);
-
 		identifier = coder.readWord(2, false);
 		transform = new FSCoordTransform(coder, context);
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSBounds.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSBounds.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSBounds.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -415,7 +415,7 @@
 	public int length(FSContext context)
 	{
 		size = FSCoder.size(new int[] {minX, maxX, minY, maxY }, true);
-		return ((5+size&lt;&lt;2)+7) &gt;&gt; 3;
+		return ((5+size&lt;&lt;2)+7) &gt;&gt; 3; // add 7 so result is byte aligned.
 	}
 
 	public void encode(FSCoder coder, FSContext context)

Modified: dev/dev-2-4/src/com/flagstone/transform/FSButton.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSButton.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSButton.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -132,10 +132,14 @@
  */
 public class FSButton implements Cloneable, Codeable
 {
-	/** Code for the button in the up state. */
+	/** 
+	 * Code for the button in the up state. 
+	 */
 	public static final int Up = 1;
 
-	/** Code for the state of the button when the mouse is over the active area. */
+	/** 
+	 * Code for the state of the button when the mouse is over the active area. 
+	 */
 	public static final int Over = 2;
 
 	/**
@@ -144,21 +148,19 @@
 	 */
 	public static final int Down = 4;
 
-	/** Code for the active area of the button. */
+	/** 
+	 * Code for the active area of the button. 
+	 */
 	public static final int Active = 8;
 
-	private int state = 0;
+	private int state;
+	private int identifier;
+	private int layer;
+	private FSCoordTransform transform;
+	private FSColorTransform colorTransform;
 
-	private int identifier = 0;
-
-	private int layer = 0;
-
-	private FSCoordTransform transform = null;
-
-	private FSColorTransform colorTransform = null;
-
 	/**
-	 * Construct an FSButton object, initalizing it with values decoded from an
+	 * Construct an FSButton object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -182,6 +184,13 @@
 	 *            FSDefineShape3 object.
 	 * @param aLayer
 	 *            the layer in the display list on which the shape is drawn.
+	 * 
+	 * @throws IllegalArgumentException if the code for the button state is not 
+	 * in the range 1..15.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 *            
+	 * @throws IllegalArgumentException if the layer number is not in the range 0..65535.
 	 */
 	public FSButton(int aState, int anIdentifier, int aLayer)
 	{
@@ -206,9 +215,17 @@
 	 * @param aTransform
 	 *            an FSCoordTransform object that changes the appearance of the
 	 *            shape when it is drawn.
+	 * 
+	 * @throws IllegalArgumentException if the code for the button state is not 
+	 * in the range 1..15.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 *            
+	 * @throws IllegalArgumentException if the layer number is not in the range 0..65535.
+	 *            
+	 * @throws NullPointerException if the transform is null.
 	 */
-	public FSButton(int aState, int anIdentifier, int aLayer,
-					FSCoordTransform aTransform)
+	public FSButton(int aState, int anIdentifier, int aLayer, FSCoordTransform aTransform)
 	{
 		setState(aState);
 		setIdentifier(anIdentifier);
@@ -234,10 +251,19 @@
 	 * @param aColorTransform
 	 *            an FSColorTransform object that changes the colour of the
 	 *            shape when it is drawn.
+	 * 
+	 * @throws IllegalArgumentException if the code for the button state is not 
+	 * in the range 1..15.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 *            
+	 * @throws IllegalArgumentException if the layer number is not in the range 0..65535.
+	 *            
+	 * @throws NullPointerException if the coordinate transform is null.
+	 *            
+	 * @throws NullPointerException if the colour transform is null.
 	 */
-	public FSButton(int aState, int anIdentifier, int aLayer,
-					FSCoordTransform aTransform,
-					FSColorTransform aColorTransform)
+	public FSButton(int aState, int anIdentifier, int aLayer, FSCoordTransform aTransform, FSColorTransform aColorTransform)
 	{
 		setState(aState);
 		setIdentifier(anIdentifier);
@@ -364,9 +390,15 @@
 	 * 
 	 * @param aNumber
 	 *            the state of the button when the shape is drawn.
+	 * 
+	 * @throws IllegalArgumentException if the code for the button state is not 
+	 * in the range 1..15.
 	 */
 	public void setState(int aNumber)
 	{
+		if (aNumber &lt; 1 || aNumber &gt; 15) {
+			throw new IllegalArgumentException(&quot;The code for the button state must be in the range 1..15.&quot;);
+		}
 		state = aNumber;
 	}
 
@@ -378,9 +410,14 @@
 	 * @param anIdentifier
 	 *            the identifier of the shape object that defines the shape's
 	 *            appearance.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -390,9 +427,14 @@
 	 * @param aNumber
 	 *            the number of the layer in the display list where the shape is
 	 *            drawn.
+	 *            
+	 * @throws IllegalArgumentException if the layer number is not in the range 0..65535.
 	 */
 	public void setLayer(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Layer number must be in the range 0..65535.&quot;);
+		}
 		layer = aNumber;
 	}
 
@@ -402,9 +444,14 @@
 	 * 
 	 * @param aTransform
 	 *            an FSCoordTransform object that will be applied to the shape.
+	 *            
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public void setTransform(FSCoordTransform aTransform)
 	{
+		if (aTransform == null) {
+			throw new NullPointerException(&quot;Coordinate transform for button cannot be null.&quot;);
+		}
 		transform = aTransform;
 	}
 
@@ -412,11 +459,20 @@
 	 * Sets the colour transform that will be applied to the shape to change
 	 * it's colour.
 	 * 
+	 * IMPORTANT: The colour transform is only used in FSDefineButton2 objects.
+	 * 
 	 * @param aTransform
 	 *            an FSColorTransform object that will be applied to the shape.
+	 *            
+	 * @throws NullPointerException if the transform is null. This check is 
+	 * performed even though this object may be used in an FSDefineButton object
+	 * where the colour transform is not used.
 	 */
 	public void setColorTransform(FSColorTransform aTransform)
 	{
+		if (aTransform == null) {
+			throw new NullPointerException(&quot;Colour transform for button cannot be null.&quot;);
+		}
 		colorTransform = aTransform;
 	}
 
@@ -426,12 +482,11 @@
 
 		try {
 			anObject = (FSButton)super.clone();
-
-			anObject.transform = (transform != null) ? (FSCoordTransform) transform
-							.clone() : null;
-			anObject.colorTransform = (colorTransform != null) ? (FSColorTransform) colorTransform
-							.clone()
-							: null;
+			anObject.transform = (FSCoordTransform)transform.clone();
+			
+			if (colorTransform != null) {
+				anObject.colorTransform = (FSColorTransform)colorTransform.clone();
+			}
 		} 
 		catch (CloneNotSupportedException e) {
 			throw new InternalError();
@@ -452,23 +507,17 @@
 
 		if (super.equals(anObject))
 		{
-			FSButton typedObject = (FSButton) anObject;
+			FSButton cx = (FSButton) anObject;
 
-			result = state == typedObject.state;
-			result = result &amp;&amp; identifier == typedObject.identifier;
-			result = result &amp;&amp; layer == typedObject.layer;
+			result = state == cx.state;
+			result = result &amp;&amp; identifier == cx.identifier;
+			result = result &amp;&amp; layer == cx.layer;
+			result = result &amp;&amp; transform.equals(cx.transform);
 
-			if (transform != null)
-				result = result &amp;&amp; transform.equals(typedObject.transform);
-			else
-				result = result &amp;&amp; transform == typedObject.transform;
-
 			if (colorTransform != null)
-				result = result
-								&amp;&amp; colorTransform
-												.equals(typedObject.colorTransform);
+				result = result &amp;&amp; colorTransform.equals(cx.colorTransform);
 			else
-				result = result &amp;&amp; colorTransform == typedObject.colorTransform;
+				result = result &amp;&amp; colorTransform == cx.colorTransform;
 		}
 		return result;
 	}
@@ -482,7 +531,10 @@
 		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;layer = &quot;).append(layer).append(&quot;; &quot;);
 		buffer.append(&quot;transform = &quot;).append(transform.toString()).append(&quot;; &quot;);
-		buffer.append(&quot;colorTransform = &quot;).append(colorTransform.toString()).append(&quot;; &quot;);
+		
+		if (colorTransform != null)
+			buffer.append(&quot;colorTransform = &quot;).append(colorTransform.toString()).append(&quot;; &quot;);
+		
 		buffer.append(&quot;}&quot;);
 
 		return buffer.toString();
@@ -490,14 +542,11 @@
 
 	public int length(FSContext context)
 	{
-		int length = 0;
+		int length = 5 + transform.length(context);
 
-		length += 5;
-		length += transform.length(context);
-		// Flash 3
 		if (context.type == FSMovieObject.DefineButton2)
 			length += colorTransform.length(context);
-		// End Flash 3
+
 		return length;
 	}
 
@@ -508,10 +557,10 @@
 		coder.writeWord(identifier, 2);
 		coder.writeWord(layer, 2);
 		transform.encode(coder, context);
-		// Flash 3
+
 		if (context.type == FSMovieObject.DefineButton2)
 			colorTransform.encode(coder, context);
-		// End Flash 3
+
 	}
 
 	public void decode(FSCoder coder, FSContext context)
@@ -523,9 +572,9 @@
 		layer = coder.readWord(2, false);
 
 		transform = new FSCoordTransform(coder, context);
-		// Flash 3
+
 		if (context.type == FSMovieObject.DefineButton2)
 			colorTransform = new FSColorTransform(coder, context);
-		// End Flash 3
+
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSButtonColorTransform.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSButtonColorTransform.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSButtonColorTransform.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -74,12 +74,11 @@
  */
 public class FSButtonColorTransform extends FSMovieObject
 {
-	private int identifier = 0;
+	private int identifier;
+	private FSColorTransform colorTransform;
 
-	private FSColorTransform colorTransform = null;
-
 	/**
-	 * Construct an FSButtonColorTransform object, initalizing it with values
+	 * Construct an FSButtonColorTransform object, initialising it with values
 	 * decoded from an encoded object.
 	 * 
 	 * @param coder
@@ -100,9 +99,12 @@
 	 *            applies to.
 	 * @param aColorTransform
 	 *            an FSColorTransform object that will be applied to the button.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 *            
+	 * @throws NullPointerException if the colour transform is null.
 	 */
-	public FSButtonColorTransform(int anIdentifier,
-									FSColorTransform aColorTransform)
+	public FSButtonColorTransform(int anIdentifier, FSColorTransform aColorTransform)
 	{
 		super(ButtonColorTransform);
 		setIdentifier(anIdentifier);
@@ -118,8 +120,7 @@
 	 */
 	public FSButtonColorTransform(FSButtonColorTransform obj)
 	{
-		super(obj);
-
+		super(ButtonColorTransform);
 		identifier = obj.identifier;
 		colorTransform = new FSColorTransform(obj.colorTransform);
 	}
@@ -153,9 +154,14 @@
 	 * @param anIdentifier
 	 *            the identifier of the FSDefineButton object that the transform
 	 *            will be applied to.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -165,21 +171,22 @@
 	 * @param aTransform
 	 *            the colour transform object that will be applied to the
 	 *            button.
+	 *            
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public void setColorTransform(FSColorTransform aTransform)
 	{
+		if (aTransform == null) {
+			throw new NullPointerException(&quot;Colour transform for button cannot be null.&quot;);
+		}
 		colorTransform = aTransform;
 	}
 
 	public Object clone()
 	{
-		FSButtonColorTransform anObject = (FSButtonColorTransform) super
-						.clone();
+		FSButtonColorTransform anObject = (FSButtonColorTransform) super.clone();
+		anObject.colorTransform = (FSColorTransform) colorTransform.clone();
 
-		anObject.colorTransform = (colorTransform != null) ? (FSColorTransform) colorTransform
-						.clone()
-						: null;
-
 		return anObject;
 	}
 
@@ -192,13 +199,7 @@
 			FSButtonColorTransform typedObject = (FSButtonColorTransform) anObject;
 
 			result = identifier == typedObject.identifier;
-
-			if (colorTransform == null)
-				result = result &amp;&amp; (typedObject.colorTransform == null);
-			else
-				result = result
-								&amp;&amp; colorTransform
-												.equals(typedObject.colorTransform);
+			result = result &amp;&amp; (typedObject.colorTransform == null);
 		}
 		return result;
 	}
@@ -219,8 +220,7 @@
 	{
 		super.length(context);
 
-		length += 2;
-		length += colorTransform.length(context);
+		length += 2 + colorTransform.length(context);
 
 		return length;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSButtonEvent.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSButtonEvent.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSButtonEvent.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -393,23 +393,24 @@
 	}
 
 	private int event = 0;
+	private ArrayList&lt;FSActionObject&gt; actions = null;
 
 	private int length = 0;
+	private byte[] data = null;
 
-	private ArrayList actions = null;
-
-	private byte[] encodedActions = null;
-
 	/**
-	 * Construct an FSButtonEvent object, initializing it with values decoded
+	 * Construct an FSButtonEvent object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
 	 *            an FSCoder containing the binary data.
+	 * @param context
+	 *            an FSContext object used for passing information between objects.
+	 * @param size the length of the encoded action in bytes.
 	 */
-	public FSButtonEvent(FSCoder coder, FSContext context, int len)
+	public FSButtonEvent(FSCoder coder, FSContext context, int size)
 	{
-		length = len - 2;
+		length = size - 2;
 		decode(coder, context);
 	}
 
@@ -422,8 +423,11 @@
 	 * @param anArray
 	 *            the array of action objects that will be executed when the
 	 *            specified event(s) occur.
+	 *            
+	 * @throws IllegalArgumentException if the event code is outside the range 1..65535.
+	 * @throws NullPointerexception if the array of actions is null.
 	 */
-	public FSButtonEvent(int aNumber, ArrayList anArray)
+	public FSButtonEvent(int aNumber, ArrayList&lt;FSActionObject&gt; anArray)
 	{
 		setEvent(aNumber);
 		setActions(anArray);
@@ -437,6 +441,9 @@
 	 *            the event code.
 	 * @param bytes
 	 *            an array of encoded action objects.
+	 *            
+	 * @throws IllegalArgumentException if the event code is outside the range 1..65535.
+	 * @throws NullPointerexception if the encoded actions is null.
 	 */
 	public FSButtonEvent(int aNumber, byte[] bytes)
 	{
@@ -457,13 +464,13 @@
 
 		if (obj.actions != null)
 		{
-			actions = new ArrayList();
+			actions = new ArrayList&lt;FSActionObject&gt;();
 
-			for (Iterator i = obj.actions.iterator(); i.hasNext();)
-				actions.add(((FSActionObject) i.next()).clone());
+			for (Iterator&lt;FSActionObject&gt; i = obj.actions.iterator(); i.hasNext();)
+				actions.add((FSActionObject) i.next().clone());
 		} else
 		{
-			encodedActions = Transform.clone(obj.encodedActions);
+			data = FSMovieObject.copy(obj.data);
 		}
 	}
 
@@ -475,10 +482,10 @@
 	 */
 	public void add(FSActionObject anAction)
 	{
-		if (encodedActions != null)
+		if (data != null)
 		{
-			actions = FSActionObject.decodeActions(encodedActions);
-			encodedActions = null;
+			actions = FSActionObject.decodeActions(data);
+			data = null;
 		}
 		actions.add(anAction);
 	}
@@ -500,12 +507,12 @@
 	 * @return the array of action objects that will be executed when the
 	 *         specified event(s) occur.
 	 */
-	public ArrayList getActions()
+	public ArrayList&lt;FSActionObject&gt; getActions()
 	{
-		if (encodedActions != null)
+		if (data != null)
 		{
-			actions = FSActionObject.decodeActions(encodedActions);
-			encodedActions = null;
+			actions = FSActionObject.decodeActions(data);
+			data = null;
 		}
 		return actions;
 	}
@@ -519,7 +526,7 @@
 	 */
 	public byte[] getEncodedActions()
 	{
-		return encodedActions;
+		return data;
 	}
 
 	/**
@@ -527,9 +534,14 @@
 	 * 
 	 * @param aNumber
 	 *            the event code.
+	 *            
+	 * @throws IllegalArgumentException if the event code is outside the range 1..65535.
 	 */
 	public void setEvent(int aNumber)
 	{
+		if (aNumber &lt; 1 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Event code must be in the range 1..65535.&quot;);
+		}
 		event = aNumber;
 	}
 
@@ -540,11 +552,16 @@
 	 * @param anArray
 	 *            the array of action objects that will be executed when the
 	 *            specified event(s) occur.
+	 *          
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setActions(ArrayList anArray)
+	public void setActions(ArrayList&lt;FSActionObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of actions cannot be null.&quot;);
+		}
 		actions = anArray;
-		encodedActions = null;
+		data = null;
 	}
 
 	/**
@@ -554,35 +571,33 @@
 	 * 
 	 * @param bytes
 	 *            the array of encoded actions.
+	 *          
+	 * @throws NullPointerException if the encoded actions is null.
 	 */
 	public void setEncodedActions(byte[] bytes)
 	{
-		encodedActions = bytes;
+		data = bytes;
 		actions = null;
 	}
 
 	public Object clone()
 	{
-		FSButtonEvent anObject = null;
+		FSButtonEvent obj = null;
 
 		try {
-		    anObject = (FSButtonEvent) super.clone();
+		    obj = (FSButtonEvent) super.clone();
 
-			if (actions != null)
-			{
-				anObject.actions = new ArrayList();
-
-				for (Iterator i = actions.iterator(); i.hasNext();)
-					anObject.actions.add(((FSActionObject) i.next()).clone());
-			} else
-			{
-				anObject.encodedActions = Transform.clone(encodedActions);
+			if (actions != null) {
+				obj.actions = FSActionObject.copy(actions);
+			} 
+			else {
+				obj.data = FSMovieObject.copy(data);
 			}
 		} 
 		catch (CloneNotSupportedException e) {
 			throw new InternalError();
 		}
-		return anObject;
+		return obj;
 	}
 
 	/**
@@ -590,23 +605,35 @@
 	 * equal if they would generate identical binary data when they are encoded
 	 * to a Flash file.
 	 * 
+	 * @param obj
+	 *            the reference object with which to compare.
+
 	 * @return true if this object would be identical to anObject when encoded.
 	 */
-	public boolean equals(Object anObject)
+	public boolean equals(Object obj)
 	{
 		boolean result = false;
 
-		if (super.equals(anObject))
+		if (obj == null)
 		{
-			FSButtonEvent typedObject = (FSButtonEvent) anObject;
+			return false;
+		}
 
+		if (obj == this)
+		{
+			return true;
+		}
+
+		if (obj instanceof FSButtonEvent)
+		{
+			FSButtonEvent typedObject = (FSButtonEvent)obj;
+
 			result = event == typedObject.event;
 
 			if (actions != null)
 				result = actions.equals(typedObject.actions);
 			else
-				result = Transform.equals(encodedActions,
-								typedObject.encodedActions);
+				result = FSMovieObject.equals(data, typedObject.data);
 		}
 		return result;
 	}
@@ -619,7 +646,7 @@
 		buffer.append(&quot;event = &quot;).append(event).append(&quot;; &quot;);
 
 		if (actions != null)
-			buffer.append(&quot;actions = &quot;).append(actions.toString()).append(&quot;; &quot;);
+			buffer.append(&quot;actions = array[&quot;).append(actions.size()).append(&quot;]; &quot;);
 		else
 			buffer.append(&quot;actions = &lt;data&gt;; &quot;);
 
@@ -634,28 +661,13 @@
 
 		if (actions != null)
 		{
-			FSActionObject currentAction = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				currentAction = (FSActionObject) i.next();
-
-				length += currentAction.length(context);
-				length += (currentAction.getType() &gt; 128) ? 3 : 1;
-			}
-
-			if ((actions.size() == 0)
-							|| (currentAction.getType() != FSAction.End))
-			{
-				length += 1;
-			}
-		} else
+			length += FSActionObject.length(context, actions);
+		} 
+		else
 		{
-			length += encodedActions.length;
+			length += data.length;
 
-			if ((encodedActions.length == 0)
-							|| (encodedActions[encodedActions.length - 1] != FSAction.End))
-			{
+			if ((data.length == 0) || (data[data.length-1] != FSAction.End)) {
 				length += 1;
 			}
 		}
@@ -668,44 +680,13 @@
 
 		if (actions != null)
 		{
-			FSActionObject action = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				action = (FSActionObject) i.next();
-
-				int objStart = coder.getPointer();
-				int length = action.getLength();
-				int start = coder.getPointer()
-								+ ((action.getType() &gt; 128) ? 24 : 8);
-				int next = start + (length &lt;&lt; 3);
-
-				action.encode(coder, context);
-				coder.setPointer(next);
-
-				int delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-				if (delta != 0)
-				{
-					context.codingError = true;
-					context.typeInError = action.getType();
-					context.startOfError = objStart &gt;&gt;&gt; 3;
-					context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
-					context.delta = delta;
-				}
-			}
-
-			if ((actions.size() == 0) || (action.getType() != FSAction.End))
-			{
-				coder.writeWord(0, 1);
-			}
-		} else
+			FSActionObject.encode(coder, context, actions);
+		} 
+		else
 		{
-			coder.writeBytes(encodedActions);
+			coder.writeBytes(data);
 
-			if ((encodedActions.length == 0)
-							|| (encodedActions[encodedActions.length - 1] != FSAction.End))
-			{
+			if ((data.length == 0) || (data[data.length-1] != FSAction.End)) {
 				coder.writeWord(0, 1);
 			}
 		}
@@ -715,23 +696,12 @@
 	{
 		event = coder.readWord(2, false);
 
-		if (context.decodeActions)
-		{
-			actions = new ArrayList();
-
-			int start;
-
-			while (length &gt; 0)
-			{
-				start = coder.getPointer();
-
-				actions.add(FSActionObject.decodeAction(coder, context));
-				length -= (coder.getPointer() - start) &gt;&gt;&gt; 3;
-			}
-		} else
-		{
-			encodedActions = new byte[length];
-			coder.readBytes(encodedActions);
+		if (context.decodeActions) {
+			actions = FSActionObject.decodeActions(coder, context, length);
+		} 
+		else {
+			data = new byte[length];
+			coder.readBytes(data);
 		}
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSButtonSound.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSButtonSound.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSButtonSound.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -121,14 +121,11 @@
  */
 public class FSButtonSound extends FSMovieObject
 {
-	private int identifier = 0;
+	private int identifier;
+	private FSSound[] sound = new FSSound[] {null, null, null, null};
 
-	private FSSound[] sound = new FSSound[]
-	{
-		null, null, null, null };
-
 	/**
-	 * Construct an FSButtonSound object, initalizing it with values decoded
+	 * Construct an FSButtonSound object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -154,6 +151,12 @@
 	 * @param aSound
 	 *            an FSSound object that identifies a sound and controls how it
 	 *            is played.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 *         
+	 * @throws IllegalArgumentException if the event code is not either 
+	 * FSButtonEvent.RollOver, FSButtonEvent.RollOut, FSButtonEvent.Press or 
+	 * FSButtonEvent.Release.
 	 */
 	public FSButtonSound(int anIdentifier, int eventCode, FSSound aSound)
 	{
@@ -176,7 +179,7 @@
 
 		identifier = obj.identifier;
 
-		for (int i = 0; i &lt; 4; i++)
+		for (int i=0; i&lt;4; i++)
 		{
 			if (obj.sound[i] != null)
 				sound[i] = new FSSound(obj.sound[i]);
@@ -198,13 +201,25 @@
 	 * 
 	 * @param eventCode
 	 *            the code representing the button event, must be either
-	 *            FSButtonEvent.rollOver, FSButtonEvent.rollOut,
-	 *            FSButtonEvent.press or FSButtonEvent.release.
+	 *            FSButtonEvent.RollOver, FSButtonEvent.RollOut,
+	 *            FSButtonEvent.Press or FSButtonEvent.Release.
 	 * @return the FSSound that identifies and controls the sound that will be
 	 *         played for the event.
+	 *         
+	 * @throws IllegalArgumentException if the event code is not either 
+	 * FSButtonEvent.RollOver, FSButtonEvent.RollOut, FSButtonEvent.Press or 
+	 * FSButtonEvent.Release.
 	 */
 	public FSSound getSoundForEvent(int eventCode)
 	{
+		if (eventCode != FSButtonEvent.RollOut &amp;&amp; 
+						eventCode != FSButtonEvent.RollOver &amp;&amp;
+						eventCode != FSButtonEvent.Press &amp;&amp; 
+						eventCode != FSButtonEvent.Release) 
+		{
+			throw new IllegalArgumentException(&quot;Invalid event code.&quot;);
+		}
+		
 		FSSound aSound = null;
 
 		if (eventCode == FSButtonEvent.RollOut)
@@ -224,9 +239,14 @@
 	 * 
 	 * @param anIdentifier
 	 *            the identifier of the button which this object applies to.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -235,14 +255,26 @@
 	 * 
 	 * @param eventCode
 	 *            the code representing the button event, must be either
-	 *            FSButtonEvent.rollOver, FSButtonEvent.rollOut,
-	 *            FSButtonEvent.press or FSButtonEvent.release.
+	 *            FSButtonEvent.RollOver, FSButtonEvent.RollOut,
+	 *            FSButtonEvent.Press or FSButtonEvent.Release.
 	 * @param aSound
 	 *            an FSSound object that identifies and controls how the sound
 	 *            is played.
+	 *         
+	 * @throws IllegalArgumentException if the event code is not either 
+	 * FSButtonEvent.RollOver, FSButtonEvent.RollOut, FSButtonEvent.Press or 
+	 * FSButtonEvent.Release.
 	 */
 	public void setSoundForEvent(int eventCode, FSSound aSound)
 	{
+		if (eventCode != FSButtonEvent.RollOut &amp;&amp; 
+						eventCode != FSButtonEvent.RollOver &amp;&amp;
+						eventCode != FSButtonEvent.Press &amp;&amp; 
+						eventCode != FSButtonEvent.Release) 
+		{
+			throw new IllegalArgumentException(&quot;Invalid event code.&quot;);
+		}
+
 		if (eventCode == FSButtonEvent.RollOut)
 			sound[0] = aSound;
 		else if (eventCode == FSButtonEvent.RollOver)
@@ -257,10 +289,9 @@
 	{
 		FSButtonSound anObject = (FSButtonSound) super.clone();
 
-		for (int i = 0; i &lt; 4; i++)
+		for (int i=0; i&lt;4; i++)
 		{
-			anObject.sound[i] = (sound[i] != null) ? (FSSound) sound[i].clone()
-							: null;
+			anObject.sound[i] = (sound[i] != null) ? (FSSound) sound[i].clone() : null;
 		}
 
 		return anObject;
@@ -272,16 +303,16 @@
 
 		if (super.equals(anObject))
 		{
-			FSButtonSound typedObject = (FSButtonSound) anObject;
+			FSButtonSound snd = (FSButtonSound) anObject;
 
-			result = identifier == typedObject.identifier;
+			result = identifier == snd.identifier;
 
-			for (int i = 0; i &lt; 4; i++)
+			for (int i=0; i&lt;4; i++)
 			{
 				if (sound[i] != null)
-					result = result &amp;&amp; sound[i].equals(typedObject.sound[i]);
+					result = result &amp;&amp; sound[i].equals(snd.sound[i]);
 				else
-					result = result &amp;&amp; sound[i] == typedObject.sound[i];
+					result = result &amp;&amp; sound[i] == snd.sound[i];
 			}
 		}
 		return result;
@@ -309,7 +340,7 @@
 
 		length += 2;
 
-		for (int i = 0; i &lt; 4; i++)
+		for (int i=0; i&lt;4; i++)
 		{
 			if (sound[i] != null &amp;&amp; sound[i].getIdentifier() != 0)
 				length += sound[i].length(context);
@@ -326,7 +357,7 @@
 
 		coder.writeWord(identifier, 2);
 
-		for (int i = 0; i &lt; 4; i++)
+		for (int i=0; i&lt;4; i++)
 		{
 			if (sound[i] != null &amp;&amp; sound[i].getIdentifier() != 0)
 				sound[i].encode(coder, context);
@@ -343,7 +374,7 @@
 
 		identifier = coder.readWord(2, false);
 
-		for (int i = 0; i &lt; 4; i++)
+		for (int i=0; i&lt;4; i++)
 		{
 			if (coder.scanWord(2, false) &gt; 0)
 				sound[i] = new FSSound(coder, context);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSCall.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSCall.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSCall.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -98,7 +98,7 @@
 	}
 
 	/**
-	 * Construct an FSCall object, initalizing it with values decoded from an
+	 * Construct an FSCall object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -126,6 +126,6 @@
 	 */
 	public FSCall(FSCall obj)
 	{
-		super(obj);
+		super(Call);
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSCharacter.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSCharacter.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSCharacter.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -142,10 +142,9 @@
  */
 public class FSCharacter implements Cloneable, Codeable
 {
-	private int glyphIndex = 0;
+	private int glyphIndex;
+	private int advance;
 
-	private int advance = 0;
-
 	/**
 	 * Construct an FSCharacter object, initalizing it with values decoded from
 	 * an encoded object.
@@ -170,6 +169,8 @@
 	 * @param anAdvance
 	 *            the relative position in twips, from the origin of the glyph
 	 *            representing this character to the next glyph to be displayed.
+	 *            
+	 * @throws IllegalArgumentException if the argument is negative.
 	 */
 	public FSCharacter(int anIndex, int anAdvance)
 	{
@@ -246,27 +247,6 @@
 	}
 
 	/**
-	 * Returns true if anObject is equal to this one. Objects are considered
-	 * equal if they would generate identical binary data when they are encoded
-	 * to a Flash file.
-	 * 
-	 * @return true if this object would be identical to anObject when encoded.
-	 */
-	public boolean equals(Object anObject)
-	{
-		boolean result = false;
-
-		if (super.equals(anObject))
-		{
-			FSCharacter typedObject = (FSCharacter) anObject;
-
-			result = glyphIndex == typedObject.glyphIndex;
-			result = result &amp;&amp; advance == typedObject.advance;
-		}
-		return result;
-	}
-
-	/**
 	 * Creates a deep copy of the entire object.
 	 * 
 	 * @return a copy of the object.
@@ -284,6 +264,40 @@
 		return anObject;
 	}
 
+	/**
+	 * Returns true if anObject is equal to this one. Objects are considered
+	 * equal if they would generate identical binary data when they are encoded
+	 * to a Flash file.
+	 * 
+	 * @param obj
+	 *            the reference object with which to compare.
+
+	 * @return true if this object would be identical to anObject when encoded.
+	 */
+	public boolean equals(Object obj)
+	{
+		boolean result = false;
+
+		if (obj == null)
+		{
+			return false;
+		}
+
+		if (obj == this)
+		{
+			return true;
+		}
+
+		if (obj instanceof FSCharacter)
+		{
+			FSCharacter character = (FSCharacter) obj;
+
+			result = glyphIndex == character.glyphIndex;
+			result = result &amp;&amp; advance == character.advance;
+		}
+		return result;
+	}
+
 	public String toString()
 	{
 		StringBuffer buffer = new StringBuffer();
@@ -298,10 +312,7 @@
 
 	public int length(FSContext context)
 	{
-		int numberOfGlyphBits = context.glyphSize;
-		int numberOfAdvanceBits = context.advanceSize;
-
-		return numberOfGlyphBits + numberOfAdvanceBits;
+		return context.glyphSize + context.advanceSize;
 	}
 
 	public void encode(FSCoder coder, FSContext context)
@@ -312,10 +323,7 @@
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		int numberOfGlyphBits = context.glyphSize;
-		int numberOfAdvanceBits = context.advanceSize;
-
-		glyphIndex = coder.readBits(numberOfGlyphBits, false);
-		advance = coder.readBits(numberOfAdvanceBits, true);
+		glyphIndex = coder.readBits(context.glyphSize, false);
+		advance = coder.readBits(context.advanceSize, true);
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSClipEvent.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSClipEvent.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSClipEvent.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -341,48 +341,44 @@
 	/** Code for a data event. */
 	public static final int Data = 256;
 
-	// Flash 6
-	// / Code for an initialize event.
+	/** Code for an initialise event. */
 	public static final int Initialize = 512;
 
-	// / Code for a press event.
+	/** Code for a press event. */
 	public static final int Press = 1024;
 
-	// / Code for a release event.
+	/** Code for a release event. */
 	public static final int Release = 2048;
 
-	// / Code for a release outside event.
+	/** Code for a release outside event. */
 	public static final int ReleaseOut = 4096;
 
-	// / Code for a roll over event.
+	/** Code for a roll over event. */
 	public static final int RollOver = 8192;
 
-	// / Code for a roll out event.
+	/** Code for a roll out event. */
 	public static final int RollOut = 16384;
 
-	// / Code for a drag over event.
+	/** Code for a drag over event. */
 	public static final int DragOver = 32768;
 
-	// / Code for a drag out event.
+	/** Code for a drag out event. */
 	public static final int DragOut = 65536;
 
-	// / Code for a key press event, where the code for the key is specified.
+	/** Code for a key press event, where the code for the key is specified. */
 	public static final int KeyPress = 131072;
 
-	// Flash 7
-	// / Code for a construct event.
+	/** Code for a construct event. */
 	public static final int Construct = 262144;
 
-	private int event = 0;
+	private int event;
+	private int keyCode; // Flash 6+
+	private ArrayList&lt;FSActionObject&gt; actions;
+	private byte[] data = null;
+	private int offset;
 
-	private int keyCode = 0; // Flash 6+
-
-	private ArrayList actions = null;
-
-	private byte[] encodedActions = null;
-
 	/**
-	 * Construct an FSClipEvent object, initalizing it with values decoded from
+	 * Construct an FSClipEvent object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -403,7 +399,7 @@
 	 *            the array of actions that will be executed when the specified
 	 *            event occurs.
 	 */
-	public FSClipEvent(int eventCode, ArrayList anArray)
+	public FSClipEvent(int eventCode, ArrayList&lt;FSActionObject&gt; anArray)
 	{
 		setEvent(eventCode);
 		setActions(anArray);
@@ -437,8 +433,10 @@
 	 * @param anArray
 	 *            the array of actions that will be executed when the specified
 	 *            event occurs.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public FSClipEvent(int eventCode, int keyCode, ArrayList anArray)
+	public FSClipEvent(int eventCode, int keyCode, ArrayList&lt;FSActionObject&gt; anArray)
 	{
 		setEvent(eventCode);
 		setKeyCode(keyCode);
@@ -457,6 +455,8 @@
 	 *            the ASCII code for the key pressed on the keyboard.
 	 * @param bytes
 	 *            an array of encoded action objects.
+	 *            
+	 * @throws NullPointerException if the encoded actions are null.
 	 */
 	public FSClipEvent(int eventCode, int keyCode, byte[] bytes)
 	{
@@ -467,10 +467,10 @@
 
 	// End Flash 6
 	/**
-	 * Constructs an FSCall object by copying values from an existing object.
+	 * Constructs an FSClipEvent object by copying values from an existing object.
 	 * 
 	 * @param obj
-	 *            an FSCall object.
+	 *            an FSClipEvent object.
 	 */
 	public FSClipEvent(FSClipEvent obj)
 	{
@@ -479,13 +479,11 @@
 
 		if (actions != null)
 		{
-			actions = new ArrayList();
-
-			for (Iterator i = obj.actions.iterator(); i.hasNext();)
-				actions.add(((FSActionObject) i.next()).clone());
-		} else
+			actions = FSActionObject.copy(obj.actions);
+		} 
+		else
 		{
-			encodedActions = Transform.clone(obj.encodedActions);
+			data = FSMovieObject.copy(obj.data);
 		}
 	}
 
@@ -497,10 +495,10 @@
 	 */
 	public void add(FSActionObject anAction)
 	{
-		if (encodedActions != null)
+		if (data != null)
 		{
-			actions = FSActionObject.decodeActions(encodedActions);
-			encodedActions = null;
+			actions = FSActionObject.decodeActions(data);
+			data = null;
 		}
 		actions.add(anAction);
 	}
@@ -527,7 +525,6 @@
 		return event;
 	}
 
-	// Flash 6
 	/**
 	 * Gets the code for the key that triggers the event when pressed. The code
 	 * is typically the ASCII code for standard western keyboards.
@@ -557,14 +554,19 @@
 	 * Sets the array of actions that are executed by the movie clip in response
 	 * to specified event(s).
 	 * 
-	 * @param anArray
+	 * @param array
 	 *            the array of actions that will be executed when the specified
 	 *            event occurs.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setActions(ArrayList anArray)
+	public void setActions(ArrayList&lt;FSActionObject&gt; array)
 	{
-		actions = anArray;
-		encodedActions = null;
+		if (array == null) {
+			throw new NullPointerException(&quot;Array of actions cannot be null.&quot;);
+		}
+		actions = array;
+		data = null;
 	}
 
 	/**
@@ -574,12 +576,12 @@
 	 * @return the array of actions that will be executed when the specified
 	 *         event occurs.
 	 */
-	public ArrayList getActions()
+	public ArrayList&lt;FSActionObject&gt; getActions()
 	{
-		if (encodedActions != null)
+		if (data != null)
 		{
-			actions = FSActionObject.decodeActions(encodedActions);
-			encodedActions = null;
+			actions = FSActionObject.decodeActions(data);
+			data = null;
 		}
 		return actions;
 	}
@@ -593,7 +595,7 @@
 	 */
 	public byte[] getEncodedActions()
 	{
-		return encodedActions;
+		return data;
 	}
 
 	/**
@@ -603,35 +605,38 @@
 	 * 
 	 * @param bytes
 	 *            the array of encoded actions.
+	 *            
+	 * @throws NullPointerException if the encoded actions are null.
 	 */
 	public void setEncodedActions(byte[] bytes)
 	{
-		encodedActions = bytes;
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Encoded actions cannot be null.&quot;);
+		}
+		data = bytes;
 		actions = null;
 	}
 
 	public Object clone()
 	{
-		FSClipEvent anObject = null;
+		FSClipEvent obj = null;
 
 		try {
-			anObject = (FSClipEvent)super.clone();
+			obj = (FSClipEvent)super.clone();
 
 			if (actions != null)
 			{
-				anObject.actions = new ArrayList();
-
-				for (Iterator i = actions.iterator(); i.hasNext();)
-					anObject.actions.add(((FSActionObject) i.next()).clone());
-			} else
+				actions = FSActionObject.copy(obj.actions);
+			} 
+			else
 			{
-				anObject.encodedActions = Transform.clone(encodedActions);
+				obj.data = FSMovieObject.copy(data);
 			}
 		} 
 		catch (CloneNotSupportedException e) {
 			throw new InternalError();
 		}
-		return anObject;
+		return obj;
 	}
 
 	/**
@@ -639,25 +644,36 @@
 	 * equal if they would generate identical binary data when they are encoded
 	 * to a Flash file.
 	 * 
+	 * @param obj
+	 *            the reference object with which to compare.
+
 	 * @return true if this object would be identical to anObject when encoded.
 	 */
-	public boolean equals(Object anObject)
+	public boolean equals(Object obj)
 	{
 		boolean result = false;
 
-		if (super.equals(anObject))
+		if (obj == null)
 		{
-			FSClipEvent typedObject = (FSClipEvent) anObject;
+			return false;
+		}
 
+		if (obj == this)
+		{
+			return true;
+		}
+
+		if (obj instanceof FSClipEvent)
+		{
+			FSClipEvent typedObject = (FSClipEvent) obj;
+
 			result = event == typedObject.event;
-			// Flash 6
 			result = result &amp;&amp; keyCode == typedObject.keyCode;
-			// End Flash 6
+
 			if (actions != null)
 				result = actions.equals(typedObject.actions);
 			else
-				result = Transform.equals(encodedActions,
-								typedObject.encodedActions);
+				result = FSMovieObject.equals(data, typedObject.data);
 		}
 		return result;
 	}
@@ -668,11 +684,10 @@
 
 		buffer.append(&quot;FSClipEvent: { &quot;);
 		buffer.append(&quot;event = &quot;).append(event).append(&quot;; &quot;);
-		// Flash 6
 		buffer.append(&quot;keyCode = &quot;).append(keyCode).append(&quot;; &quot;);
-		// End Flash 6
+
 		if (actions != null)
-			buffer.append(&quot;actions = &quot;).append(actions.toString()).append(&quot;; &quot;);
+			buffer.append(&quot;actions = array[&quot;).append(actions.size()).append(&quot;]; &quot;);
 		else
 			buffer.append(&quot;actions = &lt;data&gt;; &quot;);
 
@@ -685,37 +700,23 @@
 	{
 		int length = 4 + ((context.version &gt; 5) ? 4 : 2);
 
-		// Flash 6
-		length += ((event &amp; KeyPress) != 0) ? 1 : 0;
-		// End Flash 6
+		offset = (event &amp; KeyPress) != 0 ? 1 : 0;
 
 		if (actions != null)
 		{
-			FSActionObject currentAction = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				currentAction = (FSActionObject) i.next();
-
-				length += currentAction.length(context);
-				length += (currentAction.getType() &gt; 128) ? 3 : 1;
-			}
-
-			if ((actions.size() == 0)
-							|| (currentAction.getType() != FSAction.End))
-			{
-				length += 1;
-			}
-		} else
+			offset += FSActionObject.length(context, actions);
+		} 
+		else
 		{
-			length += encodedActions.length;
+			offset += data.length;
 
-			if ((encodedActions.length == 0)
-							|| (encodedActions[encodedActions.length - 1] != FSAction.End))
-			{
-				length += 1;
+			if ((data.length == 0) || (data[data.length - 1] != FSAction.End)) {
+				offset += 1;
 			}
 		}
+		
+		length += offset;
+		
 		return length;
 	}
 
@@ -723,88 +724,22 @@
 	{
 		int eventSize = (context.version &gt; 5) ? 4 : 2;
 
-		int offset = 0;
-
-		if (actions != null)
-		{
-			FSActionObject currentAction = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				currentAction = (FSActionObject) i.next();
-
-				offset += currentAction.getLength();
-				offset += (currentAction.getType() &gt; 128) ? 3 : 1;
-			}
-
-			if ((actions.size() == 0)
-							|| (currentAction.getType() != FSAction.End))
-			{
-				offset += 1;
-			}
-		} else
-		{
-			offset += encodedActions.length;
-
-			if ((encodedActions.length == 0)
-							|| (encodedActions[encodedActions.length - 1] != FSAction.End))
-			{
-				offset += 1;
-			}
-		}
-
-		// Flash 6
-		offset += ((event &amp; KeyPress) != 0) ? 1 : 0;
-		// End Flash 6
-
 		coder.writeWord(event, eventSize);
 		coder.writeWord(offset, 4);
 
-		// Flash 6
-		if ((event &amp; KeyPress) != 0)
+		if ((event &amp; KeyPress) != 0) {
 			coder.writeWord(keyCode, 1);
-		// End Flash 6
+		}
 
 		if (actions != null)
 		{
-			FSActionObject action = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				action = (FSActionObject) i.next();
-
-				int objStart = coder.getPointer();
-				int length = action.getLength();
-				int start = coder.getPointer()
-								+ ((action.getType() &gt; 128) ? 24 : 8);
-				int next = start + (length &lt;&lt; 3);
-
-				action.encode(coder, context);
-				coder.setPointer(next);
-
-				int delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-				if (delta != 0)
-				{
-					context.codingError = true;
-					context.typeInError = action.getType();
-					context.startOfError = objStart &gt;&gt;&gt; 3;
-					context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
-					context.delta = delta;
-				}
-			}
-
-			if ((actions.size() == 0) || (action.getType() != FSAction.End))
-			{
-				coder.writeWord(0, 1);
-			}
-		} else
+			FSActionObject.encode(coder,context,actions);
+		} 
+		else
 		{
-			coder.writeBytes(encodedActions);
+			coder.writeBytes(data);
 
-			if ((encodedActions.length == 0)
-							|| (encodedActions[encodedActions.length - 1] != FSAction.End))
-			{
+			if ((data.length == 0) || (data[data.length - 1] != FSAction.End)) {
 				coder.writeWord(0, 1);
 			}
 		}
@@ -815,46 +750,22 @@
 		int eventSize = (context.version &gt; 5) ? 4 : 2;
 
 		event = coder.readWord(eventSize, false);
-		int length = coder.readWord(4, false);
+		offset = coder.readWord(4, false);
 
-		// Flash 6
 		if ((event &amp; KeyPress) != 0)
 		{
 			keyCode = coder.readByte();
-			length -= 1;
+			offset -= 1;
 		}
-		// End Flash 6
 
 		if (context.decodeActions)
 		{
-			FSActionObject action;
-			int start;
-
-			actions = new ArrayList();
-
-			while (length &gt; 0)
-			{
-				start = coder.getPointer();
-
-				action = FSActionObject.decodeAction(coder, context);
-				actions.add(action);
-				length -= (coder.getPointer() - start) &gt;&gt;&gt; 3;
-
-				/*
-				 * The following code is to fix an apparent bug in Flash CS3
-				 * where the offset to the next clip event is 1 byte larger than
-				 * it should be.
-				 */
-
-				if (action.getType() == FSAction.End &amp;&amp; length == 1)
-				{
-					break;
-				}
-			}
-		} else
+			actions = FSActionObject.decodeActions(coder, context, offset);
+		} 
+		else
 		{
-			encodedActions = new byte[length];
-			coder.readBytes(encodedActions);
+			data = new byte[offset];
+			coder.readBytes(data);
 		}
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSCoder.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSCoder.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSCoder.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -281,6 +281,21 @@
 
 	/**
 	 * Constructs an FSCoder object containing an array of bytes with the
+	 * default little-endian byte order.
+	 * 
+	 * @param bytes
+	 *            an array of bytes where the data will be read or written.
+	 */
+	public FSCoder(byte[] bytes)
+	{
+		byteOrder = LITTLE_ENDIAN;
+		data = bytes;
+		ptr = 0;
+		end = data.length &lt;&lt; 3;
+	}
+
+	/**
+	 * Constructs an FSCoder object containing an array of bytes with the
 	 * specified byte order.
 	 * 
 	 * @param order

Modified: dev/dev-2-4/src/com/flagstone/transform/FSCoderException.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSCoderException.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSCoderException.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -11,10 +11,10 @@
 {
 	static final long serialVersionUID = 1;
 	
-	private int type = 0;
-	private int start = 0;
-	private int length = 0;
-	private int delta = 0;
+	private int type;
+	private int start;
+	private int length;
+	private int delta;
 
 	/**
 	 * Constructs an FSCoderException to report where a problem occurred when
@@ -44,8 +44,7 @@
 	 *            a message indicating the type of error - overflow or
 	 *            underflow.
 	 */
-	public FSCoderException(int type, int start, int length, int delta,
-							String message)
+	public FSCoderException(int type, int start, int length, int delta, String message)
 	{
 		super(message);
 		this.type = type;

Modified: dev/dev-2-4/src/com/flagstone/transform/FSColor.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSColor.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSColor.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -147,7 +147,6 @@
 	 */
 	public FSColor(FSCoder coder, FSContext context)
 	{
-		alpha = 255;
 		decode(coder, context);
 	}
 
@@ -161,6 +160,9 @@
 	 *            value for the green channel, in the range 0..255.
 	 * @param b
 	 *            value for the blue channel, in the range 0..255.
+	 *
+	 * @throws IllegalArgumentExcpetion if any of the colour values are not in 
+	 * the range 0..255.
 	 */
 	public FSColor(int r, int g, int b)
 	{
@@ -182,6 +184,9 @@
 	 *            value for the blue channel, in the range 0..255.
 	 * @param a
 	 *            value for the alpha channel, in the range 0..255.
+	 *
+	 * @throws IllegalArgumentExcpetion if any of the colour values are not in 
+	 * the range 0..255.
 	 */
 	public FSColor(int r, int g, int b, int a)
 	{
@@ -252,7 +257,7 @@
 	 * @param r
 	 *            value for the red channel.
 	 *            
-	 * @throws IllegalArgumentExcpetion if the argument is not in the range 0..255.
+	 * @throws IllegalArgumentExcpetion if the colour is not in the range 0..255.
 	 */
 	public void setRed(int r)
 	{
@@ -268,7 +273,7 @@
 	 * @param g
 	 *            value for the green channel.
 	 *            
-	 * @throws IllegalArgumentExcpetion if the argument is not in the range 0..255.
+	 * @throws IllegalArgumentExcpetion if the colour is not in the range 0..255.
 	 */
 	public void setGreen(int g)
 	{
@@ -284,7 +289,7 @@
 	 * @param b
 	 *            value for the blue channel, in the range 0..255.
 	 *            
-	 * @throws IllegalArgumentExcpetion if the argument is not in the range 0..255.
+	 * @throws IllegalArgumentExcpetion if the colour is not in the range 0..255.
 	 */
 	public void setBlue(int b)
 	{
@@ -300,7 +305,7 @@
 	 * @param a
 	 *            value for the alpha channel, in the range 0..255.
 	 *            
-	 * @throws IllegalArgumentExcpetion if the argument is not in the range 0..255.
+	 * @throws IllegalArgumentExcpetion if the colour is not in the range 0..255.
 	 */
 	public void setAlpha(int a)
 	{
@@ -437,5 +442,7 @@
 
 		if (context.transparent)
 			alpha = coder.readByte();
+		else 
+			alpha = 255;
 	}
 }
\ No newline at end of file

Modified: dev/dev-2-4/src/com/flagstone/transform/FSColorTransform.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSColorTransform.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSColorTransform.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -852,9 +852,9 @@
 		int numberOfBits = 13; // include extra 7 bits for byte alignment
 		int numberOfTerms = context.transparent ? 4: 3;
 
-		size = fieldSize(context);
 		hasMul = containsMultiplyTerms(context);
 		hasAdd = containsAddTerms(context);
+		size = fieldSize(context);
 
 		if (hasMul) {
 			numberOfBits += size*numberOfTerms;
@@ -993,19 +993,14 @@
 
 	private int fieldSize(FSContext context)
 	{
-		boolean containsMultiplyTerms = containsMultiplyTerms(context);
-		boolean containsAddTerms = containsAddTerms(context);
-		int numberOfBits = 0;
+		int numberOfBits = 1;
 
-		if (containsAddTerms &amp;&amp; !containsMultiplyTerms)
+		if (hasAdd &amp;&amp; !hasMul)
 			numberOfBits = addFieldSize(context);
-		else if (!containsAddTerms &amp;&amp; containsMultiplyTerms)
+		else if (!hasAdd &amp;&amp; hasMul)
 			numberOfBits = multiplyFieldSize(context);
-		else if (containsAddTerms &amp;&amp; containsMultiplyTerms)
-			numberOfBits = Math.max(addFieldSize(context),
-							multiplyFieldSize(context));
-		else
-			numberOfBits = 1;
+		else if (hasAdd &amp;&amp; hasMul)
+			numberOfBits = Math.max(addFieldSize(context), multiplyFieldSize(context));
 
 		return numberOfBits;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSCoordTransform.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSCoordTransform.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSCoordTransform.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -208,6 +208,14 @@
 		{0.0f, 1.0f, 0.0f },
 		{0.0f, 0.0f, 1.0f } 
 	};
+	
+	private int scaleSize;
+	private int rotateSize;
+	private int translateSize;
+	
+	private boolean hasScale;
+	private boolean hasRotate;
+	private boolean hasTranslate;
 
 	/**
 	 * Construct an FSCoordTransform object and initialise it with values
@@ -436,6 +444,24 @@
 	}
 
 	/**
+	 * Creates a copy of the entire object.
+	 * 
+	 * @return a copy of the object.
+	 */
+	public Object clone()
+	{
+		Object anObject = null;
+
+		try {
+			anObject = super.clone();
+		} 
+		catch (CloneNotSupportedException e) {
+			throw new InternalError();
+		}
+		return anObject;
+	}
+
+	/**
 	 * Returns true if anObject is equal to this one. Objects are considered
 	 * equal if they would generate identical binary data when they are encoded
 	 * to a Flash file.
@@ -470,24 +496,6 @@
 		return result;
 	}
 
-	/**
-	 * Creates a copy of the entire object.
-	 * 
-	 * @return a copy of the object.
-	 */
-	public Object clone()
-	{
-		Object anObject = null;
-
-		try {
-			anObject = super.clone();
-		} 
-		catch (CloneNotSupportedException e) {
-			throw new InternalError();
-		}
-		return anObject;
-	}
-
 	public String toString()
 	{
 		StringBuffer buffer = new StringBuffer();
@@ -508,81 +516,85 @@
 	{
 		int numberOfBits = 14; // include 7 bits for byte alignment
 		
-		numberOfBits += translateFieldSize() * 2;
+		hasScale = matrix[0][0] != 1.0f || matrix[1][1] != 1.0f;
+		hasRotate = matrix[1][0] != 0.0f || matrix[0][1] != 0.0f;
+	    hasTranslate = matrix[0][2] != 0.0f || matrix[1][2] != 0.0f;
 		
-		if (containsScaling())
-			numberOfBits += 5 + scaleFieldSize() * 2;
+		translateSize = 0;
+		
+		if (hasTranslate) {
+			translateSize = FSCoder.size(new int[] { (int) matrix[0][2], (int) matrix[1][2] }, true);;
+		}
+		
+		numberOfBits += translateSize &lt;&lt; 1;
+		
+		if (hasScale) {
+			scaleSize = FSCoder.fixedSize(new float[] { matrix[0][0], matrix[1][1] });
+			numberOfBits += 5 + scaleSize &lt;&lt; 1;
+		}
 
-		if (containsRotation())
-			numberOfBits += 5 + rotateFieldSize() * 2;
+		if (hasRotate) {
+			rotateSize = FSCoder.fixedSize(new float[] { matrix[1][0], matrix[0][1] });
+			numberOfBits += 5 + rotateSize &lt;&lt; 1;
+		}
 
 		return numberOfBits &gt;&gt; 3;
 	}
 
 	public void encode(FSCoder coder, FSContext context)
 	{
-		int translateBits = translateFieldSize();
-
 		coder.alignToByte();
 
-		coder.writeBits(containsScaling() ? 1 : 0, 1);
+		coder.writeBits(hasScale ? 1 : 0, 1);
 
-		if (containsScaling())
+		if (hasScale)
 		{
-			int scaleBits = scaleFieldSize();
-
-			coder.writeBits(scaleBits, 5);
-			coder.writeFixedBits(matrix[0][0], scaleBits, 16);
-			coder.writeFixedBits(matrix[1][1], scaleBits, 16);
+			coder.writeBits(scaleSize, 5);
+			coder.writeFixedBits(matrix[0][0], scaleSize, 16);
+			coder.writeFixedBits(matrix[1][1], scaleSize, 16);
 		}
 
-		coder.writeBits(containsRotation() ? 1 : 0, 1);
+		coder.writeBits(hasRotate ? 1 : 0, 1);
 
-		if (containsRotation())
+		if (hasRotate)
 		{
-			int rotateBits = rotateFieldSize();
-
-			coder.writeBits(rotateBits, 5);
-			coder.writeFixedBits(matrix[1][0], rotateBits, 16);
-			coder.writeFixedBits(matrix[0][1], rotateBits, 16);
+			coder.writeBits(rotateSize, 5);
+			coder.writeFixedBits(matrix[1][0], rotateSize, 16);
+			coder.writeFixedBits(matrix[0][1], rotateSize, 16);
 		}
-		coder.writeBits(translateBits, 5);
-		coder.writeBits((int) matrix[0][2], translateBits);
-		coder.writeBits((int) matrix[1][2], translateBits);
+		
+		coder.writeBits(translateSize, 5);
+		coder.writeBits((int) matrix[0][2], translateSize);
+		coder.writeBits((int) matrix[1][2], translateSize);
 
 		coder.alignToByte();
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		int scaleFieldSize = 0;
-		int rotateFieldSize = 0;
-		int translateFieldSize = 0;
-
 		coder.alignToByte();
 
-		boolean _containsScaling = coder.readBits(1, false) != 0 ? true : false;
+		hasScale = coder.readBits(1, false) != 0 ? true : false;
 
-		if (_containsScaling)
+		if (hasScale)
 		{
-			scaleFieldSize = coder.readBits(5, false);
-			matrix[0][0] = coder.readFixedBits(scaleFieldSize, 16);
-			matrix[1][1] = coder.readFixedBits(scaleFieldSize, 16);
+			scaleSize = coder.readBits(5, false);
+			matrix[0][0] = coder.readFixedBits(scaleSize, 16);
+			matrix[1][1] = coder.readFixedBits(scaleSize, 16);
 		}
 
-		boolean _containsRotation = coder.readBits(1, false) != 0 ? true
-						: false;
+		hasRotate = coder.readBits(1, false) != 0 ? true : false;
 
-		if (_containsRotation)
+		if (hasRotate)
 		{
-			rotateFieldSize = coder.readBits(5, false);
-			matrix[1][0] = coder.readFixedBits(rotateFieldSize, 16);
-			matrix[0][1] = coder.readFixedBits(rotateFieldSize, 16);
+			rotateSize = coder.readBits(5, false);
+			matrix[1][0] = coder.readFixedBits(rotateSize, 16);
+			matrix[0][1] = coder.readFixedBits(rotateSize, 16);
 		}
 
-		translateFieldSize = coder.readBits(5, false);
-		matrix[0][2] = (float) coder.readBits(translateFieldSize, true);
-		matrix[1][2] = (float) coder.readBits(translateFieldSize, true);
+		translateSize = coder.readBits(5, false);
+		matrix[0][2] = (float) coder.readBits(translateSize, true);
+		matrix[1][2] = (float) coder.readBits(translateSize, true);
 
 		coder.alignToByte();
 	}
@@ -596,51 +608,13 @@
 	 */
 	public boolean isUnityTransform()
 	{
-		return !(containsScaling() || containsRotation() || containsTranslation());
-	}
+		boolean scale = matrix[0][0] != 1.0f || matrix[1][1] != 1.0f;
+		boolean rotate = matrix[1][0] != 0.0f || matrix[0][1] != 0.0f;
+	    boolean translate = matrix[0][2] != 0.0f || matrix[1][2] != 0.0f;
 
-	private boolean containsScaling()
-	{
-		return matrix[0][0] != 1.0f || matrix[1][1] != 1.0f;
+		return !(scale || rotate || translate);
 	}
 
-	private boolean containsRotation()
-	{
-		return matrix[1][0] != 0.0f || matrix[0][1] != 0.0f;
-	}
-
-	private boolean containsTranslation()
-	{
-		return matrix[0][2] != 0.0f || matrix[1][2] != 0.0f;
-	}
-
-	private int scaleFieldSize()
-	{
-		int size = 0;
-
-		if (isUnityTransform() == false)
-			size = FSCoder.fixedSize(new float[] { matrix[0][0], matrix[1][1] });
-
-		return size;
-	}
-
-	private int rotateFieldSize()
-	{
-		int size = FSCoder.fixedSize(new float[] { matrix[1][0], matrix[0][1] });
-
-		return size;
-	}
-
-	private int translateFieldSize()
-	{
-		int size = 0;
-
-		if (containsTranslation())
-			size = FSCoder.size(new int[] { (int) matrix[0][2], (int) matrix[1][2] }, true);
-
-		return size;
-	}
-
 	private void composite(float[][] m)
 	{
 		float result[][] = new float[3][3];

Modified: dev/dev-2-4/src/com/flagstone/transform/FSCurve.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSCurve.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSCurve.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -101,14 +101,13 @@
  */
 public class FSCurve extends FSShapeObject
 {
-	private int controlX = 0;
+	private int controlX;
+	private int controlY;
+	private int anchorX;
+	private int anchorY;
+	
+	private int size;
 
-	private int controlY = 0;
-
-	private int anchorX = 0;
-
-	private int anchorY = 0;
-
 	/**
 	 * Construct an FSCurve object, initalizing it with values decoded from an
 	 * encoded object.
@@ -137,6 +136,9 @@
 	 * @param ay
 	 *            the y-coordinate of the anchor point, specified relative to
 	 *            the control point.
+	 *            
+	 * @throws IllegalArgumentException if any of the coordinates are not in 
+	 * the range -65535..65535.
 	 */
 	public FSCurve(int cx, int cy, int ax, int ay)
 	{
@@ -358,10 +360,8 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSCurve : {&quot;);
-		buffer.append(&quot;control = (&quot;).append(controlX).append(&quot;,&quot;).append(
-						controlY).append(&quot;); &quot;);
-		buffer.append(&quot;anchor = (&quot;).append(anchorX).append(&quot;,&quot;).append(anchorY)
-						.append(&quot;); &quot;);
+		buffer.append(&quot;control = (&quot;).append(controlX).append(&quot;,&quot;).append(controlY).append(&quot;); &quot;);
+		buffer.append(&quot;anchor = (&quot;).append(anchorX).append(&quot;,&quot;).append(anchorY).append(&quot;); &quot;);
 		buffer.append(&quot;}&quot;);
 
 		return buffer.toString();
@@ -371,11 +371,9 @@
 	{
 		int numberOfBits = 6;
 
-		int _fieldSize = FSCoder.size(new int[]
-		{
-			controlX, controlY, anchorX, anchorY, 1 }, true);
+		size = FSCoder.size(new int[] {controlX, controlY, anchorX, anchorY, 1 }, true);
 
-		numberOfBits += _fieldSize * 4;
+		numberOfBits += size &lt;&lt; 2;
 
 		context.shapeSize += numberOfBits;
 
@@ -384,27 +382,22 @@
 
 	public void encode(FSCoder coder, FSContext context)
 	{
-		int _fieldSize = FSCoder.size(new int[] {controlX, controlY, anchorX, anchorY, 1 }, true);
-
-		
 		coder.writeBits(2, 2); // shapeType, edgeType
-
-		coder.writeBits(_fieldSize-2, 4);
-		coder.writeBits(controlX, _fieldSize);
-		coder.writeBits(controlY, _fieldSize);
-		coder.writeBits(anchorX, _fieldSize);
-		coder.writeBits(anchorY, _fieldSize);
+		coder.writeBits(size-2, 4);
+		coder.writeBits(controlX, size);
+		coder.writeBits(controlY, size);
+		coder.writeBits(anchorX, size);
+		coder.writeBits(anchorY, size);
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
 		// skip over shapeType and edgeType
 		coder.adjustPointer(2);
-
-		int fieldSize = coder.readBits(4, false) + 2;
-		controlX = coder.readBits(fieldSize, true);
-		controlY = coder.readBits(fieldSize, true);
-		anchorX = coder.readBits(fieldSize, true);
-		anchorY = coder.readBits(fieldSize, true);
+		size = coder.readBits(4, false) + 2;
+		controlX = coder.readBits(size, true);
+		controlY = coder.readBits(size, true);
+		anchorX = coder.readBits(size, true);
+		anchorY = coder.readBits(size, true);
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineButton.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineButton.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineButton.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -183,14 +183,12 @@
  */
 public class FSDefineButton extends FSDefineObject
 {
-	private ArrayList buttonRecords = null;
+	private ArrayList&lt;FSButton&gt; buttonRecords;
+	private ArrayList&lt;FSActionObject&gt; actions;
+	private byte[] encodedActions;
 
-	private ArrayList actions = null;
-
-	private byte[] encodedActions = null;
-
 	/**
-	 * Construct an FSDefineButton object, initalizing it with values decoded
+	 * Construct an FSDefineButton object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -208,17 +206,20 @@
 	 * 
 	 * @param anIdentifier
 	 *            a unique identifier for this button.
-	 * @param buttonRecordArray
+	 * @param buttons
 	 *            an array of FSButton objects.
-	 * @param actionArray
+	 * @param actions
 	 *            and array of action objects.
+	 * 
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the array of FSButton objects is null.
+	 * @throws NullPointerException if the array of actions is null.
 	 */
-	public FSDefineButton(int anIdentifier, ArrayList buttonRecordArray,
-							ArrayList actionArray)
+	public FSDefineButton(int anIdentifier, ArrayList&lt;FSButton&gt; buttons, ArrayList&lt;FSActionObject&gt; actions)
 	{
 		super(DefineButton, anIdentifier);
-		setButtonRecords(buttonRecordArray);
-		setActions(actionArray);
+		setButtonRecords(buttons);
+		setActions(actions);
 	}
 
 	/**
@@ -232,20 +233,18 @@
 	{
 		super(obj);
 
-		buttonRecords = new ArrayList();
+		buttonRecords = new ArrayList&lt;FSButton&gt;();
 
-		for (Iterator i = obj.buttonRecords.iterator(); i.hasNext();)
-			buttonRecords.add(((FSButton) i.next()).clone());
+		for (Iterator&lt;FSButton&gt; i = obj.buttonRecords.iterator(); i.hasNext();)
+			buttonRecords.add((FSButton) i.next().clone());
 
 		if (actions != null)
 		{
-			actions = new ArrayList();
-
-			for (Iterator i = obj.actions.iterator(); i.hasNext();)
-				actions.add(((FSActionObject) i.next()).clone());
-		} else
+			actions = FSActionObject.copy(obj.actions);
+		} 
+		else
 		{
-			encodedActions = Transform.clone(obj.encodedActions);
+			encodedActions = FSMovieObject.copy(obj.encodedActions);
 		}
 	}
 
@@ -255,16 +254,19 @@
 	 * 
 	 * @param anIdentifier
 	 *            a unique identifier for this button.
-	 * @param buttonRecordArray
+	 * @param buttons
 	 *            an array of FSButton objects.
 	 * @param bytes
 	 *            an array of encoded action objects.
+	 * 
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the array of FSButton objects is null.
+	 * @throws NullPointerException if the encoded actions is null.
 	 */
-	public FSDefineButton(int anIdentifier, ArrayList buttonRecordArray,
-							byte[] bytes)
+	public FSDefineButton(int anIdentifier, ArrayList&lt;FSButton&gt; buttons, byte[] bytes)
 	{
 		super(DefineButton, anIdentifier);
-		setButtonRecords(buttonRecordArray);
+		setButtonRecords(buttons);
 		setEncodedActions(bytes);
 	}
 
@@ -300,7 +302,7 @@
 	 * 
 	 * @return the array of FSButton objects defined for this button.
 	 */
-	public ArrayList getButtonRecords()
+	public ArrayList&lt;FSButton&gt; getButtonRecords()
 	{
 		return buttonRecords;
 	}
@@ -311,7 +313,7 @@
 	 * 
 	 * @return the array of action objects defined for this button.
 	 */
-	public ArrayList getActions()
+	public ArrayList&lt;FSActionObject&gt; getActions()
 	{
 		if (encodedActions != null)
 		{
@@ -326,9 +328,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of FSButton objects.
+	 *           
+	 * @throws NullPointerException if the array of button records is null.
 	 */
-	public void setButtonRecords(ArrayList anArray)
+	public void setButtonRecords(ArrayList&lt;FSButton&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of button records cannot be null.&quot;);
+		}
 		buttonRecords = anArray;
 	}
 
@@ -338,9 +345,14 @@
 	 * 
 	 * @param anArray
 	 *            and array of action objects.
+	 *           
+	 * @throws NullPointerException if the array of actions is null.
 	 */
-	public void setActions(ArrayList anArray)
+	public void setActions(ArrayList&lt;FSActionObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of actions cannot be null.&quot;);
+		}
 		actions = anArray;
 		encodedActions = null;
 	}
@@ -365,34 +377,35 @@
 	 * 
 	 * @param bytes
 	 *            the array of encoded actions.
+	 *        
+	 * @throws NullPointerException if the encoded actions is null.
 	 */
 	public void setEncodedActions(byte[] bytes)
 	{
+		if (bytes == null)  {
+			throw new NullPointerException(&quot;Encoded actions cannot be null.&quot;);
+		}
 		encodedActions = bytes;
 		actions = null;
 	}
 
 	public Object clone()
 	{
-		FSDefineButton anObject = (FSDefineButton) super.clone();
+		FSDefineButton obj = (FSDefineButton) super.clone();
 
-		anObject.buttonRecords = new ArrayList();
+		obj.buttonRecords = new ArrayList&lt;FSButton&gt;();
 
-		for (Iterator i = buttonRecords.iterator(); i.hasNext();)
-			anObject.buttonRecords.add(((FSButton) i.next()).clone());
+		for (Iterator&lt;FSButton&gt; i = buttonRecords.iterator(); i.hasNext();)
+			obj.buttonRecords.add((FSButton) i.next().clone());
 
-		if (actions != null)
-		{
-			anObject.actions = new ArrayList();
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-				anObject.actions.add(((FSActionObject) i.next()).clone());
-		} else
-		{
-			anObject.encodedActions = Transform.clone(encodedActions);
+		if (actions != null) {
+			actions = FSActionObject.copy(obj.actions);
+		} 
+		else {
+			encodedActions = FSMovieObject.copy(obj.encodedActions);
 		}
 
-		return anObject;
+		return obj;
 	}
 
 	public boolean equals(Object anObject)
@@ -403,16 +416,12 @@
 		{
 			FSDefineButton typedObject = (FSDefineButton) anObject;
 
-			if (buttonRecords != null)
-				result = buttonRecords.equals(typedObject.buttonRecords);
-			else
-				result = buttonRecords == typedObject.buttonRecords;
+			result = buttonRecords.equals(typedObject.buttonRecords);
 
 			if (actions != null)
 				result = actions.equals(typedObject.actions);
 			else
-				result = Transform.equals(encodedActions,
-								typedObject.encodedActions);
+				result = FSMovieObject.equals(encodedActions, typedObject.encodedActions);
 		}
 		return result;
 	}
@@ -422,6 +431,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineButton: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;buttonRecords = &quot;).append(buttonRecords.toString()).append(&quot;; &quot;);
 
 		if (actions != null)
@@ -438,35 +448,20 @@
 	{
 		super.length(context);
 
-		for (Iterator&lt;Codeable&gt; buttonIterator = buttonRecords.iterator(); buttonIterator.hasNext();)
-			length += buttonIterator.next().length(context);
+		for (Iterator&lt;FSButton&gt; i = buttonRecords.iterator(); i.hasNext();)
+			length += i.next().length(context);
 
 		length += 1;
 
 		if (actions != null)
 		{
-			FSActionObject currentAction = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				currentAction = (FSActionObject) i.next();
-
-				length += currentAction.length(context);
-				length += (currentAction.getType() &gt; 128) ? 3 : 1;
-			}
-
-			if ((actions.size() == 0)
-							|| (currentAction.getType() != FSAction.End))
-			{
-				length += 1;
-			}
-		} else
+			length += FSActionObject.length(context, actions);
+		} 
+		else
 		{
 			length += encodedActions.length;
 
-			if ((encodedActions.length == 0)
-							|| (encodedActions[encodedActions.length - 1] != FSAction.End))
-			{
+			if ((encodedActions.length == 0) || (encodedActions[encodedActions.length - 1] != FSAction.End)) {
 				length += 1;
 			}
 		}
@@ -478,49 +473,20 @@
 	{
 		super.encode(coder, context);
 
-		for (Iterator&lt;Codeable&gt; buttonIterator = buttonRecords.iterator(); buttonIterator.hasNext();)
-			buttonIterator.next().encode(coder, context);
+		for (Iterator&lt;FSButton&gt; i = buttonRecords.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		coder.writeWord(0, 1);
 
 		if (actions != null)
 		{
-			FSActionObject action = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				action = (FSActionObject) i.next();
-
-				int objStart = coder.getPointer();
-				int start = coder.getPointer()
-								+ ((action.getType() &gt; 128) ? 24 : 8);
-				int next = start + (action.getLength() &lt;&lt; 3);
-
-				action.encode(coder, context);
-				coder.setPointer(next);
-
-				int delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-				if (delta != 0)
-				{
-					context.codingError = true;
-					context.typeInError = action.getType();
-					context.startOfError = objStart &gt;&gt;&gt; 3;
-					context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
-					context.delta = delta;
-				}
-			}
-
-			if ((actions.size() == 0) || (action.getType() != FSAction.End))
-			{
-				coder.writeWord(0, 1);
-			}
-		} else
+			FSActionObject.encode(coder, context, actions);
+		} 
+		else
 		{
 			coder.writeBytes(encodedActions);
 
-			if ((encodedActions.length == 0)
-							|| (encodedActions[encodedActions.length - 1] != FSAction.End))
+			if ((encodedActions.length == 0) || (encodedActions[encodedActions.length - 1] != FSAction.End))
 			{
 				coder.writeWord(0, 1);
 			}
@@ -533,7 +499,7 @@
 
 		int start = coder.getPointer() - 16;
 
-		buttonRecords = new ArrayList();
+		buttonRecords = new ArrayList&lt;FSButton&gt;();
 
 		while (coder.scanWord(1, false) != 0)
 			buttonRecords.add(new FSButton(coder, context));
@@ -544,16 +510,9 @@
 
 		if (context.decodeActions)
 		{
-			actions = new ArrayList();
-
-			while (actionsLength &gt; 0)
-			{
-				start = coder.getPointer();
-
-				actions.add(FSActionObject.decodeAction(coder, context));
-				actionsLength -= (coder.getPointer() - start) &gt;&gt;&gt; 3;
-			}
-		} else
+			actions = FSActionObject.decodeActions(coder, context, actionsLength);
+		} 
+		else
 		{
 			encodedActions = new byte[actionsLength];
 			coder.readBytes(encodedActions);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineButton2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineButton2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineButton2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -87,15 +87,6 @@
  * executed for each type of button event.&lt;/td&gt;
  * &lt;/tr&gt;
  * 
- * &lt;tr&gt;
- * &lt;td&gt;encodedEvents&lt;/td&gt;
- * &lt;td&gt;An array of bytes containing encoded button events can also be set. The
- * encoded objects are typically generated by the parser in the Translate
- * framework. The buttonEvents array and encodedEvents cannot both be valid at
- * the same time. Accessor methods used to set either of the attributes will set
- * the other to null.&lt;/td&gt;
- * &lt;/tr&gt;
- * 
  * &lt;/table&gt;
  * 
  * &lt;p&gt;
@@ -164,19 +155,17 @@
 	 */
 	public static final int Push = 0;
 
-	/** Defines whether a FSDefineButton2 object is configured as a menu button. */
+	/** 
+	 * Defines whether a FSDefineButton2 object is configured as a menu button. 
+	 * */
 	public static final int Menu = 1;
 
 	private int buttonType = Push;
+	private ArrayList&lt;FSButton&gt; buttonRecords = null;
+	private ArrayList&lt;FSButtonEvent&gt; buttonEvents = null;
 
-	private ArrayList buttonRecords = null;
-
-	private ArrayList buttonEvents = null;
-
-	private byte[] encodedEvents = null;
-
 	/**
-	 * Construct an FSDefineButton2 object, initalizing it with values decoded
+	 * Construct an FSDefineButton2 object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -202,10 +191,14 @@
 	 *            an array of FSButton objects.
 	 * @param buttonEventArray
 	 *            an array of FSButtonEvent objects.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the array of FSButton objects is null.
+	 * @throws NullPointerException if the array of FSButtonEvents is null.
 	 */
 	public FSDefineButton2(int anIdentifier, int buttonType,
-							ArrayList buttonRecordArray,
-							ArrayList buttonEventArray)
+							ArrayList&lt;FSButton&gt; buttonRecordArray,
+							ArrayList&lt;FSButtonEvent&gt; buttonEventArray)
 	{
 		super(DefineButton2, anIdentifier);
 		setButtonType(buttonType);
@@ -214,30 +207,6 @@
 	}
 
 	/**
-	 * Constructs an FSDefineButton object, specifying the unique identifier,
-	 * the type of button to be created, the button records that describe the
-	 * button's appearance and the encoded actions that are performed in
-	 * response to each button event.
-	 * 
-	 * @param anIdentifier
-	 *            a unique identifier for this button.
-	 * @param buttonType
-	 *            the type of button - push or menu.
-	 * @param buttonRecordArray
-	 *            an array of FSButton objects.
-	 * @param bytes
-	 *            an array containing the encoded FSButtonEvent objects.
-	 */
-	public FSDefineButton2(int anIdentifier, int buttonType,
-							ArrayList buttonRecordArray, byte[] bytes)
-	{
-		super(DefineButton2, anIdentifier);
-		setButtonType(buttonType);
-		setButtonRecords(buttonRecordArray);
-		setEncodedEvents(bytes);
-	}
-
-	/**
 	 * Constructs an FSDefineButton2 object by copying values from an existing
 	 * object.
 	 * 
@@ -249,21 +218,15 @@
 		super(obj);
 		buttonType = obj.buttonType;
 
-		buttonRecords = new ArrayList();
+		buttonRecords = new ArrayList&lt;FSButton&gt;();
 
-		for (Iterator i = obj.buttonRecords.iterator(); i.hasNext();)
-			buttonRecords.add(((FSButton) i.next()).clone());
+		for (Iterator&lt;FSButton&gt; i = obj.buttonRecords.iterator(); i.hasNext();)
+			buttonRecords.add((FSButton) i.next().clone());
 
-		if (buttonEvents != null)
-		{
-			buttonEvents = new ArrayList();
+		buttonEvents = new ArrayList&lt;FSButtonEvent&gt;();
 
-			for (Iterator i = obj.buttonEvents.iterator(); i.hasNext();)
-				buttonEvents.add(((FSButtonEvent) i.next()).clone());
-		} else
-		{
-			encodedEvents = Transform.clone(obj.encodedEvents);
-		}
+		for (Iterator&lt;FSButtonEvent&gt; i = obj.buttonEvents.iterator(); i.hasNext();)
+			buttonEvents.add((FSButtonEvent) i.next().clone());
 	}
 
 	/**
@@ -285,11 +248,7 @@
 	 */
 	public void add(FSButtonEvent aButtonEvent)
 	{
-		if (buttonEvents == null)
-			buttonEvents = new ArrayList();
-
 		buttonEvents.add(aButtonEvent);
-		encodedEvents = null;
 	}
 
 	/**
@@ -307,7 +266,7 @@
 	 * 
 	 * @return the array of button records.
 	 */
-	public ArrayList getButtonRecords()
+	public ArrayList&lt;FSButton&gt; getButtonRecords()
 	{
 		return buttonRecords;
 	}
@@ -317,7 +276,7 @@
 	 * 
 	 * @return the array of button events.
 	 */
-	public ArrayList getButtonEvents()
+	public ArrayList&lt;FSButtonEvent&gt; getButtonEvents()
 	{
 		return buttonEvents;
 	}
@@ -338,9 +297,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of FSButtonRecord objects.
+	 *            
+	 * @throws NullPointerException if the array of FSButton objects is null.
 	 */
-	public void setButtonRecords(ArrayList anArray)
+	public void setButtonRecords(ArrayList&lt;FSButton&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of button records cannot be null.&quot;);
+		}
 		buttonRecords = anArray;
 	}
 
@@ -350,48 +314,31 @@
 	 * 
 	 * @param anArray
 	 *            and array of FSButtonEvent objects.
+	 *            
+	 * @throws NullPointerException if the array of FSButtonEvent objects is null.
 	 */
-	public void setButtonEvents(ArrayList anArray)
+	public void setButtonEvents(ArrayList&lt;FSButtonEvent&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of button events cannot be null.&quot;);
+		}
 		buttonEvents = anArray;
-
-		if (encodedEvents != null)
-			encodedEvents = null;
 	}
 
-	/**
-	 * Set the encoded button event objects generated by the classes in the
-	 * Translate framework. If the object already contains an array of button
-	 * events objects then they will be deleted.
-	 * 
-	 * @param bytes
-	 *            the array of encoded button events.
-	 */
-	public void setEncodedEvents(byte[] bytes)
-	{
-		encodedEvents = bytes;
-		buttonEvents = null;
-	}
-
 	public Object clone()
 	{
 		FSDefineButton2 anObject = (FSDefineButton2) super.clone();
 
-		anObject.buttonRecords = new ArrayList();
+		anObject.buttonRecords = new ArrayList&lt;FSButton&gt;();
 
-		for (Iterator i = buttonRecords.iterator(); i.hasNext();)
-			anObject.buttonRecords.add(((FSButton) i.next()).clone());
+		for (Iterator&lt;FSButton&gt; i = buttonRecords.iterator(); i.hasNext();)
+			anObject.buttonRecords.add((FSButton) i.next().clone());
 
-		if (buttonEvents != null)
-		{
-			anObject.buttonEvents = new ArrayList();
+		anObject.buttonEvents = new ArrayList&lt;FSButtonEvent&gt;();
 
-			for (Iterator i = buttonEvents.iterator(); i.hasNext();)
-				anObject.buttonEvents.add(((FSButtonEvent) i.next()).clone());
-		} else
-		{
-			anObject.encodedEvents = Transform.clone(encodedEvents);
-		}
+		for (Iterator&lt;FSButtonEvent&gt; i = buttonEvents.iterator(); i.hasNext();)
+			anObject.buttonEvents.add((FSButtonEvent) i.next().clone());
+
 		return anObject;
 	}
 
@@ -404,19 +351,8 @@
 			FSDefineButton2 typedObject = (FSDefineButton2) anObject;
 
 			result = buttonType == typedObject.buttonType;
-
-			if (buttonRecords != null)
-				result = result
-								&amp;&amp; buttonRecords
-												.equals(typedObject.buttonRecords);
-			else
-				result = result &amp;&amp; buttonRecords == typedObject.buttonRecords;
-
-			if (buttonEvents != null)
-				result = buttonEvents.equals(typedObject.buttonEvents);
-			else
-				result = Transform.equals(encodedEvents,
-								typedObject.encodedEvents);
+			result = result &amp;&amp; buttonRecords.equals(typedObject.buttonRecords);
+			result = buttonEvents.equals(typedObject.buttonEvents);
 		}
 		return result;
 	}
@@ -426,13 +362,9 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineButon2: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;buttonRecords = &quot;).append(buttonRecords.toString()).append(&quot;; &quot;);
-
-		if (buttonEvents != null)
-			buffer.append(&quot;buttonEvents = &quot;).append(buttonEvents.toString()).append(&quot;; &quot;);
-		else
-			buffer.append(&quot;buttonEvents = &lt;data&gt;; &quot;);
-
+		buffer.append(&quot;buttonEvents = &quot;).append(buttonEvents.toString()).append(&quot;; &quot;);
 		buffer.append(&quot;}&quot;);
 
 		return buffer.toString();
@@ -446,22 +378,17 @@
 
 		length += 3;
 
-		for (Iterator&lt;Codeable&gt; buttonIterator = buttonRecords.iterator(); buttonIterator.hasNext();)
+		for (Iterator&lt;FSButton&gt; buttonIterator = buttonRecords.iterator(); buttonIterator.hasNext();)
 			length += buttonIterator.next().length(context);
 
 		length += 1;
 
-		if (buttonEvents != null)
+		for (Iterator&lt;FSButtonEvent&gt; eventIterator = buttonEvents.iterator(); eventIterator.hasNext();)
 		{
-			for (Iterator&lt;Codeable&gt; eventIterator = buttonEvents.iterator(); eventIterator.hasNext();)
-			{
-				length += 2;
-				length += eventIterator.next().length(context);
-			}
-		} else
-		{
-			length += encodedEvents.length;
+			length += 2;
+			length += eventIterator.next().length(context);
 		}
+
 		context.transparent = false;
 
 		return length;
@@ -469,52 +396,45 @@
 
 	public void encode(FSCoder coder, FSContext context)
 	{
-		int offsetStart = 0;
-		int offsetEnd = 0;
-		int currentCursor = 0;
-
 		super.encode(coder, context);
 
 		context.transparent = true;
 
 		coder.writeWord(buttonType, 1);
 
-		offsetStart = coder.getPointer();
+		int offsetStart = coder.getPointer();
 		coder.writeWord(0, 2);
 
-		for (Iterator&lt;Codeable&gt; buttonIterator = buttonRecords.iterator(); buttonIterator.hasNext();)
-			buttonIterator.next().encode(coder, context);
+		for (Iterator&lt;FSButton&gt; i = buttonRecords.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		coder.writeWord(0, 1);
 
 		// Write actions offset
 
-		currentCursor = coder.getPointer();
-		offsetEnd = (currentCursor - offsetStart) &gt;&gt; 3;
+		int currentCursor = coder.getPointer();
+		int offsetEnd = (currentCursor - offsetStart) &gt;&gt; 3;
 		coder.setPointer(offsetStart);
 		coder.writeWord(offsetEnd, 2);
 		coder.setPointer(currentCursor);
 
-		if (buttonEvents != null)
-		{
-			for (Iterator&lt;FSButtonEvent&gt; eventIterator = buttonEvents.iterator(); eventIterator.hasNext();)
-			{
-				FSButtonEvent anEvent = eventIterator.next();
+		FSButtonEvent anEvent;
 
-				offsetStart = coder.getPointer();
-				coder.writeWord(anEvent.length(context) + 2, 2);
-				anEvent.encode(coder, context);
-			}
-			// Write offset of zero for last Action Condition
-
-			currentCursor = coder.getPointer();
-			coder.setPointer(offsetStart);
-			coder.writeWord(0, 2);
-			coder.setPointer(currentCursor);
-		} else
+		for (Iterator&lt;FSButtonEvent&gt; i = buttonEvents.iterator(); i.hasNext();)
 		{
-			coder.writeBytes(encodedEvents);
+			anEvent = i.next();
+
+			offsetStart = coder.getPointer();
+			coder.writeWord(anEvent.length(context) + 2, 2);
+			anEvent.encode(coder, context);
 		}
+		// Write offset of zero for last Action Condition
+
+		currentCursor = coder.getPointer();
+		coder.setPointer(offsetStart);
+		coder.writeWord(0, 2);
+		coder.setPointer(currentCursor);
+
 		context.transparent = false;
 	}
 
@@ -522,7 +442,8 @@
 	{
 		int offsetToNext = 0;
 
-		buttonEvents = new ArrayList();
+		buttonEvents = new ArrayList&lt;FSButtonEvent&gt;();
+		buttonRecords = new ArrayList&lt;FSButton&gt;();
 
 		super.decode(coder, context);
 
@@ -533,8 +454,6 @@
 		buttonType = coder.readByte();
 		offsetToNext = coder.readWord(2, false);
 
-		buttonRecords = new ArrayList();
-
 		while (coder.scanWord(1, false) != 0)
 			buttonRecords.add(new FSButton(coder, context));
 
@@ -542,8 +461,6 @@
 
 		if (offsetToNext != 0)
 		{
-			buttonEvents = new ArrayList();
-
 			do
 			{
 				offsetToNext = coder.readWord(2, false);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineFont.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineFont.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineFont.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -83,10 +83,10 @@
  */
 public class FSDefineFont extends FSDefineObject
 {
-	private ArrayList&lt;FSShape&gt; shapes = null;
+	private ArrayList&lt;FSShape&gt; shapes;
 
 	/**
-	 * Construct an FSCall object, initalizing it with values decoded from an
+	 * Construct an FSCall object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -108,6 +108,8 @@
 	 * @param anArray
 	 *            an array of FSShape objects that define the outlines for each
 	 *            glyph in the font.
+	 *            
+	 * @throws NullPointerException if the array of shapes is null.
 	 */
 	public FSDefineFont(int anIdentifier, ArrayList&lt;FSShape&gt; anArray)
 	{
@@ -137,9 +139,14 @@
 	 * 
 	 * @param anObject
 	 *            a shape.
+	 *            
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public void add(FSShape anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Shape cannot be null&quot;);
+		}
 		shapes.add(anObject);
 	}
 
@@ -159,9 +166,14 @@
 	 * @param anArray
 	 *            an array of FSShape objects that define the outlines for each
 	 *            glyph in the font.
+	 *            
+	 * @throws NullPointerException if the array of shapes is null.
 	 */
 	public void setShapes(ArrayList&lt;FSShape&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of shapes cannot be null.&quot;);
+		}
 		shapes = anArray;
 	}
 
@@ -185,10 +197,7 @@
 		{
 			FSDefineFont typedObject = (FSDefineFont) anObject;
 
-			if (shapes != null)
-				result = shapes.equals(typedObject.shapes);
-			else
-				result = shapes == typedObject.shapes;
+			result = shapes.equals(typedObject.shapes);
 		}
 		return result;
 	}
@@ -198,6 +207,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineFont: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;shapes = &quot;).append(shapes.toString()).append(&quot;; &quot;);
 		buffer.append(&quot;}&quot;);
 
@@ -256,7 +266,7 @@
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		shapes = new ArrayList();
+		shapes = new ArrayList&lt;FSShape&gt;();
 
 		super.decode(coder, context);
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineFont2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineFont2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineFont2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -178,23 +178,23 @@
  */
 public class FSDefineFont2 extends FSDefineObject
 {
-	private int encoding = FSText.Unicode;
-	private boolean small = false;
-	private boolean italic = false;
-	private boolean bold = false;
-	private int language = 0;
-	private String name = &quot;&quot;;
-	private ArrayList&lt;FSShape&gt; shapes = new ArrayList&lt;FSShape&gt;();
-	private ArrayList&lt;Integer&gt; codes = new ArrayList&lt;Integer&gt;();
-	private int ascent = 0;
-	private int descent = 0;
-	private int leading = 0;
+	private int encoding;
+	private boolean small;
+	private boolean italic;
+	private boolean bold;
+	private int language;
+	private String name;
+	private ArrayList&lt;FSShape&gt; shapes;
+	private ArrayList&lt;Integer&gt; codes;
+	private int ascent;
+	private int descent;
+	private int leading;
 	private ArrayList&lt;Integer&gt; advances;
 	private ArrayList&lt;FSBounds&gt; bounds;
 	private ArrayList&lt;FSKerning&gt; kernings;
 
 	/**
-	 * Construct an FSDefineFont2 object, initalizing it with values decoded
+	 * Construct an FSDefineFont2 object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -230,6 +230,17 @@
 	{
 		super(DefineFont2, anIdentifier);
 		setName(name);
+		
+		encoding = FSText.Unicode;
+		small = false;
+		bold = false;
+		italic = false;
+		language = 0;
+		shapes = new ArrayList&lt;FSShape&gt;();
+		codes = new ArrayList&lt;Integer&gt;();
+		ascent = 0;
+		descent = 0;
+		leading = 0;
 	}
 
 	/**
@@ -293,9 +304,14 @@
 	 * 
 	 * @param anObject
 	 *            a shape.
+	 *            
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public void add(FSShape anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Shape cannot be null.&quot;);
+		}
 		shapes.add(anObject);
 	}
 
@@ -304,9 +320,14 @@
 	 * 
 	 * @param aCode
 	 *            a code for a glyph.
+	 *            
+	 * @throws IllegalArgumentException if the code is not in the range 0..65535.
 	 */
 	public void addCode(int aCode)
 	{
+		if (aCode &lt; 0 || aCode &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Character code must be in the range 0..65535.&quot;);
+		}
 		codes.add(new Integer(aCode));
 	}
 
@@ -315,9 +336,18 @@
 	 * 
 	 * @param anAdvance
 	 *            an advance for a glyph.
+	 *            
+	 * @throws IllegalArgumentException if the advance is not in the range -32768..32767.
 	 */
 	public void addAdvance(int anAdvance)
 	{
+		if (anAdvance &lt; -32768 || anAdvance &gt; 32767) {
+			throw new IllegalArgumentException(&quot;Advance must be in the range -32768..32767.&quot;);
+		}
+		
+		if (advances == null) {
+			advances = new ArrayList&lt;Integer&gt;();
+		}
 		advances.add(new Integer(anAdvance));
 	}
 
@@ -326,9 +356,19 @@
 	 * 
 	 * @param anObject
 	 *            an FSBounds.
+	 *            
+	 * @throws NullPointerException if the bounds object is null.
 	 */
 	public void add(FSBounds anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Bounding box cannot be null.&quot;);
+		}
+		
+		if (bounds == null) {
+			bounds = new ArrayList&lt;FSBounds&gt;();
+		}
+
 		bounds.add(anObject);
 	}
 
@@ -337,9 +377,19 @@
 	 * 
 	 * @param anObject
 	 *            an FSKerning.
+	 *            
+	 * @throws NullPointerException if the kerning is null.
 	 */
 	public void add(FSKerning anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Kerning cannot be null.&quot;);
+		}
+		
+		if (kernings == null) {
+			kernings = new ArrayList&lt;FSKerning&gt;();
+		}
+
 		kernings.add(anObject);
 	}
 
@@ -450,7 +500,7 @@
 	 * 
 	 * @return an array of FSShape objects
 	 */
-	public ArrayList getShapes()
+	public ArrayList&lt;FSShape&gt; getShapes()
 	{
 		return shapes;
 	}
@@ -463,7 +513,7 @@
 	 * @return an array of Integer objects that contain the character codes for
 	 *         each glyph in the font.
 	 */
-	public ArrayList getCodes()
+	public ArrayList&lt;Integer&gt; getCodes()
 	{
 		return codes;
 	}
@@ -504,7 +554,7 @@
 	 * @return an array of Integer objects that contain the advance for each
 	 *         glyph in the font.
 	 */
-	public ArrayList getAdvances()
+	public ArrayList&lt;Integer&gt; getAdvances()
 	{
 		return advances;
 	}
@@ -514,7 +564,7 @@
 	 * 
 	 * @return an array of FSBounds objects.
 	 */
-	public ArrayList getBounds()
+	public ArrayList&lt;FSBounds&gt; getBounds()
 	{
 		return bounds;
 	}
@@ -526,7 +576,7 @@
 	 * @return an array of FSKerning objects that define the spacing adjustment
 	 *         between pairs of glyphs.
 	 */
-	public ArrayList getKernings()
+	public ArrayList&lt;FSKerning&gt; getKernings()
 	{
 		return kernings;
 	}
@@ -572,9 +622,14 @@
 	 * 
 	 * @param aString
 	 *            the name assigned to the font, identifying the font family.
+	 *            
+	 * @throws NullPointerException if the name is null.
 	 */
 	public void setName(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;The name of the font cannot be null&quot;);
+		}
 		name = aString;
 	}
 
@@ -585,9 +640,14 @@
 	 * @param anArray
 	 *            an array of FSShape objects that define the glyphs for the
 	 *            font.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setShapes(ArrayList anArray)
+	public void setShapes(ArrayList&lt;FSShape&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of shapes cannot be null.&quot;);
+		}
 		shapes = anArray;
 	}
 
@@ -597,9 +657,14 @@
 	 * @param anArray
 	 *            sets the code table that maps a particular glyph to a
 	 *            character code.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setCodes(ArrayList anArray)
+	public void setCodes(ArrayList&lt;Integer&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of character codes cannot be null.&quot;);
+		}
 		codes = anArray;
 	}
 
@@ -608,9 +673,14 @@
 	 * 
 	 * @param aNumber
 	 *            the ascent for the font.
+	 *            
+	 * @throws IllegalArgumentException if the ascent is not in the range -32768..32767.
 	 */
 	public void setAscent(int aNumber)
 	{
+		if (aNumber &lt; -32768 || aNumber &gt; 32767) {
+			throw new IllegalArgumentException(&quot;Ascent must be in the range -32768..32767.&quot;);
+		}	
 		ascent = aNumber;
 	}
 
@@ -619,9 +689,14 @@
 	 * 
 	 * @param aNumber
 	 *            the descent for the font.
+	 *            
+	 * @throws IllegalArgumentException if the descent is not in the range -32768..32767.
 	 */
 	public void setDescent(int aNumber)
 	{
+		if (aNumber &lt; -32768 || aNumber &gt; 32767) {
+			throw new IllegalArgumentException(&quot;Descent must be in the range -32768..32767.&quot;);
+		}
 		descent = aNumber;
 	}
 
@@ -630,9 +705,14 @@
 	 * 
 	 * @param aNumber
 	 *            the descent for the font.
+	 *            
+	 * @throws IllegalArgumentException if the descent is not in the range -32768..32767.
 	 */
 	public void setLeading(int aNumber)
 	{
+		if (aNumber &lt; -32768 || aNumber &gt; 32767) {
+			throw new IllegalArgumentException(&quot;Leading must be in the range -32768..32767.&quot;);
+		}
 		leading = aNumber;
 	}
 
@@ -641,9 +721,14 @@
 	 * 
 	 * @param anArray
 	 *            of Integer objects that define the spacing between glyphs.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setAdvances(ArrayList anArray)
+	public void setAdvances(ArrayList&lt;Integer&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of advances cannot be null.&quot;);
+		}
 		advances = anArray;
 	}
 
@@ -653,9 +738,14 @@
 	 * @param anArray
 	 *            an array of FSBounds objects that define the bounding
 	 *            rectangles that enclose each glyph in the font.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setBounds(ArrayList anArray)
+	public void setBounds(ArrayList&lt;FSBounds&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of bounding boxes cannot be null.&quot;);
+		}
 		bounds = anArray;
 	}
 
@@ -665,13 +755,17 @@
 	 * @param anArray
 	 *            an array of FSKerning objects that define an adjustment
 	 *            applied to the spacing between pairs of glyphs.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setKernings(ArrayList anArray)
+	public void setKernings(ArrayList&lt;FSKerning&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of kernings cannot be null.&quot;);
+		}
 		kernings = anArray;
 	}
 
-
 	public Object clone()
 	{
 		FSDefineFont2 anObject = (FSDefineFont2) super.clone();
@@ -719,53 +813,38 @@
 
 		if (super.equals(anObject))
 		{
-			FSDefineFont2 typedObject = (FSDefineFont2) anObject;
+			FSDefineFont2 font = (FSDefineFont2) anObject;
 
-			result = encoding == typedObject.encoding;
-			// Flash 7
-			result = result &amp;&amp; small == typedObject.small;
-			// End Flash 7
-			result = result &amp;&amp; italic == typedObject.italic;
-			result = result &amp;&amp; bold == typedObject.bold;
-			// Flash 6
-			result = result &amp;&amp; language == typedObject.language;
-			// End Flash 6
+			result = encoding == font.encoding;
+			result = result &amp;&amp; small == font.small;
+			result = result &amp;&amp; italic == font.italic;
+			result = result &amp;&amp; bold == font.bold;
+			result = result &amp;&amp; language == font.language;
 
-			if (name != null)
-				result = result &amp;&amp; name.equals(typedObject.name);
-			else
-				result = result &amp;&amp; name == typedObject.name;
+			result = result &amp;&amp; name.equals(font.name);
+			result = result &amp;&amp; shapes.equals(font.shapes);
+			result = result &amp;&amp; codes.equals(font.codes);
 
-			if (shapes != null)
-				result = result &amp;&amp; shapes.equals(typedObject.shapes);
-			else
-				result = result &amp;&amp; shapes == typedObject.shapes;
-
-			if (codes != null)
-				result = result &amp;&amp; codes.equals(typedObject.codes);
-			else
-				result = result &amp;&amp; codes == typedObject.codes;
-
 			if (containsLayoutInfo())
 			{
-				result = result &amp;&amp; ascent == typedObject.ascent;
-				result = result &amp;&amp; descent == typedObject.descent;
-				result = result &amp;&amp; leading == typedObject.leading;
+				result = result &amp;&amp; ascent == font.ascent;
+				result = result &amp;&amp; descent == font.descent;
+				result = result &amp;&amp; leading == font.leading;
 
 				if (advances != null)
-					result = result &amp;&amp; advances.equals(typedObject.advances);
+					result = result &amp;&amp; advances.equals(font.advances);
 				else
-					result = result &amp;&amp; advances == typedObject.advances;
+					result = result &amp;&amp; advances == font.advances;
 
 				if (bounds != null)
-					result = result &amp;&amp; bounds.equals(typedObject.bounds);
+					result = result &amp;&amp; bounds.equals(font.bounds);
 				else
-					result = result &amp;&amp; bounds == typedObject.bounds;
+					result = result &amp;&amp; bounds == font.bounds;
 
 				if (kernings != null)
-					result = result &amp;&amp; kernings.equals(typedObject.kernings);
+					result = result &amp;&amp; kernings.equals(font.kernings);
 				else
-					result = result &amp;&amp; kernings == typedObject.kernings;
+					result = result &amp;&amp; kernings == font.kernings;
 			}
 		}
 		return result;
@@ -776,24 +855,28 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineFont2: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;encoding = &quot;).append(encoding).append(&quot;; &quot;);
-		// Flash 7
 		buffer.append(&quot;small = &quot;).append(small).append(&quot;; &quot;);
-		// End Flash 7
 		buffer.append(&quot;italic = &quot;).append(italic).append(&quot;; &quot;);
 		buffer.append(&quot;bold = &quot;).append(bold).append(&quot;; &quot;);
-		// Flash 6
 		buffer.append(&quot;language = &quot;).append(language).append(&quot;; &quot;);
-		// End Flash 6
 		buffer.append(&quot;name = &quot;).append(name).append(&quot;; &quot;);
-		buffer.append(&quot;shapes = &quot;).append(shapes.toString()).append(&quot;; &quot;);
-		buffer.append(&quot;codes = &quot;).append(codes.toString()).append(&quot;; &quot;);
+		buffer.append(&quot;shapes = array[&quot;).append(shapes.size()).append(&quot;]; &quot;);
+		buffer.append(&quot;codes = array[&quot;).append(codes.size()).append(&quot;]; &quot;);
 		buffer.append(&quot;ascent = &quot;).append(ascent).append(&quot;; &quot;);
 		buffer.append(&quot;descent = &quot;).append(descent).append(&quot;; &quot;);
 		buffer.append(&quot;leading = &quot;).append(leading).append(&quot;; &quot;);
-		buffer.append(&quot;advances = &quot;).append(advances.toString()).append(&quot;; &quot;);
-		buffer.append(&quot;bounds = &quot;).append(bounds.toString()).append(&quot;; &quot;);
-		buffer.append(&quot;kernings = &quot;).append(kernings.toString()).append(&quot;; &quot;);
+		
+		if (advances != null) {
+			buffer.append(&quot;advances = array[&quot;).append(advances.size()).append(&quot;]; &quot;);
+		}
+		if (bounds != null) {
+			buffer.append(&quot;bounds = array[&quot;).append(bounds.size()).append(&quot;]; &quot;);
+		}
+		if (kernings != null) {
+			buffer.append(&quot;kernings = array[&quot;).append(kernings.size()).append(&quot;]; &quot;);
+		}
 		buffer.append(&quot;}&quot;);
 
 		return buffer.toString();
@@ -911,8 +994,8 @@
 		coder.writeWord(offset, entrySize);
 		coder.setPointer(currentLocation);
 
-		for (Iterator codesIterator = codes.iterator(); codesIterator.hasNext();)
-			coder.writeWord(((Integer) codesIterator.next()).intValue(), wideCodes ? 2 : 1);
+		for (Iterator&lt;Integer&gt; codesIterator = codes.iterator(); codesIterator.hasNext();)
+			coder.writeWord(codesIterator.next().intValue(), wideCodes ? 2 : 1);
 
 		if (containsLayoutInfo())
 		{
@@ -920,10 +1003,9 @@
 			coder.writeWord(descent, 2);
 			coder.writeWord(leading, 2);
 
-			for (Iterator advancesIterator = advances.iterator(); advancesIterator
+			for (Iterator&lt;Integer&gt; advancesIterator = advances.iterator(); advancesIterator
 							.hasNext();)
-				coder.writeWord(((Integer) advancesIterator.next()).intValue(),
-								2);
+				coder.writeWord( advancesIterator.next().intValue(), 2);
 
 			for (Iterator&lt;FSBounds&gt; boundsIterator = bounds.iterator(); boundsIterator
 							.hasNext();)
@@ -943,17 +1025,9 @@
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		boolean containsWideOffsets = false;
-		boolean containsWideCodes = false;
-		boolean containsLayout = false;
-
-		int glyphCount = 0;
-		int kerningCount = 0;
-		int nameLength = 0;
-
 		super.decode(coder, context);
 
-		containsLayout = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsLayout = coder.readBits(1, false) != 0 ? true : false;
 		int format = coder.readBits(3, false);
 
 		encoding = FSText.Unicode;
@@ -967,15 +1041,15 @@
 		else if (format == 4)
 			encoding = FSText.SJIS;
 
-		containsWideOffsets = coder.readBits(1, false) != 0 ? true : false;
-		containsWideCodes = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsWideOffsets = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsWideCodes = coder.readBits(1, false) != 0 ? true : false;
 
 		context.wideCodes = containsWideCodes;
 
 		italic = coder.readBits(1, false) != 0 ? true : false;
 		bold = coder.readBits(1, false) != 0 ? true : false;
 		language = coder.readBits(8, false);
-		nameLength = coder.readByte();
+		int nameLength = coder.readByte();
 		name = coder.readString(nameLength);
 
 		if (name.length() &gt; 0)
@@ -986,7 +1060,7 @@
 			}
 		}
 
-		glyphCount = coder.readWord(2, false);
+		int glyphCount = coder.readWord(2, false);
 
 		int offsetStart = coder.getPointer();
 		int[] offset = new int[glyphCount + 1];
@@ -1018,9 +1092,9 @@
 			descent = coder.readWord(2, true);
 			leading = coder.readWord(2, true);
 
-			advances = new ArrayList();
-			bounds = new ArrayList();
-			kernings = new ArrayList();
+			advances = new ArrayList&lt;Integer&gt;();
+			bounds = new ArrayList&lt;FSBounds&gt;();
+			kernings = new ArrayList&lt;FSKerning&gt;();
 
 			for (int i = 0; i &lt; glyphCount; i++)
 				advances.add(new Integer(coder.readWord(2, true)));
@@ -1028,7 +1102,7 @@
 			for (int i = 0; i &lt; glyphCount; i++)
 				bounds.add(new FSBounds(coder, context));
 
-			kerningCount = coder.readWord(2, false);
+			int kerningCount = coder.readWord(2, false);
 
 			for (int i = 0; i &lt; kerningCount; i++)
 				kernings.add(new FSKerning(coder, context));

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineImage.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineImage.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineImage.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -142,18 +142,14 @@
  */
 public class FSDefineImage extends FSDefineObject
 {
-	private int width = 0;
+	private int width;
+	private int height;
+	private int pixelSize;
+	private int tableSize;
+	private byte[] compressedData;
 
-	private int height = 0;
-
-	private int pixelSize = 8;
-
-	private int tableSize = 0;
-
-	private byte[] compressedData = null;
-
 	/**
-	 * Construct an FSDefineImage object, initalizing it with values decoded
+	 * Construct an FSDefineImage object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -180,9 +176,13 @@
 	 *            data. Each entry is 24 bits.
 	 * @param compressedBytes
 	 *            the zlib compressed colour table and image data.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+	 * @throws IllegalArgumentException if the width or height are outside the range of 0..65535.
+	 * @throws IllegalArgumentException if the size of the table is outside the range 1..256.
+	 * @throws NullPointerException if the compressed colour table and image is null.
 	 */
-	public FSDefineImage(int anIdentifier, int width, int height,
-							int tableSize, byte[] compressedBytes)
+	public FSDefineImage(int anIdentifier, int width, int height, int tableSize, byte[] compressedBytes)
 	{
 		super(DefineImage, anIdentifier);
 		extendLength = true;
@@ -207,9 +207,13 @@
 	 *            the zlib compressed image data.
 	 * @param aPixelSize
 	 *            the size of each pixel, either 16 or 24 bits.
+     *
+     * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+	 * @throws IllegalArgumentException if the width or height are outside the range of 0..65535.
+	 * @throws NullPointerException if the compressed image is null.
+     * @throws IllegalArgumentException if the pixel size is not either 8, 16 or 24.
 	 */
-	public FSDefineImage(int anIdentifier, int width, int height,
-							byte[] compressedBytes, int aPixelSize)
+	public FSDefineImage(int anIdentifier, int width, int height, byte[] compressedBytes, int aPixelSize)
 	{
 		super(DefineImage, anIdentifier);
 		extendLength = true;
@@ -234,7 +238,7 @@
 		height = obj.height;
 		pixelSize = obj.pixelSize;
 		tableSize = obj.tableSize;
-		compressedData = Transform.clone(obj.compressedData);
+		compressedData = FSMovieObject.copy(obj.compressedData);
 	}
 
 	/**
@@ -297,9 +301,14 @@
 	 * 
 	 * @param aNumber
 	 *            the width of the image.
-	 */
+     *
+     * @throws IllegalArgumentException if the width is outside the range of 0..65535.
+     */
 	public void setWidth(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Image width must be in the range 0..65535&quot;);
+		}
 		width = aNumber;
 	}
 
@@ -308,9 +317,14 @@
 	 * 
 	 * @param aNumber
 	 *            the height of the image in pixels.
+     *
+     * @throws IllegalArgumentException if the height is outside the range of 0..65535.
 	 */
 	public void setHeight(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Image height must be in the range 0..65535&quot;);
+		}
 		height = aNumber;
 	}
 
@@ -319,12 +333,17 @@
 	 * for colour-mapped images and 16 or 24 bits for images where the colour is
 	 * specified directly.
 	 * 
-	 * @param aNumber
+	 * @param size
 	 *            the size of each pixel in bits: 8, 16 or 24.
+	 *            
+	 * @throws IllegalArgumentException if the pixel size is not either 8, 16 or 24.
 	 */
-	public void setPixelSize(int aNumber)
+	public void setPixelSize(int size)
 	{
-		pixelSize = aNumber;
+		if (size != 8 &amp;&amp; size != 16 &amp;&amp; size != 24) {
+			throw new IllegalArgumentException(&quot;Pixel size must be either 8, 16 or 24.&quot;);
+		}
+		pixelSize = size;
 	}
 
 	/**
@@ -332,13 +351,18 @@
 	 * For images where the colour is specified directly in the image then the
 	 * table size should be zero.
 	 * 
-	 * @param aNumber
+	 * @param size
 	 *            the number of entries in the colour table in the compressed
 	 *            image.
+	 *         
+	 * @throws IllegalArgumentException if the table size is not in the range 1..256.
 	 */
-	public void setTableSize(int aNumber)
+	public void setTableSize(int size)
 	{
-		tableSize = aNumber;
+		if (size &lt; 1 || size &gt; 256) {
+			throw new IllegalArgumentException(&quot;Colour table size must be in the range 1..256.&quot;);
+		}
+		tableSize = size;
 	}
 
 	/**
@@ -346,9 +370,14 @@
 	 * 
 	 * @param bytes
 	 *            byte array containing zlib compressed colour table and image.
+	 *            
+	 * @throws NullPointerException if the compressed image is null.
 	 */
 	public void setCompressedData(byte[] bytes)
 	{
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Compressed image cannot be null.&quot;);
+		}
 		compressedData = bytes;
 	}
 
@@ -356,7 +385,7 @@
 	{
 		FSDefineImage anObject = (FSDefineImage) super.clone();
 
-		anObject.compressedData = Transform.clone(compressedData);
+		anObject.compressedData = FSMovieObject.copy(compressedData);
 
 		return anObject;
 	}
@@ -367,21 +396,18 @@
 
 		if (super.equals(anObject))
 		{
-			FSDefineImage typedObject = (FSDefineImage) anObject;
+			FSDefineImage image = (FSDefineImage) anObject;
 
-			result = pixelSize == typedObject.pixelSize;
-			result = result &amp;&amp; width == typedObject.width;
-			result = result &amp;&amp; height == typedObject.height;
-			result = result &amp;&amp; tableSize == typedObject.tableSize;
+			result = pixelSize == image.pixelSize;
+			result = result &amp;&amp; width == image.width;
+			result = result &amp;&amp; height == image.height;
+			result = result &amp;&amp; tableSize == image.tableSize;
 
 			try
 			{
-				result = result
-								&amp;&amp; Transform
-												.equals(
-																unzip(compressedData),
-																unzip(typedObject.compressedData));
-			} catch (DataFormatException e)
+				result = result &amp;&amp; equals(unzip(compressedData),unzip(image.compressedData));
+			} 
+			catch (DataFormatException e)
 			{
 				result = false;
 			}
@@ -410,6 +436,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineImage: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;pixelSize = &quot;).append(pixelSize).append(&quot;; &quot;);
 		buffer.append(&quot;width = &quot;).append(width).append(&quot;; &quot;);
 		buffer.append(&quot;height = &quot;).append(height).append(&quot;; &quot;);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineImage2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineImage2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineImage2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -124,18 +124,14 @@
  */
 public class FSDefineImage2 extends FSDefineObject
 {
-	private int width = 0;
+	private int width;
+	private int height;
+	private int pixelSize;
+	private int tableSize;
+	private byte[] compressedData;
 
-	private int height = 0;
-
-	private int pixelSize = 8;
-
-	private int tableSize = 0;
-
-	private byte[] compressedData = null;
-
 	/**
-	 * Construct an FSCall object, initalizing it with values decoded from an
+	 * Construct an FSCall object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -162,6 +158,11 @@
 	 *            data. Each entry is 32 bits.
 	 * @param compressedBytes
 	 *            the zlib compressed colour table and image data.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+	 * @throws IllegalArgumentException if the width or height are outside the range of 0..65535.
+	 * @throws IllegalArgumentException if the size of the table is outside the range 1..256.
+	 * @throws NullPointerException if the compressed colour table and image is null.
 	 */
 	public FSDefineImage2(int anIdentifier, int width, int height,
 							int tableSize, byte[] compressedBytes)
@@ -188,9 +189,12 @@
 	 *            the height of the image.
 	 * @param compressedBytes
 	 *            the zlib compressed image data.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+	 * @throws IllegalArgumentException if the width or height are outside the range of 0..65535.
+	 * @throws NullPointerException if the compressed image is null.
 	 */
-	public FSDefineImage2(int anIdentifier, int width, int height,
-							byte[] compressedBytes)
+	public FSDefineImage2(int anIdentifier, int width, int height, byte[] compressedBytes)
 	{
 		super(DefineImage2, anIdentifier);
 		extendLength = true;
@@ -215,7 +219,7 @@
 		height = obj.height;
 		pixelSize = obj.pixelSize;
 		tableSize = obj.tableSize;
-		compressedData = Transform.clone(obj.compressedData);
+		compressedData = FSMovieObject.copy(obj.compressedData);
 	}
 
 	/**
@@ -278,6 +282,8 @@
 	 * 
 	 * @param aNumber
 	 *            the width of the image.
+	 *
+	 * @throws IllegalArgumentException if the width is outside the range of 0..65535.
 	 */
 	public void setWidth(int aNumber)
 	{
@@ -289,6 +295,8 @@
 	 * 
 	 * @param aNumber
 	 *            the height of the image in pixels.
+	 *            
+	 * @throws IllegalArgumentException if the height is outside the range of 0..65535.
 	 */
 	public void setHeight(int aNumber)
 	{
@@ -299,12 +307,17 @@
 	 * Sets the size of the pixel in bits: 8 for colour-mapped images, 32 for
 	 * direct images.
 	 * 
-	 * @param aNumber
+	 * @param size
 	 *            the size of each pixel in bits: 8 or 32.
+	 *            
+	 * @throws IllegalArgumentException if the pixels size is not either 8 or 32.
 	 */
-	public void setPixelSize(int aNumber)
+	public void setPixelSize(int size)
 	{
-		pixelSize = aNumber;
+		if (size != 8 &amp;&amp; size != 32) {
+			throw new IllegalArgumentException(&quot;Pixel size must be either 8 or 32 bits.&quot;);
+		}
+		pixelSize = size;
 	}
 
 	/**
@@ -312,13 +325,18 @@
 	 * For images where the colour is specified directly in the image then the
 	 * table size should be zero.
 	 * 
-	 * @param aNumber
+	 * @param size
 	 *            the number of entries in the colour table in the compressed
 	 *            image.
+	 *            
+	 * @throws IllegalArgumentException if the table size is not in the range 1..256.
 	 */
-	public void setTableSize(int aNumber)
+	public void setTableSize(int size)
 	{
-		tableSize = aNumber;
+		if (size &lt; 1 || size &gt; 256) {
+			throw new IllegalArgumentException(&quot;Colour table size must be in the range 1..256.&quot;);
+		}
+		tableSize = size;
 	}
 
 	/**
@@ -326,9 +344,14 @@
 	 * 
 	 * @param bytes
 	 *            byte array containing zlib compressed colour table and image.
+	 *            
+	 * @throws NullPointerException if the compressed image is null.
 	 */
 	public void setCompressedData(byte[] bytes)
 	{
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Compressed image cannot be null.&quot;);
+		}
 		compressedData = bytes;
 	}
 
@@ -336,7 +359,7 @@
 	{
 		FSDefineImage2 anObject = (FSDefineImage2) super.clone();
 
-		anObject.compressedData = Transform.clone(compressedData);
+		anObject.compressedData = FSMovieObject.copy(compressedData);
 
 		return anObject;
 	}
@@ -347,21 +370,18 @@
 
 		if (super.equals(anObject))
 		{
-			FSDefineImage2 typedObject = (FSDefineImage2) anObject;
+			FSDefineImage2 image = (FSDefineImage2) anObject;
 
-			result = pixelSize == typedObject.pixelSize;
-			result = result &amp;&amp; width == typedObject.width;
-			result = result &amp;&amp; height == typedObject.height;
-			result = result &amp;&amp; tableSize == typedObject.tableSize;
+			result = pixelSize == image.pixelSize;
+			result = result &amp;&amp; width == image.width;
+			result = result &amp;&amp; height == image.height;
+			result = result &amp;&amp; tableSize == image.tableSize;
 
 			try
 			{
-				result = result
-								&amp;&amp; Transform
-												.equals(
-																unzip(compressedData),
-																unzip(typedObject.compressedData));
-			} catch (DataFormatException e)
+				result = result &amp;&amp; equals(unzip(compressedData),unzip(image.compressedData));
+			} 
+			catch (DataFormatException e)
 			{
 				result = false;
 			}
@@ -390,6 +410,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineImage2: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;pixelSize = &quot;).append(pixelSize).append(&quot;; &quot;);
 		buffer.append(&quot;width = &quot;).append(width).append(&quot;; &quot;);
 		buffer.append(&quot;height = &quot;).append(height).append(&quot;; &quot;);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -119,14 +119,12 @@
  */
 public class FSDefineJPEGImage extends FSDefineObject
 {
-	private byte[] image = null;
-
+	private byte[] image;
 	private int width;
-
 	private int height;
 
 	/**
-	 * Construct an FSDefineJPEGImage object, initalizing it with values decoded
+	 * Construct an FSDefineJPEGImage object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -145,6 +143,9 @@
 	 *            the unique identifier for this object
 	 * @param bytes
 	 *            the JPEG encoded image data.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+	 * @throws NullPointerException if the image is null.
 	 */
 	public FSDefineJPEGImage(int anIdentifier, byte[] bytes)
 	{
@@ -164,7 +165,7 @@
 		super(obj);
 		width = obj.width;
 		height = obj.height;
-		image = Transform.clone(obj.image);
+		image = FSMovieObject.copy(obj.image);
 	}
 
 	/**
@@ -203,9 +204,14 @@
 	 * 
 	 * @param bytes
 	 *            an array of bytes containing the image data.
+	 *            
+	 * @throws NullPointerException if the image is null.
 	 */
 	public void setImage(byte[] bytes)
 	{
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Image cannot be null.&quot;);
+		}
 		image = bytes;
 		decodeInfo();
 	}
@@ -214,7 +220,7 @@
 	{
 		FSDefineJPEGImage anObject = (FSDefineJPEGImage) super.clone();
 
-		anObject.image = Transform.clone(image);
+		anObject.image = FSMovieObject.copy(image);
 		anObject.width = width;
 		anObject.height = height;
 
@@ -228,8 +234,7 @@
 		if (super.equals(anObject))
 		{
 			FSDefineJPEGImage typedObject = (FSDefineJPEGImage) anObject;
-
-			result = Transform.equals(image, typedObject.image);
+			result = equals(image, typedObject.image);
 		}
 		return result;
 	}
@@ -239,6 +244,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineJPEGImage: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;image = &quot;).append(&quot;&lt;data&gt;&quot;).append(&quot;; &quot;);
 		buffer.append(&quot;}&quot;);
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -121,15 +121,12 @@
 public class FSDefineJPEGImage2 extends FSDefineObject
 {
 	private int width;
-
 	private int height;
-
 	private byte[] image = null;
-
 	private byte[] encodingTable = null;
 
 	/**
-	 * Construct an FSDefineJPEGImage2 object, initalizing it with values
+	 * Construct an FSDefineJPEGImage2 object, initialising it with values
 	 * decoded from an encoded object.
 	 * 
 	 * @param coder
@@ -151,6 +148,9 @@
 	 *            the JPEG encoded image data.
 	 * @param encodingBytes
 	 *            the JPEG encoded encoding table.
+	 *            
+     * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+	 * @throws NullPointerException if the image is null.
 	 */
 	public FSDefineJPEGImage2(int anIdentifier, byte[] imageBytes,
 								byte[] encodingBytes)
@@ -186,10 +186,10 @@
 	public FSDefineJPEGImage2(FSDefineJPEGImage2 obj)
 	{
 		super(obj);
-		image = Transform.clone(obj.image);
+		image = FSMovieObject.copy(obj.image);
 		width = obj.width;
 		height = obj.height;
-		encodingTable = Transform.clone(obj.encodingTable);
+		encodingTable = FSMovieObject.copy(obj.encodingTable);
 	}
 
 	/**
@@ -237,15 +237,22 @@
 	 * 
 	 * @param bytes
 	 *            an array of bytes containing the image data.
+	 *       
+	 * @throws NullPointerException if the image is null.
 	 */
 	public void setImage(byte[] bytes)
 	{
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Image cannot be null.&quot;);
+		}
 		image = bytes;
 		decodeInfo();
 	}
 
 	/**
-	 * Sets the encoding table.
+	 * Sets the encoding table. If the argument is null then the table will be 
+	 * set to the default empty table containing the start of image and end of 
+	 * image marker bytes, 0xFFD8, 0xFFD9.
 	 * 
 	 * @param bytes
 	 *            an array of bytes containing the encoding table.
@@ -263,10 +270,10 @@
 	{
 		FSDefineJPEGImage2 anObject = (FSDefineJPEGImage2) super.clone();
 
-		anObject.image = Transform.clone(image);
+		anObject.image = FSMovieObject.copy(image);
 		anObject.width = width;
 		anObject.height = height;
-		anObject.encodingTable = Transform.clone(encodingTable);
+		anObject.encodingTable = copy(encodingTable);
 
 		return anObject;
 	}
@@ -279,10 +286,8 @@
 		{
 			FSDefineJPEGImage2 typedObject = (FSDefineJPEGImage2) anObject;
 
-			result = Transform.equals(image, typedObject.image);
-			result = result
-							&amp;&amp; Transform.equals(encodingTable,
-											typedObject.encodingTable);
+			result = equals(image, typedObject.image);
+			result = result &amp;&amp; equals(encodingTable, typedObject.encodingTable);
 		}
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage3.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage3.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineJPEGImage3.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -149,17 +149,13 @@
 public class FSDefineJPEGImage3 extends FSDefineObject
 {
 	private int width;
-
 	private int height;
+	private byte[] image;
+	private byte[] encodingTable;
+	private byte[] alpha;
 
-	private byte[] image = null;
-
-	private byte[] encodingTable = null;
-
-	private byte[] alpha = null;
-
 	/**
-	 * Construct an FSDefineJPEGImage3 object, initalizing it with values
+	 * Construct an FSDefineJPEGImage3 object, initialising it with values
 	 * decoded from an encoded object.
 	 * 
 	 * @param coder
@@ -183,6 +179,10 @@
 	 *            byte array containing the encoding table
 	 * @param alphaBytes
 	 *            byte array containing the zlib compressed alpha channel data
+	 *            
+     * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+	 * @throws NullPointerException if the image is null.
+	 * @throws NullPointerException if the alpha information is null.
 	 */
 	public FSDefineJPEGImage3(int anIdentifier, byte[] imageBytes,
 								byte[] encodingBytes, byte[] alphaBytes)
@@ -203,11 +203,11 @@
 	public FSDefineJPEGImage3(FSDefineJPEGImage3 obj)
 	{
 		super(obj);
-		image = Transform.clone(obj.image);
+		image = FSMovieObject.copy(obj.image);
 		width = obj.width;
 		height = obj.height;
-		encodingTable = Transform.clone(obj.encodingTable);
-		alpha = Transform.clone(obj.alpha);
+		encodingTable = FSMovieObject.copy(obj.encodingTable);
+		alpha = FSMovieObject.copy(obj.alpha);
 	}
 
 	/**
@@ -261,7 +261,9 @@
 	}
 
 	/**
-	 * Sets the encoding table.
+	 * Sets the encoding table. If the argument is null then the table will be 
+	 * set to the default empty table containing the start of image and end of 
+	 * image marker bytes, 0xFFD8, 0xFFD9.
 	 * 
 	 * @param bytes
 	 *            byte array containing the encoding table.
@@ -280,6 +282,8 @@
 	 * 
 	 * @param bytes
 	 *            an array of bytes containing the image table.
+	 *            
+	 * @throws NullPointerException if the image is null.
 	 */
 	public void setImage(byte[] bytes)
 	{
@@ -292,6 +296,8 @@
 	 * 
 	 * @param bytes
 	 *            array of bytes containing zlib encoded alpha channel.
+	 *            
+	 * @throws NullPointerException if the alpha information is null.
 	 */
 	public void setCompressedAlpha(byte[] bytes)
 	{
@@ -302,9 +308,9 @@
 	{
 		FSDefineJPEGImage3 anObject = (FSDefineJPEGImage3) super.clone();
 
-		anObject.image = Transform.clone(image);
-		anObject.encodingTable = Transform.clone(encodingTable);
-		anObject.alpha = Transform.clone(alpha);
+		anObject.image = FSMovieObject.copy(image);
+		anObject.encodingTable = FSMovieObject.copy(encodingTable);
+		anObject.alpha = FSMovieObject.copy(alpha);
 
 		return anObject;
 	}
@@ -317,11 +323,9 @@
 		{
 			FSDefineJPEGImage3 typedObject = (FSDefineJPEGImage3) anObject;
 
-			result = Transform.equals(image, typedObject.image);
-			result = result
-							&amp;&amp; Transform.equals(encodingTable,
-											typedObject.encodingTable);
-			result = result &amp;&amp; Transform.equals(alpha, typedObject.alpha);
+			result = equals(image, typedObject.image);
+			result = result &amp;&amp; equals(encodingTable,typedObject.encodingTable);
+			result = result &amp;&amp; equals(alpha, typedObject.alpha);
 		}
 		return result;
 	}
@@ -331,6 +335,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineJPEGImage3: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;encodingTable = &quot;).append(&quot;&lt;data&gt;&quot;).append(&quot;; &quot;);
 		buffer.append(&quot;image = &quot;).append(&quot;&lt;data&gt;&quot;).append(&quot;; &quot;);
 		buffer.append(&quot;alpha = &quot;).append(&quot;&lt;data&gt;&quot;).append(&quot;; &quot;);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineMorphShape.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineMorphShape.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineMorphShape.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -204,20 +204,17 @@
  */
 public class FSDefineMorphShape extends FSDefineObject
 {
-	private FSBounds startBounds = null;
+	private FSBounds startBounds;
+	private FSBounds endBounds;
 
-	private FSBounds endBounds = null;
+	private ArrayList&lt;FSFillStyle&gt; fillStyles;
+	private ArrayList&lt;FSMorphLineStyle&gt; lineStyles;
 
-	private ArrayList fillStyles = null;
+	private FSShape startShape;
+	private FSShape endShape;
 
-	private ArrayList lineStyles = null;
-
-	private FSShape startShape = null;
-
-	private FSShape endShape = null;
-
 	/**
-	 * Construct an FSDefineJPEGImage object, initalizing it with values decoded
+	 * Construct an FSDefineJPEGImage object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -247,11 +244,15 @@
 	 *            the shape at the start of the morphing process.
 	 * @param endShape
 	 *            the shape at the end of the morphing process.
+	 *            
+     * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+	 * @throws NullPointerException if either of the bounding boxes are null.       
+	 * @throws NullPointerException if either of the style arrays are null.       
+	 * @throws NullPointerException if either of the shapes are null.       
 	 */
-	public FSDefineMorphShape(int anIdentifier, FSBounds startBounds,
-								FSBounds endBounds, ArrayList fillStyleArray,
-								ArrayList lineStyleArray, FSShape startShape,
-								FSShape endShape)
+	public FSDefineMorphShape(int anIdentifier, FSBounds startBounds, FSBounds endBounds, 
+								ArrayList&lt;FSFillStyle&gt; fillStyleArray, ArrayList&lt;FSMorphLineStyle&gt; lineStyleArray, 
+								FSShape startShape, FSShape endShape)
 	{
 		super(DefineMorphShape, anIdentifier);
 		setStartBounds(startBounds);
@@ -272,18 +273,19 @@
 	public FSDefineMorphShape(FSDefineMorphShape obj)
 	{
 		super(obj);
+		
 		startBounds = new FSBounds(obj.startBounds);
 		endBounds = new FSBounds(obj.endBounds);
 
-		fillStyles = new ArrayList();
+		fillStyles = new ArrayList&lt;FSFillStyle&gt;();
 
-		for (Iterator i = obj.fillStyles.iterator(); i.hasNext();)
-			fillStyles.add(((FSFillStyle) i.next()).clone());
+		for (Iterator&lt;FSFillStyle&gt; i = obj.fillStyles.iterator(); i.hasNext();)
+			fillStyles.add((FSFillStyle) i.next().clone());
 
-		lineStyles = new ArrayList();
+		lineStyles = new ArrayList&lt;FSMorphLineStyle&gt;();
 
-		for (Iterator i = obj.lineStyles.iterator(); i.hasNext();)
-			lineStyles.add(((FSLineStyle) i.next()).clone());
+		for (Iterator&lt;FSMorphLineStyle&gt; i = obj.lineStyles.iterator(); i.hasNext();)
+			lineStyles.add((FSMorphLineStyle) i.next().clone());
 
 		startShape = new FSShape(obj.startShape);
 		endShape = new FSShape(obj.endShape);
@@ -295,7 +297,7 @@
 	 * @param aLineStyle
 	 *            and FSLineStyle object.
 	 */
-	public void add(FSLineStyle aLineStyle)
+	public void add(FSMorphLineStyle aLineStyle)
 	{
 		lineStyles.add(aLineStyle);
 	}
@@ -339,7 +341,7 @@
 	 * 
 	 * @return the array morph fill styles.
 	 */
-	public ArrayList getFillStyles()
+	public ArrayList&lt;FSFillStyle&gt; getFillStyles()
 	{
 		return fillStyles;
 	}
@@ -350,7 +352,7 @@
 	 * 
 	 * @return the array morph line styles.
 	 */
-	public ArrayList getLineStyles()
+	public ArrayList&lt;FSMorphLineStyle&gt; getLineStyles()
 	{
 		return lineStyles;
 	}
@@ -380,9 +382,14 @@
 	 * 
 	 * @param aBounds
 	 *            the bounding rectangle enclosing the start shape.
+	 *            
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public void setStartBounds(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Bounding box cannot be null.&quot;);
+		}
 		startBounds = aBounds;
 	}
 
@@ -391,9 +398,14 @@
 	 * 
 	 * @param aBounds
 	 *            the bounding rectangle enclosing the end shape.
+	 *            
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public void setEndBounds(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Bounding box cannot be null.&quot;);
+		}
 		endBounds = aBounds;
 	}
 
@@ -403,9 +415,14 @@
 	 * @param anArray
 	 *            an array of FSMorphSolidFill, FSMorphBitmapFill and
 	 *            FSMorphGradientFill objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setFillStyles(ArrayList anArray)
+	public void setFillStyles(ArrayList&lt;FSFillStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of fill styles cannot be null.&quot;);
+		}
 		fillStyles = anArray;
 	}
 
@@ -414,9 +431,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of FSMorphLineStyle objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setLineStyles(ArrayList anArray)
+	public void setLineStyles(ArrayList&lt;FSMorphLineStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of line styles cannot be null.&quot;);
+		}
 		lineStyles = anArray;
 	}
 
@@ -425,9 +447,14 @@
 	 * 
 	 * @param aShape
 	 *            the shape at the start of the morphing process.
+	 *            
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public void setStartShape(FSShape aShape)
 	{
+		if (aShape == null) {
+			throw new NullPointerException(&quot;Shape cannot be null.&quot;);
+		}
 		startShape = aShape;
 	}
 
@@ -436,9 +463,14 @@
 	 * 
 	 * @param aShape
 	 *            the shape at the end of the morphing process.
+	 *            
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public void setEndShape(FSShape aShape)
 	{
+		if (aShape == null) {
+			throw new NullPointerException(&quot;Shape cannot be null.&quot;);
+		}
 		endShape = aShape;
 	}
 
@@ -446,25 +478,21 @@
 	{
 		FSDefineMorphShape anObject = (FSDefineMorphShape) super.clone();
 
-		anObject.startBounds = (startBounds != null) ? (FSBounds) startBounds
-						.clone() : null;
-		anObject.endBounds = (endBounds != null) ? (FSBounds) endBounds.clone()
-						: null;
+		anObject.startBounds = (FSBounds) startBounds.clone();
+		anObject.endBounds = (FSBounds) endBounds.clone();
 
-		anObject.fillStyles = new ArrayList();
+		anObject.fillStyles = new ArrayList&lt;FSFillStyle&gt;();
 
-		for (Iterator i = fillStyles.iterator(); i.hasNext();)
-			anObject.fillStyles.add(((FSFillStyle) i.next()).clone());
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			anObject.fillStyles.add((FSFillStyle) i.next().clone());
 
-		anObject.lineStyles = new ArrayList();
+		anObject.lineStyles = new ArrayList&lt;FSMorphLineStyle&gt;();
 
-		for (Iterator i = lineStyles.iterator(); i.hasNext();)
-			anObject.lineStyles.add(((FSLineStyle) i.next()).clone());
+		for (Iterator&lt;FSMorphLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			anObject.lineStyles.add((FSMorphLineStyle) i.next().clone());
 
-		anObject.startShape = (startShape != null) ? (FSShape) startShape
-						.clone() : null;
-		anObject.endShape = (endShape != null) ? (FSShape) endShape.clone()
-						: null;
+		anObject.startShape = (FSShape) startShape.clone();
+		anObject.endShape = (FSShape) endShape.clone();
 
 		return anObject;
 	}
@@ -475,37 +503,14 @@
 
 		if (super.equals(anObject))
 		{
-			FSDefineMorphShape typedObject = (FSDefineMorphShape) anObject;
+			FSDefineMorphShape shape = (FSDefineMorphShape) anObject;
 
-			if (startBounds != null)
-				result = startBounds.equals(typedObject.startBounds);
-			else
-				result = startBounds == typedObject.startBounds;
-
-			if (endBounds != null)
-				result = result &amp;&amp; endBounds.equals(typedObject.endBounds);
-			else
-				result = result &amp;&amp; endBounds == typedObject.endBounds;
-
-			if (fillStyles != null)
-				result = result &amp;&amp; fillStyles.equals(typedObject.fillStyles);
-			else
-				result = result &amp;&amp; fillStyles == typedObject.fillStyles;
-
-			if (lineStyles != null)
-				result = result &amp;&amp; lineStyles.equals(typedObject.lineStyles);
-			else
-				result = result &amp;&amp; lineStyles == typedObject.lineStyles;
-
-			if (startShape != null)
-				result = result &amp;&amp; startShape.equals(typedObject.startShape);
-			else
-				result = result &amp;&amp; startShape == typedObject.startShape;
-
-			if (endShape != null)
-				result = result &amp;&amp; endShape.equals(typedObject.endShape);
-			else
-				result = result &amp;&amp; endShape == typedObject.endShape;
+			result = startBounds.equals(shape.startBounds);
+			result = result &amp;&amp; endBounds.equals(shape.endBounds);
+			result = result &amp;&amp; fillStyles.equals(shape.fillStyles);
+			result = result &amp;&amp; lineStyles.equals(shape.lineStyles);
+			result = result &amp;&amp; startShape.equals(shape.startShape);
+			result = result &amp;&amp; endShape.equals(shape.endShape);
 		}
 		return result;
 	}
@@ -515,6 +520,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineMorphShape: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;startBounds = &quot;).append(startBounds.toString()).append(&quot;; &quot;);
 		buffer.append(&quot;endBounds = &quot;).append(endBounds.toString()).append(&quot;; &quot;);
 		buffer.append(&quot;fillStyles = &quot;).append(fillStyles.toString()).append(&quot;; &quot;);
@@ -547,7 +553,7 @@
 
 		length += (lineStyles.size() &gt;= 255) ? 3 : 1;
 
-		for (Iterator&lt;FSLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
+		for (Iterator&lt;FSMorphLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
 						.hasNext();)
 			length += styleIterator.next().length(context);
 
@@ -606,7 +612,7 @@
 			coder.writeWord(lineStyles.size(), 1);
 		}
 
-		for (Iterator&lt;FSLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
+		for (Iterator&lt;FSMorphLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
 						.hasNext();)
 			 styleIterator.next().encode(coder, context);
 
@@ -658,7 +664,7 @@
 						&amp;&amp; fillStyleCount == 0xFF)
 			fillStyleCount = coder.readWord(2, false);
 
-		fillStyles = new ArrayList(fillStyleCount);
+		fillStyles = new ArrayList&lt;FSFillStyle&gt;(fillStyleCount);
 
 		for (int i = 0; i &lt; fillStyleCount; i++)
 		{
@@ -696,7 +702,7 @@
 						&amp;&amp; lineStyleCount == 0xFF)
 			lineStyleCount = coder.readWord(2, false);
 
-		lineStyles = new ArrayList(lineStyleCount);
+		lineStyles = new ArrayList&lt;FSMorphLineStyle&gt;(lineStyleCount);
 
 		for (int i = 0; i &lt; lineStyleCount; i++)
 			lineStyles.add(new FSMorphLineStyle(coder, context));

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineMovieClip.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineMovieClip.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineMovieClip.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -89,10 +89,10 @@
  */
 public class FSDefineMovieClip extends FSDefineObject
 {
-	private ArrayList objects = null;
+	private ArrayList&lt;FSMovieObject&gt; objects;
 
 	/**
-	 * Construct an FSDefineMovieClip object, initalizing it with values decoded
+	 * Construct an FSDefineMovieClip object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -110,11 +110,13 @@
 	 * 
 	 * @param anIdentifier
 	 *            a unique identifier for the movie clip.
+     *
+     * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
 	 */
 	public FSDefineMovieClip(int anIdentifier)
 	{
 		super(DefineMovieClip, anIdentifier);
-		setObjects(new ArrayList());
+		setObjects(new ArrayList&lt;FSMovieObject&gt;());
 	}
 
 	/**
@@ -125,8 +127,11 @@
 	 *            a unique identifier for the movie clip.
 	 * @param anArray
 	 *            the array of movie objects.
+     *
+     * @throws IllegalArgumentException if the identifier is outside the range of 1..65535.
+     * @throws NullPointerException if the array is null.
 	 */
-	public FSDefineMovieClip(int anIdentifier, ArrayList anArray)
+	public FSDefineMovieClip(int anIdentifier, ArrayList&lt;FSMovieObject&gt; anArray)
 	{
 		super(DefineMovieClip, anIdentifier);
 		setObjects(anArray);
@@ -143,10 +148,10 @@
 	{
 		super(obj);
 
-		objects = new ArrayList();
+		objects = new ArrayList&lt;FSMovieObject&gt;();
 
-		for (Iterator i = obj.objects.iterator(); i.hasNext();)
-			objects.add(((FSMovieObject) i.next()).clone());
+		for (Iterator&lt;FSMovieObject&gt; i = obj.objects.iterator(); i.hasNext();)
+			objects.add((FSMovieObject) i.next().clone());
 	}
 
 	/**
@@ -165,7 +170,7 @@
 	 * 
 	 * @return the array of movie objects.
 	 */
-	public ArrayList getObjects()
+	public ArrayList&lt;FSMovieObject&gt; getObjects()
 	{
 		return objects;
 	}
@@ -175,9 +180,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of movie objects.
+	 *            
+     * @throws NullPointerException if the array is null.
 	 */
-	public void setObjects(ArrayList anArray)
+	public void setObjects(ArrayList&lt;FSMovieObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array cannot be null.&quot;);
+		}
 		objects = anArray;
 	}
 
@@ -195,10 +205,10 @@
 	{
 		FSDefineMovieClip anObject = (FSDefineMovieClip) super.clone();
 
-		anObject.objects = new ArrayList();
+		anObject.objects = new ArrayList&lt;FSMovieObject&gt;();
 
-		for (Iterator i = objects.iterator(); i.hasNext();)
-			anObject.objects.add(((FSMovieObject) i.next()).clone());
+		for (Iterator&lt;FSMovieObject&gt; i = objects.iterator(); i.hasNext();)
+			anObject.objects.add((FSMovieObject) i.next().clone());
 
 		return anObject;
 	}
@@ -210,11 +220,7 @@
 		if (super.equals(anObject))
 		{
 			FSDefineMovieClip typedObject = (FSDefineMovieClip) anObject;
-
-			if (objects != null)
-				result = objects.equals(typedObject.objects);
-			else
-				result = objects == typedObject.objects;
+			result = objects.equals(typedObject.objects);
 		}
 		return result;
 	}
@@ -224,7 +230,8 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineMovieClip: { &quot;);
-		buffer.append(&quot;objects = &quot;).append(objects.toString()).append(&quot;; &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
+		buffer.append(&quot;objects = array[&quot;).append(objects.size()).append(&quot;]; &quot;);
 		buffer.append(&quot;}&quot;);
 
 		return buffer.toString();
@@ -235,7 +242,7 @@
 		super.length(context);
 		
 		length += 4;
-		length += FSMovieObject.length(context, objects);
+		length += length(context, objects);
 		
 		return length;
 	}
@@ -245,7 +252,7 @@
 		super.encode(coder, context);
 
 		coder.writeWord(numberOfFrames(), 2);
-		FSMovieObject.encode(coder, context, objects);
+		encode(coder, context, objects);
 		coder.writeWord(0, 2);
 	}
 
@@ -255,7 +262,7 @@
 
 		/* frameCount */coder.readWord(2, false);
 
-		objects = new ArrayList();
+		objects = new ArrayList&lt;FSMovieObject&gt;();
 
 		FSMovieObject object = null;
 
@@ -265,11 +272,12 @@
 		}
 	}
 
+	// TODO refactor with code in FSMovie
 	private int numberOfFrames()
 	{
 		int numberOfFrames = 0;
 
-		for (Iterator i = objects.iterator(); i.hasNext();)
+		for (Iterator&lt;FSMovieObject&gt; i = objects.iterator(); i.hasNext();)
 		{
 			FSMovieObject currentObject = (FSMovieObject) i.next();
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineObject.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineObject.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineObject.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -46,7 +46,7 @@
  */
 public abstract class FSDefineObject extends FSMovieObject
 {
-	protected int identifier = 0;
+	protected int identifier;
 
 	FSDefineObject(int type, int anIdentifier)
 	{
@@ -54,6 +54,7 @@
 		setIdentifier(anIdentifier);
 	}
 
+	// TODO consider removing.
 	protected FSDefineObject(FSDefineObject obj)
 	{
 		super(obj);
@@ -76,9 +77,14 @@
 	 * 
 	 * @param anIdentifier
 	 *            a unique identifier for the object.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineShape.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineShape.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineShape.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -137,16 +137,13 @@
  */
 public class FSDefineShape extends FSDefineObject
 {
-	private FSBounds bounds = null;
+	private FSBounds bounds;
+	private ArrayList&lt;FSFillStyle&gt; fillStyles;
+	private ArrayList&lt;FSLineStyle&gt; lineStyles;
+	private FSShape shape;
 
-	private ArrayList fillStyles = null;
-
-	private ArrayList lineStyles = null;
-
-	private FSShape shape = null;
-
 	/**
-	 * Construct an FSDefineShape object, initalizing it with values decoded
+	 * Construct an FSDefineShape object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -171,9 +168,14 @@
 	 *            the array of line styles used in the shape.
 	 * @param aShape
 	 *            the shape to be drawn.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the bounding box is null.
+	 * @throws NullPointerException if the line or fill style arrays are null.
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public FSDefineShape(int anIdentifier, FSBounds aBounds,
-							ArrayList fillStyleArray, ArrayList lineStyleArray,
+							ArrayList&lt;FSFillStyle&gt; fillStyleArray, ArrayList&lt;FSLineStyle&gt; lineStyleArray,
 							FSShape aShape)
 	{
 		super(FSMovieObject.DefineShape, anIdentifier);
@@ -193,17 +195,18 @@
 	public FSDefineShape(FSDefineShape obj)
 	{
 		super(obj);
+		
 		bounds = new FSBounds(obj.bounds);
 
-		fillStyles = new ArrayList();
+		fillStyles = new ArrayList&lt;FSFillStyle&gt;();
 
-		for (Iterator i = obj.fillStyles.iterator(); i.hasNext();)
-			fillStyles.add(((FSFillStyle) i.next()).clone());
+		for (Iterator&lt;FSFillStyle&gt; i = obj.fillStyles.iterator(); i.hasNext();)
+			fillStyles.add((FSFillStyle) i.next().clone());
 
-		lineStyles = new ArrayList();
+		lineStyles = new ArrayList&lt;FSLineStyle&gt;();
 
-		for (Iterator i = obj.lineStyles.iterator(); i.hasNext();)
-			lineStyles.add(((FSLineStyle) i.next()).clone());
+		for (Iterator&lt;FSLineStyle&gt; i = obj.lineStyles.iterator(); i.hasNext();)
+			lineStyles.add((FSLineStyle) i.next().clone());
 
 		shape = new FSShape(obj.shape);
 	}
@@ -211,23 +214,33 @@
 	/**
 	 * Add a FSLineStyle object to the array of line styles.
 	 * 
-	 * @param aLineStyle
+	 * @param style
 	 *            and FSLineStyle object.
+	 *            
+	 * @throws NullPointerException if the line style is null.
 	 */
-	public void add(FSLineStyle aLineStyle)
+	public void add(FSLineStyle style)
 	{
-		lineStyles.add(aLineStyle);
+		if (style == null) {
+			throw new NullPointerException(&quot;Line style cannot be null.&quot;);
+		}
+		lineStyles.add(style);
 	}
 
 	/**
 	 * Add the fill style object to the array of fill styles.
 	 * 
-	 * @param aFillStyle
+	 * @param style
 	 *            and FSFillStyle object.
+	 *            
+	 * @throws NullPointerException if the fill style is null.
 	 */
-	public void add(FSFillStyle aFillStyle)
+	public void add(FSFillStyle style)
 	{
-		fillStyles.add(aFillStyle);
+		if (style == null) {
+			throw new NullPointerException(&quot;Fill style cannot be null.&quot;);
+		}
+		fillStyles.add(style);
 	}
 
 	/**
@@ -245,7 +258,7 @@
 	 * 
 	 * @return the fill styles used in the shape.
 	 */
-	public ArrayList getFillStyles()
+	public ArrayList&lt;FSFillStyle&gt; getFillStyles()
 	{
 		return fillStyles;
 	}
@@ -255,7 +268,7 @@
 	 * 
 	 * @return the line styles used in the shape.
 	 */
-	public ArrayList getLineStyles()
+	public ArrayList&lt;FSLineStyle&gt; getLineStyles()
 	{
 		return lineStyles;
 	}
@@ -275,9 +288,14 @@
 	 * 
 	 * @param aBounds
 	 *            set the bounding rectangle for the shape.
+	 *            
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public void setBounds(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Bounding box for shape cannot be null&quot;);
+		}
 		bounds = aBounds;
 	}
 
@@ -286,9 +304,14 @@
 	 * 
 	 * @param anArray
 	 *            set the fill styles for the shape.
+	 *            
+	 * @throws NullPointerException if the fill style array is null.
 	 */
-	public void setFillStyles(ArrayList anArray)
+	public void setFillStyles(ArrayList&lt;FSFillStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of fill styles cannot be null&quot;);
+		}
 		fillStyles = anArray;
 	}
 
@@ -297,9 +320,14 @@
 	 * 
 	 * @param anArray
 	 *            set the line styles for the shape.
+	 *
+	 * @throws NullPointerException if the line style array is null.
 	 */
-	public void setLineStyles(ArrayList anArray)
+	public void setLineStyles(ArrayList&lt;FSLineStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of line styles cannot be null&quot;);
+		}
 		lineStyles = anArray;
 	}
 
@@ -308,9 +336,14 @@
 	 * 
 	 * @param aShape
 	 *            set the shape to be drawn.
+	 *   
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public void setShape(FSShape aShape)
 	{
+		if (aShape == null) {
+			throw new NullPointerException(&quot;Shape cannot be null&quot;);
+		}
 		shape = aShape;
 	}
 
@@ -318,19 +351,19 @@
 	{
 		FSDefineShape anObject = (FSDefineShape) super.clone();
 
-		anObject.bounds = (bounds != null) ? (FSBounds) bounds.clone() : null;
+		anObject.bounds = (FSBounds) bounds.clone();
 
-		anObject.fillStyles = new ArrayList();
+		anObject.fillStyles = new ArrayList&lt;FSFillStyle&gt;();
 
-		for (Iterator i = fillStyles.iterator(); i.hasNext();)
-			anObject.fillStyles.add(((FSFillStyle) i.next()).clone());
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			anObject.fillStyles.add((FSFillStyle) i.next().clone());
 
-		anObject.lineStyles = new ArrayList();
+		anObject.lineStyles = new ArrayList&lt;FSLineStyle&gt;();
 
-		for (Iterator i = lineStyles.iterator(); i.hasNext();)
-			anObject.lineStyles.add(((FSLineStyle) i.next()).clone());
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			anObject.lineStyles.add((FSLineStyle) i.next().clone());
 
-		anObject.shape = (shape != null) ? (FSShape) shape.clone() : null;
+		anObject.shape = (FSShape) shape.clone();
 
 		return anObject;
 	}
@@ -343,25 +376,10 @@
 		{
 			FSDefineShape typedObject = (FSDefineShape) anObject;
 
-			if (bounds != null)
-				result = bounds.equals(typedObject.bounds);
-			else
-				result = bounds == typedObject.bounds;
-
-			if (fillStyles != null)
-				result = result &amp;&amp; fillStyles.equals(typedObject.fillStyles);
-			else
-				result = result &amp;&amp; fillStyles == typedObject.fillStyles;
-
-			if (lineStyles != null)
-				result = result &amp;&amp; lineStyles.equals(typedObject.lineStyles);
-			else
-				result = result &amp;&amp; lineStyles == typedObject.lineStyles;
-
-			if (shape != null)
-				result = result &amp;&amp; shape.equals(typedObject.shape);
-			else
-				result = result &amp;&amp; shape == typedObject.shape;
+			result = bounds.equals(typedObject.bounds);
+			result = result &amp;&amp; fillStyles.equals(typedObject.fillStyles);
+			result = result &amp;&amp; lineStyles.equals(typedObject.lineStyles);
+			result = result &amp;&amp; shape.equals(typedObject.shape);
 		}
 		return result;
 	}
@@ -371,6 +389,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineShape: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;bounds = &quot;).append(bounds.toString()).append(&quot;; &quot;);
 		buffer.append(&quot;fillStyles = &quot;).append(fillStyles.toString()).append(&quot;; &quot;);
 		buffer.append(&quot;lineStyles = &quot;).append(lineStyles.toString()).append(&quot;; &quot;);
@@ -390,15 +409,13 @@
 		length += bounds.length(context);
 		length += 1;
 
-		for (Iterator&lt;FSFillStyle&gt; styleIterator = fillStyles.iterator(); styleIterator
-						.hasNext();)
-			length += styleIterator.next().length(context);
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			length += i.next().length(context);
 
 		length += 1;
 
-		for (Iterator&lt;FSLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
-						.hasNext();)
-			length += styleIterator.next().length(context);
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			length += i.next().length(context);
 
 		context.fillSize = numberOfFillBits;
 		context.lineSize = numberOfLineBits;
@@ -422,15 +439,13 @@
 
 		coder.writeWord(fillStyles.size(), 1);
 
-		for (Iterator&lt;FSFillStyle&gt; styleIterator = fillStyles.iterator(); styleIterator
-						.hasNext();)
-		 styleIterator.next().encode(coder, context);
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		coder.writeWord(lineStyles.size(), 1);
 
-		for (Iterator&lt;FSLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
-						.hasNext();)
-			styleIterator.next().encode(coder, context);
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		context.fillSize = numberOfFillBits;
 		context.lineSize = numberOfLineBits;
@@ -451,12 +466,10 @@
 		int start = coder.getPointer() - 16; // account for identifier
 
 		bounds = new FSBounds(coder, context);
+		
 		fillStyleCount = coder.readByte();
+		fillStyles = new ArrayList&lt;FSFillStyle&gt;(fillStyleCount);
 
-		fillStyles = new ArrayList(fillStyleCount);
-
-		fillStyles = new ArrayList();
-
 		for (int i = 0; i &lt; fillStyleCount; i++)
 		{
 			switch (coder.scanWord(1, false))
@@ -489,7 +502,7 @@
 
 		lineStyleCount = coder.readByte();
 
-		lineStyles = new ArrayList(lineStyleCount);
+		lineStyles = new ArrayList&lt;FSLineStyle&gt;(lineStyleCount);
 
 		for (int i = 0; i &lt; lineStyleCount; i++)
 			lineStyles.add(new FSLineStyle(coder, context));

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineShape2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineShape2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineShape2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -139,16 +139,13 @@
  */
 public class FSDefineShape2 extends FSDefineObject
 {
-	private FSBounds bounds = null;
+	private FSBounds bounds;
+	private ArrayList&lt;FSFillStyle&gt; fillStyles;
+	private ArrayList&lt;FSLineStyle&gt; lineStyles;
+	private FSShape shape ;
 
-	private ArrayList fillStyles = null;
-
-	private ArrayList lineStyles = null;
-
-	private FSShape shape = null;
-
 	/**
-	 * Construct an FSDefineShape2 object, initalizing it with values decoded
+	 * Construct an FSDefineShape2 object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -173,9 +170,14 @@
 	 *            the array of line styles used in the shape.
 	 * @param aShape
 	 *            the shape to be drawn.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the bounding box is null.
+	 * @throws NullPointerException if the line or fill style arrays are null.
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public FSDefineShape2(int anIdentifier, FSBounds aBounds,
-							ArrayList fillStyleArray, ArrayList lineStyleArray,
+							ArrayList&lt;FSFillStyle&gt; fillStyleArray, ArrayList&lt;FSLineStyle&gt; lineStyleArray,
 							FSShape aShape)
 	{
 		super(DefineShape2, anIdentifier);
@@ -197,15 +199,15 @@
 		super(obj);
 		bounds = new FSBounds(obj.bounds);
 
-		fillStyles = new ArrayList();
+		fillStyles = new ArrayList&lt;FSFillStyle&gt;();
 
-		for (Iterator i = obj.fillStyles.iterator(); i.hasNext();)
-			fillStyles.add(((FSFillStyle) i.next()).clone());
+		for (Iterator&lt;FSFillStyle&gt; i = obj.fillStyles.iterator(); i.hasNext();)
+			fillStyles.add((FSFillStyle) i.next().clone());
 
-		lineStyles = new ArrayList();
+		lineStyles = new ArrayList&lt;FSLineStyle&gt;();
 
-		for (Iterator i = obj.lineStyles.iterator(); i.hasNext();)
-			lineStyles.add(((FSLineStyle) i.next()).clone());
+		for (Iterator&lt;FSLineStyle&gt; i = obj.lineStyles.iterator(); i.hasNext();)
+			lineStyles.add((FSLineStyle) i.next().clone());
 
 		shape = new FSShape(obj.shape);
 	}
@@ -213,23 +215,33 @@
 	/**
 	 * Add a FSLineStyle object to the array of line styles.
 	 * 
-	 * @param aLineStyle
+	 * @param style
 	 *            and FSLineStyle object.
+	 *            
+	 * @throws NullPointerException if the line style is null.
 	 */
-	public void add(FSLineStyle aLineStyle)
+	public void add(FSLineStyle style)
 	{
-		lineStyles.add(aLineStyle);
+		if (style == null) {
+			throw new NullPointerException(&quot;Line style cannot be null.&quot;);
+		}
+		lineStyles.add(style);
 	}
 
 	/**
 	 * Add the fill style object to the array of fill styles.
 	 * 
-	 * @param aFillStyle
+	 * @param style
 	 *            and FSFillStyle object.
+	 *            
+	 * @throws NullPointerException if the fill style is null.
 	 */
-	public void add(FSFillStyle aFillStyle)
+	public void add(FSFillStyle style)
 	{
-		fillStyles.add(aFillStyle);
+		if (style == null) {
+			throw new NullPointerException(&quot;Fill style cannot be null.&quot;);
+		}
+		fillStyles.add(style);
 	}
 
 	/**
@@ -247,7 +259,7 @@
 	 * 
 	 * @return the fill styles used in the shape.
 	 */
-	public ArrayList getFillStyles()
+	public ArrayList&lt;FSFillStyle&gt; getFillStyles()
 	{
 		return fillStyles;
 	}
@@ -257,7 +269,7 @@
 	 * 
 	 * @return the line styles used in the shape.
 	 */
-	public ArrayList getLineStyles()
+	public ArrayList&lt;FSLineStyle&gt; getLineStyles()
 	{
 		return lineStyles;
 	}
@@ -277,9 +289,14 @@
 	 * 
 	 * @param aBounds
 	 *            set the bounding rectangle for the shape.
+	 *            
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public void setBounds(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Bounding box for shape cannot be null&quot;);
+		}
 		bounds = aBounds;
 	}
 
@@ -288,9 +305,14 @@
 	 * 
 	 * @param anArray
 	 *            set the fill styles for the shape.
+	 *            
+	 * @throws NullPointerException if the fill style array is null.
 	 */
-	public void setFillStyles(ArrayList anArray)
+	public void setFillStyles(ArrayList&lt;FSFillStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of fill styles cannot be null&quot;);
+		}
 		fillStyles = anArray;
 	}
 
@@ -299,9 +321,14 @@
 	 * 
 	 * @param anArray
 	 *            set the line styles for the shape.
+	 *
+	 * @throws NullPointerException if the line style array is null.
 	 */
-	public void setLineStyles(ArrayList anArray)
+	public void setLineStyles(ArrayList&lt;FSLineStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of line styles cannot be null&quot;);
+		}
 		lineStyles = anArray;
 	}
 
@@ -310,9 +337,14 @@
 	 * 
 	 * @param aShape
 	 *            set the shape to be drawn.
+	 *   
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public void setShape(FSShape aShape)
 	{
+		if (aShape == null) {
+			throw new NullPointerException(&quot;Shape cannot be null&quot;);
+		}
 		shape = aShape;
 	}
 
@@ -320,19 +352,19 @@
 	{
 		FSDefineShape2 anObject = (FSDefineShape2) super.clone();
 
-		anObject.bounds = (bounds != null) ? (FSBounds) bounds.clone() : null;
+		anObject.bounds = (FSBounds) bounds.clone();
 
-		anObject.fillStyles = new ArrayList();
+		anObject.fillStyles = new ArrayList&lt;FSFillStyle&gt;();
 
-		for (Iterator i = fillStyles.iterator(); i.hasNext();)
-			anObject.fillStyles.add(((FSFillStyle) i.next()).clone());
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			anObject.fillStyles.add((FSFillStyle) i.next().clone());
 
-		anObject.lineStyles = new ArrayList();
+		anObject.lineStyles = new ArrayList&lt;FSLineStyle&gt;();
 
-		for (Iterator i = lineStyles.iterator(); i.hasNext();)
-			anObject.lineStyles.add(((FSLineStyle) i.next()).clone());
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			anObject.lineStyles.add((FSLineStyle) i.next().clone());
 
-		anObject.shape = (shape != null) ? (FSShape) shape.clone() : null;
+		anObject.shape = (FSShape) shape.clone();
 
 		return anObject;
 	}
@@ -345,25 +377,10 @@
 		{
 			FSDefineShape2 typedObject = (FSDefineShape2) anObject;
 
-			if (bounds != null)
-				result = bounds.equals(typedObject.bounds);
-			else
-				result = bounds == typedObject.bounds;
-
-			if (fillStyles != null)
-				result = result &amp;&amp; fillStyles.equals(typedObject.fillStyles);
-			else
-				result = result &amp;&amp; fillStyles == typedObject.fillStyles;
-
-			if (lineStyles != null)
-				result = result &amp;&amp; lineStyles.equals(typedObject.lineStyles);
-			else
-				result = result &amp;&amp; lineStyles == typedObject.lineStyles;
-
-			if (shape != null)
-				result = result &amp;&amp; shape.equals(typedObject.shape);
-			else
-				result = result &amp;&amp; shape == typedObject.shape;
+			result = bounds.equals(typedObject.bounds);
+			result = result &amp;&amp; fillStyles.equals(typedObject.fillStyles);
+			result = result &amp;&amp; lineStyles.equals(typedObject.lineStyles);
+			result = result &amp;&amp; shape.equals(typedObject.shape);
 		}
 		return result;
 	}
@@ -393,15 +410,13 @@
 		length += bounds.length(context);
 		length += (fillStyles.size() &gt;= 255) ? 3 : 1;
 
-		for (Iterator&lt;FSFillStyle&gt; styleIterator = fillStyles.iterator(); styleIterator
-						.hasNext();)
-			length += styleIterator.next().length(context);
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			length += i.next().length(context);
 
 		length += (lineStyles.size() &gt;= 255) ? 3 : 1;
 
-		for (Iterator&lt;FSLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
-						.hasNext();)
-			length += styleIterator.next().length(context);
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			length += i.next().length(context);
 
 		context.arrayExtended = true;
 		context.fillSize = numberOfFillBits;
@@ -434,9 +449,8 @@
 			coder.writeWord(fillStyles.size(), 1);
 		}
 
-		for (Iterator&lt;FSFillStyle&gt; styleIterator = fillStyles.iterator(); styleIterator
-						.hasNext();)
-			styleIterator.next().encode(coder, context);
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		if (lineStyles.size() &gt;= 255)
 		{
@@ -447,9 +461,8 @@
 			coder.writeWord(lineStyles.size(), 1);
 		}
 
-		for (Iterator&lt;FSLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
-						.hasNext();)
-			styleIterator.next().encode(coder, context);
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		context.arrayExtended = true;
 		context.fillSize = numberOfFillBits;
@@ -477,10 +490,8 @@
 		if (fillStyleCount == 0xFF)
 			fillStyleCount = coder.readWord(2, false);
 
-		fillStyles = new ArrayList(fillStyleCount);
+		fillStyles = new ArrayList&lt;FSFillStyle&gt;(fillStyleCount);
 
-		fillStyles = new ArrayList();
-
 		for (int i = 0; i &lt; fillStyleCount; i++)
 		{
 			switch (coder.scanWord(1, false))
@@ -516,7 +527,7 @@
 		if (lineStyleCount == 0xFF)
 			lineStyleCount = coder.readWord(2, false);
 
-		lineStyles = new ArrayList(lineStyleCount);
+		lineStyles = new ArrayList&lt;FSLineStyle&gt;(lineStyleCount);
 
 		for (int i = 0; i &lt; lineStyleCount; i++)
 			lineStyles.add(new FSLineStyle(coder, context));

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineShape3.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineShape3.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineShape3.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -139,16 +139,13 @@
  */
 public class FSDefineShape3 extends FSDefineObject
 {
-	private FSBounds bounds = null;
+	private FSBounds bounds;
+	private ArrayList&lt;FSFillStyle&gt; fillStyles;
+	private ArrayList&lt;FSLineStyle&gt; lineStyles;
+	private FSShape shape;
 
-	private ArrayList fillStyles = null;
-
-	private ArrayList lineStyles = null;
-
-	private FSShape shape = null;
-
 	/**
-	 * Construct an FSDefineShape3 object, initalizing it with values decoded
+	 * Construct an FSDefineShape3 object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -173,9 +170,14 @@
 	 *            the array of line styles used in the shape.
 	 * @param aShape
 	 *            the shape to be drawn.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the bounding box is null.
+	 * @throws NullPointerException if the line or fill style arrays are null.
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public FSDefineShape3(int anIdentifier, FSBounds aBounds,
-							ArrayList fillStyleArray, ArrayList lineStyleArray,
+							ArrayList&lt;FSFillStyle&gt; fillStyleArray, ArrayList&lt;FSLineStyle&gt; lineStyleArray,
 							FSShape aShape)
 	{
 		super(DefineShape3, anIdentifier);
@@ -197,15 +199,15 @@
 		super(obj);
 		bounds = new FSBounds(obj.bounds);
 
-		fillStyles = new ArrayList();
+		fillStyles = new ArrayList&lt;FSFillStyle&gt;();
 
-		for (Iterator i = obj.fillStyles.iterator(); i.hasNext();)
-			fillStyles.add(((FSFillStyle) i.next()).clone());
+		for (Iterator&lt;FSFillStyle&gt; i = obj.fillStyles.iterator(); i.hasNext();)
+			fillStyles.add((FSFillStyle) i.next().clone());
 
-		lineStyles = new ArrayList();
+		lineStyles = new ArrayList&lt;FSLineStyle&gt;();
 
-		for (Iterator i = obj.lineStyles.iterator(); i.hasNext();)
-			lineStyles.add(((FSLineStyle) i.next()).clone());
+		for (Iterator&lt;FSLineStyle&gt; i = obj.lineStyles.iterator(); i.hasNext();)
+			lineStyles.add((FSLineStyle) i.next().clone());
 
 		shape = new FSShape(obj.shape);
 	}
@@ -213,23 +215,33 @@
 	/**
 	 * Add a FSLineStyle object to the array of line styles.
 	 * 
-	 * @param aLineStyle
+	 * @param style
 	 *            and FSLineStyle object.
+	 *            
+	 * @throws NullPointerException if the line style is null.
 	 */
-	public void add(FSLineStyle aLineStyle)
+	public void add(FSLineStyle style)
 	{
-		lineStyles.add(aLineStyle);
+		if (style == null) {
+			throw new NullPointerException(&quot;Line style cannot be null.&quot;);
+		}
+		lineStyles.add(style);
 	}
 
 	/**
 	 * Add the fill style object to the array of fill styles.
 	 * 
-	 * @param aFillStyle
+	 * @param style
 	 *            and FSFillStyle object.
+	 *            
+	 * @throws NullPointerException if the fill style is null.
 	 */
-	public void add(FSFillStyle aFillStyle)
+	public void add(FSFillStyle style)
 	{
-		fillStyles.add(aFillStyle);
+		if (style == null) {
+			throw new NullPointerException(&quot;Fill style cannot be null.&quot;);
+		}
+		fillStyles.add(style);
 	}
 
 	/**
@@ -247,7 +259,7 @@
 	 * 
 	 * @return the fill styles used in the shape.
 	 */
-	public ArrayList getFillStyles()
+	public ArrayList&lt;FSFillStyle&gt; getFillStyles()
 	{
 		return fillStyles;
 	}
@@ -257,7 +269,7 @@
 	 * 
 	 * @return the line styles used in the shape.
 	 */
-	public ArrayList getLineStyles()
+	public ArrayList&lt;FSLineStyle&gt; getLineStyles()
 	{
 		return lineStyles;
 	}
@@ -277,9 +289,14 @@
 	 * 
 	 * @param aBounds
 	 *            set the bounding rectangle for the shape.
+	 *            
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public void setBounds(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Bounding box for shape cannot be null&quot;);
+		}
 		bounds = aBounds;
 	}
 
@@ -288,9 +305,14 @@
 	 * 
 	 * @param anArray
 	 *            set the fill styles for the shape.
+	 *            
+	 * @throws NullPointerException if the fill style array is null.
 	 */
-	public void setFillStyles(ArrayList anArray)
+	public void setFillStyles(ArrayList&lt;FSFillStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of fill styles cannot be null&quot;);
+		}
 		fillStyles = anArray;
 	}
 
@@ -299,9 +321,14 @@
 	 * 
 	 * @param anArray
 	 *            set the line styles for the shape.
+	 *
+	 * @throws NullPointerException if the line style array is null.
 	 */
-	public void setLineStyles(ArrayList anArray)
+	public void setLineStyles(ArrayList&lt;FSLineStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of line styles cannot be null&quot;);
+		}
 		lineStyles = anArray;
 	}
 
@@ -310,9 +337,14 @@
 	 * 
 	 * @param aShape
 	 *            set the shape to be drawn.
+	 *   
+	 * @throws NullPointerException if the shape is null.
 	 */
 	public void setShape(FSShape aShape)
 	{
+		if (aShape == null) {
+			throw new NullPointerException(&quot;Shape cannot be null&quot;);
+		}
 		shape = aShape;
 	}
 
@@ -320,17 +352,17 @@
 	{
 		FSDefineShape3 anObject = (FSDefineShape3) super.clone();
 
-		anObject.bounds = (bounds != null) ? (FSBounds) bounds.clone() : null;
+		anObject.bounds = (FSBounds) bounds.clone();
 
-		anObject.fillStyles = new ArrayList();
+		anObject.fillStyles = new ArrayList&lt;FSFillStyle&gt;();
 
-		for (Iterator i = fillStyles.iterator(); i.hasNext();)
-			anObject.fillStyles.add(((FSFillStyle) i.next()).clone());
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			anObject.fillStyles.add((FSFillStyle) i.next().clone());
 
-		anObject.lineStyles = new ArrayList();
+		anObject.lineStyles = new ArrayList&lt;FSLineStyle&gt;();
 
-		for (Iterator i = lineStyles.iterator(); i.hasNext();)
-			anObject.lineStyles.add(((FSLineStyle) i.next()).clone());
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			anObject.lineStyles.add((FSLineStyle) i.next().clone());
 
 		anObject.shape = (shape != null) ? (FSShape) shape.clone() : null;
 
@@ -345,25 +377,10 @@
 		{
 			FSDefineShape3 typedObject = (FSDefineShape3) anObject;
 
-			if (bounds != null)
-				result = bounds.equals(typedObject.bounds);
-			else
-				result = bounds == typedObject.bounds;
-
-			if (fillStyles != null)
-				result = result &amp;&amp; fillStyles.equals(typedObject.fillStyles);
-			else
-				result = result &amp;&amp; fillStyles == typedObject.fillStyles;
-
-			if (lineStyles != null)
-				result = result &amp;&amp; lineStyles.equals(typedObject.lineStyles);
-			else
-				result = result &amp;&amp; lineStyles == typedObject.lineStyles;
-
-			if (shape != null)
-				result = result &amp;&amp; shape.equals(typedObject.shape);
-			else
-				result = result &amp;&amp; shape == typedObject.shape;
+			result = bounds.equals(typedObject.bounds);
+			result = result &amp;&amp; fillStyles.equals(typedObject.fillStyles);
+			result = result &amp;&amp; lineStyles.equals(typedObject.lineStyles);
+			result = result &amp;&amp; shape.equals(typedObject.shape);
 		}
 		return result;
 	}
@@ -396,15 +413,13 @@
 
 		length += (fillStyles.size() &gt;= 255) ? 3 : 1;
 
-		for (Iterator&lt;FSFillStyle&gt; styleIterator = fillStyles.iterator(); styleIterator
-						.hasNext();)
-			length += styleIterator.next().length(context);
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			length += i.next().length(context);
 
 		length += (lineStyles.size() &gt;= 255) ? 3 : 1;
 
-		for (Iterator&lt;FSLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
-						.hasNext();)
-			length += styleIterator.next().length(context);
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			length += i.next().length(context);
 
 		context.arrayExtended = true;
 		context.fillSize = numberOfFillBits;
@@ -441,9 +456,8 @@
 			coder.writeWord(fillStyles.size(), 1);
 		}
 
-		for (Iterator&lt;FSFillStyle&gt; styleIterator = fillStyles.iterator(); styleIterator
-						.hasNext();)
-			styleIterator.next().encode(coder, context);
+		for (Iterator&lt;FSFillStyle&gt; i = fillStyles.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		if (lineStyles.size() &gt;= 255)
 		{
@@ -454,9 +468,8 @@
 			coder.writeWord(lineStyles.size(), 1);
 		}
 
-		for (Iterator&lt;FSLineStyle&gt; styleIterator = lineStyles.iterator(); styleIterator
-						.hasNext();)
-			styleIterator.next().encode(coder, context);
+		for (Iterator&lt;FSLineStyle&gt; i = lineStyles.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		context.arrayExtended = true;
 		context.fillSize = numberOfFillBits;
@@ -487,10 +500,8 @@
 		if (fillStyleCount == 0xFF)
 			fillStyleCount = coder.readWord(2, false);
 
-		fillStyles = new ArrayList(fillStyleCount);
+		fillStyles = new ArrayList&lt;FSFillStyle&gt;(fillStyleCount);
 
-		fillStyles = new ArrayList();
-
 		for (int i = 0; i &lt; fillStyleCount; i++)
 		{
 			switch (coder.scanWord(1, false))
@@ -526,7 +537,7 @@
 		if (lineStyleCount == 0xFF)
 			lineStyleCount = coder.readWord(2, false);
 
-		lineStyles = new ArrayList(lineStyleCount);
+		lineStyles = new ArrayList&lt;FSLineStyle&gt;(lineStyleCount);
 
 		for (int i = 0; i &lt; lineStyleCount; i++)
 			lineStyles.add(new FSLineStyle(coder, context));

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineSound.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineSound.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineSound.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -30,9 +30,6 @@
 
 package com.flagstone.transform;
 
-import java.util.ArrayList;
-import java.util.Iterator;
-
 /**
  * FSDefineSound is used to define a sound that will be played when a given
  * event occurs.
@@ -148,20 +145,15 @@
  */
 public class FSDefineSound extends FSDefineObject
 {
-	private int format = 0;
+	private int format;
+	private int playbackRate;
+	private int playbackChannels;
+	private int playbackSampleSize;
+	private int sampleCount;
+	private byte[] soundData;
 
-	private int playbackRate = 5512;
-
-	private int playbackChannels = 1;
-
-	private int playbackSampleSize = 1;
-
-	private int sampleCount = 0;
-
-	private byte[] soundData = null;
-
 	/**
-	 * Construct an FSDefineSound object, initalizing it with values decoded
+	 * Construct an FSDefineSound object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -197,6 +189,13 @@
 	 *            the number of samples in the sound data.
 	 * @param bytes
 	 *            the sound data.
+	 *           
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the play back rate is not either 5512, 11025, 22050 or 44100.
+	 * @throws IllegalArgumentException if the number of channels is not 1 or 2.
+	 * @throws IllegalArgumentexception if the sample size is not either 1 or 2.
+	 * @throws IllegalArgumentException if the number of sound samples &lt; 0.
+	 * @throws NullPointerException if the sound data is null.
 	 */
 	public FSDefineSound(int anIdentifier, int aFormat, int rate, int channels,
 							int sampleSize, int count, byte[] bytes)
@@ -225,7 +224,7 @@
 		playbackChannels = obj.playbackChannels;
 		playbackSampleSize = obj.playbackSampleSize;
 		sampleCount = obj.sampleCount;
-		soundData = Transform.clone(obj.soundData);
+		soundData = FSMovieObject.copy(obj.soundData);
 	}
 
 	/**
@@ -310,9 +309,14 @@
 	 * 
 	 * @param rate
 	 *            the rate at which the sounds is played in Hz.
+	 *           
+	 * @throws IllegalArgumentException if the play back rate is not either 5512, 11025, 22050 or 44100.
 	 */
 	public void setPlaybackRate(int rate)
 	{
+		if (rate != 5512 &amp;&amp; rate != 11025 &amp;&amp; rate != 22050 &amp;&amp; rate != 44100) {
+			throw new IllegalArgumentException(&quot;Playback rate must be one of: 5512, 11025, 22050 or 44100 Hertz.&quot;);
+		}
 		playbackRate = rate;
 	}
 
@@ -322,9 +326,14 @@
 	 * @param channels
 	 *            the number of channels in the sound, either 1 (Mono) or 2
 	 *            (Stereo).
+	 *           
+	 * @throws IllegalArgumentException if the number of channels is not 1 or 2.
 	 */
 	public void setPlaybackChannels(int channels)
 	{
+		if (channels &lt; 1 || channels &gt; 2) {
+			throw new IllegalArgumentException(&quot;Number of channels must be 1 or 2.&quot;);
+		}
 		playbackChannels = channels;
 	}
 
@@ -333,9 +342,14 @@
 	 * 
 	 * @param sampleSize
 	 *            the size of sound samples in bytes.
+	 *           
+	 * @throws IllegalArgumentException if the sample size is not either 1 or 2.
 	 */
 	public void setPlaybackSampleSize(int sampleSize)
 	{
+		if (sampleSize &lt; 1 || sampleSize &gt; 2) {
+			throw new IllegalArgumentException(&quot;Sample size must be 1 or 2 bytes.&quot;);
+		}
 		playbackSampleSize = sampleSize;
 	}
 
@@ -344,9 +358,14 @@
 	 * 
 	 * @param count
 	 *            the number of samples for the sound.
+	 *           
+	 * @throws IllegalArgumentException if the number of sound samples &lt; 0.
 	 */
 	public void setSampleCount(int count)
 	{
+		if (sampleCount &lt; 1) {
+			throw new IllegalArgumentException(&quot;Sample count cannot be negative.&quot;);
+		}
 		sampleCount = count;
 	}
 
@@ -355,9 +374,14 @@
 	 * 
 	 * @param bytes
 	 *            the sound data.
+	 *           
+	 * @throws NullPointerException if the sound data is null.
 	 */
 	public void setSoundData(byte[] bytes)
 	{
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Sound data cannot be null.&quot;);
+		}
 		soundData = bytes;
 	}
 
@@ -365,7 +389,7 @@
 	{
 		FSDefineSound anObject = (FSDefineSound) super.clone();
 
-		anObject.soundData = Transform.clone(soundData);
+		anObject.soundData = copy(soundData);
 
 		return anObject;
 	}
@@ -384,9 +408,7 @@
 			result = result
 							&amp;&amp; playbackSampleSize == typedObject.playbackSampleSize;
 			result = result &amp;&amp; sampleCount == typedObject.sampleCount;
-			result = result
-							&amp;&amp; Transform.equals(soundData,
-											typedObject.soundData);
+			result = result&amp;&amp; equals(soundData, typedObject.soundData);
 		}
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineText.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineText.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineText.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -151,14 +151,12 @@
  */
 public class FSDefineText extends FSDefineObject
 {
-	private FSBounds bounds = null;
+	private FSBounds bounds;
+	private FSCoordTransform transform;
+	private ArrayList&lt;FSText&gt; objects;
 
-	private FSCoordTransform transform = null;
-
-	private ArrayList objects = null;
-
 	/**
-	 * Construct an FSDefineText object, initalizing it with values decoded from
+	 * Construct an FSDefineText object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -185,9 +183,14 @@
 	 * @param array
 	 *            an array of FSText objects that define the text to be
 	 *            displayed. Must not be null.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the bounding box is null.
+	 * @throws NullPointerException if the coordinate transform null.
+	 * @throws NullPointerException if the array of text objects is null.
 	 */
 	public FSDefineText(int anIdentifier, FSBounds aBounds,
-						FSCoordTransform aTransform, ArrayList array)
+						FSCoordTransform aTransform, ArrayList&lt;FSText&gt; array)
 	{
 		super(FSMovieObject.DefineText, anIdentifier);
 		setBounds(aBounds);
@@ -208,10 +211,10 @@
 		bounds = new FSBounds(obj.bounds);
 		transform = new FSCoordTransform(obj.transform);
 
-		objects = new ArrayList(obj.objects.size());
+		objects = new ArrayList&lt;FSText&gt;(obj.objects.size());
 
-		for (Iterator i = obj.objects.iterator(); i.hasNext();)
-			objects.add(((FSText) i.next()).clone());
+		for (Iterator&lt;FSText&gt; i = obj.objects.iterator(); i.hasNext();)
+			objects.add((FSText) i.next().clone());
 	}
 
 	/**
@@ -219,9 +222,14 @@
 	 * 
 	 * @param anObject
 	 *            an FSText object.
+	 *            
+	 * @throws NullPointerException if the text object is null.
 	 */
 	public void add(FSText anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Text object cannot be null&quot;);
+		}
 		objects.add(anObject);
 	}
 
@@ -252,7 +260,7 @@
 	 * 
 	 * @return the array of text records (FSTextStyle and FSText objects).
 	 */
-	public ArrayList getObjects()
+	public ArrayList&lt;FSText&gt; getObjects()
 	{
 		return objects;
 	}
@@ -262,9 +270,14 @@
 	 * 
 	 * @param aBounds
 	 *            the bounding rectangle enclosing the text.
+	 *
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public void setBounds(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Bounding box cannot be null&quot;);
+		}
 		bounds = aBounds;
 	}
 
@@ -275,9 +288,14 @@
 	 * @param aTransform
 	 *            an FSCoordTransform to change the size and orientation of the
 	 *            text.
+	 *            
+	 * @throws NullPointerException if the coordinate transform null.
 	 */
 	public void setTransform(FSCoordTransform aTransform)
 	{
+		if (aTransform == null) {
+			throw new NullPointerException(&quot;Coordinate transform cannot be null&quot;);
+		}
 		transform = aTransform;
 	}
 
@@ -287,9 +305,14 @@
 	 * @param anArray
 	 *            an array of FSText objects that define the text to be
 	 *            displayed.
+	 *            
+	 * @throws NullPointerException if the array of text objects is null.
 	 */
-	public void setObjects(ArrayList anArray)
+	public void setObjects(ArrayList&lt;FSText&gt; anArray)
 	{
+		if (objects == null) {
+			throw new NullPointerException(&quot;Array of text objects cannot be null.&quot;);
+		}
 		objects = anArray;
 	}
 
@@ -297,14 +320,13 @@
 	{
 		FSDefineText anObject = (FSDefineText) super.clone();
 
-		anObject.bounds = (bounds != null) ? (FSBounds) bounds.clone() : null;
-		anObject.transform = (transform != null) ? (FSCoordTransform) transform
-						.clone() : null;
+		anObject.bounds = (FSBounds) bounds.clone();
+		anObject.transform = (FSCoordTransform) transform.clone();
 
-		anObject.objects = new ArrayList(objects.size());
+		anObject.objects = new ArrayList&lt;FSText&gt;(objects.size());
 
-		for (Iterator i = objects.iterator(); i.hasNext();)
-			anObject.objects.add(((FSText) i.next()).clone());
+		for (Iterator&lt;FSText&gt; i = objects.iterator(); i.hasNext();)
+			anObject.objects.add((FSText) i.next().clone());
 
 		return anObject;
 	}
@@ -317,20 +339,9 @@
 		{
 			FSDefineText typedObject = (FSDefineText) anObject;
 
-			if (bounds != null)
-				result = bounds.equals(typedObject.bounds);
-			else
-				result = bounds == typedObject.bounds;
-
-			if (transform != null)
-				result = result &amp;&amp; transform.equals(typedObject.transform);
-			else
-				result = result &amp;&amp; transform == typedObject.transform;
-
-			if (objects != null)
-				result = result &amp;&amp; objects.equals(typedObject.objects);
-			else
-				result = result &amp;&amp; objects == typedObject.objects;
+			result = bounds.equals(typedObject.bounds);
+			result = result &amp;&amp; transform.equals(typedObject.transform);
+			result = result &amp;&amp; objects.equals(typedObject.objects);
 		}
 		return result;
 	}
@@ -349,6 +360,7 @@
 		return buffer.toString();
 	}
 
+	// TODO consider adding field sizes as attributes.
 	public int length(FSContext context)
 	{
 		super.length(context);
@@ -448,7 +460,7 @@
 		 * FSDefineText objects with no text records - this appears to be a bug
 		 * in the Flash file.
 		 */
-		objects = new ArrayList();
+		objects = new ArrayList&lt;FSText&gt;();
 
 		while (coder.scanBits(8, false) != 0)
 			objects.add(new FSText(coder, context));
@@ -463,10 +475,8 @@
 	{
 		int numberOfBits = 0;
 
-		for (Iterator recordIterator = objects.iterator(); recordIterator
-						.hasNext();)
-			numberOfBits = Math.max(numberOfBits, ((FSText) recordIterator
-							.next()).glyphBits());
+		for (Iterator&lt;FSText&gt; i = objects.iterator(); i.hasNext();)
+			numberOfBits = Math.max(numberOfBits, i.next().glyphBits());
 
 		return numberOfBits;
 	}
@@ -475,10 +485,8 @@
 	{
 		int numberOfBits = 1;
 
-		for (Iterator recordIterator = objects.iterator(); recordIterator
-						.hasNext();)
-			numberOfBits = Math.max(numberOfBits, ((FSText) recordIterator
-							.next()).advanceBits());
+		for (Iterator&lt;FSText&gt; i = objects.iterator(); i.hasNext();)
+			numberOfBits = Math.max(numberOfBits, i.next().advanceBits());
 
 		return numberOfBits;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineText2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineText2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineText2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -152,14 +152,12 @@
  */
 public class FSDefineText2 extends FSDefineObject
 {
-	private FSBounds bounds = null;
+	private FSBounds bounds;
+	private FSCoordTransform transform;
+	private ArrayList&lt;FSText&gt; objects;
 
-	private FSCoordTransform transform = null;
-
-	private ArrayList objects = null;
-
 	/**
-	 * Construct an FSDefineText2 object, initalizing it with values decoded
+	 * Construct an FSDefineText2 object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -185,10 +183,15 @@
 	 * @param textRecordArray
 	 *            an array of text record (FSTextStyle and FSText) object that
 	 *            define the text to be displayed.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the bounding box is null.
+	 * @throws NullPointerException if the coordinate transform null.
+	 * @throws NullPointerException if the array of text objects is null.
 	 */
 	public FSDefineText2(int anIdentifier, FSBounds aBounds,
 							FSCoordTransform aTransform,
-							ArrayList textRecordArray)
+							ArrayList&lt;FSText&gt; textRecordArray)
 	{
 		super(DefineText2, anIdentifier);
 		setBounds(aBounds);
@@ -209,10 +212,10 @@
 		bounds = new FSBounds(obj.bounds);
 		transform = new FSCoordTransform(obj.transform);
 
-		objects = new ArrayList(obj.objects.size());
+		objects = new ArrayList&lt;FSText&gt;(obj.objects.size());
 
-		for (Iterator i = obj.objects.iterator(); i.hasNext();)
-			objects.add(((FSText) i.next()).clone());
+		for (Iterator&lt;FSText&gt; i = obj.objects.iterator(); i.hasNext();)
+			objects.add((FSText) i.next().clone());
 	}
 
 	/**
@@ -220,9 +223,14 @@
 	 * 
 	 * @param anObject
 	 *            an FSText object.
+	 *            
+	 * @throws NullPointerException if the text object is null.
 	 */
 	public void add(FSText anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Text object cannot be null&quot;);
+		}
 		objects.add(anObject);
 	}
 
@@ -253,7 +261,7 @@
 	 * 
 	 * @return the array of text records (FSTextStyle and FSText objects).
 	 */
-	public ArrayList getObjects()
+	public ArrayList&lt;FSText&gt; getObjects()
 	{
 		return objects;
 	}
@@ -263,9 +271,14 @@
 	 * 
 	 * @param aBounds
 	 *            the bounding rectangle enclosing the text.
+	 *
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public void setBounds(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Bounding box cannot be null&quot;);
+		}
 		bounds = aBounds;
 	}
 
@@ -276,9 +289,14 @@
 	 * @param aTransform
 	 *            an FSCoordTransform to change the size and orientation of the
 	 *            text.
+	 *            
+	 * @throws NullPointerException if the coordinate transform null.
 	 */
 	public void setTransform(FSCoordTransform aTransform)
 	{
+		if (aTransform == null) {
+			throw new NullPointerException(&quot;Coordinate transform cannot be null&quot;);
+		}
 		transform = aTransform;
 	}
 
@@ -288,9 +306,14 @@
 	 * @param anArray
 	 *            an array of FSText objects that define the text to be
 	 *            displayed.
+	 *            
+	 * @throws NullPointerException if the array of text objects is null.
 	 */
-	public void setObjects(ArrayList anArray)
+	public void setObjects(ArrayList&lt;FSText&gt; anArray)
 	{
+		if (objects == null) {
+			throw new NullPointerException(&quot;Array of text objects cannot be null.&quot;);
+		}
 		objects = anArray;
 	}
 
@@ -298,14 +321,13 @@
 	{
 		FSDefineText2 anObject = (FSDefineText2) super.clone();
 
-		anObject.bounds = (bounds != null) ? (FSBounds) bounds.clone() : null;
-		anObject.transform = (transform != null) ? (FSCoordTransform) transform
-						.clone() : null;
+		anObject.bounds = (FSBounds) bounds.clone();
+		anObject.transform = (FSCoordTransform) transform.clone();
 
-		anObject.objects = new ArrayList(objects.size());
+		anObject.objects = new ArrayList&lt;FSText&gt;(objects.size());
 
-		for (Iterator i = objects.iterator(); i.hasNext();)
-			anObject.objects.add(((FSText) i.next()).clone());
+		for (Iterator&lt;FSText&gt; i = objects.iterator(); i.hasNext();)
+			anObject.objects.add((FSText) i.next().clone());
 
 		return anObject;
 	}
@@ -318,20 +340,9 @@
 		{
 			FSDefineText2 typedObject = (FSDefineText2) anObject;
 
-			if (bounds != null)
-				result = bounds.equals(typedObject.bounds);
-			else
-				result = bounds == typedObject.bounds;
-
-			if (transform != null)
-				result = result &amp;&amp; transform.equals(typedObject.transform);
-			else
-				result = result &amp;&amp; transform == typedObject.transform;
-
-			if (objects != null)
-				result = result &amp;&amp; objects.equals(typedObject.objects);
-			else
-				result = result &amp;&amp; objects == typedObject.objects;
+			result = bounds.equals(typedObject.bounds);
+			result = result &amp;&amp; transform.equals(typedObject.transform);
+			result = result &amp;&amp; objects.equals(typedObject.objects);
 		}
 		return result;
 	}
@@ -349,7 +360,8 @@
 
 		return buffer.toString();
 	}
-
+	
+//TODO record sizes as attributes
 	public int length(FSContext context)
 	{
 		super.length(context);
@@ -362,9 +374,8 @@
 		length += transform.length(context);
 		length += 2;
 
-		for (Iterator&lt;Codeable&gt; recordIterator = objects.iterator(); recordIterator
-						.hasNext();)
-			length += recordIterator.next().length(context);
+		for (Iterator&lt;FSText&gt; i = objects.iterator(); i.hasNext();)
+			length += i.next().length(context);
 
 		length += 1;
 
@@ -389,8 +400,8 @@
 		coder.writeWord(context.glyphSize, 1);
 		coder.writeWord(context.advanceSize, 1);
 
-		for (Iterator&lt;Codeable&gt; recordIterator = objects.iterator(); recordIterator.hasNext();)
-			recordIterator.next().encode(coder, context);
+		for (Iterator&lt;FSText&gt; i = objects.iterator(); i.hasNext();)
+			i.next().encode(coder, context);
 
 		coder.writeWord(0, 1);
 
@@ -455,7 +466,7 @@
 		 * FSDefineText objects with no text records - this appears to be a bug
 		 * in the Flash file.
 		 */
-		objects = new ArrayList();
+		objects = new ArrayList&lt;FSText&gt;();
 
 		while (coder.scanBits(8, false) != 0)
 			objects.add(new FSText(coder, context));
@@ -471,10 +482,8 @@
 	{
 		int numberOfBits = 0;
 
-		for (Iterator recordIterator = objects.iterator(); recordIterator
-						.hasNext();)
-			numberOfBits = Math.max(numberOfBits, ((FSText) recordIterator
-							.next()).glyphBits());
+		for (Iterator&lt;FSText&gt; i = objects.iterator(); i.hasNext();)
+			numberOfBits = Math.max(numberOfBits, ((FSText) i.next()).glyphBits());
 
 		return numberOfBits;
 	}
@@ -483,10 +492,8 @@
 	{
 		int numberOfBits = 0;
 
-		for (Iterator recordIterator = objects.iterator(); recordIterator
-						.hasNext();)
-			numberOfBits = Math.max(numberOfBits, ((FSText) recordIterator
-							.next()).advanceBits());
+		for (Iterator&lt;FSText&gt; i = objects.iterator(); i.hasNext();)
+			numberOfBits = Math.max(numberOfBits, ((FSText) i.next()).advanceBits());
 
 		return numberOfBits;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineTextField.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineTextField.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineTextField.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -318,53 +318,31 @@
 	public static final int AlignJustify = 3;
 
 	private FSBounds bounds = null;
-
 	private boolean wordWrapped = false;
-
 	private boolean multiline = false;
-
 	private boolean password = false;
-
 	private boolean readOnly = false;
-
 	private int reserved1 = 0;
-
 	private boolean selectable = false;
-
 	private boolean bordered = false;
-
 	private boolean reserved2 = false;
-
 	private boolean html = false;
-
 	private boolean useFontGlyphs = false;
-
 	private boolean autoSize = false;
-
 	private int fontIdentifier = 0;
-
 	private int fontHeight = 0;
-
 	private FSColor color = null;
-
 	private int maxLength = 0;
-
 	private int alignment = Transform.VALUE_NOT_SET;
-
 	private int leftMargin = Transform.VALUE_NOT_SET;
-
 	private int rightMargin = Transform.VALUE_NOT_SET;
-
 	private int indent = Transform.VALUE_NOT_SET;
-
 	private int leading = Transform.VALUE_NOT_SET;
-
 	private String variableName = &quot;&quot;;
-
 	private String initialText = &quot;&quot;;
 
 	/**
-	 * Construct an FSDefineTextField object, initalizing it with values decoded
+	 * Construct an FSDefineTextField object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -388,6 +366,9 @@
 	 *            the unique identifier for this object.
 	 * @param aBounds
 	 *            the bounding rectangle for the field which defines its size.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public FSDefineTextField(int anIdentifier, FSBounds aBounds)
 	{
@@ -409,9 +390,13 @@
 	 * @param attributes
 	 *            a collection of key-value pairs identifying the attributes to
 	 *            be set.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the bounding box is null.
+	 * @throws NullPointerException if the table of attributes is null.
 	 */
 	public FSDefineTextField(int anIdentifier, FSBounds aBounds,
-								Hashtable attributes)
+								Hashtable&lt;String,Object&gt; attributes)
 	{
 		super(DefineTextField, anIdentifier);
 		setBounds(aBounds);
@@ -692,9 +677,9 @@
 	 * 
 	 * @return the list of attributes for the object.
 	 */
-	public Hashtable getAttributes()
+	public Hashtable&lt;String,Object&gt; getAttributes()
 	{
-		Hashtable attributes = new Hashtable();
+		Hashtable&lt;String,Object&gt; attributes = new Hashtable&lt;String,Object&gt;();
 
 		attributes.put(WordWrapped, new Boolean(isWordWrapped()));
 		attributes.put(Multiline, new Boolean(isMultiline()));
@@ -726,9 +711,14 @@
 	 * 
 	 * @param aBounds
 	 *            the bounding rectangle enclosing the text field.
+	 *            
+	 * @throws NullPointerException if the bounding box is null.
 	 */
 	public void setBounds(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Bounding box for field cannot be null.&quot;);
+		}
 		bounds = aBounds;
 	}
 
@@ -829,9 +819,14 @@
 	 * 
 	 * @param anIdentifier
 	 *            the identifier for the font that the text will be rendered in.
+	 *            
+	 * @throws IllegalArgumentException if the identifier for the font is not in the range 1..65535.
 	 */
 	public void setFontIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier for font must be in the range 1..65535.&quot;);
+		}
 		fontIdentifier = anIdentifier;
 	}
 
@@ -840,9 +835,14 @@
 	 * 
 	 * @param aNumber
 	 *            the height of the font.
+	 *            
+	 * @throws IllegalArgumentException if the height font is not in the range 0..65535.
 	 */
 	public void setFontHeight(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Height for font must be in the range 0..65535.&quot;);
+		}
 		fontHeight = aNumber;
 	}
 
@@ -855,6 +855,9 @@
 	 */
 	public void setColor(FSColor aColor)
 	{
+		if (aColor == null) {
+			aColor = new FSColor(0,0,0);
+		}
 		color = aColor;
 	}
 
@@ -864,9 +867,14 @@
 	 * 
 	 * @param aNumber
 	 *            the maximum number of characters displayed in the field.
+	 *            
+	 * @throws IllegalArgumentException if the maximum length is not in the range 0..65535.
 	 */
 	public void setMaxLength(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;maximum length for text must be in the range 0..65535.&quot;);
+		}
 		maxLength = aNumber;
 	}
 
@@ -876,9 +884,16 @@
 	 * 
 	 * @param aType
 	 *            the type of alignment.
+	 *            
+	 * @throws IllegalArgumentException if alignment is not either AlignLeft, 
+	 * AlignRight, AlignCenter or AlignJustify.
 	 */
 	public void setAlignment(int aType)
 	{
+		if (aType &lt; AlignLeft || aType &gt; AlignJustify) {
+			throw new IllegalArgumentException(&quot;Alignment for text must be either &quot; +
+					&quot;AlignLeft, AlignRight, AlignCenter or AlignJustify&quot;);
+		}
 		alignment = aType;
 	}
 
@@ -887,9 +902,14 @@
 	 * 
 	 * @param aNumber
 	 *            the width of the left margin.
+	 *            
+	 * @throws IllegalArgumentException if margin is not in the range 0..65535.
 	 */
 	public void setLeftMargin(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Margin must be in the range 0..65535.&quot;);
+		}
 		leftMargin = aNumber;
 	}
 
@@ -898,9 +918,14 @@
 	 * 
 	 * @param aNumber
 	 *            the width of the right margin.
+	 *            
+	 * @throws IllegalArgumentException if margin is not in the range 0..65535.
 	 */
 	public void setRightMargin(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Margin must be in the range 0..65535.&quot;);
+		}
 		rightMargin = aNumber;
 	}
 
@@ -909,9 +934,14 @@
 	 * 
 	 * @param aNumber
 	 *            the indentation for the first line.
+	 *            
+	 * @throws IllegalArgumentException if indentation is not in the range 0..65535.
 	 */
 	public void setIndent(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Indentation must be in the range 0..65535.&quot;);
+		}
 		indent = aNumber;
 	}
 
@@ -920,9 +950,14 @@
 	 * 
 	 * @param aNumber
 	 *            the value for the leading.
+	 *            
+	 * @throws IllegalArgumentException if leading is not in the range -32768..32767.
 	 */
 	public void setLeading(int aNumber)
 	{
+		if (aNumber &lt; -32768 || aNumber &gt; 32767) {
+			throw new IllegalArgumentException(&quot;Leading must be in the range -32768..32767.&quot;);
+		}
 		leading = aNumber;
 	}
 
@@ -958,7 +993,7 @@
 	 * @param attributes
 	 *            the list of attributes for the object.
 	 */
-	public void setAttributes(Hashtable attributes)
+	public void setAttributes(Hashtable&lt;String,Object&gt; attributes)
 	{
 		if (attributes.get(WordWrapped) != null)
 			setWordWrapped(((Boolean) attributes.get(WordWrapped))
@@ -1009,8 +1044,8 @@
 	{
 		FSDefineTextField anObject = (FSDefineTextField) super.clone();
 
-		anObject.bounds = (bounds != null) ? (FSBounds) bounds.clone() : null;
-		anObject.color = (color != null) ? (FSColor) color.clone() : null;
+		anObject.bounds = (FSBounds) bounds.clone();
+		anObject.color = (FSColor) color.clone();
 
 		return anObject;
 	}
@@ -1023,11 +1058,7 @@
 		{
 			FSDefineTextField typedObject = (FSDefineTextField) anObject;
 
-			if (bounds != null)
-				result = bounds.equals(typedObject.bounds);
-			else
-				result = bounds == typedObject.bounds;
-
+			result = bounds.equals(typedObject.bounds);
 			result = result &amp;&amp; wordWrapped == typedObject.wordWrapped;
 			result = result &amp;&amp; multiline == typedObject.multiline;
 			result = result &amp;&amp; password == typedObject.password;
@@ -1044,10 +1075,7 @@
 			result = result &amp;&amp; fontIdentifier == typedObject.fontIdentifier;
 			result = result &amp;&amp; fontHeight == typedObject.fontHeight;
 
-			if (color != null)
-				result = result &amp;&amp; color.equals(typedObject.color);
-			else
-				result = result &amp;&amp; color == typedObject.color;
+			result = result &amp;&amp; color.equals(typedObject.color);
 
 			result = result &amp;&amp; maxLength == typedObject.maxLength;
 
@@ -1061,9 +1089,7 @@
 			}
 
 			if (variableName != null)
-				result = result
-								&amp;&amp; variableName
-												.equals(typedObject.variableName);
+				result = result &amp;&amp; variableName.equals(typedObject.variableName);
 			else
 				result = result &amp;&amp; variableName == typedObject.variableName;
 
@@ -1080,6 +1106,7 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;FSDefineTextField: { &quot;);
+		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
 		buffer.append(&quot;bounds = &quot;).append(bounds.toString()).append(&quot;; &quot;);
 		buffer.append(&quot;wordWrapped = &quot;).append(wordWrapped).append(&quot;; &quot;);
 		buffer.append(&quot;multiline = &quot;).append(multiline).append(&quot;; &quot;);
@@ -1174,24 +1201,14 @@
 		if (_containsMaxLength)
 			coder.writeWord(maxLength, 2);
 
+		// TODO can value not set be replaced by zero.
 		if (containsLayoutInfo())
 		{
-			coder.writeWord((alignment != Transform.VALUE_NOT_SET) ? alignment
-							: 0, 1);
-			coder
-							.writeWord(
-											(leftMargin != Transform.VALUE_NOT_SET) ? leftMargin
-															: 0, 2);
-			coder
-							.writeWord(
-											(rightMargin != Transform.VALUE_NOT_SET) ? rightMargin
-															: 0, 2);
-			coder
-							.writeWord(
-											(indent != Transform.VALUE_NOT_SET) ? indent
-															: 0, 2);
-			coder.writeWord((leading != Transform.VALUE_NOT_SET) ? leading : 0,
-							2);
+			coder.writeWord((alignment != Transform.VALUE_NOT_SET) ? alignment : 0, 1);
+			coder.writeWord((leftMargin != Transform.VALUE_NOT_SET) ? leftMargin: 0, 2);
+			coder.writeWord((rightMargin != Transform.VALUE_NOT_SET) ? rightMargin: 0, 2);
+			coder.writeWord((indent != Transform.VALUE_NOT_SET) ? indent : 0, 2);
+			coder.writeWord((leading != Transform.VALUE_NOT_SET) ? leading : 0, 2);
 		}
 
 		coder.writeString(variableName);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDefineVideo.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDefineVideo.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDefineVideo.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -30,9 +30,6 @@
 
 package com.flagstone.transform;
 
-import java.util.ArrayList;
-import java.util.Iterator;
-
 /**
  * The FSDefineVideo class is used to display video within a Flash file.
  * 
@@ -140,20 +137,15 @@
 	/** Instruct the Flash Player to turn the deblocking filter on. */
 	public static final int On = 2;
 
-	private int frameCount = 0;
+	private int frameCount;
+	private int width;
+	private int height;
+	private int deblocking;
+	private boolean smoothing;
+	private int codec;
 
-	private int width = 0;
-
-	private int height = 0;
-
-	private int deblocking = 0;
-
-	private boolean smoothing = false;
-
-	private int codec = 0;
-
 	/**
-	 * Construct an FSDefineVideo object, initalizing it with values decoded
+	 * Construct an FSDefineVideo object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -187,6 +179,12 @@
 	 *            the format of the video data. Flash 6 supports
 	 *            FSDefineVideo.H263. Support for Macromedia's ScreenVideo
 	 *            format was added in Flash 7.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the number of frames is not in the range 0..65535.
+	 * @throws IllegalArgumentException if the width is not in the range 0..65535.
+	 * @throws IllegalArgumentException if the height is not in the range 0..65535.
+	 * @throws IllegalArgumentException if blocking is not either On, Off or UseVideo.
 	 */
 	public FSDefineVideo(int anIdentifier, int count, int width, int height,
 							int deblocking, boolean smoothing, int codec)
@@ -233,9 +231,14 @@
 	 * 
 	 * @param count
 	 *            the number of video frames.
+	 *          
+	 * @throws IllegalArgumentException if the number of frames is not in the range 0..65535.
 	 */
 	public void setFrameCount(int count)
 	{
+		if (count &lt; 0 || count &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Number of frames must be in the rage 0..65535.&quot;);
+		}
 		frameCount = count;
 	}
 
@@ -252,12 +255,17 @@
 	/**
 	 * Sets the width of each frame in pixels.
 	 * 
-	 * @param width
+	 * @param size
 	 *            the width of the frame.
+	 *          
+	 * @throws IllegalArgumentException if the width is not in the range 0..65535.
 	 */
-	public void setWidth(int width)
+	public void setWidth(int size)
 	{
-		this.width = width;
+		if (size &lt; 0 || size &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Width of video frame must be in the rage 0..65535.&quot;);
+		}
+		width = size;
 	}
 
 	/**
@@ -273,12 +281,17 @@
 	/**
 	 * Sets the height of each frame in pixels.
 	 * 
-	 * @param height
+	 * @param size
 	 *            the height of the frame.
+	 *          
+	 * @throws IllegalArgumentException if the height is not in the range 0..65535.
 	 */
-	public void setHeight(int height)
+	public void setHeight(int size)
 	{
-		this.height = height;
+		if (size &lt; 0 || size &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Height of video frame must be in the rage 0..65535.&quot;);
+		}
+		this.height = size;
 	}
 
 	/**
@@ -296,14 +309,19 @@
 	/**
 	 * Sets the method used to control the Flash Player's deblocking filter.
 	 * 
-	 * @param deblocking
+	 * @param value
 	 *            the deblocking filter control, either FSDefineVideo.Off,
 	 *            FSDefineVideo.On or FSDefineVideo.UseVideo to allow the video
 	 *            data to specify whether the deblocking filter is used.
+	 *            
+	 * @throws IllegalArgumentException if blocking is not either On, Off or UseVideo.
 	 */
-	public void setDeblocking(int deblocking)
+	public void setDeblocking(int value)
 	{
-		this.deblocking = deblocking;
+		if (value != Off &amp;&amp; value != On &amp;&amp; value != UseVideo) {
+			throw new IllegalArgumentException(&quot;Deblocking must be either Off, On or UseVideo.&quot;);
+		}
+		deblocking = value;
 	}
 
 	/**

Modified: dev/dev-2-4/src/com/flagstone/transform/FSDoAction.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSDoAction.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSDoAction.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -105,12 +105,12 @@
  */
 public class FSDoAction extends FSMovieObject
 {
-	private ArrayList actions = null;
+	private ArrayList&lt;FSActionObject&gt; actions;
 
 	private byte[] encodedActions = null;
 
 	/**
-	 * Construct an FSDoAction object, initalizing it with values decoded from
+	 * Construct an FSDoAction object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -127,8 +127,10 @@
 	 * 
 	 * @param anArray
 	 *            the array of action objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public FSDoAction(ArrayList anArray)
+	public FSDoAction(ArrayList&lt;FSActionObject&gt; anArray)
 	{
 		super(FSMovieObject.DoAction);
 		setActions(anArray);
@@ -140,6 +142,8 @@
 	 * 
 	 * @param bytes
 	 *            an array of encoded action objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
 	public FSDoAction(byte[] bytes)
 	{
@@ -160,13 +164,14 @@
 
 		if (obj.actions != null)
 		{
-			actions = new ArrayList(obj.actions.size());
+			actions = new ArrayList&lt;FSActionObject&gt;(obj.actions.size());
 
-			for (Iterator i = obj.actions.iterator(); i.hasNext();)
-				actions.add(((FSActionObject) i.next()).clone());
-		} else
+			for (Iterator&lt;FSActionObject&gt; i = obj.actions.iterator(); i.hasNext();)
+				actions.add((FSActionObject) i.next().clone());
+		} 
+		else
 		{
-			encodedActions = Transform.clone(obj.encodedActions);
+			encodedActions = copy(obj.encodedActions);
 		}
 	}
 
@@ -176,9 +181,14 @@
 	 * 
 	 * @param anAction
 	 *            an object belonging to a class derived from FSActionObject.
+	 *            
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void add(FSActionObject anAction)
 	{
+		if (anAction == null) {
+			throw new NullPointerException(&quot;Action cannot be null.&quot;);
+		}
 		if (encodedActions != null)
 		{
 			actions = FSActionObject.decodeActions(encodedActions);
@@ -192,7 +202,7 @@
 	 * 
 	 * @return the array of action objects.
 	 */
-	public ArrayList getActions()
+	public ArrayList&lt;FSActionObject&gt; getActions()
 	{
 		if (encodedActions != null)
 		{
@@ -209,9 +219,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of action objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setActions(ArrayList anArray)
+	public void setActions(ArrayList&lt;FSActionObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of actions cannot be null.&quot;);
+		}
 		actions = anArray;
 		encodedActions = null;
 	}
@@ -235,9 +250,14 @@
 	 * 
 	 * @param bytes
 	 *            the array of encoded actions.
+	 *            
+	 * @throws NullPointerException if the encoded actions are null.
 	 */
 	public void setEncodedActions(byte[] bytes)
 	{
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Encoded actions cannot be null.&quot;);
+		}
 		encodedActions = bytes;
 		actions = null;
 	}
@@ -248,13 +268,13 @@
 
 		if (actions != null)
 		{
-			anObject.actions = new ArrayList();
+			anObject.actions = new ArrayList&lt;FSActionObject&gt;();
 
-			for (Iterator i = actions.iterator(); i.hasNext();)
-				anObject.actions.add(((FSActionObject) i.next()).clone());
+			for (Iterator&lt;FSActionObject&gt; i = actions.iterator(); i.hasNext();)
+				anObject.actions.add((FSActionObject) i.next().clone());
 		} else
 		{
-			anObject.encodedActions = Transform.clone(encodedActions);
+			anObject.encodedActions = FSMovieObject.copy(encodedActions);
 		}
 		return anObject;
 	}
@@ -272,8 +292,7 @@
 				result = actions.equals(typedObject.actions);
 			} else
 			{
-				result = Transform.equals(encodedActions,
-								typedObject.encodedActions);
+				result = equals(encodedActions, typedObject.encodedActions);
 			}
 		}
 		return result;
@@ -301,22 +320,9 @@
 
 		if (actions != null)
 		{
-			FSActionObject currentAction = null;
-			int count = actions.size();
-
-			for (int i = 0; i &lt; count; i++)
-			{
-				currentAction = (FSActionObject) actions.get(i);
-
-				length += currentAction.length(context);
-				length += (currentAction.getType() &gt; 128) ? 3 : 1;
-			}
-
-			if (count == 0 || (currentAction.getType() != FSAction.End))
-			{
-				length += 1;
-			}
-		} else
+			length += FSActionObject.length(context, actions);
+		} 
+		else
 		{
 			length += encodedActions.length;
 
@@ -335,42 +341,13 @@
 
 		if (actions != null)
 		{
-			FSActionObject action = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				action = (FSActionObject) i.next();
-
-				int objStart = coder.getPointer();
-				int start = coder.getPointer()
-								+ ((action.getType() &gt; 128) ? 24 : 8);
-				int next = start + (action.getLength() &lt;&lt; 3);
-
-				action.encode(coder, context);
-
-				int delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-				if (delta != 0)
-				{
-					context.codingError = true;
-					context.typeInError = action.getType();
-					context.startOfError = objStart &gt;&gt;&gt; 3;
-					context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
-					context.delta = delta;
-				}
-				coder.setPointer(next);
-			}
-
-			if ((actions.size() == 0) || (action.getType() != FSAction.End))
-			{
-				coder.writeWord(0, 1);
-			}
-		} else
+			FSActionObject.encode(coder, context, actions);
+		} 
+		else
 		{
 			coder.writeBytes(encodedActions);
 
-			if ((encodedActions.length == 0)
-							|| (encodedActions[encodedActions.length - 1] != FSAction.End))
+			if ((encodedActions.length == 0) || (encodedActions[encodedActions.length - 1] != FSAction.End))
 			{
 				coder.writeWord(0, 1);
 			}
@@ -383,19 +360,9 @@
 
 		if (context.decodeActions)
 		{
-			actions = new ArrayList();
-
-			int len = length;
-			int start;
-
-			while (len &gt; 0)
-			{
-				start = coder.getPointer();
-
-				actions.add(FSActionObject.decodeAction(coder, context));
-				len -= (coder.getPointer() - start) &gt;&gt;&gt; 3;
-			}
-		} else
+			actions = FSActionObject.decodeActions(coder, context, length);
+		} 
+		else
 		{
 			encodedActions = new byte[length];
 			coder.readBytes(encodedActions);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSEnableDebugger.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSEnableDebugger.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSEnableDebugger.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -89,6 +89,8 @@
 	 * 
 	 * @param password
 	 *            the string defining the password.
+	 *            
+	 * @throws NullPointerException if the password is null.
 	 */
 	public FSEnableDebugger(String password)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSEnableDebugger2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSEnableDebugger2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSEnableDebugger2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -90,6 +90,8 @@
 	 * 
 	 * @param password
 	 *            the string defining the password.
+	 *            
+	 * @throws NullPointerException if the password is null.
 	 */
 	public FSEnableDebugger2(String password)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSEnvelope.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSEnvelope.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSEnvelope.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -87,9 +87,9 @@
  */
 public class FSEnvelope implements Cloneable, Codeable
 {
-	private int mark = 0;
-	private int left = 0;
-	private int right = 0;
+	private int mark;
+	private int left;
+	private int right;
 
 	/**
 	 * Construct an FSEnvelope object, initialising it with values decoded from
@@ -113,6 +113,8 @@
 	 *            the level for the left sound channel, in the range 0..65535.
 	 * @param rightValue
 	 *            the level for the right sound channel, in the range 0..65535.
+	 *            
+	 * @throws IllegalArgumentException if the left or right levels are not in the range 0..65535.
 	 */
 	public FSEnvelope(int markValue, int leftValue, int rightValue)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSExceptionHandler.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSExceptionHandler.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSExceptionHandler.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -117,19 +117,13 @@
 public class FSExceptionHandler extends FSActionObject
 {
 	private int register;
-
 	private String variable;
-
 	private ArrayList&lt;FSActionObject&gt; tryActions;
-
 	private ArrayList&lt;FSActionObject&gt; catchActions;
-
 	private ArrayList&lt;FSActionObject&gt; finalActions;
-
+	
 	private int tryLength;
-
 	private int catchLength;
-
 	private int finalLength;
 
 	/**
@@ -159,11 +153,15 @@
 	 *            actions that will be executed in the catch block of the
 	 *            exception, if one is defined. This may be null is no catch
 	 *            block is required - the exception will be handled by another
-	 *            catche block higher in the exception tree.
+	 *            catch block higher in the exception tree.
 	 * @param finallyArray
 	 *            actions that will be executed in the finally block of the
 	 *            exception, if one is defined. This may be null is no finally
 	 *            block is required.
+	 *            
+	 * @throws NullPointerException if the name is null.
+	 * @throws IllegalArgumentException if the name is empty.
+	 * @throws NullPointerException if the array of actions for the try block are null.
 	 */
 
 	public FSExceptionHandler(String name, ArrayList&lt;FSActionObject&gt; tryArray,
@@ -172,9 +170,8 @@
 	{
 		super(ExceptionHandler);
 
-		register = 0;
-		variable = name;
-		tryActions = tryArray;
+		setVariable(name);
+		setTryActions(tryArray);
 		catchActions = catchArray;
 		finalActions = finallyArray;
 	}
@@ -198,6 +195,9 @@
 	 *            actions that will be executed in the finally block of the
 	 *            exception, if one is defined. This may be null is no finally
 	 *            block is required.
+	 *            
+	 * @throws IllegalArgumentexception is the register number is not in the range 0..255
+	 * @throws NullPointerException if the array of actions for the try block are null.
 	 */
 	public FSExceptionHandler(int index, ArrayList&lt;FSActionObject&gt; tryArray,
 								ArrayList&lt;FSActionObject&gt; catchArray,
@@ -205,9 +205,8 @@
 	{
 		super(ExceptionHandler);
 
-		register = index;
-		variable = null;
-		tryActions = tryArray;
+		setRegister(index);
+		setTryActions(tryArray);
 		catchActions = catchArray;
 		finalActions = finallyArray;
 	}
@@ -221,7 +220,7 @@
 	 */
 	public FSExceptionHandler(FSExceptionHandler obj)
 	{
-		super(obj);
+		super(ExceptionHandler);
 
 		register = obj.register;
 
@@ -238,9 +237,18 @@
 	 * 
 	 * @param anAction
 	 *            an action.
+	 *            
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void addToTry(FSActionObject anAction)
 	{
+		if (anAction == null) {
+			throw new NullPointerException(&quot;Action cannot be null.&quot;);
+		}
+		
+		if (tryActions == null)
+			tryActions = new ArrayList&lt;FSActionObject&gt;();
+
 		tryActions.add(anAction);
 	}
 
@@ -249,9 +257,15 @@
 	 * 
 	 * @param anAction
 	 *            an action.
+	 *            
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void addToCatch(FSActionObject anAction)
 	{
+		if (anAction == null) {
+			throw new NullPointerException(&quot;Action cannot be null.&quot;);
+		}
+		
 		if (catchActions == null)
 			catchActions = new ArrayList&lt;FSActionObject&gt;();
 
@@ -263,9 +277,15 @@
 	 * 
 	 * @param anAction
 	 *            an action.
+	 *            
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void addToFinally(FSActionObject anAction)
 	{
+		if (anAction == null) {
+			throw new NullPointerException(&quot;Action cannot be null.&quot;);
+		}
+		
 		if (catchActions == null)
 			finalActions = new ArrayList&lt;FSActionObject&gt;();
 
@@ -289,9 +309,18 @@
 	 * @param name
 	 *            the name of the variable. May be null if the exception object
 	 *            will be signed to a register.
+	 *            
+	 * @throws NullPointerException if the name is null.
+	 * @throws IllegalArgumentException if the name is empty.
 	 */
 	public void setVariable(String name)
 	{
+		if (name == null) {
+			throw new NullPointerException(&quot;Variable name cannot be null.&quot;);
+		}
+		if (name.length() == 0) {
+			throw new IllegalArgumentException(&quot;Variable name cannot be empty.&quot;);
+		}
 		variable = name;
 		register = 0;
 	}
@@ -313,9 +342,14 @@
 	 * @param index
 	 *            the number of the register. May be 0 if the exception object
 	 *            will be assigned to a local variable.
+	 *            
+	 * @throws IllegalArgumentexception is the register number is not in the range 0..255
 	 */
 	public void setRegister(int index)
 	{
+		if (index &lt; 0 || index &gt; 255) {
+			throw new IllegalArgumentException(&quot;Register index must be in the range 0..255.&quot;);
+		}
 		register = index;
 		variable = null;
 	}
@@ -405,26 +439,17 @@
 			if (variable != null)
 				result = variable.equals(typedObject.variable);
 			else
-				result = variable == typedObject.variable;
+				result = result &amp;&amp; register == typedObject.register;
 
-			result = result &amp;&amp; register == typedObject.register;
+			result = result &amp;&amp; tryActions.equals(typedObject.tryActions);
 
-			if (tryActions != null)
-				result = result &amp;&amp; tryActions.equals(typedObject.tryActions);
-			else
-				result = result &amp;&amp; tryActions == typedObject.tryActions;
-
 			if (catchActions != null)
-				result = result
-								&amp;&amp; catchActions
-												.equals(typedObject.catchActions);
+				result = result &amp;&amp; catchActions.equals(typedObject.catchActions);
 			else
 				result = result &amp;&amp; catchActions == typedObject.catchActions;
 
 			if (finalActions != null)
-				result = result
-								&amp;&amp; finalActions
-												.equals(typedObject.finalActions);
+				result = result &amp;&amp; finalActions.equals(typedObject.finalActions);
 			else
 				result = result &amp;&amp; finalActions == typedObject.finalActions;
 		}
@@ -441,15 +466,11 @@
 		buffer.append(&quot;register = &quot;).append(register).append(&quot;; &quot;);
 		buffer.append(&quot;try = array[&quot;).append(tryActions.size()).append(&quot;]; &quot;);
 
-		if (catchActions != null)
-		{
-			buffer.append(&quot;catch = array[&quot;).append(catchActions.size()).append(
-							&quot;]; &quot;);
+		if (catchActions != null) {
+			buffer.append(&quot;catch = array[&quot;).append(catchActions.size()).append(&quot;]; &quot;);
 		}
-		if (finalActions != null)
-		{
-			buffer.append(&quot;final = array[&quot;).append(finalActions.size()).append(
-							&quot;]; &quot;);
+		if (finalActions != null) {
+			buffer.append(&quot;final = array[&quot;).append(finalActions.size()).append(&quot;]; &quot;);
 		}
 
 		buffer.append(&quot;}&quot;);
@@ -464,9 +485,9 @@
 		length += 7;
 		length += (variable != null) ? FSCoder.strlen(variable, true) : 1;
 
-		tryLength = FSActionObject.length(tryActions);
-		catchLength = FSActionObject.length(catchActions);
-		finalLength = FSActionObject.length(finalActions);
+		tryLength = FSActionObject.length(context, tryActions);
+		catchLength = FSActionObject.length(context, catchActions);
+		finalLength = FSActionObject.length(context, finalActions);
 
 		length += tryLength;
 		length += catchLength;

Modified: dev/dev-2-4/src/com/flagstone/transform/FSExport.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSExport.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSExport.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -119,6 +119,10 @@
 	 *            the identifier of the object to be exported.
 	 * @param aString
 	 *            the name of the exported object to allow it to be referenced.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the name of the exported object is null.
+	 * @throws IllegalArgumentException if the name is an empty string.
 	 */
 	public FSExport(int anIdentifier, String aString)
 	{
@@ -154,6 +158,10 @@
 	 *            the identifier of the object to be exported.
 	 * @param aString
 	 *            the name of the exported object to allow it to be referenced.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the name of the exported object is null.
+	 * @throws IllegalArgumentException if the name is an empty string.
 	 */
 	public void add(int anIdentifier, String aString)
 	{
@@ -167,6 +175,7 @@
 	 */
 	public Hashtable&lt;Integer,String&gt; getObjects()
 	{
+		//TODO return a Map instead
 		return objects;
 	}
 
@@ -175,9 +184,14 @@
 	 * 
 	 * @param aTable
 	 *            the table of objects being imported.
+	 *            
+	 * @throws NullPointerException if the table is null.
 	 */
 	public void setObjects(Hashtable&lt;Integer,String&gt; aTable)
 	{
+		if (aTable == null) {
+			throw new NullPointerException(&quot;Export table cannot be null.&quot;);
+		}
 		objects = aTable;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSFontInfo.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSFontInfo.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSFontInfo.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -131,27 +131,22 @@
  */
 public class FSFontInfo extends FSMovieObject
 {
-	private int identifier = 0;
+	private int identifier;
+	private String name;
+	private int encoding;
+	private boolean small;
+	private boolean italic;
+	private boolean bold;
 
-	private String name = &quot;&quot;;
+	private ArrayList&lt;Integer&gt; codes = new ArrayList&lt;Integer&gt;();
 
-	private int encoding = FSText.Unicode;
-
-	private boolean small = false;
-
-	private boolean italic = false;
-
-	private boolean bold = false;
-
-	private ArrayList codes = new ArrayList();
-
 	/*
 	 * attributes used to retain state during encoding.
 	 */
-	private boolean _containsWideCodes = false;
+	private boolean wideCodes = false;
 
 	/**
-	 * Construct an FSFontInfo object, initalizing it with values decoded from
+	 * Construct an FSFontInfo object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -172,6 +167,9 @@
 	 *            glyphs for the font.
 	 * @param aName
 	 *            the name assigned to the font, identifying the font family.
+     *
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the name of the font is null.
 	 */
 	public FSFontInfo(int anIdentifier, String aName)
 	{
@@ -197,10 +195,10 @@
 		italic = obj.italic;
 		bold = obj.bold;
 
-		codes = new ArrayList(obj.codes.size());
+		codes = new ArrayList&lt;Integer&gt;(obj.codes.size());
 
-		for (Iterator i = obj.codes.iterator(); i.hasNext();)
-			codes.add(new Integer(((Integer) i.next()).intValue()));
+		for (Iterator&lt;Integer&gt; i = obj.codes.iterator(); i.hasNext();)
+			codes.add(new Integer(i.next()).intValue());
 	}
 
 	/**
@@ -287,7 +285,7 @@
 	 * 
 	 * @return the array of character codes.
 	 */
-	public ArrayList getCodes()
+	public ArrayList&lt;Integer&gt; getCodes()
 	{
 		return codes;
 	}
@@ -298,9 +296,14 @@
 	 * @param anIdentifier
 	 *            the unique identifier of the FSDefineFont that contains the
 	 *            glyphs for the font.
+     *
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier for font should be in the range 1...65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -309,9 +312,14 @@
 	 * 
 	 * @param aString
 	 *            the name assigned to the font, identifying the font family.
+     *
+	 * @throws NullPointerException if the name of the font is null.
 	 */
 	public void setName(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;The name of the font cannot be null.&quot;);
+		}
 		name = aString;
 	}
 
@@ -358,9 +366,14 @@
 	 * 
 	 * @param anArray
 	 *            the array mapping glyphs to particular character codes.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setCodes(ArrayList anArray)
+	public void setCodes(ArrayList&lt;Integer&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;The array of character codes cannot be null.&quot;);
+		}
 		codes = anArray;
 	}
 
@@ -368,10 +381,10 @@
 	{
 		FSFontInfo anObject = (FSFontInfo) super.clone();
 
-		anObject.codes = new ArrayList();
+		anObject.codes = new ArrayList&lt;Integer&gt;();
 
-		for (Iterator i = codes.iterator(); i.hasNext();)
-			anObject.codes.add(new Integer(((Integer) i.next()).intValue()));
+		for (Iterator&lt;Integer&gt; i = codes.iterator(); i.hasNext();)
+			anObject.codes.add(new Integer(i.next()).intValue());
 
 		return anObject;
 	}
@@ -382,23 +395,15 @@
 
 		if (super.equals(anObject))
 		{
-			FSFontInfo typedObject = (FSFontInfo) anObject;
+			FSFontInfo info = (FSFontInfo) anObject;
 
-			result = identifier == typedObject.identifier;
-			result = result &amp;&amp; encoding == typedObject.encoding;
-			result = result &amp;&amp; small == typedObject.small;
-			result = result &amp;&amp; italic == typedObject.italic;
-			result = result &amp;&amp; bold == typedObject.bold;
-
-			if (name != null)
-				result = result &amp;&amp; name.equals(typedObject.name);
-			else
-				result = result &amp;&amp; name == typedObject.name;
-
-			if (codes != null)
-				result = result &amp;&amp; codes.equals(typedObject.codes);
-			else
-				result = result &amp;&amp; codes == typedObject.codes;
+			result = identifier == info.identifier;
+			result = result &amp;&amp; encoding == info.encoding;
+			result = result &amp;&amp; small == info.small;
+			result = result &amp;&amp; italic == info.italic;
+			result = result &amp;&amp; bold == info.bold;
+			result = result &amp;&amp; name.equals(info.name);
+			result = result &amp;&amp; codes.equals(info.codes);
 		}
 		return result;
 	}
@@ -429,15 +434,15 @@
 		length += 4;
 		length += FSCoder.strlen(name, false);
 
-		_containsWideCodes = false;
+		wideCodes = false;
 
-		for (Iterator codesIterator = codes.iterator(); codesIterator.hasNext();)
+		for (Iterator&lt;Integer&gt; i = codes.iterator(); i.hasNext();)
 		{
-			if (((Integer) codesIterator.next()).intValue() &gt; 255)
-				_containsWideCodes = true;
+			if (i.next().intValue() &gt; 255)
+				wideCodes = true;
 		}
 
-		length += codes.size() * (_containsWideCodes ? 2 : 1);
+		length += codes.size() * (wideCodes ? 2 : 1);
 
 		return length;
 	}
@@ -454,18 +459,17 @@
 		coder.writeBits(encoding, 2);
 		coder.writeBits(italic ? 1 : 0, 1);
 		coder.writeBits(bold ? 1 : 0, 1);
-		coder.writeBits(_containsWideCodes ? 1 : 0, 1);
+		coder.writeBits(wideCodes ? 1 : 0, 1);
 
-		for (Iterator codesIterator = codes.iterator(); codesIterator.hasNext();)
-			coder.writeWord(((Integer) codesIterator.next()).intValue(),
-							_containsWideCodes ? 2 : 1);
+		for (Iterator&lt;Integer&gt; i = codes.iterator(); i.hasNext();)
+			coder.writeWord(i.next().intValue(), wideCodes ? 2 : 1);
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
 		int nameLength = 0;
 
-		codes = new ArrayList();
+		codes = new ArrayList&lt;Integer&gt;();
 
 		super.decode(coder, context);
 
@@ -486,15 +490,14 @@
 		encoding = coder.readBits(2, false);
 		italic = coder.readBits(1, false) != 0 ? true : false;
 		bold = coder.readBits(1, false) != 0 ? true : false;
-		_containsWideCodes = coder.readBits(1, false) != 0 ? true : false;
+		wideCodes = coder.readBits(1, false) != 0 ? true : false;
 
 		int bytesRead = 3 + nameLength + 1;
 
 		while (bytesRead &lt; length)
 		{
-			codes.add(new Integer(coder.readWord(_containsWideCodes ? 2 : 1,
-							false)));
-			bytesRead += (_containsWideCodes) ? 2 : 1;
+			codes.add(new Integer(coder.readWord(wideCodes ? 2 : 1, false)));
+			bytesRead += (wideCodes) ? 2 : 1;
 		}
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSFontInfo2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSFontInfo2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSFontInfo2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -125,24 +125,17 @@
  */
 public class FSFontInfo2 extends FSMovieObject
 {
-	private int identifier = 0;
+	private int identifier;
+	private String name;
+	private boolean small;
+	private int encoding;
+	private boolean italic;
+	private boolean bold;
+	private int language;
+	private ArrayList&lt;Integer&gt; codes = new ArrayList&lt;Integer&gt;();
 
-	private String name = &quot;&quot;;
-
-	private boolean small = false;
-
-	private int encoding = FSText.Unicode;
-
-	private boolean italic = false;
-
-	private boolean bold = false;
-
-	private int language = 1; // FSText.Latin
-
-	private ArrayList codes = new ArrayList();
-
 	/**
-	 * Construct an FSFontInfo2 object, initalizing it with values decoded from
+	 * Construct an FSFontInfo2 object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -163,6 +156,9 @@
 	 *            glyphs for the font.
 	 * @param aName
 	 *            the name assigned to the font, identifying the font family.
+     *
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the name of the font is null.
 	 */
 	public FSFontInfo2(int anIdentifier, String aName)
 	{
@@ -189,10 +185,10 @@
 		bold = obj.bold;
 		language = obj.language;
 
-		codes = new ArrayList(obj.codes.size());
+		codes = new ArrayList&lt;Integer&gt;(obj.codes.size());
 
-		for (Iterator i = obj.codes.iterator(); i.hasNext();)
-			codes.add(new Integer(((Integer) i.next()).intValue()));
+		for (Iterator&lt;Integer&gt; i = obj.codes.iterator(); i.hasNext();)
+			codes.add(new Integer(i.next().intValue()));
 	}
 
 	/**
@@ -292,7 +288,7 @@
 	 * 
 	 * @return the array of character codes.
 	 */
-	public ArrayList getCodes()
+	public ArrayList&lt;Integer&gt; getCodes()
 	{
 		return codes;
 	}
@@ -303,9 +299,14 @@
 	 * @param anIdentifier
 	 *            the unique identifier of the FSDefineFont that contains the
 	 *            glyphs for the font.
+     *
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier for font should be in the range 1...65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -314,9 +315,14 @@
 	 * 
 	 * @param aString
 	 *            the name assigned to the font, identifying the font family.
+     *
+	 * @throws NullPointerException if the name of the font is null.
 	 */
 	public void setName(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;The name of the font cannot be null.&quot;);
+		}
 		name = aString;
 	}
 
@@ -380,9 +386,14 @@
 	 *            ordinal position of a character code in the array identifies
 	 *            the index of the corresponding glyph in the FSDefineFont
 	 *            object.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setCodes(ArrayList anArray)
+	public void setCodes(ArrayList&lt;Integer&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;The array of character codes cannot be null.&quot;);
+		}
 		codes = anArray;
 	}
 
@@ -390,10 +401,10 @@
 	{
 		FSFontInfo2 anObject = (FSFontInfo2) super.clone();
 
-		anObject.codes = new ArrayList();
+		anObject.codes = new ArrayList&lt;Integer&gt;();
 
-		for (Iterator i = codes.iterator(); i.hasNext();)
-			anObject.codes.add(new Integer(((Integer) i.next()).intValue()));
+		for (Iterator&lt;Integer&gt; i = codes.iterator(); i.hasNext();)
+			anObject.codes.add(new Integer(i.next().intValue()));
 
 		return anObject;
 	}
@@ -412,16 +423,8 @@
 			result = result &amp;&amp; italic == typedObject.italic;
 			result = result &amp;&amp; bold == typedObject.bold;
 			result = result &amp;&amp; language == typedObject.language;
-
-			if (name != null)
-				result = result &amp;&amp; name.equals(typedObject.name);
-			else
-				result = result &amp;&amp; name == typedObject.name;
-
-			if (codes != null)
-				result = result &amp;&amp; codes.equals(typedObject.codes);
-			else
-				result = result &amp;&amp; codes == typedObject.codes;
+			result = result &amp;&amp; name.equals(typedObject.name);
+			result = result &amp;&amp; codes.equals(typedObject.codes);
 		}
 		return result;
 	}
@@ -473,15 +476,15 @@
 		coder.writeBits(1, 1);
 		coder.writeWord(language, 1);
 
-		for (Iterator codesIterator = codes.iterator(); codesIterator.hasNext();)
-			coder.writeWord(((Integer) codesIterator.next()).intValue(), 2);
+		for (Iterator&lt;Integer&gt; codesIterator = codes.iterator(); codesIterator.hasNext();)
+			coder.writeWord(codesIterator.next().intValue(), 2);
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
 		int nameLength = 0;
 
-		codes = new ArrayList();
+		codes = new ArrayList&lt;Integer&gt;();
 
 		super.decode(coder, context);
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSFrame.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSFrame.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSFrame.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -31,7 +31,6 @@
 package com.flagstone.transform;
 
 import java.util.*;
-import com.flagstone.transform.*;
 
 /**
  * The Frame class is used to provide a higher level view of a movie. Rather
@@ -94,31 +93,35 @@
 	 *            an FSMovie object.
 	 * @return an array of Frame objects.
 	 */
-	public static ArrayList framesFromMovie(FSMovie aMovie)
+	public static ArrayList&lt;FSFrame&gt; framesFromMovie(FSMovie aMovie)
 	{
-		ArrayList frames = new ArrayList();
+		ArrayList&lt;FSFrame&gt; frames = new ArrayList&lt;FSFrame&gt;();
 
 		FSFrame currentFrame = new FSFrame();
+		FSMovieObject currentObject;
 
-		for (Iterator i = aMovie.getObjects().iterator(); i.hasNext();)
+		for (Iterator&lt;FSMovieObject&gt; i = aMovie.getObjects().iterator(); i.hasNext();)
 		{
-			FSMovieObject currentObject = (FSMovieObject) i.next();
+			currentObject = i.next();
 
 			if (currentObject instanceof FSDoAction)
 			{
-				currentFrame.actions = ((FSDoAction) currentObject)
-								.getActions();
-			} else if (currentObject instanceof FSFrameLabel)
+				currentFrame.actions = ((FSDoAction) currentObject).getActions();
+			} 
+			else if (currentObject instanceof FSFrameLabel)
 			{
 				currentFrame.label = ((FSFrameLabel) currentObject).getLabel();
-			} else if (currentObject instanceof FSDefineObject)
+			} 
+			else if (currentObject instanceof FSDefineObject)
 			{
 				currentFrame.addDefinition((FSDefineObject) currentObject);
-			} else if (currentObject instanceof FSShowFrame)
+			} 
+			else if (currentObject instanceof FSShowFrame)
 			{
 				frames.add(currentFrame);
 				currentFrame = new FSFrame();
-			} else
+			} 
+			else
 			{
 				currentFrame.addCommand(currentObject);
 			}
@@ -126,23 +129,20 @@
 		return frames;
 	}
 
-	private String label = null;
+	private String label;
+	private ArrayList&lt;FSDefineObject&gt; definitions;
+	private ArrayList&lt;FSMovieObject&gt; commands;
+	private ArrayList&lt;FSActionObject&gt; actions;
 
-	private ArrayList definitions = null;
-
-	private ArrayList commands = null;
-
-	private ArrayList actions = null;
-
 	/**
 	 * Constructs an empty frame with no label defined and the definitions,
 	 * commands and actions arrays empty.
 	 */
 	public FSFrame()
 	{
-		definitions = new ArrayList();
-		commands = new ArrayList();
-		actions = new ArrayList();
+		definitions = new ArrayList&lt;FSDefineObject&gt;();
+		commands = new ArrayList&lt;FSMovieObject&gt;();
+		actions = new ArrayList&lt;FSActionObject&gt;();
 	}
 
 	/**
@@ -165,9 +165,11 @@
 	 * @param actions
 	 *            an array of action objects that will be executed when the
 	 *            frame is displayed. Maybe null if no actions are defined.
+	 *            
+	 * @throws NullPointerException if any of the arrays are null.
 	 */
-	public FSFrame(String label, ArrayList definitions, ArrayList commands,
-					ArrayList actions)
+	public FSFrame(String label, ArrayList&lt;FSDefineObject&gt; definitions, ArrayList&lt;FSMovieObject&gt; commands,
+					ArrayList&lt;FSActionObject&gt; actions)
 	{
 		setLabel(label);
 		setDefinitions(definitions);
@@ -180,11 +182,17 @@
 	 * 
 	 * @param anObject
 	 *            the action object to be added to the frame.
+	 *            
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void addAction(FSActionObject anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Action cannot be null.&quot;);
+		}
+		
 		if (actions == null)
-			actions = new ArrayList();
+			actions = new ArrayList&lt;FSActionObject&gt;();
 
 		actions.add(anObject);
 	}
@@ -195,11 +203,17 @@
 	 * 
 	 * @param anObject
 	 *            a sub-class of FSDefineObject.
+	 *            
+	 * @throws NullPointerException if the definition is null.
 	 */
 	public void addDefinition(FSDefineObject anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Definition cannot be null.&quot;);
+		}
+		
 		if (definitions == null)
-			definitions = new ArrayList();
+			definitions = new ArrayList&lt;FSDefineObject&gt;();
 
 		definitions.add(anObject);
 	}
@@ -209,9 +223,18 @@
 	 * 
 	 * @param anObject
 	 *            an FSMovieObject the manipulates the display list.
+	 *            
+	 * @throws NullPointerException if the movie object is null.
 	 */
 	public void addCommand(FSMovieObject anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Movie object cannot be null.&quot;);
+		}
+		
+		if (commands == null)
+			commands = new ArrayList&lt;FSMovieObject&gt;();
+
 		commands.add(anObject);
 	}
 
@@ -230,7 +253,7 @@
 	 * 
 	 * @return the array of definitions.
 	 */
-	public ArrayList getDefinitions()
+	public ArrayList&lt;FSDefineObject&gt; getDefinitions()
 	{
 		return definitions;
 	}
@@ -240,7 +263,7 @@
 	 * 
 	 * @return the array of commands objects.
 	 */
-	public ArrayList getCommands()
+	public ArrayList&lt;FSMovieObject&gt; getCommands()
 	{
 		return commands;
 	}
@@ -251,7 +274,7 @@
 	 * 
 	 * @return the array of actions defined for the frame.
 	 */
-	public ArrayList getActions()
+	public ArrayList&lt;FSActionObject&gt; getActions()
 	{
 		return actions;
 	}
@@ -272,9 +295,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of actions.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setDefinitions(ArrayList anArray)
+	public void setDefinitions(ArrayList&lt;FSDefineObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of definition objects cannot be null.&quot;);
+		}
 		definitions = anArray;
 	}
 
@@ -284,9 +312,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of command objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setCommands(ArrayList anArray)
+	public void setCommands(ArrayList&lt;FSMovieObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of movie objects cannot be null.&quot;);
+		}
 		commands = anArray;
 	}
 
@@ -295,9 +328,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of actions.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setActions(ArrayList anArray)
+	public void setActions(ArrayList&lt;FSActionObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of actions cannot be null.&quot;);
+		}
 		actions = anArray;
 	}
 
@@ -310,13 +348,15 @@
 	 * 
 	 * @param aMovie
 	 *            an FSMovie object.
+	 *            
+	 * @throws NullPointerException if the movie is null.
 	 */
 	public void addToMovie(FSMovie aMovie)
 	{
 		if (definitions != null || definitions.size() &gt; 0)
 		{
-			for (Iterator i = definitions.iterator(); i.hasNext();)
-				aMovie.add((FSMovieObject) i.next());
+			for (Iterator&lt;FSDefineObject&gt; i = definitions.iterator(); i.hasNext();)
+				aMovie.add(i.next());
 		}
 
 		if (label != null &amp;&amp; label.length() &gt; 0)
@@ -325,8 +365,8 @@
 		if (actions != null &amp;&amp; actions.size() &gt; 0)
 			aMovie.add(new FSDoAction(actions));
 
-		for (Iterator j = commands.iterator(); j.hasNext();)
-			aMovie.add((FSMovieObject) j.next());
+		for (Iterator&lt;FSMovieObject&gt; j = commands.iterator(); j.hasNext();)
+			aMovie.add(j.next());
 
 		aMovie.add(new FSShowFrame());
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSFrameLabel.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSFrameLabel.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSFrameLabel.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -30,9 +30,6 @@
 
 package com.flagstone.transform;
 
-import java.util.ArrayList;
-import java.util.Iterator;
-
 /**
  * FSFrameLabel defines a name for the current frame in a movie or movie clip.
  * 
@@ -192,20 +189,16 @@
  */
 public class FSFrameLabel extends FSMovieObject
 {
-	private String label = null;
+	private String label;
+	private boolean anchor;
 
-	// Flash 6
-	private boolean anchor = false;
-
-	// End Flash 6
-
 	FSFrameLabel()
 	{
 		super(FrameLabel);
 	}
 
 	/**
-	 * Construct an FSFrameLabel object, initalizing it with values decoded from
+	 * Construct an FSFrameLabel object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -223,6 +216,8 @@
 	 * @param aString
 	 *            the string that defines the label that will be assigned to the
 	 *            current frame.
+	 *           
+	 * @throws NullPointerException if the label string is null.
 	 */
 	public FSFrameLabel(String aString)
 	{
@@ -230,7 +225,6 @@
 		setLabel(aString);
 	}
 
-	// Flash 6
 	/**
 	 * Constructs an FSFrameLabel object with the specified name. If the
 	 * isAnchor flag is true then the frame will be directly selectable by a URL
@@ -242,6 +236,8 @@
 	 * @param isAnchor
 	 *            if true the name will be used as an anchor when referencing
 	 *            the frame in a URL.
+	 *           
+	 * @throws NullPointerException if the label string is null.
 	 */
 	public FSFrameLabel(String aString, boolean isAnchor)
 	{
@@ -250,7 +246,6 @@
 		setAnchor(isAnchor);
 	}
 
-	// End Flash 6
 	/**
 	 * Constructs an FSFrameLabel object by copying values from an existing
 	 * object.
@@ -281,9 +276,14 @@
 	 * @param aString
 	 *            the string that defines the label that will be assigned to the
 	 *            current frame.
+	 *                        
+	 * @throws NullPointerException if the label string is null.
 	 */
 	public void setLabel(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Label string cannot be null.&quot;);
+		}
 		label = aString;
 	}
 
@@ -298,9 +298,14 @@
 	 * @param isAnchor
 	 *            if true the name will be used as an anchor when referencing
 	 *            the frame in a URL.
+	 *                        
+	 * @throws NullPointerException if the label string is null.
 	 */
 	public void setLabel(String aString, boolean isAnchor)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Label string cannot be null.&quot;);
+		}
 		label = aString;
 		anchor = isAnchor;
 	}
@@ -338,14 +343,8 @@
 		{
 			FSFrameLabel typedObject = (FSFrameLabel) anObject;
 
-			if (label != null)
-				result = label.equals(typedObject.label);
-			else
-				result = typedObject.label == null;
-
-			// Flash 6
+			result = label.equals(typedObject.label);
 			result = result &amp;&amp; anchor == typedObject.anchor;
-			// Flash 7
 		}
 		return result;
 	}
@@ -356,9 +355,7 @@
 
 		buffer.append(&quot;FSFrameLabel: { &quot;);
 		buffer.append(&quot;label = &quot;).append(label).append(&quot;; &quot;);
-		// Flash 6
-		buffer.append(&quot;anchor = &quot;).append(anchor).append(&quot;; &quot;);
-		// End Flash 6
+		buffer.append(&quot;anchor = &quot;).append(anchor).append(&quot;; &quot;); // flash 6
 		buffer.append(&quot;}&quot;);
 
 		return buffer.toString();
@@ -369,11 +366,8 @@
 		super.length(context);
 
 		length += FSCoder.strlen(label, true);
+		length += anchor ? 1 : 0; // flash 6
 
-		// Flash 6
-		length += anchor ? 1 : 0;
-		// End Flash 6
-
 		return length;
 	}
 
@@ -383,10 +377,8 @@
 		coder.writeString(label);
 		coder.writeWord(0, 1);
 
-		// Flash 6
 		if (anchor)
 			coder.writeWord(1, 1);
-		// End Flash 6
 	}
 
 	public void decode(FSCoder coder, FSContext context)

Modified: dev/dev-2-4/src/com/flagstone/transform/FSFree.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSFree.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSFree.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -83,6 +83,8 @@
 	 * 
 	 * @param anIdentifier
 	 *            the identifier of the object to be deleted.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public FSFree(int anIdentifier)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSGetUrl.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSGetUrl.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSGetUrl.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -166,17 +166,16 @@
  */
 public class FSGetUrl extends FSActionObject
 {
-	private String url = null;
+	private String url;
+	private String target;
 
-	private String target = &quot;&quot;;
-
 	FSGetUrl()
 	{
 		super(FSActionObject.GetUrl);
 	}
 
 	/**
-	 * Construct an FSGetUrl object, initalizing it with values decoded from an
+	 * Construct an FSGetUrl object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -196,10 +195,13 @@
 	 * @param targetString
 	 *            the location (in the Flash Player or web browser) where the
 	 *            contents of file retrieved via the url will be displayed.
+	 *            
+	 * @throws NullPointerException if the url or target are null.
+	 * @throws IllegalArgumentException if the url is an empty string.
 	 */
 	public FSGetUrl(String urlString, String targetString)
 	{
-		super(FSActionObject.GetUrl);
+		super(GetUrl);
 		setUrl(urlString);
 		setTarget(targetString);
 	}
@@ -210,11 +212,15 @@
 	 * 
 	 * @param urlString
 	 *            a fully qualified URL.
+	 *            
+	 * @throws NullPointerException if the url is null.
+	 * @throws IllegalArgumentException if the url is an empty string.
 	 */
 	public FSGetUrl(String urlString)
 	{
-		super(FSActionObject.GetUrl);
+		super(GetUrl);
 		setUrl(urlString);
+		target = &quot;&quot;;
 	}
 
 	/**
@@ -225,7 +231,7 @@
 	 */
 	public FSGetUrl(FSGetUrl obj)
 	{
-		super(obj);
+		super(GetUrl);
 		url = new String(obj.url);
 		target = new String(obj.target);
 	}
@@ -256,9 +262,18 @@
 	 * 
 	 * @param aString
 	 *            a fully qualified URL.
+	 *            
+	 * @throws NullPointerException if the url is null.
+	 * @throws IllegalArgumentException if the url is an empty string.
 	 */
 	public void setUrl(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;URL cannot be null.&quot;);
+		}
+		if (aString.length() == 0) {
+			throw new IllegalArgumentException(&quot;URL cannot be an empty string.&quot;);
+		}
 		url = aString;
 	}
 
@@ -271,9 +286,14 @@
 	 *            the name of the location (in the Flash Player or web browser)
 	 *            where contents of file retrieved via the url will be
 	 *            displayed.
+	 *            
+	 * @throws NullPointerException if the target is null.
 	 */
 	public void setTarget(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Target cannot be null.&quot;);
+		}
 		target = aString;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSGetUrl2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSGetUrl2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSGetUrl2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -279,10 +279,10 @@
 	/** Load variables submitting the movie variables using HTTP POST. */
 	public static final int VariablesToTargetWithPost = 194;
 
-	private int requestType = MovieToLevel;
+	private int requestType;
 
 	/**
-	 * Construct an FSGetUrl2 object, initalizing it with values decoded from an
+	 * Construct an FSGetUrl2 object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -315,7 +315,7 @@
 	 */
 	public FSGetUrl2(FSGetUrl2 obj)
 	{
-		super(obj);
+		super(GetUrl2);
 		requestType = obj.requestType;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSGotoFrame.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSGotoFrame.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSGotoFrame.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -100,10 +100,10 @@
  */
 public class FSGotoFrame extends FSActionObject
 {
-	private int frameNumber = 1;
+	private int frameNumber;
 
 	/**
-	 * Construct an FSGotoFrame object, initalizing it with values decoded from
+	 * Construct an FSGotoFrame object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -121,6 +121,8 @@
 	 * 
 	 * @param aNumber
 	 *            the number of the frame.
+	 *            
+	 * @throws IllegalArgumentException if the frame number is not in the range 1..65535.
 	 */
 	public FSGotoFrame(int aNumber)
 	{
@@ -137,7 +139,7 @@
 	 */
 	public FSGotoFrame(FSGotoFrame obj)
 	{
-		super(obj);
+		super(GotoFrame);
 		frameNumber = obj.frameNumber;
 	}
 
@@ -157,9 +159,14 @@
 	 * 
 	 * @param aNumber
 	 *            the frame number.
+	 *            
+	 * @throws IllegalArgumentException if the frame number is not in the range 1..65535.
 	 */
 	public void setFrameNumber(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Frame number must be in the range 1..65535.&quot;);
+		}
 		frameNumber = aNumber;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSGotoFrame2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSGotoFrame2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSGotoFrame2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -164,12 +164,11 @@
  */
 public class FSGotoFrame2 extends FSActionObject
 {
-	private boolean playFrame = false;
+	private boolean playFrame;
+	private int frameOffset;
 
-	private int frameOffset = 0;
-
 	/**
-	 * Construct an FSGotoFrame2 object, initalizing it with values decoded from
+	 * Construct an FSGotoFrame2 object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -193,6 +192,7 @@
 	{
 		super(GotoFrame2);
 		setPlayFrame(aBool);
+		frameOffset = 0;
 	}
 
 	// Flash 5
@@ -207,6 +207,8 @@
 	 *            true if the player should being playing the movie at the
 	 *            specified frame, false if the player should stop playing the
 	 *            movie.
+	 *            
+	 * @throws IllegalArgumentException if the frame offset is not in the range 1..65535.
 	 */
 	public FSGotoFrame2(int offset, boolean aBool)
 	{
@@ -225,7 +227,7 @@
 	 */
 	public FSGotoFrame2(FSGotoFrame2 obj)
 	{
-		super(obj);
+		super(GotoFrame2);
 		playFrame = obj.playFrame;
 		frameOffset = obj.frameOffset;
 	}
@@ -253,6 +255,9 @@
 	 */
 	public void setFrameOffset(int offset)
 	{
+		if (offset &lt; 0 || offset &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Frame offset must be in the range 1..65535.&quot;);
+		}
 		frameOffset = offset;
 	}
 
@@ -333,6 +338,7 @@
 		// End Flash 5
 	}
 
+	// TODO should frame offset be negative
 	public void decode(FSCoder coder, FSContext context)
 	{
 		boolean containsOffset = false;

Modified: dev/dev-2-4/src/com/flagstone/transform/FSGotoLabel.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSGotoLabel.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSGotoLabel.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -95,7 +95,7 @@
  */
 public class FSGotoLabel extends FSActionObject
 {
-	private String label = null;
+	private String label;
 
 	FSGotoLabel()
 	{
@@ -103,7 +103,7 @@
 	}
 
 	/**
-	 * Construct an FSGotoLabel object, initalizing it with values decoded from
+	 * Construct an FSGotoLabel object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -120,6 +120,8 @@
 	 * 
 	 * @param aString
 	 *            the label assigned a particular frame in the movie.
+	 * 
+	 * @throws NullPointerException if the label is null.
 	 */
 	public FSGotoLabel(String aString)
 	{
@@ -136,7 +138,7 @@
 	 */
 	public FSGotoLabel(FSGotoLabel obj)
 	{
-		super(obj);
+		super(GotoLabel);
 		label = new String(obj.label);
 	}
 
@@ -155,9 +157,14 @@
 	 * 
 	 * @param aString
 	 *            the label assigned a particular frame in the movie.
+	 * 
+	 * @throws NullPointerException if the label is null.
 	 */
 	public void setLabel(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Label cannot be null.&quot;);
+		}
 		label = aString;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSGradient.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSGradient.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSGradient.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -88,7 +88,7 @@
 	private FSColor color;
 
 	/**
-	 * Construct an FSGradient object, initalizing it with values decoded from
+	 * Construct an FSGradient object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -106,6 +106,9 @@
 	 *            the ratio along the gradient square.
 	 * @param aColor
 	 *            the color at the control point.
+	 *            
+	 * @throws IllegalArgumentException if the argument is not in the range 0..255.
+	 * @throws NullPointerException if the colour object is null.
 	 */
 	public FSGradient(int aRatio, FSColor aColor)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSGradientFill.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSGradientFill.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSGradientFill.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -206,6 +206,9 @@
 	 * @param anArray
 	 *            an array of up to eight FSGradient objects defining the
 	 *            control points for the gradient.
+	 *            
+	 * @throws NullPointerException if the transform is null.
+	 * @throws NullPointerException if the array of gradient points is null.
 	 */
 	public FSGradientFill(int aType, FSCoordTransform aTransform, ArrayList&lt;FSGradient&gt; anArray)
 	{
@@ -272,7 +275,7 @@
 	 * @param aTransform
 	 *            the coordinate transform.
 	 * 
-	 * @throws NullPointerException if the argument is null.
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public void setTransform(FSCoordTransform aTransform)
 	{
@@ -288,7 +291,7 @@
 	 * @param anArray
 	 *            an array of up to eight FSGradient objects.
 	 * 
-	 * @throws NullPointerException if the argument is null.
+	 * @throws NullPointerException if the array is null.
 	 */
 	public void setGradients(ArrayList&lt;FSGradient&gt; anArray)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSHeader.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSHeader.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSHeader.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -49,15 +49,15 @@
  */
 public final class FSHeader
 {
-	private String signature = null;
-	private int version = 0;
-	private int minX = 0;
-	private int minY = 0;
-	private int maxX = 0;
-	private int maxY = 0;
-	private int length = 0;
-	private float frameRate = 0.0f;
-	private int frameCount = 0;
+	private String signature;
+	private int version ;
+	private int minX;
+	private int minY;
+	private int maxX;
+	private int maxY;
+	private int length;
+	private float frameRate;
+	private int frameCount;
 
 	/**
 	 * Create a new FSHeader object and initialise it with the information
@@ -66,6 +66,9 @@
 	 * @param filename
 	 *            the path to a file.
 	 * 
+	 * @throws NullPointerException
+	 *             if the path is null.
+
 	 * @throws FileNotFoundException
 	 *             if the file referenced by the path does not exist or refers
 	 *             to a directory.
@@ -89,9 +92,11 @@
 	 * @param file
 	 *            a File containing the abstract path to a file.
 	 * 
+	 * @throws NullPointerException
+	 *             if the file is null.
+
 	 * @throws FileNotFoundException
-	 *             if the file referenced by the path does not exist or refers
-	 *             to a directory.
+	 *             if the file does not exist or refers to a directory.
 	 * 
 	 * @throws IOException
 	 *             if there is an error reading the file.
@@ -220,6 +225,9 @@
 	 * @param fileName
 	 *            the path to a file.
 	 * 
+	 * @throws NullPointerException
+	 *             if the path is null.
+
 	 * @throws FileNotFoundException
 	 *             if the file referenced by the path does not exist or refers
 	 *             to a directory.
@@ -242,6 +250,9 @@
 	 * @param file
 	 *            a File containing the abstract path to a file.
 	 * 
+	 * @throws NullPointerException
+	 *             if the file is null.
+
 	 * @throws FileNotFoundException
 	 *             if the file referenced by the path does not exist or refers
 	 *             to a directory.

Modified: dev/dev-2-4/src/com/flagstone/transform/FSIf.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSIf.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSIf.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -123,6 +123,8 @@
 	 * @param anOffset
 	 *            the number of bytes to add to the instruction pointer if the
 	 *            value popped off the stack evaluates to true.
+	 *            
+	 * @throws IllegalArgumentException if the offset is not in the range -32768..32767.
 	 */
 	public FSIf(int anOffset)
 	{
@@ -138,7 +140,7 @@
 	 */
 	public FSIf(FSIf obj)
 	{
-		super(obj);
+		super(If);
 		offset = obj.offset;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSImageBlock.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSImageBlock.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSImageBlock.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -123,8 +123,9 @@
 				byte[] a = unzip(block);
 				byte[] b = unzip(typedObject.block);
 
-				result = result &amp;&amp; Transform.equals(a, b);
-			} catch (DataFormatException e)
+				result = result &amp;&amp; FSMovieObject.equals(a, b);
+			} 
+			catch (DataFormatException e)
 			{
 				result = false;
 			}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSImport.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSImport.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSImport.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -109,17 +109,16 @@
  */
 public class FSImport extends FSMovieObject
 {
-	private String url = null;
+	private String url;
+	private Hashtable&lt;Integer,String&gt; objects;
 
-	private Hashtable objects = new Hashtable();
-
 	FSImport()
 	{
 		super(Import);
 	}
 
 	/**
-	 * Construct an FSImport object, initalizing it with values decoded from an
+	 * Construct an FSImport object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -145,6 +144,10 @@
 	 *            the identifier of the object to be exported.
 	 * @param aString
 	 *            the name of the exported object to allow it to be referenced.
+	 *            
+	 * @throws NullPointerException if the url or name are null.
+	 * @throws IllegalArgumentException if the url or name is an empty string.
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535. 
 	 */
 	public FSImport(String aUrl, int anIdentifier, String aString)
 	{
@@ -164,11 +167,12 @@
 		super(obj);
 		url = new String(obj.url);
 
-		objects = new Hashtable(obj.objects.size());
+		objects = new Hashtable&lt;Integer,String&gt;(obj.objects.size());
+		Integer key;
 
-		for (Iterator i = obj.objects.keySet().iterator(); i.hasNext();)
+		for (Iterator&lt;Integer&gt; i = obj.objects.keySet().iterator(); i.hasNext();)
 		{
-			Object key = i.next();
+			key = i.next();
 			objects.put(key, new String((String) objects.get(key)));
 		}
 	}
@@ -180,9 +184,26 @@
 	 *            the identifier of the object to be imported.
 	 * @param aString
 	 *            the name of the imported object to allow it to be referenced.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535. 
+	 * @throws NullPointerException if the name is null.
+	 * @throws IllegalArgumentException if the name is an empty string.
 	 */
 	public void add(int anIdentifier, String aString)
 	{
+		if (anIdentifier &lt; 0 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535&quot;);
+		}
+		if (aString == null) {
+			throw new NullPointerException(&quot;Name cannot be null.&quot;);
+		}
+		if (aString.length() == 0) {
+			throw new IllegalArgumentException(&quot;Name cannot be an empty string.&quot;);
+		}
+		
+		if (objects == null) {
+			 objects = new Hashtable&lt;Integer,String&gt;();
+		}
 		objects.put(new Integer(anIdentifier), aString);
 	}
 
@@ -203,7 +224,7 @@
 	 * 
 	 * @return the table of imported objects.
 	 */
-	public Hashtable getObjects()
+	public Hashtable&lt;Integer,String&gt; getObjects()
 	{
 		return objects;
 	}
@@ -216,9 +237,18 @@
 	 * @param aString
 	 *            a URL relative to the URL of the file containing the FSImport
 	 *            object.
+	 *
+	 * @throws NullPointerException if the url is null.
+	 * @throws IllegalArgumentException if the url is an empty string.
 	 */
 	public void setUrl(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Name cannot be null.&quot;);
+		}
+		if (aString.length() == 0) {
+			throw new IllegalArgumentException(&quot;Name cannot be an empty string.&quot;);
+		}
 		url = aString;
 	}
 
@@ -227,8 +257,10 @@
 	 * 
 	 * @param aTable
 	 *            the table of objects being imported.
+	 *            
+	 * @throws NullPointerException if the table is null.
 	 */
-	public void setObjects(Hashtable aTable)
+	public void setObjects(Hashtable&lt;Integer,String&gt; aTable)
 	{
 		objects = aTable;
 	}
@@ -239,14 +271,8 @@
 
 		if (super.equals(anObject))
 		{
-			if (url != null)
-				result = url.equals(((FSImport) anObject).getUrl());
-			else
-				result = ((FSImport) anObject).getUrl() == null;
-
-			result = result
-							&amp;&amp; objects.equals(((FSImport) anObject)
-											.getObjects());
+			result = url.equals(((FSImport) anObject).getUrl());
+			result = result &amp;&amp; objects.equals(((FSImport) anObject).getObjects());
 		}
 		return result;
 	}
@@ -270,7 +296,7 @@
 		length += FSCoder.strlen(url, true);
 		length += 2;
 
-		for (Enumeration e = objects.keys(); e.hasMoreElements();)
+		for (Enumeration&lt;Integer&gt; e = objects.keys(); e.hasMoreElements();)
 		{
 			String name = (String) (objects.get(e.nextElement()));
 
@@ -290,9 +316,9 @@
 
 		coder.writeWord(objects.size(), 2);
 
-		for (Enumeration e = objects.keys(); e.hasMoreElements();)
+		for (Enumeration&lt;Integer&gt; e = objects.keys(); e.hasMoreElements();)
 		{
-			Integer identifier = (Integer) (e.nextElement());
+			Integer identifier = e.nextElement();
 			String name = (String) (objects.get(identifier));
 
 			coder.writeWord(identifier.intValue(), 2);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSInitialize.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSInitialize.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSInitialize.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -102,14 +102,12 @@
  */
 public class FSInitialize extends FSMovieObject
 {
-	private int identifier = 0;
+	private int identifier;
+	private ArrayList&lt;FSActionObject&gt; actions;
+	private byte[] encodedActions;
 
-	private ArrayList actions = null;
-
-	private byte[] encodedActions = null;
-
 	/**
-	 * Construct an FSInitialize object, initalizing it with values decoded from
+	 * Construct an FSInitialize object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -129,8 +127,11 @@
 	 *            the identifier of the movie clip to initialize
 	 * @param anArray
 	 *            the array of action objects.
+     *
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the array is null.
 	 */
-	public FSInitialize(int anIdentifier, ArrayList anArray)
+	public FSInitialize(int anIdentifier, ArrayList&lt;FSActionObject&gt; anArray)
 	{
 		super(Initialize);
 		setIdentifier(anIdentifier);
@@ -145,6 +146,9 @@
 	 *            the identifier of the movie clip to initialize
 	 * @param bytes
 	 *            an array of encoded action objects.
+     *
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if the array is null.
 	 */
 	public FSInitialize(int anIdentifier, byte[] bytes)
 	{
@@ -168,13 +172,13 @@
 
 		if (obj.actions != null)
 		{
-			actions = new ArrayList(obj.actions.size());
+			actions = new ArrayList&lt;FSActionObject&gt;(obj.actions.size());
 
-			for (Iterator i = obj.actions.iterator(); i.hasNext();)
-				actions.add(((FSActionObject) i.next()).clone());
+			for (Iterator&lt;FSActionObject&gt; i = obj.actions.iterator(); i.hasNext();)
+				actions.add((FSActionObject) i.next().clone());
 		} else
 		{
-			encodedActions = Transform.clone(obj.encodedActions);
+			encodedActions = FSMovieObject.copy(obj.encodedActions);
 		}
 	}
 
@@ -194,9 +198,14 @@
 	 * @param aNumber
 	 *            the identifier of the movie clip. The value must be in the
 	 *            range 1..65535.
+     *
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int aNumber)
 	{
+		if (aNumber &lt; 1 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = aNumber;
 	}
 
@@ -205,9 +214,14 @@
 	 * 
 	 * @param anAction
 	 *            an object belonging to a class derived from FSActionObject.
+	 *            
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void add(FSActionObject anAction)
 	{
+		if (anAction == null) {
+			throw new NullPointerException(&quot;Action cannot be null.&quot;);
+		}
 		if (encodedActions != null)
 		{
 			actions = FSActionObject.decodeActions(encodedActions);
@@ -221,7 +235,7 @@
 	 * 
 	 * @return the array of action objects.
 	 */
-	public ArrayList getActions()
+	public ArrayList&lt;FSActionObject&gt; getActions()
 	{
 		if (encodedActions != null)
 		{
@@ -236,9 +250,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of action objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setActions(ArrayList anArray)
+	public void setActions(ArrayList&lt;FSActionObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of actions cannot be null.&quot;);
+		}
 		actions = anArray;
 		encodedActions = null;
 	}
@@ -262,9 +281,14 @@
 	 * 
 	 * @param bytes
 	 *            the array of encoded actions.
+	 *            
+	 * @throws NullPointerException if the encoded actions are null.
 	 */
 	public void setEncodedActions(byte[] bytes)
 	{
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Encoded actions cannot be null.&quot;);
+		}
 		encodedActions = bytes;
 		actions = null;
 	}
@@ -275,13 +299,13 @@
 
 		if (actions != null)
 		{
-			anObject.actions = new ArrayList();
+			anObject.actions = new ArrayList&lt;FSActionObject&gt;();
 
-			for (Iterator i = actions.iterator(); i.hasNext();)
-				anObject.actions.add(((FSActionObject) i.next()).clone());
+			for (Iterator&lt;FSActionObject&gt; i = actions.iterator(); i.hasNext();)
+				anObject.actions.add((FSActionObject) i.next().clone());
 		} else
 		{
-			anObject.encodedActions = Transform.clone(encodedActions);
+			anObject.encodedActions = FSMovieObject.copy(encodedActions);
 		}
 		return anObject;
 	}
@@ -299,9 +323,7 @@
 			if (actions != null)
 				result = result &amp;&amp; actions.equals(typedObject.actions);
 			else
-				result = result
-								&amp;&amp; Transform.equals(encodedActions,
-												typedObject.encodedActions);
+				result = result &amp;&amp; equals(encodedActions, typedObject.encodedActions);
 		}
 		return result;
 	}
@@ -331,22 +353,9 @@
 
 		if (actions != null)
 		{
-			FSActionObject currentAction = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				currentAction = (FSActionObject) i.next();
-
-				length += currentAction.length(context);
-				length += (currentAction.getType() &gt; 128) ? 3 : 1;
-			}
-
-			if ((actions.size() == 0)
-							|| (currentAction.getType() != FSAction.End))
-			{
-				length += 1;
-			}
-		} else
+			length += FSActionObject.length(context, actions);
+		} 
+		else
 		{
 			length += encodedActions.length;
 
@@ -367,38 +376,9 @@
 
 		if (actions != null)
 		{
-			FSActionObject action = null;
-
-			for (Iterator i = actions.iterator(); i.hasNext();)
-			{
-				action = (FSActionObject) i.next();
-
-				int objStart = coder.getPointer();
-				int length = action.getLength();
-				int start = coder.getPointer()
-								+ ((action.getType() &gt; 128) ? 24 : 8);
-				int next = start + (length &lt;&lt; 3);
-
-				action.encode(coder, context);
-				coder.setPointer(next);
-
-				int delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-				if (delta != 0)
-				{
-					context.codingError = true;
-					context.typeInError = action.getType();
-					context.startOfError = objStart &gt;&gt;&gt; 3;
-					context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
-					context.delta = delta;
-				}
-			}
-
-			if ((actions.size() == 0) || (action.getType() != FSAction.End))
-			{
-				coder.writeWord(0, 1);
-			}
-		} else
+			FSActionObject.encode(coder, context, actions);
+		} 
+		else
 		{
 			coder.writeBytes(encodedActions);
 
@@ -418,19 +398,9 @@
 
 		if (context.decodeActions)
 		{
-			actions = new ArrayList();
-
-			int len = length - 2;
-			int start;
-
-			while (len &gt; 0)
-			{
-				start = coder.getPointer();
-
-				actions.add(FSActionObject.decodeAction(coder, context));
-				len -= (coder.getPointer() - start) &gt;&gt;&gt; 3;
-			}
-		} else
+			actions = FSActionObject.decodeActions(coder, context, length);
+		} 
+		else
 		{
 			encodedActions = new byte[length - 2];
 			coder.readBytes(encodedActions);

Modified: dev/dev-2-4/src/com/flagstone/transform/FSJPEGEncodingTable.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSJPEGEncodingTable.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSJPEGEncodingTable.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -153,7 +153,7 @@
 		super(obj);
 
 		if (obj.encodingTable != null)
-			encodingTable = Transform.clone(obj.encodingTable);
+			encodingTable = FSMovieObject.copy(obj.encodingTable);
 	}
 
 	/**

Modified: dev/dev-2-4/src/com/flagstone/transform/FSJump.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSJump.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSJump.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -107,6 +107,8 @@
 	 * 
 	 * @param anOffset
 	 *            the number of bytes to add to the instruction pointer.
+	 *            
+	 * @throws IllegalArgumentException if the offset is not in the range -32768..32767.
 	 */
 	public FSJump(int anOffset)
 	{
@@ -122,7 +124,7 @@
 	 */
 	public FSJump(FSJump obj)
 	{
-		super(obj);
+		super(Jump);
 		offset = obj.offset;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSKerning.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSKerning.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSKerning.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -81,9 +81,9 @@
  */
 public class FSKerning implements Cloneable, Codeable
 {
-	private int leftIndex = 0;
-	private int rightIndex = 0;
-	private int adjustment = 0;
+	private int leftIndex;
+	private int rightIndex;
+	private int adjustment;
 
 	/**
 	 * Construct an FSKerning object, initialising it with values decoded from an

Modified: dev/dev-2-4/src/com/flagstone/transform/FSLayer.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSLayer.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSLayer.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -346,7 +346,7 @@
 	{
 		if (place == null)
 		{
-			place = new FSPlaceObject2(layer, new FSColorTransform(r, g, b, a));
+			place = new FSPlaceObject2(layer, null, new FSColorTransform(r, g, b, a));
 			displayList.add(place);
 		} else
 		{
@@ -365,7 +365,7 @@
 	{
 		if (place == null)
 		{
-			place = new FSPlaceObject2(layer, (FSCoordTransform) null);
+			place = new FSPlaceObject2(layer, null, null);
 			place.setClippingDepth(depth);
 			displayList.add(place);
 		} else
@@ -386,7 +386,8 @@
 	{
 		if (place == null)
 		{
-			place = new FSPlaceObject2(layer, ratio, null);
+			place = new FSPlaceObject2(layer, null, null);
+			place.setRatio(ratio);
 			displayList.add(place);
 		} else
 		{
@@ -404,7 +405,7 @@
 	{
 		if (place == null)
 		{
-			place = new FSPlaceObject2(layer, (FSCoordTransform) null);
+			place = new FSPlaceObject2(layer, null, null);
 			place.setName(name);
 			displayList.add(place);
 		} else
@@ -435,7 +436,8 @@
 
 		if (place == null)
 		{
-			place = new FSPlaceObject2(id, layer);
+			place = new FSPlaceObject2(id, layer, null, null);
+			place.setPlaceType(FSPlaceObject2.Replace);
 			displayList.add(place);
 		} else
 		{
@@ -454,7 +456,7 @@
 	{
 		if (place == null)
 		{
-			place = new FSPlaceObject2(layer, color);
+			place = new FSPlaceObject2(layer, null, color);
 			displayList.add(place);
 		} else
 		{
@@ -477,7 +479,7 @@
 	{
 		if (place == null)
 		{
-			place = new FSPlaceObject2(layer, coord);
+			place = new FSPlaceObject2(layer, coord, null);
 			displayList.add(place);
 		} else
 		{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSLimitScript.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSLimitScript.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSLimitScript.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -76,12 +76,11 @@
  */
 public class FSLimitScript extends FSMovieObject
 {
-	private int depth = 0;
+	private int depth;
+	private int timeout;
 
-	private int timeout = 0;
-
 	/**
-	 * Construct an FSLimitScript object, initalizing it with values decoded
+	 * Construct an FSLimitScript object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -104,6 +103,9 @@
 	 *            the time in seconds that a sequence of actions is allowed to
 	 *            execute before the Flash Player displays a dialog box asking
 	 *            whether the script should be terminated.
+	 *            
+	 * @throws IllegalArgumentException if the depth is not in the range 0..65535.
+	 * @throws IllegalArgumentException if the timeout is not in the range 0..65535.
 	 */
 	public FSLimitScript(int depth, int timeout)
 	{
@@ -141,9 +143,14 @@
 	 * 
 	 * @param depth
 	 *            the maximum depth a sequence of actions can recurse to.
+     *
+	 * @throws IllegalArgumentException if the depth is not in the range 0..65535.
 	 */
 	public void setDepth(int depth)
 	{
+		if (depth &lt; 0 || depth &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Stack depth must be in the range 0..65535&quot;);
+		}
 		this.depth = depth;
 	}
 
@@ -168,9 +175,14 @@
 	 * @param time
 	 *            the time in seconds that a sequence of actions is allowed to
 	 *            execute.
+	 *            
+	 * @throws IllegalArgumentException if the timeout is not in the range 0..65535.            
 	 */
 	public void setTimeout(int time)
 	{
+		if (time &lt; 0 || time &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Timeout must be in the range 0..65535&quot;);
+		}
 		timeout = time;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSLine.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSLine.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSLine.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -104,6 +104,9 @@
 	 * @param yValue
 	 *            the y-coordinate of the end point, specified relative to the
 	 *            current drawing point.
+	 *            
+	 * @throws IllegalArgumentException if the x coordinate is not in the range -65535..65535.
+	 * @throws IllegalArgumentException if the y coordinate is not in the range -65535..65535.
 	 */
 	public FSLine(int xValue, int yValue)
 	{
@@ -283,14 +286,18 @@
 		{
 			x = coder.readBits(size, true);
 			y = coder.readBits(size, true);
-		} else
+		} 
+		else
 		{
 			if (coder.readBits(1, false) != 0)
 			{
+				x = 0;
 				y = coder.readBits(size, true);
-			} else
+			} 
+			else
 			{
 				x = coder.readBits(size, true);
+				y = 0;
 			}
 		}
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSLineStyle.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSLineStyle.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSLineStyle.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -143,6 +143,9 @@
 	 *            the width of the line.
 	 * @param aColor
 	 *            the colour of the line.
+	 * 
+	 * @throws IllegalArgumentException if the argument is not in the range 0..65535.
+	 * @throws NullPointerException if the argument is null,
 	 */
 	public FSLineStyle(int aWidth, FSColor aColor)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSMorphBitmapFill.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSMorphBitmapFill.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSMorphBitmapFill.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -141,6 +141,9 @@
 	 * @param end
 	 *            the transform applied to the image at the end of the morphing
 	 *            process.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws NullPointerException if either of the transforms are null.
 	 */
 	public FSMorphBitmapFill(int aType, int anIdentifier, FSCoordTransform start, FSCoordTransform end)
 	{
@@ -201,7 +204,7 @@
 	 * @param anIdentifier
 	 *            the identifier of the bitmap image.
 	 *            
-	 * @throws IllegalArgumentException if the argument is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
@@ -218,7 +221,7 @@
 	 * @param aTransform
 	 *            the starting coordinate transform.
 	 *          
-	 * @throws NullPointerException if the argument is null.
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public void setStartTransform(FSCoordTransform aTransform)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSMorphGradient.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSMorphGradient.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSMorphGradient.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -132,6 +132,9 @@
 	 *            the colour at the starting control point.
 	 * @param endColor
 	 *            the colour at the ending control point.
+	 *            
+	 * @throws IllegalArgumentException if either of the ratios are not in the range 0..255.
+	 * @throws NullPointerException if either of the colour objects are null.
 	 */
 	public FSMorphGradient(int startRatio, int endRatio, FSColor startColor, FSColor endColor)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSMorphGradientFill.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSMorphGradientFill.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSMorphGradientFill.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -226,6 +226,9 @@
 	 * @param gradients
 	 *            an array of up to eight FSMorphGradient objects defining the
 	 *            control points for the gradient.
+	 *            
+	 * @throws NullPointerException if either of the transforms are null.
+	 * @throws NullPointerException if the array is null.
 	 */
 	public FSMorphGradientFill(int aType, FSCoordTransform start, FSCoordTransform end, ArrayList&lt;FSMorphGradient&gt; gradients)
 	{
@@ -260,9 +263,14 @@
 	 * 
 	 * @param aGradient
 	 *            an FSMorphGradient object.
+	 *            
+	 * @throws NullPointerException if the gradient is null
 	 */
 	public void add(FSMorphGradient aGradient)
 	{
+		if (aGradient == null) {
+			throw new NullPointerException(&quot;Gradient cannot be null.&quot;);
+		}
 		gradients.add(aGradient);
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSMorphLineStyle.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSMorphLineStyle.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSMorphLineStyle.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -113,6 +113,9 @@
 	 *            the colour of the line at the start of the morphing process.
 	 * @param anEndColor
 	 *            the colour of the line at the end of the morphing process.
+	 *            
+	 * @throws IllegalArgumentException if the widths are not in the range 0..65535.
+	 * @throws NullPointerException if either of the colour objects are null.
 	 */
 	public FSMorphLineStyle(int aStartWidth, int anEndWidth,
 							FSColor aStartColor, FSColor anEndColor)
@@ -216,10 +219,13 @@
 	 * @param aColor
 	 *            the starting colour of the line.
 	 * 
-	 * @throws NullPointerException if the argument is null,
+	 * @throws NullPointerException if the colour is null,
 	 */
 	public void setStartColor(FSColor aColor)
 	{
+		if (aColor == null) {
+			throw new NullPointerException(&quot;Colour cannot be null.&quot;);
+		}
 		startColor = aColor;
 	}
 
@@ -229,10 +235,13 @@
 	 * @param aColor
 	 *            the ending colour of the line.
 	 * 
-	 * @throws NullPointerException if the argument is null,
+	 * @throws NullPointerException if the colour is null,
 	 */
 	public void setEndColor(FSColor aColor)
 	{
+		if (aColor == null) {
+			throw new NullPointerException(&quot;Colour cannot be null.&quot;);
+		}
 		endColor = aColor;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSMorphSolidFill.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSMorphSolidFill.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSMorphSolidFill.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -90,7 +90,7 @@
 	private FSColor end = null;
 
 	/**
-	 * Construct an FSMorphSolidFill object, initalizing it with values decoded
+	 * Construct an FSMorphSolidFill object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -110,6 +110,8 @@
 	 *            the colour at the start of the morphing process.
 	 * @param end
 	 *            the colour at the end of the morphing process.
+	 *            
+	 * @throws NullPointerException if either of the colour objects are null.
 	 */
 	public FSMorphSolidFill(FSColor start, FSColor end)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSMovie.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSMovie.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSMovie.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -344,31 +344,70 @@
 		this.encoding = encoding;
 	}
 
+	/**
+	 * Instructs the movie to fully decode all action objects (true) or leave 
+	 * them as binary data (false).
+	 * 
+	 * @param decode true if the objects containing actions will be fully decoded
+	 * false if the actions will be left as binary data.
+	 */
 	public void setDecodeActions(boolean decode)
 	{
 		decodeActions = decode;
 	}
 
+	/**
+	 * Returns true if actions will be decoded, false if they will be left as 
+	 * binary data.
+	 *  
+	 * @return true if actions will be decoded, false otherwise.
+	 */
 	public boolean willDecodeActions()
 	{
 		return decodeActions;
 	}
 
+	/**
+	 * Instructs the movie to fully decode all shape objects (true) or leave 
+	 * them as binary data (false).
+	 * 
+	 * @param decode true if the objects containing shapes will be fully decoded
+	 * false if the shapes will be left as binary data.
+	 */
 	public void setDecodeShapes(boolean decode)
 	{
 		decodeShapes = decode;
 	}
 
+	/**
+	 * Returns true if shapes will be decoded, false if they will be left as 
+	 * binary data.
+	 *  
+	 * @return true if shapes will be decoded, false otherwise.
+	 */
 	public boolean willDecodeShapes()
 	{
 		return decodeShapes;
 	}
 
+	/**
+	 * Instructs the movie to fully decode all glyph objects (true) or leave 
+	 * them as binary data (false).
+	 * 
+	 * @param decode true if the font objects containing glyphs will be fully decoded
+	 * false if the glyphs will be left as binary data.
+	 */
 	public void setDecodeGlyphs(boolean decode)
 	{
 		decodeGlyphs = decode;
 	}
 
+	/**
+	 * Returns true if glyphs will be decoded, false if they will be left as 
+	 * binary data.
+	 *  
+	 * @return true if glyphs will be decoded, false otherwise.
+	 */
 	public boolean willDecodeGlyphs()
 	{
 		return decodeGlyphs;
@@ -401,9 +440,14 @@
 	 * 
 	 * @param aString
 	 *            the signature used for the encoded Flash file.
+	 *            
+	 * @throws IllegalArgumentException if the string is not &quot;FWS&quot; or &quot;CWS&quot;.
 	 */
 	public void setSignature(String aString)
 	{
+		if (!aString.equals(&quot;FWS&quot;) &amp;&amp; !aString.equals(&quot;CWS&quot;)) {
+			throw new IllegalArgumentException(&quot;Invalid signature string for flash file.&quot;);
+		}
 		signature = aString;
 	}
 
@@ -455,9 +499,14 @@
 	 * 
 	 * @param aBounds
 	 *            the FSBounds object that defines the frame size.
+	 *            
+	 * @throws NullPointerException if the frame is null.
 	 */
 	public void setFrameSize(FSBounds aBounds)
 	{
+		if (aBounds == null) {
+			throw new NullPointerException(&quot;Frame for movie cannot be null&quot;);
+		}
 		frameSize = aBounds;
 	}
 
@@ -499,9 +548,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of objects that describe a coder.
+	 *            
+	 * @throws NullPointerException if the array is null
 	 */
 	public void setObjects(ArrayList&lt;FSMovieObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array cannot be null&quot;);
+		}
 		objects = anArray;
 	}
 
@@ -510,9 +564,14 @@
 	 * 
 	 * @param anObject
 	 *            the object to be added to the movie.
+	 *            
+	 * @throws NullPointerException if the movie object is null.
 	 */
 	public void add(FSMovieObject anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Cannot add a null object to the movie.&quot;);
+		}
 		objects.add(anObject);
 	}
 
@@ -521,9 +580,14 @@
 	 * 
 	 * @param array
 	 *            an array of FSMovieObjects.
+	 *            
+	 * @throws NullPointerException if the array is null
 	 */
 	public void add(ArrayList&lt;FSMovieObject&gt; array)
 	{
+		if (array == null) {
+			throw new NullPointerException(&quot;Array cannot be null&quot;);
+		}
 		objects.addAll(array);
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSMovieObject.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSMovieObject.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSMovieObject.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -209,7 +209,7 @@
 	// / Type used to identify TabOrder objects.
 	public static final int TabOrder = 66;
 
-	public static final String[] name =
+	public static final String[] className =
 	{
 		&quot;ShowFrame&quot;,
 		&quot;DefineShape&quot;,
@@ -591,6 +591,54 @@
 		table.put(new Integer(type), aClass);
 	}
 
+	/**
+	 * Compares two arrays of bytes. The arrays are considered equal if 
+	 * both are null, both are references to the same array or if both arrays
+	 * are the same length and contain the same binary data.
+	 * 
+	 * @param a the first array
+	 * @param b the second array
+	 * @return true if a equals b, false otherwise.  
+	 */
+	public static boolean equals(byte[] a, byte[] b)
+	{
+		boolean result = false;
+
+		if (a == b)
+			return true;
+
+		if (a != null &amp;&amp; b != null)
+		{
+			result = a.length == b.length;
+
+			if (result)
+				for (int i = 0; i &lt; a.length; i++)
+					if (a[i] != b[i])
+						result = false;
+		}
+		return result;
+	}
+
+	/**
+	 * Creates a copy of an array of bytes.
+	 * 
+	 * @param data the array to be copied
+	 * @return a copy of the array.
+	 */
+	public static byte[] copy(byte[] data)
+	{
+		byte[] newData = null;
+
+		if (data != null)
+		{
+			newData = new byte[data.length];
+
+			for (int i = 0; i &lt; data.length; i++)
+				newData[i] = data[i];
+		}
+		return newData;
+	}
+
 	protected int type;
 	protected int length;
 	protected boolean extendLength;
@@ -690,7 +738,7 @@
 	 */
 	public String toString()
 	{
-		return name[type];
+		return className[type];
 	}
 
 	public int length(FSContext context)

Modified: dev/dev-2-4/src/com/flagstone/transform/FSNewFunction.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSNewFunction.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSNewFunction.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -175,21 +175,19 @@
  */
 public class FSNewFunction extends FSActionObject
 {
-	private String name = null;
+	private String name;
+	private ArrayList&lt;String&gt; arguments;
+	private ArrayList&lt;FSActionObject&gt; actions;
 
-	private ArrayList arguments = null;
-
-	private ArrayList actions = null;
-
 	private int actionsLength = 0;
 
-	FSNewFunction()
+    FSNewFunction()
 	{
 		super(NewFunction);
 	}
 
 	/**
-	 * Construct an FSNewFunction object, initalizing it with values decoded
+	 * Construct an FSNewFunction object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -215,9 +213,11 @@
 	 * @param actionArray
 	 *            the array of actions that define the operation performed by
 	 *            the function.
+	 *            
+	 * @throws NullPointerException if the name or either of the arrays are null.
 	 */
-	public FSNewFunction(String aString, ArrayList argumentArray,
-							ArrayList actionArray)
+	public FSNewFunction(String aString, ArrayList&lt;String&gt; argumentArray,
+							ArrayList&lt;FSActionObject&gt; actionArray)
 	{
 		super(NewFunction);
 		setName(aString);
@@ -235,10 +235,13 @@
 	 * @param actionArray
 	 *            the array of actions that define the operation performed by
 	 *            the function.
+	 *            
+	 * @throws NullPointerException if either of arrays are null.
 	 */
-	public FSNewFunction(ArrayList argumentArray, ArrayList actionArray)
+	public FSNewFunction(ArrayList&lt;String&gt; argumentArray, ArrayList&lt;FSActionObject&gt; actionArray)
 	{
 		super(NewFunction);
+		name = &quot;&quot;;
 		setArguments(argumentArray);
 		setActions(actionArray);
 	}
@@ -252,26 +255,19 @@
 	 */
 	public FSNewFunction(FSNewFunction obj)
 	{
-		super(obj);
+		super(NewFunction);
 
-		if (obj.name != null)
-			name = new String(obj.name);
+		name = new String(obj.name);
 
-		if (obj.arguments != null)
-		{
-			arguments = new ArrayList(obj.arguments.size());
+		arguments = new ArrayList&lt;String&gt;(obj.arguments.size());
 
-			for (Iterator i = obj.arguments.iterator(); i.hasNext();)
-				arguments.add(new String(i.next().toString()));
-		}
+		for (Iterator&lt;String&gt; i = obj.arguments.iterator(); i.hasNext();)
+			arguments.add(i.next());
 
-		if (obj.actions != null)
-		{
-			actions = new ArrayList(obj.actions.size());
+		actions = new ArrayList&lt;FSActionObject&gt;(obj.actions.size());
 
-			for (Iterator i = obj.actions.iterator(); i.hasNext();)
-				actions.add(((FSActionObject) i.next()).clone());
-		}
+		for (Iterator&lt;FSActionObject&gt; i = obj.actions.iterator(); i.hasNext();)
+			actions.add((FSActionObject) i.next().clone());
 	}
 
 	/**
@@ -279,9 +275,18 @@
 	 * 
 	 * @param anArgument
 	 *            the name of an argument passed to the FSNewFunction object.
+	 *            
+	 * @throws NullPointerException if the argument name is null.
+	 * @throws IllegalArgumentException if the argument name is an empty string.
 	 */
 	public void add(String anArgument)
 	{
+		if (anArgument == null) {
+			throw new NullPointerException(&quot;Argument name cannot be null.&quot;);
+		}
+		if (anArgument.length() == 0) {
+			throw new IllegalArgumentException(&quot;Argument name cannot be an empty string&quot;);
+		}
 		arguments.add(anArgument);
 	}
 
@@ -290,9 +295,14 @@
 	 * 
 	 * @param anAction
 	 *            an object belonging to a class derived from FSActionObject.
+     *
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void add(FSActionObject anAction)
 	{
+		if (anAction == null) {
+			throw new NullPointerException(&quot;Action cannot be null.&quot;);
+		}
 		actions.add(anAction);
 	}
 
@@ -311,7 +321,7 @@
 	 * 
 	 * @return the array of argument names.
 	 */
-	public ArrayList getArguments()
+	public ArrayList&lt;String&gt; getArguments()
 	{
 		return arguments;
 	}
@@ -321,19 +331,25 @@
 	 * 
 	 * @return the array of actions executed.
 	 */
-	public ArrayList getActions()
+	public ArrayList&lt;FSActionObject&gt; getActions()
 	{
 		return actions;
 	}
 
 	/**
-	 * Sets the name of the function.
+	 * Sets the name of the function. The name may be an empty string when defining
+	 * methods.
 	 * 
 	 * @param aString
 	 *            the name of the function.
+	 *            
+	 * @throws NullPointerException if the name is null.
 	 */
 	public void setName(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Function name cannot be null.&quot;);
+		}
 		name = aString;
 	}
 
@@ -342,9 +358,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of Strings listing the names of the arguments.
+     *
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setArguments(ArrayList anArray)
+	public void setArguments(ArrayList&lt;String&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of argument names cannot be null&quot;);
+		}
 		arguments = anArray;
 	}
 
@@ -354,9 +375,14 @@
 	 * @param anArray
 	 *            the array of actions that define the operation performed by
 	 *            the function.
+     *
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setActions(ArrayList anArray)
+	public void setActions(ArrayList&lt;FSActionObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of actions cannot be null&quot;);
+		}
 		actions = anArray;
 	}
 
@@ -364,15 +390,15 @@
 	{
 		FSNewFunction anObject = (FSNewFunction) super.clone();
 
-		anObject.arguments = new ArrayList();
+		anObject.arguments = new ArrayList&lt;String&gt;();
 
-		for (Iterator i = arguments.iterator(); i.hasNext();)
-			anObject.arguments.add(new String((String) i.next()));
+		for (Iterator&lt;String&gt; i = arguments.iterator(); i.hasNext();)
+			anObject.arguments.add(i.next());
 
-		anObject.actions = new ArrayList();
+		anObject.actions = new ArrayList&lt;FSActionObject&gt;();
 
-		for (Iterator i = actions.iterator(); i.hasNext();)
-			anObject.actions.add(((FSActionObject) i.next()).clone());
+		for (Iterator&lt;FSActionObject&gt; i = actions.iterator(); i.hasNext();)
+			anObject.actions.add((FSActionObject) i.next().clone());
 
 		return anObject;
 	}
@@ -385,20 +411,9 @@
 		{
 			FSNewFunction typedObject = (FSNewFunction) anObject;
 
-			if (name != null)
-				result = name.equals(typedObject.name);
-			else
-				result = name == typedObject.name;
-
-			if (arguments != null)
-				result = result &amp;&amp; arguments.equals(typedObject.arguments);
-			else
-				result = result &amp;&amp; arguments == typedObject.arguments;
-
-			if (actions != null)
-				result = result &amp;&amp; actions.equals(typedObject.actions);
-			else
-				result = result &amp;&amp; actions == typedObject.actions;
+			result = name.equals(typedObject.name);
+			result = result &amp;&amp; arguments.equals(typedObject.arguments);
+			result = result &amp;&amp; actions.equals(typedObject.actions);
 		}
 		return result;
 	}
@@ -420,20 +435,17 @@
 	{
 		super.length(context);
 
-		length += (name != null) ? FSCoder.strlen(name, true) : 1;
+		length += FSCoder.strlen(name, true);
 		length += 2;
 
-		if (arguments.size() &gt; 0)
-		{
-			for (int i = 0; i &lt; arguments.size(); i++)
-				length += FSCoder.strlen((String) arguments.get(i), true);
-		}
+		for (int i=0; i&lt;arguments.size(); i++)
+			length += FSCoder.strlen((String) arguments.get(i), true);
 
 		length += 2;
 
 		actionsLength = 0;
 
-		for (int i = 0; i &lt; actions.size(); i++)
+		for (int i=0; i&lt;actions.size(); i++)
 		{
 			FSActionObject currentAction = (FSActionObject) actions.get(i);
 
@@ -450,62 +462,35 @@
 		coder.writeWord(type, 1);
 		coder.writeWord(length - actionsLength, 2);
 
-		if (name != null)
-			coder.writeString(name);
-
+		coder.writeString(name);
 		coder.writeWord(0, 1);
 
 		coder.writeWord(arguments.size(), 2);
 
-		if (arguments.size() &gt; 0)
+		for (int i=0; i&lt;arguments.size(); i++)
 		{
-			for (int i = 0; i &lt; arguments.size(); i++)
-			{
-				coder.writeString((String) arguments.get(i));
-				coder.writeWord(0, 1);
-			}
+			coder.writeString((String) arguments.get(i));
+			coder.writeWord(0, 1);
 		}
 
 		coder.writeWord(actionsLength, 2);
 
-		for (Iterator i = actions.iterator(); i.hasNext();)
+		for (Iterator&lt;FSActionObject&gt; i = actions.iterator(); i.hasNext();)
 		{
-			FSActionObject action = (FSActionObject) i.next();
-
-			int objStart = coder.getPointer();
-			int start = coder.getPointer()
-							+ ((action.getType() &gt; 128) ? 24 : 8);
-			int next = start + (action.getLength() &lt;&lt; 3);
-
-			action.encode(coder, context);
-			coder.setPointer(next);
-
-			int delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-			if (delta != 0)
-			{
-				context.codingError = true;
-				context.typeInError = action.getType();
-				context.startOfError = objStart &gt;&gt;&gt; 3;
-				context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
-				context.delta = delta;
-			}
+			FSActionObject.encode(coder, context, i.next());
 		}
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		int argumentCount = 0;
-		int bytesRead = 0;
+		arguments = new ArrayList&lt;String&gt;();
+		actions = new ArrayList&lt;FSActionObject&gt;();
 
-		arguments = new ArrayList();
-		actions = new ArrayList();
-
 		super.decode(coder, context);
 
 		name = coder.readString();
 
-		argumentCount = coder.readWord(2, false);
+		int argumentCount = coder.readWord(2, false);
 
 		if (argumentCount &gt; 0)
 		{
@@ -514,15 +499,7 @@
 		}
 
 		actionsLength = coder.readWord(2, false);
+		actions = FSActionObject.decodeActions(coder, context, actionsLength);
 		length += actionsLength;
-
-		while (bytesRead &lt; actionsLength)
-		{
-			FSActionObject anAction = FSActionObject.decodeAction(coder, context);
-
-			bytesRead += anAction.getLength()
-							+ ((anAction.getType() &gt;= 128) ? 3 : 1);
-			actions.add(anAction);
-		}
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSNewFunction2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSNewFunction2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSNewFunction2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -288,12 +288,12 @@
 	/** Load the predefine variable, &lt;em&gt;_global&lt;/em&gt;, into register 6. */
 	public static final int LoadGlobal = 32768;
 
-	private String name = null;
-	private int registerCount = 0;
-	private int optimizations = 0;
+	private String name;
+	private int registerCount;
+	private int optimizations;
 
-	private ArrayList&lt;FSRegisterVariable&gt; arguments = null;
-	private ArrayList&lt;FSActionObject&gt; actions = null;
+	private ArrayList&lt;FSRegisterVariable&gt; arguments;
+	private ArrayList&lt;FSActionObject&gt; actions;
 
 	/*
 	 * variables used to record state when encoding.
@@ -328,6 +328,8 @@
 	 * @param actions
 	 *            the array of actions that define the operation performed by
 	 *            the function.
+	 *            
+	 * @throws NullPointerException if the name or either of the arrays are null.
 	 */
 	public FSNewFunction2(String name, ArrayList&lt;FSRegisterVariable&gt; arguments, ArrayList&lt;FSActionObject&gt; actions)
 	{
@@ -348,10 +350,13 @@
 	 * @param actions
 	 *            the array of actions that define the operation performed by
 	 *            the function.
+	 *            
+	 * @throws NullPointerException if either of arrays are null.
 	 */
 	public FSNewFunction2(ArrayList&lt;FSRegisterVariable&gt; arguments, ArrayList&lt;FSActionObject&gt; actions)
 	{
 		super(NewFunction2);
+		name = &quot;&quot;;
 		setArguments(arguments);
 		setActions(actions);
 	}
@@ -365,29 +370,21 @@
 	 */
 	public FSNewFunction2(FSNewFunction2 obj)
 	{
-		super(obj);
+		super(NewFunction2);
 
-		if (obj.name != null)
-			name = new String(obj.name);
-
+		name = new String(obj.name);
 		registerCount = obj.registerCount;
 		optimizations = obj.optimizations;
 
-		if (obj.arguments != null)
-		{
-			arguments = new ArrayList&lt;FSRegisterVariable&gt;(obj.arguments.size());
+		arguments = new ArrayList&lt;FSRegisterVariable&gt;(obj.arguments.size());
 
-			for (Iterator&lt;FSRegisterVariable&gt; i = obj.arguments.iterator(); i.hasNext();)
-				arguments.add(new FSRegisterVariable(i.next()));
-		}
+		for (Iterator&lt;FSRegisterVariable&gt; i = obj.arguments.iterator(); i.hasNext();)
+			arguments.add(new FSRegisterVariable(i.next()));
 
-		if (obj.actions != null)
-		{
-			actions = new ArrayList&lt;FSActionObject&gt;(obj.actions.size());
+		actions = new ArrayList&lt;FSActionObject&gt;(obj.actions.size());
 
-			for (Iterator&lt;FSActionObject&gt; i = obj.actions.iterator(); i.hasNext();)
-				actions.add((FSActionObject)i.next().clone());
-		}
+		for (Iterator&lt;FSActionObject&gt; i = obj.actions.iterator(); i.hasNext();)
+			actions.add((FSActionObject)i.next().clone());
 	}
 
 	/**
@@ -395,9 +392,14 @@
 	 * 
 	 * @param anArgument
 	 *            the name of an argument passed to the FSNewFunction object.
+	 *            
+	 * @throws NullPointerException if the argument is null.
 	 */
 	public void add(FSRegisterVariable anArgument)
 	{
+		if (anArgument == null) {
+			throw new NullPointerException(&quot;Argument name cannot be null.&quot;);
+		}
 		arguments.add(anArgument);
 	}
 
@@ -406,9 +408,14 @@
 	 * 
 	 * @param anAction
 	 *            an object belonging to a class derived from FSActionObject.
+     *
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void add(FSActionObject anAction)
 	{
+		if (anAction == null) {
+			throw new NullPointerException(&quot;Action cannot be null.&quot;);
+		}
 		actions.add(anAction);
 	}
 
@@ -423,14 +430,19 @@
 	}
 
 	/**
-	 * Sets the name of the function. The name may be null when defining
+	 * Sets the name of the function. The name may be an empty string when defining
 	 * methods.
 	 * 
 	 * @param aString
 	 *            the name of the function or null for a method.
+	 *            
+	 * @throws NullPointerException if the name is null.
 	 */
 	public void setName(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Function name cannot be null.&quot;);
+		}
 		name = aString;
 	}
 
@@ -450,9 +462,14 @@
 	 * 
 	 * @param count
 	 *            the number of registers to allocate.
+	 *            
+	 * @throws IllegalArgumentException if the register count is not in the range 0..256
 	 */
 	public void setRegisterCount(int count)
 	{
+		if (count &lt; 0 || count &lt; 256) {
+			throw new IllegalArgumentException(&quot;Number of registers must be in the range 0..255&quot;);
+		}
 		registerCount = count;
 	}
 
@@ -500,9 +517,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of Strings listing the names of the arguments.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
 	public void setArguments(ArrayList&lt;FSRegisterVariable&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of argument names cannot be null&quot;);
+		}
 		arguments = anArray;
 	}
 
@@ -522,9 +544,14 @@
 	 * @param anArray
 	 *            the array of actions that define the operation performed by
 	 *            the function.
+     *
+	 * @throws NullPointerException if the array is null.
 	 */
 	public void setActions(ArrayList&lt;FSActionObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of actions cannot be null&quot;);
+		}
 		actions = anArray;
 	}
 
@@ -553,23 +580,11 @@
 		{
 			FSNewFunction2 typedObject = (FSNewFunction2) anObject;
 
-			if (name != null)
-				result = name.equals(typedObject.name);
-			else
-				result = name == typedObject.name;
-
+			result = name.equals(typedObject.name);
 			result = result &amp;&amp; registerCount == typedObject.registerCount;
 			result = result &amp;&amp; optimizations == typedObject.optimizations;
-
-			if (arguments != null)
-				result = result &amp;&amp; arguments.equals(typedObject.arguments);
-			else
-				result = result &amp;&amp; arguments == typedObject.arguments;
-
-			if (actions != null)
-				result = result &amp;&amp; actions.equals(typedObject.actions);
-			else
-				result = result &amp;&amp; actions == typedObject.actions;
+			result = result &amp;&amp; arguments.equals(typedObject.arguments);
+			result = result &amp;&amp; actions.equals(typedObject.actions);
 		}
 		return result;
 	}
@@ -593,7 +608,7 @@
 	{
 		super.length(context);
 
-		length += (name != null) ? FSCoder.strlen(name, true) : 1;
+		length += FSCoder.strlen(name, true);
 		length += 5;
 
 		for (int i = 0; i &lt; arguments.size(); i++)
@@ -601,17 +616,7 @@
 
 		length += 2;
 
-		_actionsLength = 0;
-
-		FSActionObject currentAction;
-
-		for (Iterator&lt;FSActionObject&gt; i = actions.iterator(); i.hasNext();)
-		{
-			currentAction =  i.next();
-
-			_actionsLength += currentAction.length(context);
-			_actionsLength += (currentAction.getType() &gt; 128) ? 3 : 1;
-		}
+		_actionsLength = FSActionObject.length(context, actions);
 		length += _actionsLength;
 
 		return length;
@@ -622,11 +627,8 @@
 		coder.writeWord(type, 1);
 		coder.writeWord(length - _actionsLength, 2);
 
-		if (name != null)
-			coder.writeString(name);
-
+		coder.writeString(name);
 		coder.writeWord(0, 1);
-
 		coder.writeWord(arguments.size(), 2);
 		coder.writeWord(registerCount, 1);
 		coder.writeBits(optimizations, 16);
@@ -638,41 +640,19 @@
 
 		for (Iterator&lt;FSActionObject&gt; i = actions.iterator(); i.hasNext();)
 		{
-			FSActionObject action = (FSActionObject) i.next();
-
-			int objStart = coder.getPointer();
-			int start = coder.getPointer()
-							+ ((action.getType() &gt; 128) ? 24 : 8);
-			int next = start + (action.getLength() &lt;&lt; 3);
-
-			action.encode(coder, context);
-			coder.setPointer(next);
-
-			int delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-			if (delta != 0)
-			{
-				context.codingError = true;
-				context.typeInError = action.getType();
-				context.startOfError = objStart &gt;&gt;&gt; 3;
-				context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
-				context.delta = delta;
-			}
+			FSActionObject.encode(coder, context, i.next());
 		}
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		int argumentCount = 0;
-		int bytesRead = 0;
-
 		arguments = new ArrayList&lt;FSRegisterVariable&gt;();
 		actions = new ArrayList&lt;FSActionObject&gt;();
 
 		super.decode(coder, context);
 
 		name = coder.readString();
-		argumentCount = coder.readWord(2, false);
+		int argumentCount = coder.readWord(2, false);
 		registerCount = coder.readByte();
 		optimizations = coder.readBits(16, false);
 
@@ -680,14 +660,7 @@
 			arguments.add(new FSRegisterVariable(coder, context));
 
 		_actionsLength = coder.readWord(2, false);
+		actions = FSActionObject.decodeActions(coder, context, _actionsLength);
 		length += _actionsLength;
-
-		while (bytesRead &lt; _actionsLength)
-		{
-			FSActionObject anAction = FSActionObject.decodeAction(coder, context);
-
-			bytesRead += anAction.getLength() + ((anAction.getType() &gt;= 128) ? 3 : 1);
-			actions.add(anAction);
-		}
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSPlaceObject.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSPlaceObject.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSPlaceObject.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -164,16 +164,13 @@
  */
 public class FSPlaceObject extends FSMovieObject
 {
-	private int identifier = 0;
+	private int identifier;
+	private int layer;
+	private FSCoordTransform transform;
+	private FSColorTransform colorTransform;
 
-	private int layer = 0;
-
-	private FSCoordTransform transform = null;
-
-	private FSColorTransform colorTransform = null;
-
 	/**
-	 * Construct an FSPlaceObject object, initalizing it with values decoded
+	 * Construct an FSPlaceObject object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -199,6 +196,9 @@
 	 *            the x-coordinate where the object will be drawn.
 	 * @param yLocation
 	 *            the y-coordinate where the object will be drawn.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the layer is not in the range 1..65535.
 	 */
 	public FSPlaceObject(int anIdentifier, int aLayer, int xLocation,
 							int yLocation)
@@ -221,6 +221,10 @@
 	 * @param aTransform
 	 *            an FSCoordTransform object that defines the orientation, size
 	 *            and location of the object when it is drawn.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the layer is not in the range 1..65535.
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public FSPlaceObject(int anIdentifier, int aLayer,
 							FSCoordTransform aTransform)
@@ -247,6 +251,11 @@
 	 * @param aColorTransform
 	 *            an FSColorTransform object that defines the colour of the
 	 *            object when it is drawn.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the layer is not in the range 1..65535.
+	 * @throws NullPointerException if the transform is null.
+	 * @throws NullPointerException if the colour transform is null.
 	 */
 	public FSPlaceObject(int anIdentifier, int aLayer,
 							FSCoordTransform aTransform,
@@ -325,9 +334,14 @@
 	 * @param anIdentifier
 	 *            the unique identifier for the object to the placed on the
 	 *            display list.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -336,9 +350,14 @@
 	 * 
 	 * @param aNumber
 	 *            the layer in the display list where the object will be placed.
+	 *            
+	 * @throws IllegalArgumentException if the layer number is not in the range 1..65535.
 	 */
 	public void setLayer(int aNumber)
 	{
+		if (aNumber &lt; 1 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Layer must be in the range 1..65535.&quot;);
+		}
 		layer = aNumber;
 	}
 
@@ -349,9 +368,14 @@
 	 * @param aTransform
 	 *            an FSCoordTransform object that defines the orientation, size
 	 *            and location of the object when it is drawn.
+	 *            
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public void setTransform(FSCoordTransform aTransform)
 	{
+		if (aTransform == null) {
+			throw new NullPointerException(&quot;Coordinate transform cannot be null&quot;);
+		}
 		transform = aTransform;
 	}
 
@@ -362,9 +386,14 @@
 	 * @param aColorTransform
 	 *            an FSColorTransform object that defines the colour of the
 	 *            object when it is drawn.
+	 *            
+	 * @throws NullPointerException if the transform is null.
 	 */
 	public void setColorTransform(FSColorTransform aColorTransform)
 	{
+		if (aColorTransform == null) {
+			throw new NullPointerException(&quot;Colour transform cannot be null&quot;);
+		}
 		colorTransform = aColorTransform;
 	}
 
@@ -372,11 +401,8 @@
 	{
 		FSPlaceObject anObject = (FSPlaceObject) super.clone();
 
-		anObject.transform = (transform != null) ? (FSCoordTransform) transform
-						.clone() : null;
-		anObject.colorTransform = (colorTransform != null) ? (FSColorTransform) colorTransform
-						.clone()
-						: null;
+		anObject.transform = (FSCoordTransform) transform.clone();
+		anObject.colorTransform = (FSColorTransform) colorTransform.clone();
 
 		return anObject;
 	}
@@ -391,18 +417,8 @@
 
 			result = identifier == typedObject.identifier;
 			result = result &amp;&amp; layer == typedObject.layer;
-
-			if (transform != null)
-				result = result &amp;&amp; transform.equals(typedObject.transform);
-			else
-				result = result &amp;&amp; transform == typedObject.transform;
-
-			if (colorTransform == null)
-				result = result &amp;&amp; (typedObject.getColorTransform() == null);
-			else
-				result = result
-								&amp;&amp; colorTransform
-												.equals(typedObject.colorTransform);
+			result = result &amp;&amp; transform.equals(typedObject.transform);
+			result = result &amp;&amp; colorTransform.equals(typedObject.colorTransform);
 		}
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSPlaceObject2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSPlaceObject2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSPlaceObject2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -180,146 +180,11 @@
  * &lt;/ul&gt;
  * 
  * &lt;p&gt;
- * The class provides a range of constructors which define different subsets of
- * the attributes according to the type of operation that will be performed on
- * an object in the Flash Player's display list. If an attribute is not
- * specified in a constructor then it will be assigned a default value and will
- * be omitted when the object is encoded.
- * &lt;/p&gt;
+ * The FSLayer class provides a simple API for manipulating objects on the 
+ * display list. While it is relatively simple to create instances of FSPlaceObject2
+ * object that perform the same steps the API provided by FSPlayer is easier to
+ * use and much more readable.&lt;/p&gt; 
  * 
- * &lt;h1 class=&quot;datasheet&quot;&gt;Examples&lt;/h1&gt;
- * 
- * &lt;p&gt;
- * The following code samples illustrate how to use the FSPlaceObject2 class to
- * manipulate objects on the display list. These examples use constructors with
- * the most convenient (simplest) arguments. To define more complex place
- * operations constructors are provided that take larger numbers of arguments
- * and allow more complex transformations to be specified.
- * &lt;/p&gt;
- * 
- * &lt;p&gt;
- * 1. Display an object.&lt;br/&gt; To display an object at a given location the
- * placeType, identifier, layer number and x,y coordinates are required.
- * &lt;/p&gt;
- * 
- * &lt;pre&gt;
- *  // Add the shape to the display list - on layer 1 at coordinates (400, 400)
- *  // The constructor allows just the x and y coordinate to be defined, the
- *  // FSCoordTransform object is constructed internally.
- * 
- *  FSDefineShape shape = new FSDefineShape(movie.newIdentifier(), ......);
- * 
- *  movie.add(new FSPlaceObject2(shape.getIdentifier(), 1, 400, 400));
- *  movie.add(new FSShowFrame());
- * &lt;/pre&gt;
- * 
- * &lt;p&gt;
- * 2. Move an object.&lt;br/&gt; To move an object only the layer number is required.
- * This simplifies the code required to manipulate existing objects when
- * compared to the original FSPlaceObject class.
- * &lt;/p&gt;
- * 
- * &lt;pre&gt;
- * // Add the shape to the display list.
- * movie.add(new FSPlaceObject2(shape.getIdentifier(), 1, 400, 400));
- * movie.add(new FSShowFrame());
- * 
- * // Move shape to a new location.
- * movie.add(new FSPlaceObject2(1, 250, 300));
- * movie.add(new FSShowFrame());
- * &lt;/pre&gt;
- * 
- * &lt;p&gt;
- * 3. Replace an existing object with another.&lt;br/&gt; To move an object only the
- * layer number is required. This simplifies the code required to manipulate
- * existing objects when compared to the original FSPlaceObject class.
- * &lt;/p&gt;
- * 
- * &lt;pre&gt;
- * // Add the shape to the display list.
- * movie.add(new FSPlaceObject2(shape.getIdentifier(), 1, 400, 400));
- * movie.add(new FSShowFrame());
- * 
- * // Replace the shape.
- * movie.add(new FSPlaceObject2(newShape.getIdentifier(), 1));
- * movie.add(new FSShowFrame());
- * &lt;/pre&gt;
- * 
- * &lt;p&gt;
- * 4. Defining a clipping layer.&lt;br/&gt; The number of layers to clip using the
- * outline of the shape as a path can be specified when placing the shape on the
- * display list.
- * &lt;/p&gt;
- * 
- * &lt;pre&gt;
- * // Add the shape to the display list and clip objects on the next two layers
- * 
- * currentLayer = 1;
- * clipTo = currentLayer + 2;
- * 
- * movie.add(new FSPlaceObject2(shape.getIdentifier(), currentLayer, clipTo, 400,
- * 				400));
- * movie.add(new FSShowFrame());
- * &lt;/pre&gt;
- * 
- * &lt;p&gt;
- * 5. Controlling the morphing process.&lt;br/&gt; The ratio attribute controls the
- * progress as an FSDefineMorphShape object changes from one shape into another.
- * &lt;/p&gt;
- * 
- * &lt;pre&gt;
- *  FSShape triangle = new FSShape(....);
- *  FSShape hexagon = new FSShape(....);
- * 
- *  FSDefineMorphShape shape = new FSDefineMorphShape(movie.newIdentifier(), ...., triangle, hexagon);
- * 
- *  movie.add(new FSPlaceObject2(shape.getIdentifier(), 1, 0.0, 400, 400));
- * 
- *  // Morph the shapes over 10 frames
- * 
- *  for (float i=0.1; i&lt;1.0; i+= 0.1)
- *  {
- *  movie.add(new FSPlaceObject(1, i));
- *  movie.add(new FSShowFrame());
- *  }
- * &lt;/pre&gt;
- * 
- * &lt;p&gt;
- * 6. Defining a movie clip event.&lt;br/&gt; FSClipEvent objects are ONLY used to
- * define the sequence of actions executed when a particular event occurs in a
- * movie clip.
- * &lt;/p&gt;
- * 
- * &lt;pre&gt;
- *  // Define an array of clip events that will contain one event that defines the
- *  // behaviour of the movie clip in response to a mouse down event.
- * 
- *  ArrayList events = new ArrayList();
- * 
- *  FSClipEvent clipEvent = new FSClipEvent(FSClipEvent.MouseDown);
- * 
- *  // Add one or more actions for the mouse down event.
- * 
- *  clipEvent.add(...);
- *  ...
- * 
- *  // Add the clip event to the array of events for the movie clip.
- * 
- *  events.add(clipEvent);
- * 
- *  // Create the commands to animate the movie clip.
- * 
- *  ArrayList commands = new ArrayList();
- * 
- *  commands.add(...);
- * 
- *  FSDefineMovieClip movieClip = new FSDefineMovieClip(movie.newIdentifier(), commands);
- * 
- *  // Now place the movie clip on the screen on layer 1 at (400, 400).
- * 
- *  movie.add(new FSPlaceObject2(movieClip.getIdentifier(), 1, events, 400, 400));
- * &lt;/pre&gt;
- * 
  * &lt;h1 class=&quot;datasheet&quot;&gt;History&lt;/h1&gt;
  * 
  * &lt;p&gt;
@@ -338,26 +203,16 @@
 	/* Replace an existing object on the display list with a new one */
 	public static final int Replace = 3;
 
-	private int place = New;
+	private int place;
+	private int layer;
+	private int identifier;
+	private FSCoordTransform transform;
+	private FSColorTransform colorTransform;
+	private float ratio;
+	private int clippingDepth;
+	private String name;
+	private ArrayList&lt;FSClipEvent&gt; clipEvents;
 
-	private int layer = 0;
-
-	private int identifier = 0;
-
-	private FSCoordTransform transform = null;
-
-	private FSColorTransform colorTransform = null;
-
-	private float ratio = -1.0f;
-
-	private int clippingDepth = 0;
-
-	private String name = null;
-
-	private ArrayList clipEvents = null;
-
-	private byte[] encodedEvents = null;
-
 	/**
 	 * Construct an FSPlaceObject2 object, initialising it with values decoded
 	 * from an encoded object.
@@ -371,370 +226,102 @@
 		decode(coder, context);
 	}
 
-	/**
+    /**
 	 * Constructs an FSPlaceObject2 object to place a new object on the display
-	 * list at the coordinates on the screen.
+	 * list with the object identifier, layer number, coordinate transform and 
+	 * colour transform.
 	 * 
-	 * @param anIdentifier
-	 *            the identifier of a new object to be displayed.
-	 * @param aLayer
-	 *            the layer number on which an object is being displayed.
-	 * @param xLocation
-	 *            the x-coordinate where the object will be displayed.
-	 * @param yLocation
-	 *            the y-coordinate where the object will be displayed.
-	 */
-	public FSPlaceObject2(int anIdentifier, int aLayer, int xLocation,
-							int yLocation)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.New);
-		setIdentifier(anIdentifier);
-		setLayer(aLayer);
-		setTransform(new FSCoordTransform(xLocation, yLocation));
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object to place new morphing shape on the
-	 * display list at the coordinates on the screen.
+	 * This method may also be used to repalce an existing object with a new 
+	 * one by changing the place type to Replace.
 	 * 
 	 * @param anIdentifier
-	 *            the identifier of a new object to be displayed.
+	 *            the identifier of a new object to be displayed. This value is
+	 *            ignored if the placement type is Modify.
 	 * @param aLayer
 	 *            the layer number on which an object is being displayed.
-	 * @param aRatio
-	 *            the ratio of the progress in morphing the shape.
-	 * @param xLocation
-	 *            the x-coordinate where the object will be displayed.
-	 * @param yLocation
-	 *            the y-coordinate where the object will be displayed.
-	 */
-	public FSPlaceObject2(int anIdentifier, int aLayer, float aRatio,
-							int xLocation, int yLocation)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.New);
-		setIdentifier(anIdentifier);
-		setLayer(aLayer);
-		setRatio(aRatio);
-		setTransform(new FSCoordTransform(xLocation, yLocation));
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object to place a new shape on the display
-	 * list with the specified coordinate and optional colour transform.
-	 * 
-	 * @param anIdentifier
-	 *            the identifier of a new object to be displayed.
-	 * @param aLayer
-	 *            the layer number on which an object is being displayed.
-	 * @param aTransform
+	 * @param transform
 	 *            an FSCoordTransform object that will be applied to the object
 	 *            displayed in the display list at layer, aLayer.
+	 * @param colorTransform
+	 *            an FSColorTransform object that will be applied to the object
+	 *            displayed in the display list at layer, aLayer.
 	 */
-	public FSPlaceObject2(int anIdentifier, int aLayer,
-							FSCoordTransform aTransform)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.New);
-		setIdentifier(anIdentifier);
-		setLayer(aLayer);
-		setTransform(aTransform);
-	}
+	public FSPlaceObject2(int anIdentifier, int aLayer, FSCoordTransform transform,
+							FSColorTransform colorTransform)
+   {
+       super(PlaceObject2);
+       place = New;
+       setIdentifier(anIdentifier);
+       setLayer(aLayer);
+       setTransform(transform);
+       setColorTransform(colorTransform);
+   }
 
-	/**
-	 * Constructs an FSPlaceObject2 object to place a new shape on the display
-	 * list with the specified coordinate and optional colour transform.
+    /**
+	 * Constructs an FSPlaceObject2 object to update an existing object with the
+	 * specified coordinate transform and colour transform. 
 	 * 
-	 * @param anIdentifier
-	 *            the identifier of a new object to be displayed.
-	 * @param aLayer
+s	 * @param aLayer
 	 *            the layer number on which an object is being displayed.
-	 * @param aTransform
+	 * @param transform
 	 *            an FSCoordTransform object that will be applied to the object
 	 *            displayed in the display list at layer, aLayer.
-	 * @param aColorTransform
-	 *            a FSColorTransform object that will be applied to the object
+	 * @param colorTransform
+	 *            an FSColorTransform object that will be applied to the object
 	 *            displayed in the display list at layer, aLayer.
 	 */
-	public FSPlaceObject2(int anIdentifier, int aLayer,
-							FSCoordTransform aTransform,
-							FSColorTransform aColorTransform)
+	public FSPlaceObject2(int aLayer, FSCoordTransform transform,
+							FSColorTransform colorTransform)
 	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.New);
-		setIdentifier(anIdentifier);
-		setLayer(aLayer);
-		setTransform(aTransform);
-		setColorTransform(aColorTransform);
-	}
+	    super(PlaceObject2);
+	    place = Modify;
+	    setLayer(aLayer);
+	    setTransform(transform);
+	    setColorTransform(colorTransform);
+    }
 
 	/**
-	 * Constructs an FSPlaceObject2 object to place a new shape on the display
-	 * list at the coordinates on the screen that defines a clipping path that
-	 * will clip objects for the specified number of layers.
+	 * Constructs an FSPlaceObject2 object to place a new object on the display
+	 * list at the coordinates on the screen.
 	 * 
 	 * @param anIdentifier
 	 *            the identifier of a new object to be displayed.
 	 * @param aLayer
 	 *            the layer number on which an object is being displayed.
-	 * @param aDepth
-	 *            the layer number up to which objects will be clipped by this
-	 *            object's outline.
-	 * @param xLocation
+	 * @param x
 	 *            the x-coordinate where the object will be displayed.
-	 * @param yLocation
+	 * @param y
 	 *            the y-coordinate where the object will be displayed.
 	 */
-	public FSPlaceObject2(int anIdentifier, int aLayer, int aDepth,
-							int xLocation, int yLocation)
+	public FSPlaceObject2(int anIdentifier, int aLayer, int x, int y)
 	{
 		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.New);
+		place = New;
 		setIdentifier(anIdentifier);
 		setLayer(aLayer);
-		setClippingDepth(aDepth);
-		setTransform(new FSCoordTransform(xLocation, yLocation));
+		setTransform(new FSCoordTransform(x, y));
 	}
-
+	
 	/**
-	 * Constructs an FSPlaceObject2 object that places a new, named movie clip
-	 * on the display list at the coordinates on the screen.
-	 * 
-	 * @param anIdentifier
-	 *            the identifier of a new movie clip to be displayed.
-	 * @param aLayer
-	 *            the layer number on which the clip is being displayed.
-	 * @param anArray
-	 *            an array of FSClipEvent objects that define the events
-	 *            responded to by the movie clip.
-	 * @param aName
-	 *            a c-string that define a name for the movie clip.
-	 * @param xLocation
-	 *            the x-coordinate where the object will be displayed.
-	 * @param yLocation
-	 *            the y-coordinate where the object will be displayed.
-	 */
-	public FSPlaceObject2(int anIdentifier, int aLayer, ArrayList anArray,
-							String aName, int xLocation, int yLocation)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.New);
-		setIdentifier(anIdentifier);
-		setLayer(aLayer);
-		setClipEvents(anArray);
-		setName(aName);
-		setTransform(new FSCoordTransform(xLocation, yLocation));
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object that places a new, named movie clip
-	 * on the display list at the coordinates on the screen. The array of bytes
-	 * contains the encoded FSClipEvent objects which specify the events and
-	 * actions that the movie clip will respond to. These are typically
-	 * generated using the classes in the Translate framework.
-	 * 
-	 * @param anIdentifier
-	 *            the identifier of a new movie clip to be displayed.
-	 * @param aLayer
-	 *            the layer number on which the clip is being displayed.
-	 * @param bytes
-	 *            an array of encoded clip event objects.
-	 * @param aName
-	 *            a c-string that define a name for the movie clip.
-	 * @param xLocation
-	 *            the x-coordinate where the object will be displayed.
-	 * @param yLocation
-	 *            the y-coordinate where the object will be displayed.
-	 */
-	public FSPlaceObject2(int anIdentifier, int aLayer, byte[] bytes,
-							String aName, int xLocation, int yLocation)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.New);
-		setIdentifier(anIdentifier);
-		setLayer(aLayer);
-		setEncodedEvents(bytes);
-		setName(aName);
-		setTransform(new FSCoordTransform(xLocation, yLocation));
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object that replaces the object at the
-	 * specified layer in the display list, aLayer with the object with the
-	 * identifier, anIdentifier. The location and transforms currently applied
-	 * to the object being replaced will be preserved.
-	 * 
-	 * @param anIdentifier
-	 *            the identifier of the object that will replaced the one
-	 *            current displayed on &lt;i&gt;aLayer&lt;/i&gt;.
-	 * @param aLayer
-	 *            the layer number on which the object being replaced is
-	 *            displayed.
-	 */
-	public FSPlaceObject2(int anIdentifier, int aLayer)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.Replace);
-		setIdentifier(anIdentifier);
-		setLayer(aLayer);
-	}
-
-	/**
 	 * Constructs an FSPlaceObject2 object that changes the location of the
 	 * object in the display list at layer, aLayer to the coordinates (x,y).
 	 * 
 	 * @param aLayer
 	 *            the layer number on which the object is being displayed.
-	 * @param xLocation
+	 * @param x
 	 *            the x-coordinate where the object will be displayed.
-	 * @param yLocation
+	 * @param y
 	 *            the y-coordinate where the object will be displayed.
 	 */
-	public FSPlaceObject2(int aLayer, int xLocation, int yLocation)
+	public FSPlaceObject2(int aLayer, int x, int y)
 	{
 		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.Modify);
+		place = Modify;
 		setLayer(aLayer);
-		setTransform(new FSCoordTransform(xLocation, yLocation));
+		setTransform(new FSCoordTransform(x, y));
 	}
 
 	/**
-	 * Constructs an FSPlaceObject2 object that applies the specified coordinate
-	 * transform to the object in the display list at layer, aLayer.
-	 * 
-	 * @param aLayer
-	 *            the layer number on which the object is being displayed.
-	 * @param transform
-	 *            an FSCoordTransform object that will be applied to the object
-	 *            displayed in the display list at layer, aLayer.
-	 */
-	public FSPlaceObject2(int aLayer, FSCoordTransform transform)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.Modify);
-		setLayer(aLayer);
-		setTransform(transform);
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object that applied the specified colour
-	 * transform to the object in the display list at layer, aLayer.
-	 * 
-	 * @param aLayer
-	 *            the layer number on which the object is being displayed.
-	 * @param colorTransform
-	 *            an FSColorTransform object that will be applied to the object
-	 *            displayed in the display list at layer, aLayer.
-	 */
-	public FSPlaceObject2(int aLayer, FSColorTransform colorTransform)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.Modify);
-		setLayer(aLayer);
-		setColorTransform(colorTransform);
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object that applies the specified coordinate
-	 * and colour transforms to the object in the display list at layer, aLayer.
-	 * 
-	 * @param aLayer
-	 *            the layer number on which the object is being displayed.
-	 * @param transform
-	 *            an FSCoordTransform object that will be applied to the object
-	 *            displayed in the display list at layer, aLayer.
-	 * @param colorTransform
-	 *            an FSColorTransform object that will be applied to the object
-	 *            displayed in the display list at layer, aLayer.
-	 */
-	public FSPlaceObject2(int aLayer, FSCoordTransform transform,
-							FSColorTransform colorTransform)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.Modify);
-		setLayer(aLayer);
-		setTransform(transform);
-		setColorTransform(colorTransform);
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object that changes the location of the
-	 * object in the display list at layer, aLayer to the coordinates (x,y).
-	 * 
-	 * @param aLayer
-	 *            the layer number on which the object is being displayed.
-	 * @param aRatio
-	 *            the ratio of the progress in morphing the shape.
-	 * @param xLocation
-	 *            the x-coordinate where the object will be displayed.
-	 * @param yLocation
-	 *            the y-coordinate where the object will be displayed.
-	 */
-	public FSPlaceObject2(int aLayer, float aRatio, int xLocation, int yLocation)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.Modify);
-		setLayer(aLayer);
-		setRatio(aRatio);
-		setTransform(new FSCoordTransform(xLocation, yLocation));
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object that modifies the morphing shape
-	 * located on layer, aLayer in the display list. The progress of the
-	 * morphing process is controlled by aRatio.
-	 * 
-	 * @param aLayer
-	 *            the layer number on which the object is being displayed.
-	 * @param aRatio
-	 *            the ratio of the progress in morphing the shape.
-	 * @param transform
-	 *            an FSCoordTransform object that will be applied to the object
-	 *            displayed.
-	 */
-	public FSPlaceObject2(int aLayer, float aRatio, FSCoordTransform transform)
-	{
-		super(PlaceObject2);
-		setPlaceType(FSPlaceObject2.Modify);
-		setLayer(aLayer);
-		setRatio(aRatio);
-		setTransform(transform);
-	}
-
-	/**
-	 * Constructs an FSPlaceObject2 object with the specified placement type,
-	 * object identifier, layer number, coordinate transform and colour
-	 * transform. The exact operation performed is dependent on the placement
-	 * type specified.
-	 * 
-	 * @param aPlace
-	 *            the type of operation to be performed, either New, Modify or
-	 *            Replace.
-	 * @param anIdentifier
-	 *            the identifier of a new object to be displayed.
-	 * @param aLayer
-	 *            the layer number on which an object is being displayed.
-	 * @param transform
-	 *            an FSCoordTransform object that will be applied to the object
-	 *            displayed in the display list at layer, aLayer.
-	 * @param colorTransform
-	 *            an FSColorTransform object that will be applied to the object
-	 *            displayed in the display list at layer, aLayer.
-	 */
-	public FSPlaceObject2(int aPlace, int anIdentifier, int aLayer,
-							FSCoordTransform transform,
-							FSColorTransform colorTransform)
-	{
-		super(PlaceObject2);
-		setPlaceType(aPlace);
-		setIdentifier(anIdentifier);
-		setLayer(aLayer);
-		setTransform(transform);
-		setColorTransform(colorTransform);
-	}
-
-	/**
 	 * Constructs an FSPlaceObject2 object by copying values from an existing
 	 * object.
 	 * 
@@ -762,14 +349,11 @@
 
 		if (obj.clipEvents != null)
 		{
-			clipEvents = new ArrayList(obj.clipEvents.size());
+			clipEvents = new ArrayList&lt;FSClipEvent&gt;(obj.clipEvents.size());
 
-			for (Iterator i = obj.clipEvents.iterator(); i.hasNext();)
-				clipEvents.add(((FSClipEvent) i.next()).clone());
-		} else
-		{
-			encodedEvents = Transform.clone(encodedEvents);
-		}
+			for (Iterator&lt;FSClipEvent&gt; i = obj.clipEvents.iterator(); i.hasNext();)
+				clipEvents.add((FSClipEvent) i.next().clone());
+		} 
 	}
 
 	/**
@@ -778,14 +362,19 @@
 	 * 
 	 * @param aClipEvent
 	 *            a clip event object.
+	 *            
+	 * throws NullPointerException of the clip event object is null
 	 */
 	public void add(FSClipEvent aClipEvent)
 	{
+		if (aClipEvent == null) {
+			throw new NullPointerException(&quot;Clip event cannot be null.&quot;);
+		}
+		
 		if (clipEvents == null)
-			clipEvents = new ArrayList();
+			clipEvents = new ArrayList&lt;FSClipEvent&gt;();
 
 		clipEvents.add(aClipEvent);
-		encodedEvents = null;
 	}
 
 	/**
@@ -795,7 +384,7 @@
 	 * 
 	 * @return the array of clip events
 	 */
-	public ArrayList getClipEvents()
+	public ArrayList&lt;FSClipEvent&gt; getClipEvents()
 	{
 		return clipEvents;
 	}
@@ -810,30 +399,18 @@
 	 * 
 	 * @param anArray
 	 *            an array of FSClipEvent objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setClipEvents(ArrayList anArray)
+	public void setClipEvents(ArrayList&lt;FSClipEvent&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of clip events cannot be null&quot;);
+		}
 		clipEvents = anArray;
-
-		if (encodedEvents != null)
-			encodedEvents = null;
 	}
 
 	/**
-	 * Set the encoded clip event objects generated by the classes in the
-	 * Translate framework. If the object already contains an array of clip
-	 * events objects then they will be deleted.
-	 * 
-	 * @param bytes
-	 *            the array of encoded clip events.
-	 */
-	public void setEncodedEvents(byte[] bytes)
-	{
-		encodedEvents = bytes;
-		clipEvents = null;
-	}
-
-	/**
 	 * Gets the type of place operation being performed.
 	 * 
 	 * @return the placement type.
@@ -927,9 +504,14 @@
 	 * @param aType
 	 *            the type of operation to be performed, either New, Modify or
 	 *            Replace.
+	 *            
+	 * throws IllegalArgumentException is the type is not either New, Modify or Replace. 
 	 */
 	public void setPlaceType(int aType)
 	{
+		if (aType != New &amp;&amp; aType != Modify &amp;&amp; aType != Replace) {
+			throw new IllegalArgumentException(&quot;Placement type must be either New, Modify or Replace.&quot;);
+		}
 		place = aType;
 	}
 
@@ -938,9 +520,14 @@
 	 * 
 	 * @param aLayer
 	 *            the layer number on which the object is being displayed.
+	 *            
+	 * @throws IllegalArgumentException if the layer number is not in the range 1..65535.
 	 */
 	public void setLayer(int aLayer)
 	{
+		if (aLayer &lt; 1 || aLayer &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Layer must be in the range 1..65535.&quot;);
+		}
 		layer = aLayer;
 	}
 
@@ -949,9 +536,14 @@
 	 * 
 	 * @param anIdentifier
 	 *            the identifier of a new object to be displayed.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -989,9 +581,14 @@
 	 * 
 	 * @param aNumber
 	 *            the progress in the morphing process.
+	 *            
+	 * @throws IllegalArgumentException if the ratio is not in the range 0.0..1.0.
 	 */
 	public void setRatio(float aNumber)
 	{
+		if (aNumber &lt; 0.0f || aNumber &gt; 1.0f) {
+			throw new IllegalArgumentException(&quot;Morphing ratio must be in the range 0.0..1.0.&quot;);
+		}
 		ratio = aNumber;
 	}
 
@@ -1001,9 +598,14 @@
 	 * 
 	 * @param aNumber
 	 *            the number of layers clipped.
+	 *            
+	 * @throws IllegalArgumentException if the depth is not in the range 0..65535.
 	 */
 	public void setClippingDepth(int aNumber)
 	{
+		if (aNumber &lt; 1 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		clippingDepth = aNumber;
 	}
 
@@ -1024,22 +626,19 @@
 	{
 		FSPlaceObject2 anObject = (FSPlaceObject2) super.clone();
 
-		anObject.transform = (transform != null) ? (FSCoordTransform) transform
-						.clone() : null;
-		anObject.colorTransform = (colorTransform != null) ? (FSColorTransform) colorTransform
-						.clone()
-						: null;
+		if (transform != null)
+			anObject.transform = (FSCoordTransform) transform.clone();
+		
+		if (colorTransform != null)
+			anObject.colorTransform = (FSColorTransform) colorTransform.clone();
 
 		if (clipEvents != null)
 		{
-			anObject.clipEvents = new ArrayList();
+			anObject.clipEvents = new ArrayList&lt;FSClipEvent&gt;();
 
-			for (Iterator i = clipEvents.iterator(); i.hasNext();)
-				anObject.clipEvents.add(((FSClipEvent) i.next()).clone());
-		} else
-		{
-			anObject.encodedEvents = Transform.clone(encodedEvents);
-		}
+			for (Iterator&lt;FSClipEvent&gt; i = clipEvents.iterator(); i.hasNext();)
+				anObject.clipEvents.add((FSClipEvent) i.next().clone());
+		} 
 		return anObject;
 	}
 
@@ -1063,9 +662,7 @@
 			if (colorTransform == null)
 				result = result &amp;&amp; (typedObject.colorTransform == null);
 			else
-				result = result
-								&amp;&amp; colorTransform
-												.equals(typedObject.colorTransform);
+				result = result &amp;&amp; colorTransform.equals(typedObject.colorTransform);
 
 			result = result &amp;&amp; ratio == typedObject.ratio;
 			result = result &amp;&amp; clippingDepth == typedObject.clippingDepth;
@@ -1075,17 +672,8 @@
 			else
 				result = result &amp;&amp; name.equals(typedObject.name);
 
-			if (transform != null)
-				result = result &amp;&amp; transform.equals(typedObject.transform);
-			else
-				result = result &amp;&amp; transform == typedObject.transform;
-
 			if (clipEvents != null)
 				result = result &amp;&amp; clipEvents.equals(typedObject.clipEvents);
-			else
-				result = result
-								&amp;&amp; Transform.equals(encodedEvents,
-												typedObject.encodedEvents);
 		}
 		return result;
 	}
@@ -1098,16 +686,24 @@
 		buffer.append(&quot;place = &quot;).append(place).append(&quot;; &quot;);
 		buffer.append(&quot;layer = &quot;).append(layer).append(&quot;; &quot;);
 		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
-		buffer.append(&quot;transform = &quot;).append(transform.toString()).append(&quot;; &quot;);
-		buffer.append(&quot;colorTransform = &quot;).append(colorTransform.toString()).append(&quot;; &quot;);
+		
+		if (transform != null) {
+			buffer.append(&quot;transform = &quot;).append(transform.toString()).append(&quot;; &quot;);
+		}
+		
+		if (colorTransform != null) {
+			buffer.append(&quot;colorTransform = &quot;).append(colorTransform.toString()).append(&quot;; &quot;);
+		}
+		
 		buffer.append(&quot;ratio = &quot;).append(ratio).append(&quot;; &quot;);
 		buffer.append(&quot;clippingDepth = &quot;).append(clippingDepth).append(&quot;; &quot;);
-		buffer.append(&quot;name = &quot;).append(name).append(&quot;; &quot;);
+		
+		if (name != null) {
+			buffer.append(&quot;name = &quot;).append(name).append(&quot;; &quot;);
+		}
 
 		if (clipEvents != null)
 			buffer.append(&quot;clipEvents = array[&quot;).append(clipEvents.size()).append(&quot;]; &quot;);
-		else
-			buffer.append(&quot;clipEvents = &lt;data&gt;; &quot;);
 
 		buffer.append(&quot;}&quot;);
 
@@ -1122,31 +718,23 @@
 
 		length += 3;
 		length += (place == 2 || place == 3) ? 2 : 0;
-		length += (containsTransform()) ? transform.length(context) : 0;
-		length += (containsColorTransform()) ? colorTransform
-						.length(context) : 0;
-		length += (containsRatio()) ? 2 : 0;
-		length += (containsClippingDepth()) ? 2 : 0;
+		length += (transform != null) ? transform.length(context) : 0;
+		length += (colorTransform != null) ? colorTransform.length(context) : 0;
+		length += (ratio &gt; 0.0) ? 2 : 0;
+		length += (clippingDepth &gt; 0) ? 2 : 0;
+		length += name != null ? FSCoder.strlen(name, true) : 0;
 
-		length += containsName() ? FSCoder.strlen(name, true) : 0;
-
-		if (containsClipEvents())
+		if (clipEvents != null)
 		{
-			if (clipEvents != null)
-			{
-				int eventSize = context.version &gt; 5 ? 4 : 2;
+			int eventSize = context.version &gt; 5 ? 4 : 2;
 
-				length += 2 + eventSize;
+			length += 2 + eventSize;
 
-				for (Iterator i = clipEvents.iterator(); i.hasNext();)
-					length += ((FSClipEvent) i.next()).length(context);
+			for (Iterator&lt;FSClipEvent&gt; i = clipEvents.iterator(); i.hasNext();)
+				length += i.next().length(context);
 
-				length += eventSize;
-			} else
-			{
-				length += encodedEvents.length;
-			}
-		}
+			length += eventSize;
+		} 
 		context.transparent = false;
 
 		return length;
@@ -1158,85 +746,66 @@
 
 		context.transparent = true;
 
-		coder.writeBits(containsClipEvents() ? 1 : 0, 1);
-		coder.writeBits(containsClippingDepth() ? 1 : 0, 1);
-		coder.writeBits(containsName() ? 1 : 0, 1);
-		coder.writeBits(containsRatio() ? 1 : 0, 1);
-		coder.writeBits(containsColorTransform() ? 1 : 0, 1);
-		coder.writeBits(containsTransform() ? 1 : 0, 1);
+		coder.writeBits(clipEvents != null ? 1 : 0, 1);
+		coder.writeBits(clippingDepth &gt; 0 ? 1 : 0, 1);
+		coder.writeBits(name != null ? 1 : 0, 1);
+		coder.writeBits(ratio &gt; 0.0 ? 1 : 0, 1);
+		coder.writeBits(colorTransform != null ? 1 : 0, 1);
+		coder.writeBits(transform != null ? 1 : 0, 1);
 		coder.writeBits(place, 2);
 		coder.writeWord(layer, 2);
 
 		if (place == 2 || place == 3)
 			coder.writeWord(identifier, 2);
-		if (containsTransform())
+		if (transform != null)
 			transform.encode(coder, context);
-		if (containsColorTransform())
+		if (colorTransform != null)
 			colorTransform.encode(coder, context);
-		if (containsRatio())
+		if (ratio &gt; 0.0)
 			coder.writeWord((int) (ratio * 65535.0f), 2);
 
-		// if (context.version &gt; 5)
-		// {
-		if (containsName())
+		if (name != null)
 		{
 			coder.writeString(name);
 			coder.writeWord(0, 1);
 		}
 
-		if (containsClippingDepth())
+		if (clippingDepth &gt; 0)
 			coder.writeWord(clippingDepth, 2);
-		/*
-		 * } else { if (containsClippingDepth())
-		 * coder.writeWord(clippingDepth+1, 2);
-		 * 
-		 * if (containsName()) { coder.writeString(name); coder.writeWord(0, 1); } }
-		 */
-		if (containsClipEvents())
+
+		if (clipEvents != null)
 		{
-			if (clipEvents != null)
-			{
-				int eventSize = context.version &gt; 5 ? 4 : 2;
-				int eventMask = 0;
+			int eventSize = context.version &gt; 5 ? 4 : 2;
+			int eventMask = 0;
 
-				coder.writeWord(0, 2);
+			coder.writeWord(0, 2);
 
-				for (Iterator i = clipEvents.iterator(); i.hasNext();)
-					eventMask |= ((FSClipEvent) i.next()).getEvent();
+			for (Iterator&lt;FSClipEvent&gt; i = clipEvents.iterator(); i.hasNext();)
+				eventMask |= i.next().getEvent();
 
-				coder.writeWord(eventMask, eventSize);
+			coder.writeWord(eventMask, eventSize);
 
-				for (Iterator&lt;FSClipEvent&gt; i = clipEvents.iterator(); i.hasNext();)
-					i.next().encode(coder, context);
+			for (Iterator&lt;FSClipEvent&gt; i = clipEvents.iterator(); i.hasNext();)
+				i.next().encode(coder, context);
 
-				coder.writeWord(0, eventSize);
-			} else
-			{
-				coder.writeBytes(encodedEvents);
-			}
-		}
+			coder.writeWord(0, eventSize);
+		} 
 		context.transparent = false;
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		boolean containsClipEvents = false;
-		boolean containsClippingDepth = false;
-		boolean containsName = false;
-		boolean containsRatio = false;
-		boolean containsColorTransform = false;
-		boolean containsTransform = false;
-
 		super.decode(coder, context);
 
 		context.transparent = true;
 
-		containsClipEvents = coder.readBits(1, false) != 0 ? true : false;
-		containsClippingDepth = coder.readBits(1, false) != 0 ? true : false;
-		containsName = coder.readBits(1, false) != 0 ? true : false;
-		containsRatio = coder.readBits(1, false) != 0 ? true : false;
-		containsColorTransform = coder.readBits(1, false) != 0 ? true : false;
-		containsTransform = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsClipEvents = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsClippingDepth = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsName = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsRatio = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsColorTransform = coder.readBits(1, false) != 0 ? true : false;
+		boolean containsTransform = coder.readBits(1, false) != 0 ? true : false;
+		
 		place = coder.readBits(2, false);
 		layer = coder.readWord(2, false);
 
@@ -1261,7 +830,7 @@
 		if (containsClipEvents)
 		{
 			int eventSize = context.version &gt; 5 ? 4 : 2;
-			clipEvents = new ArrayList();
+			clipEvents = new ArrayList&lt;FSClipEvent&gt;();
 
 			coder.readWord(2, false);
 			coder.readWord(eventSize, false);
@@ -1273,35 +842,4 @@
 		}
 		context.transparent = false;
 	}
-
-	private boolean containsTransform()
-	{
-		return transform != null;
-	}
-
-	private boolean containsColorTransform()
-	{
-		return colorTransform != null;
-	}
-
-	private boolean containsClipEvents()
-	{
-		return (clipEvents != null &amp;&amp; clipEvents.size() &gt; 0)
-						|| encodedEvents != null;
-	}
-
-	private boolean containsClippingDepth()
-	{
-		return clippingDepth &gt; 0;
-	}
-
-	private boolean containsName()
-	{
-		return name != null &amp;&amp; name.length() &gt; 0;
-	}
-
-	private boolean containsRatio()
-	{
-		return ratio &gt;= 0.0;
-	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSProperty.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSProperty.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSProperty.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -31,14 +31,14 @@
 package com.flagstone.transform;
 
 /**
- * FSProperty is a lightweigth class used to hold codes that specify movie clip
+ * FSProperty is a lightweight class used to hold codes that specify movie clip
  * and movie properties that will be pushed onto the Flash Player stack.
  * 
  * See FSPush for a list of available properties.
  */
 public class FSProperty
 {
-	private int value = 0;
+	private int value;
 
 	/**
 	 * Construct an FSProperty object with the property value.

Modified: dev/dev-2-4/src/com/flagstone/transform/FSProtect.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSProtect.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSProtect.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -106,11 +106,17 @@
 	public FSProtect()
 	{
 		super(Protect);
+		password = &quot;&quot;;
 	}
 
 	/** 
 	 * Constructs an Protect object with the specified password - uses for file
 	 * with Flash version 4 and above. 
+	 *            
+	 * @param aString
+	 *            the string defining the password.
+	 *            
+	 * @throws NullPointerException if argument is null. 
 	 */
 	public FSProtect(String password)
 	{
@@ -128,10 +134,7 @@
 	{
 		super(obj);
 
-		if (obj.password != null)
-			password = new String(obj.password);
-		else
-			password = obj.password;
+		password = obj.password;
 	}
 
 	/**
@@ -167,14 +170,7 @@
 
 		if (super.equals(anObject))
 		{
-			if (password != null) {
-				result = password.equals(((FSProtect)anObject).password);
-			}
-			else {
-				result = password == ((FSProtect)anObject).password;
-			}
-			
-				
+			result = password.equals(((FSProtect)anObject).password);
 		}
 		return result;
 	}
@@ -194,7 +190,7 @@
 	{
 		super.length(context);
 
-		if ((password != null) &amp;&amp; (password.length() &gt; 0))
+		if (password.length() &gt; 0)
 			length += 2 + FSCoder.strlen(password, true);
 
 		return length;
@@ -204,7 +200,7 @@
 	{
 		super.encode(coder, context);
 
-		if ((password != null) &amp;&amp; (password.length() &gt; 0))
+		if (password.length() &gt; 0)
 		{
 			coder.writeWord(0, 2);
 			coder.writeString(password);
@@ -225,8 +221,7 @@
 			coder.readWord(2, false);
 			password = coder.readString(length - 2);
 
-			while (password.charAt(password.length() - 1) == 0)
-			{
+			while (password.charAt(password.length() - 1) == 0) {
 				password = password.substring(0, password.length() - 1);
 			}
 		}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSPush.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSPush.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSPush.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -476,6 +476,8 @@
 	 * 
 	 * @param nullValue
 	 *            an instance of the simple FSNull class.
+	 * 
+	 * @throws NullPointerException if the object is null.
 	 */
 	public FSPush(FSNull nullValue)
 	{
@@ -488,6 +490,8 @@
 	 * 
 	 * @param voidValue
 	 *            an instance of the simple FSVoid class.
+	 * 
+	 * @throws NullPointerException if the object is null.
 	 */
 	public FSPush(FSVoid voidValue)
 	{
@@ -501,6 +505,8 @@
 	 * 
 	 * @param aString
 	 *            string literal value to push onto the stack.
+	 * 
+	 * @throws NullPointerException if the object is null.
 	 */
 	public FSPush(String aString)
 	{
@@ -513,6 +519,8 @@
 	 * 
 	 * @param anIndex
 	 *            an index into a literal table to push onto the stack.
+	 * 
+	 * @throws NullPointerException if the object is null.
 	 */
 	public FSPush(FSTableIndex anIndex)
 	{
@@ -527,6 +535,8 @@
 	 * @param anIndex
 	 *            a reference to one of the Flash Player's internal registers to
 	 *            push onto the stack.
+	 * 
+	 * @throws NullPointerException if the object is null.
 	 */
 	public FSPush(FSRegisterIndex anIndex)
 	{
@@ -542,6 +552,8 @@
 	 *            an array of values to be pushed onto the stack. The values in
 	 *            the array must be one of the following classes: Boolean,
 	 *            Integer, Double, String, FSRegisterIndex or FSTableIndex.
+	 * 
+	 * @throws NullPointerException if the array is null.
 	 */
 	public FSPush(ArrayList&lt;Object&gt; anArray)
 	{
@@ -557,7 +569,7 @@
 	 */
 	public FSPush(FSPush obj)
 	{
-		super(obj);
+		super(Push);
 
 		values = new ArrayList&lt;Object&gt;(obj.values.size());
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSQuicktimeMovie.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSQuicktimeMovie.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSQuicktimeMovie.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -88,6 +88,8 @@
 	 * 
 	 * @param aString
 	 *            the file or URL where the file is located.
+	 * 
+	 * throws NullPointerException if the name is null.
 	 */
 	public FSQuicktimeMovie(String aString)
 	{
@@ -124,7 +126,7 @@
 	 * @param aString
 	 *            the file or URL where the file is located.
 	 * 
-	 * throws NullPointerException if the argument is null.
+	 * throws NullPointerException if the name is null.
 	 */
 	public void setName(String aString)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSRegisterCopy.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSRegisterCopy.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSRegisterCopy.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -99,6 +99,9 @@
 	 * 
 	 * @param anIndex
 	 *            the number of one of the Flash Player's internal registers.
+	 *            
+	 * @throws IllegalArgumentException if the register index is not in the 
+	 * range 0..255.
 	 */
 	public FSRegisterCopy(int anIndex)
 	{
@@ -115,7 +118,7 @@
 	 */
 	public FSRegisterCopy(FSRegisterCopy obj)
 	{
-		super(obj);
+		super(RegisterCopy);
 		registerNumber = obj.registerNumber;
 	}
 
@@ -123,7 +126,7 @@
 	 * Gets the number of the Player register that the value on the stack will
 	 * be copied to.
 	 * 
-	 * @return the register number in the range 0..3 up to flash 7 then 256 from
+	 * @return the register number in the range 0..3 up to flash 7 then 0..255 from
 	 * version 7 onwards.
 	 */
 	public int getRegisterNumber()
@@ -137,9 +140,15 @@
 	 * 
 	 * @param anIndex
 	 *            the number of one of the Flash Player's internal registers.
+	 *            
+	 * @throws IllegalArgumentException if the register index is not in the 
+	 * range 0..256.
 	 */
 	public void setRegisterNumber(int anIndex)
 	{
+		if (anIndex &lt; 0 || anIndex &gt; 255) {
+			throw new IllegalArgumentException(&quot;Register index must be in the range 0..255.&quot;);
+		}
 		registerNumber = anIndex;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSRegisterIndex.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSRegisterIndex.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSRegisterIndex.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -89,7 +89,7 @@
  */
 public class FSRegisterIndex
 {
-	private int index = 0;
+	private int index;
 
 	/**
 	 * Constructs an FSRegisterIndex object referencing the value stored in one
@@ -97,6 +97,9 @@
 	 * 
 	 * @param anIndex
 	 *            the register number.
+	 *            
+	 * @throws IllegalArgumentException if the register index is not in the 
+	 * range 0..255.
 	 */
 	public FSRegisterIndex(int anIndex)
 	{
@@ -130,9 +133,15 @@
 	 * 
 	 * @param anIndex
 	 *            the register number.
+	 *            
+	 * @throws IllegalArgumentException if the register index is not in the 
+	 * range 0..255.
 	 */
 	public void setIndex(int anIndex)
 	{
+		if (anIndex &lt; 0 || anIndex &gt; 255) {
+			throw new IllegalArgumentException(&quot;Register index must be in the range 0..255.&quot;);
+		}
 		index = anIndex;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSRegisterVariable.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSRegisterVariable.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSRegisterVariable.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -42,8 +42,8 @@
  */
 public class FSRegisterVariable implements Cloneable, Codeable
 {
-	private int index = 0;
-	private String name = null;
+	private int index;
+	private String name;
 
 	/**
 	 * Construct an FSRegisterVariable object, initialising it with values
@@ -67,6 +67,10 @@
 	 *            stored in a local variable.
 	 * @param name
 	 *            the name of the argument.
+	 *            
+	 * @throws IllegalArgumentException if the register index is not in the 
+	 * range 0..256.
+	 * @throws NullPointerException if the variable name is null.
 	 */
 	public FSRegisterVariable(int index, String name)
 	{
@@ -116,21 +120,32 @@
 	 *            the number of the register, 1..255, in which the function
 	 *            argument will be stored, 0 if the argument will be stored in a
 	 *            local variable.
+	 *            
+	 * @throws IllegalArgumentException if the register index is not in the 
+	 * range 0..256.
 	 */
-	public void setIndex(int index)
+	public void setIndex(int anIndex)
 	{
-		this.index = index;
+		if (anIndex &lt; 0 || anIndex &gt; 255) {
+			throw new IllegalArgumentException(&quot;Register index must be in the range 0..255.&quot;);
+		}
+		index = anIndex;
 	}
 
 	/**
 	 * Sets the name of the function argument.
 	 * 
-	 * @param name
+	 * @param aName
 	 *            the name of the argument.
+	 *
+	 * @throws NullPointerException if the variable name is null.
 	 */
-	public void setName(String name)
+	public void setName(String aName)
 	{
-		this.name = name;
+		if (aName == null) {
+			throw new NullPointerException(&quot;Variable name cannot be null.&quot;);
+		}
+		this.name = aName;
 	}
 
 	/**

Modified: dev/dev-2-4/src/com/flagstone/transform/FSRemoveObject.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSRemoveObject.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSRemoveObject.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -117,12 +117,11 @@
  */
 public class FSRemoveObject extends FSMovieObject
 {
-	private int identifier = 0;
+	private int identifier;
+	private int layer;
 
-	private int layer = 0;
-
 	/**
-	 * Construct an FSRemoveObject object, initalizing it with values decoded
+	 * Construct an FSRemoveObject object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -144,6 +143,9 @@
 	 * @param layer
 	 *            the layer in the display list where the object is being
 	 *            displayed.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the layer is not in the range 1..65535.
 	 */
 	public FSRemoveObject(int anIdentifier, int layer)
 	{
@@ -192,9 +194,14 @@
 	 * @param anIdentifier
 	 *            the unique identifier for the object currently on the display
 	 *            list.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -204,9 +211,14 @@
 	 * @param aLayer
 	 *            the layer in the display list where the object is being
 	 *            displayed.
+	 *            
+	 * @throws IllegalArgumentException if the layer number is not in the range 1..65535.
 	 */
 	public void setLayer(int aLayer)
 	{
+		if (aLayer &lt; 1 || aLayer &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Layer must be in the range 1..65535.&quot;);
+		}
 		layer = aLayer;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSRemoveObject2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSRemoveObject2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSRemoveObject2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -68,10 +68,10 @@
  */
 public class FSRemoveObject2 extends FSMovieObject
 {
-	private int layer = 0;
+	private int layer;
 
 	/**
-	 * Construct an FSRemoveObject2 object, initalizing it with values decoded
+	 * Construct an FSRemoveObject2 object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -89,6 +89,8 @@
 	 * 
 	 * @param layer
 	 *            the layer number on which the object is displayed.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public FSRemoveObject2(int layer)
 	{
@@ -128,6 +130,9 @@
 	 */
 	public void setLayer(int aLayer)
 	{
+		if (aLayer &lt; 1 || aLayer &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Layer must be in the range 1..65535.&quot;);
+		}
 		layer = aLayer;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSSerialNumber.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSSerialNumber.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSSerialNumber.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -73,7 +73,7 @@
 	private String serialNumber = null;
 
 	/**
-	 * Construct an FSSerialNumber object, initalizing it with values decoded
+	 * Construct an FSSerialNumber object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -90,6 +90,8 @@
 	 * 
 	 * @param aString
 	 *            an arbitrary string containing the serial number.
+	 *            
+	 * @throws NullPointerException if serial number is null. 
 	 */
 	public FSSerialNumber(String aString)
 	{
@@ -125,9 +127,14 @@
 	 * 
 	 * @param aString
 	 *            an arbitrary string containing the serial number.
+	 *            
+	 * @throws NullPointerException if argument is null. 
 	 */
 	public void setSerialNumber(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Serial number cannot be null.&quot;);
+		}
 		serialNumber = aString;
 	}
 
@@ -139,10 +146,7 @@
 		{
 			FSSerialNumber typedObject = (FSSerialNumber) anObject;
 
-			if (serialNumber != null)
-				result = serialNumber.equals(typedObject.serialNumber);
-			else
-				result = serialNumber == typedObject.serialNumber;
+			result = serialNumber.equals(typedObject.serialNumber);
 		}
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSSetBackgroundColor.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSSetBackgroundColor.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSSetBackgroundColor.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -85,10 +85,10 @@
  */
 public class FSSetBackgroundColor extends FSMovieObject
 {
-	private FSColor color = null;
+	private FSColor color;
 
 	/**
-	 * Construct an FSSetBackgroundColor object, initalizing it with values
+	 * Construct an FSSetBackgroundColor object, initialising it with values
 	 * decoded from an encoded object.
 	 * 
 	 * @param coder
@@ -105,6 +105,8 @@
 	 * 
 	 * @param aColor
 	 *            the colour for the background.
+	 *     
+	 * @throws NullPointerException if the colour is null,
 	 */
 	public FSSetBackgroundColor(FSColor aColor)
 	{
@@ -140,9 +142,14 @@
 	 * 
 	 * @param aColor
 	 *            the colour for the background.
+	 *     
+	 * @throws NullPointerException if the colour is null,
 	 */
 	public void setColor(FSColor aColor)
 	{
+		if (aColor == null) {
+			throw new NullPointerException(&quot;Colour cannot be null.&quot;);
+		}
 		color = aColor;
 	}
 
@@ -150,7 +157,7 @@
 	{
 		FSSetBackgroundColor anObject = (FSSetBackgroundColor) super.clone();
 
-		anObject.color = (color != null) ? (FSColor) color.clone() : null;
+		anObject.color = (FSColor) color.clone();
 
 		return anObject;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSSetTarget.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSSetTarget.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSSetTarget.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -85,10 +85,10 @@
  */
 public class FSSetTarget extends FSActionObject
 {
-	private String target = &quot;&quot;;
+	private String target;
 
 	/**
-	 * Construct an FSSetTarget object, initalizing it with values decoded from
+	 * Construct an FSSetTarget object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -106,6 +106,9 @@
 	 * 
 	 * @param aString
 	 *            the name of a movie clip.
+	 * 
+	 * @throws NullPointerException if the target string is null.
+	 * @throws IllegalArgumentException if the target string is empty.
 	 */
 	public FSSetTarget(String aString)
 	{
@@ -122,7 +125,7 @@
 	 */
 	public FSSetTarget(FSSetTarget obj)
 	{
-		super(obj);
+		super(SetTarget);
 		target = new String(obj.target);
 	}
 
@@ -141,9 +144,18 @@
 	 * 
 	 * @param aString
 	 *            the name of a movie clip.
+	 * 
+	 * @throws NullPointerException if the target string is null.
+	 * @throws IllegalArgumentException if the target string is empty.
 	 */
 	public void setTarget(String aString)
 	{
+		if (aString == null) {
+			throw new NullPointerException(&quot;Target cannot be null.&quot;);
+		}
+		if (aString.length() == 0) {
+			throw new IllegalArgumentException(&quot;Target cannot be an empty string.&quot;);
+		}
 		target = aString;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSShape.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSShape.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSShape.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -66,8 +66,8 @@
  */
 public class FSShape implements Cloneable, Codeable
 {
-	private ArrayList&lt;FSShapeObject&gt; objects = null;
-	private byte[] encodedObjects = null;
+	private ArrayList&lt;FSShapeObject&gt; objects;
+	private byte[] encodedObjects;
 
 	/*
 	 * This method is only used when lazily decoding shapes.
@@ -85,7 +85,7 @@
 	}
 
 	/**
-	 * Construct an FSShape object, initalizing it with values decoded from an
+	 * Construct an FSShape object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -99,7 +99,7 @@
 	/** Constructs an FSShape object with no shape objects. */
 	public FSShape()
 	{
-		objects = new ArrayList();
+		objects = new ArrayList&lt;FSShapeObject&gt;();
 	}
 
 	/**
@@ -108,6 +108,8 @@
 	 * 
 	 * @param anArray
 	 *            the array of shape records.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
 	public FSShape(ArrayList&lt;FSShapeObject&gt; anArray)
 	{
@@ -128,9 +130,10 @@
 
 			for (Iterator&lt;FSShapeObject&gt; i = obj.objects.iterator(); i.hasNext();)
 				objects.add((FSShapeObject)i.next().clone());
-		} else
+		} 
+		else
 		{
-			encodedObjects = Transform.clone(obj.encodedObjects);
+			encodedObjects = FSMovieObject.copy(obj.encodedObjects);
 		}
 	}
 
@@ -170,9 +173,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of shape records.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
 	public void setObjects(ArrayList&lt;FSShapeObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of shape objects cannot be null&quot;);
+		}
 		objects = anArray;
 	}
 
@@ -192,7 +200,7 @@
 					anObject.objects.add((FSShapeObject)i.next().clone());
 			} else
 			{
-				anObject.encodedObjects = Transform.clone(encodedObjects);
+				anObject.encodedObjects = FSMovieObject.copy(encodedObjects);
 			}
 		} 
 		catch (CloneNotSupportedException e)
@@ -222,7 +230,7 @@
 			if (objects != null)
 				result = objects.equals(typedObject.objects);
 			else
-				result = objects == typedObject.objects;
+				result = FSMovieObject.equals(encodedObjects,typedObject.encodedObjects);
 		}
 		return result;
 	}
@@ -232,7 +240,12 @@
 		StringBuffer buffer = new StringBuffer();
 
 		buffer.append(&quot;: { &quot;);
-		buffer.append(&quot;objects = &quot;).append(objects.toString()).append(&quot;; &quot;);
+		if (objects != null) {
+			buffer.append(&quot;objects = array[&quot;).append(objects.size()).append(&quot;]; &quot;);
+		}
+		if (objects != null) {
+			buffer.append(&quot;encodedObjects = &lt;data&gt;; &quot;);
+		}
 		buffer.append(&quot;}&quot;);
 
 		return buffer.toString();
@@ -248,13 +261,14 @@
 		{
 			numberOfBits += 8;
 
-			for (Iterator shapeIterator = objects.iterator(); shapeIterator.hasNext();)
-				numberOfBits += ((Codeable) shapeIterator.next()).length(context);
+			for (Iterator&lt;FSShapeObject&gt; i = objects.iterator(); i.hasNext();)
+				numberOfBits += i.next().length(context);
 
 			numberOfBits += 6; // Add size of end of shape
 
 			numberOfBits += (numberOfBits % 8 &gt; 0) ? 8 - (numberOfBits % 8) : 0;
-		} else
+		} 
+		else
 		{
 			numberOfBits += encodedObjects.length &lt;&lt; 3;
 		}
@@ -268,12 +282,13 @@
 			coder.writeBits(context.fillSize, 4);
 			coder.writeBits(context.lineSize, 4);
 
-			for (Iterator shapeIterator = objects.iterator(); shapeIterator.hasNext();)
-				((Codeable) shapeIterator.next()).encode(coder, context);
+			for (Iterator&lt;FSShapeObject&gt; i = objects.iterator(); i.hasNext();)
+				i.next().encode(coder, context);
 
 			coder.writeBits(0, 6); // End of shape
 			coder.alignToByte();
-		} else
+		} 
+		else
 		{
 			coder.writeBytes(encodedObjects);
 		}
@@ -284,7 +299,8 @@
 		if (encodedObjects != null)
 		{
 			coder.readBytes(encodedObjects);
-		} else
+		} 
+		else
 		{
 			objects = FSShapeObject.decodeShape(coder, context);
 		}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSShapeObject.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSShapeObject.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSShapeObject.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -73,7 +73,6 @@
 		return objects;
 	}
 
-
 	/**
 	 * Creates a deep copy of the entire object.
 	 * 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSShapeStyle.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSShapeStyle.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSShapeStyle.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -341,6 +341,9 @@
 	 *            move the current point by relativeX in the x direction.
 	 * @param relativeY
 	 *            move the current point by relativeY in the y direction.
+     *
+	 * @throws IllegalArgumentException if the x coordintae is not in the range -65535..65535.
+	 * @throws IllegalArgumentException if the y coordinate is not in the range -65535..65535.
 	 */
 	public FSShapeStyle(int relativeX, int relativeY)
 	{
@@ -356,6 +359,8 @@
 	 *            an array of FSLineStyle objects.
 	 * @param fills
 	 *            an array of fill style objects.
+	 *            
+	 * @throws NullPointerException if either of the arrays are null.
 	 */
 	public FSShapeStyle(ArrayList&lt;FSLineStyle&gt; lines, ArrayList&lt;FSFillStyle&gt; fills)
 	{
@@ -380,6 +385,9 @@
 	 *            move the current point by relativeX in the x direction.
 	 * @param relativeY
 	 *            move the current point by relativeY in the y direction.
+     *
+	 * @throws IllegalArgumentException if the x coordintae is not in the range -65535..65535.
+	 * @throws IllegalArgumentException if the y coordinate is not in the range -65535..65535.
 	 */
 	public FSShapeStyle(int lineIndex, int fillIndex, int altIndex, int relativeX, int relativeY)
 	{
@@ -407,6 +415,8 @@
 	 *            an array of FSLineStyle objects.
 	 * @param fills
 	 *            an array of fill style objects.
+	 *
+	 * @throws NullPointerException if either of the arrays are null.
 	 */
 	public FSShapeStyle(int lineIndex, int fillIndex, int altIndex, 
 	                    ArrayList&lt;FSLineStyle&gt; lines, ArrayList&lt;FSFillStyle&gt; fills)
@@ -439,6 +449,10 @@
 	 *            an array of line style objects.
 	 * @param fills
 	 *            an array of fill style objects.
+     *
+	 * @throws IllegalArgumentException if the x coordinate is not in the range -65535..65535.
+	 * @throws IllegalArgumentException if the y coordinate is not in the range -65535..65535.
+	 * @throws NullPointerException if either of the arrays are null.
 	 */
 	public FSShapeStyle(int lineIndex, int fillIndex, int altIndex, int relativeX, int relativeY,
 						ArrayList&lt;FSLineStyle&gt; lines, ArrayList&lt;FSFillStyle&gt; fills)
@@ -491,7 +505,7 @@
 	 * @param style
 	 *            and FSLineStyle object.
 	 *            
-	 * @throws NullPointerException if the argument is null.
+	 * @throws NullPointerException if the line style is null.
 	 */
 	public void add(FSLineStyle style)
 	{
@@ -511,7 +525,7 @@
 	 * @param style
 	 *            and FSFillStyle object.
 	 *            
-	 * @throws NullPointerException if the argument is null.
+	 * @throws NullPointerException if the fill style is null.
 	 */
 	public void add(FSFillStyle style)
 	{
@@ -641,7 +655,7 @@
 	 * @param y
 	 *            the y-coordinate of the drawing point.
 	 *	 
-	 * @throws IllegalArgumentException if the arguments are not in the range -65535..65535.
+	 * @throws IllegalArgumentException if the coordinates are not in the range -65535..65535.
 	 */
 	public void setMove(int x, int y)
 	{
@@ -697,9 +711,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of FSLineStyle objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
 	public void setLineStyles(ArrayList&lt;FSLineStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of line styles cannot be null.&quot;);
+		}
 		lineStyles = anArray;
 	}
 
@@ -709,9 +728,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of fill style objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
 	public void setFillStyles(ArrayList&lt;FSFillStyle&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of line styles cannot be null.&quot;);
+		}
 		fillStyles = anArray;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSShowFrame.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSShowFrame.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSShowFrame.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -131,7 +131,7 @@
 	}
 
 	/**
-	 * Construct an FSShowFrame object, initalising it with values decoded from
+	 * Construct an FSShowFrame object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder

Modified: dev/dev-2-4/src/com/flagstone/transform/FSSolidFill.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSSolidFill.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSSolidFill.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -149,6 +149,8 @@
 	 * @param aColor
 	 *            an FSColor object that defines the colour that the area will
 	 *            be filled with.
+	 * 
+	 * @throws NullPointerException if the colour is null.
 	 */
 	public FSSolidFill(FSColor aColor)
 	{
@@ -186,7 +188,7 @@
 	 *            an FSColor object that defines the colour that the area will
 	 *            be filled with.
 	 * 
-	 * @throws NullPointerException if the argument is null.
+	 * @throws NullPointerException if the colour is null.
 	 */
 	public void setColor(FSColor aColor)
 	{

Modified: dev/dev-2-4/src/com/flagstone/transform/FSSound.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSSound.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSSound.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -30,7 +30,8 @@
 
 package com.flagstone.transform;
 
-import java.util.*;
+import java.util.ArrayList;
+import java.util.Iterator;
 
 /**
  * The FSSound class identifies a sound (previously defined using The
@@ -124,10 +125,14 @@
 	 */
 	public static final int NATIVE_PCM = 0;
 
-	/** Identifies an adaptive pulse code modulated sound. */
+	/** 
+	 * Identifies an adaptive pulse code modulated sound. 
+	 */
 	public static final int ADPCM = 1;
 
-	/** Identifies an MP3 format sound. */
+	/** 
+	 * Identifies an MP3 format sound. 
+	 * */
 	public static final int MP3 = 2;
 
 	/**
@@ -136,34 +141,42 @@
 	 */
 	public static final int PCM = 3;
 
-	// Flash 6
-	// / Identifies a Nellymoser Asao encoded sound.
+	/** 
+	 * Nellymoser Asao encoded at 8KHz. Use only for Flash Video (flv) files,
+	 * Do not use for SWF files.
+	 */
+	public static final int NELLYMOSER_8K = 5;
+
+	/** 
+	 * Identifies a Nellymoser Asao encoded sound. 
+	 */
 	public static final int NELLYMOSER = 6;
 
-	// End Flash 6
-	/** Start playing the sound. */
+	/** 
+	 * Start playing the sound. 
+	 */
 	public static final int Start = 0;
 
-	/** Start playing the sound or continues if it is already playing. */
+	/** 
+	 * Start playing the sound or continues if it is already playing. 
+	 */
 	public static final int Continue = 1;
 
-	/** Stop playing the sound. */
+	/** 
+	 * Stop playing the sound.
+	 */
 	public static final int Stop = 2;
 
-	private int identifier = 0;
+	private int identifier;
+	private int mode;
+	private int inPoint;
+	private int outPoint;
+	private int loopCount;
 
-	private int mode = 0;
+	private ArrayList&lt;FSEnvelope&gt; envelopes;
 
-	private int inPoint = 0;
-
-	private int outPoint = 0;
-
-	private int loopCount = 0;
-
-	private ArrayList&lt;FSEnvelope&gt; envelopes = null;
-
 	/**
-	 * Construct an FSSound object, initalizing it with values decoded from an
+	 * Construct an FSSound object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -175,24 +188,6 @@
 	}
 
 	/**
-	 * Constructs an FSSound object specifying how the sound is played.
-	 * 
-	 * @param anIdentifier
-	 *            the unique identifier of the object that contains the sound
-	 *            data.
-	 * @param aMode
-	 *            how the sound is synchronised when the frames are displayed:
-	 *            Start - start playing the sound, Continue - do not play the
-	 *            sound if it is already playing and Stop - stop playing the
-	 *            sound.
-	 */
-	public FSSound(int anIdentifier, int aMode)
-	{
-		setIdentifier(anIdentifier);
-		setMode(aMode);
-	}
-
-	/**
 	 * Constructs and FSSound object specifying how the sound is played and the
 	 * number of times the sound is repeated.
 	 * 
@@ -206,110 +201,20 @@
 	 * @param aCount
 	 *            the number of times the sound is repeated. May be set to zero
 	 *            if the sound will not be repeated.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the mode is not either Start, Stop or Continue.
+	 * @throws IllegalArgumentException if the loop count is not in the range 0..65535.
 	 */
 	public FSSound(int anIdentifier, int aMode, int aCount)
 	{
 		setIdentifier(anIdentifier);
 		setMode(aMode);
 		setLoopCount(aCount);
+		envelopes = new ArrayList&lt;FSEnvelope&gt;();
 	}
 
 	/**
-	 * Constructs and FSSound object specifying how the sound is played and the
-	 * points at which the sound fades in and out.
-	 * 
-	 * @param anIdentifier
-	 *            the unique identifier of the object that contains the sound
-	 *            data.
-	 * @param aMode
-	 *            how the sound is synchronised when the frames are displayed:
-	 *            Play - do not play the sound if it is already playing and Stop -
-	 *            stop playing the sound.
-	 * @param anInPoint
-	 *            the sample number which the sound fades in to. May be set to
-	 *            zero if the sound does not fade in.
-	 * @param anOutPoint
-	 *            the sample number at which the sound starts to fade. May be
-	 *            set to zero if the sound does not fade out.
-	 */
-	public FSSound(int anIdentifier, int aMode, int anInPoint, int anOutPoint)
-	{
-		setIdentifier(anIdentifier);
-		setMode(aMode);
-		setInPoint(anInPoint);
-		setOutPoint(anOutPoint);
-	}
-
-	/**
-	 * Constructs and FSSound object specifying how the sound is played, the
-	 * point at which the sound fades in and out and the number of times the
-	 * sound is repeated.
-	 * 
-	 * @param anIdentifier
-	 *            the unique identifier of the object that contains the sound
-	 *            data.
-	 * @param aMode
-	 *            how the sound is synchronised when the frames are displayed:
-	 *            Play - do not play the sound if it is already playing and Stop -
-	 *            stop playing the sound.
-	 * @param anInPoint
-	 *            the sample number which the sound fades in to. May be set to
-	 *            zero if the sound does not fade in.
-	 * @param anOutPoint
-	 *            the sample number at which the sound starts to fade. May be
-	 *            set to zero if the sound does not fade out.
-	 * @param aCount
-	 *            the number of times the sound is repeated. May be set to zero
-	 *            if the sound will not be repeated.
-	 */
-	public FSSound(int anIdentifier, int aMode, int anInPoint, int anOutPoint,
-					int aCount)
-	{
-		setIdentifier(anIdentifier);
-		setMode(aMode);
-		setInPoint(anInPoint);
-		setOutPoint(anOutPoint);
-		setLoopCount(aCount);
-	}
-
-	/**
-	 * Constructs and FSSound object specifying how the sound is played, the
-	 * point at which the sound fades in and out, the number of times the sound
-	 * is repeated and the envelopes used to control how the sound is played.
-	 * 
-	 * @param anIdentifier
-	 *            the unique identifier of the object that contains the sound
-	 *            data.
-	 * @param aMode
-	 *            how the sound is synchronised when the frames are displayed:
-	 *            Play - do not play the sound if it is already playing and Stop -
-	 *            stop playing the sound.
-	 * @param anInPoint
-	 *            the sample number which the sound fades in to. May be set to
-	 *            zero if the sound does not fade in.
-	 * @param anOutPoint
-	 *            the sample number at which the sound starts to fade. May be
-	 *            set to zero if the sound does not fade out.
-	 * @param aCount
-	 *            the number of times the sound is repeated. May be set to zero
-	 *            if the sound will not be repeated.
-	 * @param anArray
-	 *            an array of FSEnvelope objects that define the levels at which
-	 *            a sound is played over the duration of the sound. May be set
-	 *            to NULL if no envelope is defined.
-	 */
-	public FSSound(int anIdentifier, int aMode, int anInPoint, int anOutPoint,
-					int aCount, ArrayList anArray)
-	{
-		setIdentifier(anIdentifier);
-		setMode(aMode);
-		setInPoint(anInPoint);
-		setOutPoint(anOutPoint);
-		setLoopCount(aCount);
-		setEnvelopes(anArray);
-	}
-
-	/**
 	 * Constructs an FSSound object by copying values from an existing object.
 	 * 
 	 * @param obj
@@ -408,9 +313,14 @@
 	 * 
 	 * @param anIdentifier
 	 *            the identifier for the sound to be played.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is not in the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -421,9 +331,14 @@
 	 * 
 	 * @param aMode
 	 *            how the sound is played.
+	 *            
+	 * @throws IllegalArgumentException if the mode is not either Start, Stop or Continue.
 	 */
 	public void setMode(int aMode)
 	{
+		if (aMode &lt; 0 || aMode &gt; 2) {
+			throw new IllegalArgumentException(&quot;Mode must either Start, Stop or Continue&quot;);
+		}
 		mode = aMode;
 	}
 
@@ -433,9 +348,14 @@
 	 * 
 	 * @param aNumber
 	 *            the sample number which the sound fades in to.
+	 *            
+	 * @throws IllegalArgumentException if the loop count is not in the range 0..65535.
 	 */
 	public void setInPoint(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Loop count must be in the range 0..65535.&quot;);
+		}
 		inPoint = aNumber;
 	}
 
@@ -470,9 +390,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of FSEnvelope objects.
+	 *            
+	 * @throws NullPointerException if the array of envelopes is null.
 	 */
 	public void setEnvelopes(ArrayList&lt;FSEnvelope&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of envelopes cannot be null.&quot;);
+		}
 		envelopes = anArray;
 	}
 
@@ -507,11 +432,7 @@
 			result = result &amp;&amp; inPoint == typedObject.inPoint;
 			result = result &amp;&amp; outPoint == typedObject.outPoint;
 			result = result &amp;&amp; loopCount == typedObject.loopCount;
-
-			if (envelopes != null)
-				result = result &amp;&amp; envelopes.equals(typedObject.envelopes);
-			else
-				result = result &amp;&amp; envelopes == typedObject.envelopes;
+			result = result &amp;&amp; envelopes.equals(typedObject.envelopes);
 		}
 		return result;
 	}
@@ -534,68 +455,54 @@
 
 	public int length(FSContext context)
 	{
-		boolean _containsInPoint = containsInPoint();
-		boolean _containsOutPoint = containsOutPoint();
-		boolean _containsLoopCount = containsLoopCount();
-		boolean _containsEnvelopes = containsEnvelopes();
-
 		int length = 3;
 
-		length += (_containsInPoint) ? 4 : 0;
-		length += (_containsOutPoint) ? 4 : 0;
-		length += (_containsLoopCount) ? 2 : 0;
-		length += (_containsEnvelopes) ? 1 : 0;
-		length += (_containsEnvelopes) ? envelopes.size() * 8 : 0;
+		length += (inPoint != 0) ? 4 : 0;
+		length += (outPoint != 0) ? 4 : 0;
+		length += (loopCount != 0) ? 2 : 0;
+		
+		if (envelopes.size() &gt; 0) {
+			length += 1 + envelopes.size() * 8;
+		}
 
 		return length;
 	}
 
 	public void encode(FSCoder coder, FSContext context)
 	{
-		boolean _containsInPoint = containsInPoint();
-		boolean _containsOutPoint = containsOutPoint();
-		boolean _containsLoopCount = containsLoopCount();
-		boolean _containsEnvelopes = containsEnvelopes();
-
 		coder.writeWord(identifier, 2);
 		coder.writeBits(mode, 4);
-		coder.writeBits(_containsEnvelopes ? 1 : 0, 1);
-		coder.writeBits(_containsLoopCount ? 1 : 0, 1);
-		coder.writeBits(_containsOutPoint ? 1 : 0, 1);
-		coder.writeBits(_containsInPoint ? 1 : 0, 1);
+		coder.writeBits(envelopes.size() &gt; 0 ? 1 : 0, 1);
+		coder.writeBits(loopCount != 0 ? 1 : 0, 1);
+		coder.writeBits(outPoint != 0 ? 1 : 0, 1);
+		coder.writeBits(inPoint != 0 ? 1 : 0, 1);
 
-		if (_containsInPoint)
+		if (inPoint != 0)
 			coder.writeWord(inPoint, 4);
-		if (_containsOutPoint)
+		if (outPoint != 0)
 			coder.writeWord(outPoint, 4);
-		if (_containsLoopCount)
+		if (loopCount != 0)
 			coder.writeWord(loopCount, 2);
-		if (_containsEnvelopes)
+		if (envelopes.size() &gt; 0)
 		{
 			coder.writeWord(envelopes.size(), 1);
 
-			for (int i = 0; i &lt; envelopes.size(); i++)
+			for (int i=0; i&lt;envelopes.size(); i++)
 				envelopes.get(i).encode(coder, context);
 		}
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		boolean _containsInPoint = false;
-		boolean _containsOutPoint = false;
-		boolean _containsLoopCount = false;
-		boolean _containsEnvelopes = false;
-
-		envelopes = new ArrayList();
-
 		int envelopeCount = 0;
+		envelopes = new ArrayList&lt;FSEnvelope&gt;();
 
 		identifier = coder.readWord(2, false);
 		mode = coder.readBits(4, false);
-		_containsEnvelopes = coder.readBits(1, false) != 0 ? true : false;
-		_containsLoopCount = coder.readBits(1, false) != 0 ? true : false;
-		_containsOutPoint = coder.readBits(1, false) != 0 ? true : false;
-		_containsInPoint = coder.readBits(1, false) != 0 ? true : false;
+		boolean _containsEnvelopes = coder.readBits(1, false) != 0 ? true : false;
+		boolean _containsLoopCount = coder.readBits(1, false) != 0 ? true : false;
+		boolean _containsOutPoint = coder.readBits(1, false) != 0 ? true : false;
+		boolean _containsInPoint = coder.readBits(1, false) != 0 ? true : false;
 
 		if (_containsInPoint)
 			inPoint = coder.readWord(4, false);
@@ -614,24 +521,4 @@
 				envelopes.add(new FSEnvelope(coder, context));
 		}
 	}
-
-	private boolean containsInPoint()
-	{
-		return inPoint != 0;
-	}
-
-	private boolean containsOutPoint()
-	{
-		return outPoint != 0;
-	}
-
-	private boolean containsLoopCount()
-	{
-		return loopCount != 0;
-	}
-
-	private boolean containsEnvelopes()
-	{
-		return envelopes != null &amp;&amp; envelopes.size() &gt; 0;
-	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamBlock.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamBlock.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamBlock.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -80,10 +80,10 @@
  */
 public class FSSoundStreamBlock extends FSMovieObject
 {
-	private byte[] soundData = null;
+	private byte[] soundData;
 
 	/**
-	 * Construct an FSSoundStreamBlock object, initalizing it with values
+	 * Construct an FSSoundStreamBlock object, initialising it with values
 	 * decoded from an encoded object.
 	 * 
 	 * @param coder
@@ -101,6 +101,8 @@
 	 * 
 	 * @param bytes
 	 *            an array of bytes containing the sound data.
+	 *            
+	 * @throws NullPointerException if the sound data is null.
 	 */
 	public FSSoundStreamBlock(byte[] bytes)
 	{
@@ -118,7 +120,7 @@
 	public FSSoundStreamBlock(FSSoundStreamBlock obj)
 	{
 		super(obj);
-		soundData = Transform.clone(obj.soundData);
+		soundData = FSMovieObject.copy(obj.soundData);
 	}
 
 	/**
@@ -137,9 +139,14 @@
 	 * 
 	 * @param bytes
 	 *            an array of bytes containing the sound data.
+	 *            
+	 * @throws NullPointerException if the sound data is null.
 	 */
 	public void setSoundData(byte[] bytes)
 	{
+		if (bytes == null) {
+			throw new NullPointerException(&quot;Sound data cannot be null.&quot;);
+		}
 		soundData = bytes;
 	}
 
@@ -147,7 +154,7 @@
 	{
 		FSSoundStreamBlock anObject = (FSSoundStreamBlock) super.clone();
 
-		anObject.soundData = Transform.clone(soundData);
+		anObject.soundData = FSMovieObject.copy(soundData);
 
 		return anObject;
 	}
@@ -160,7 +167,7 @@
 		{
 			FSSoundStreamBlock typedObject = (FSSoundStreamBlock) anObject;
 
-			result = Transform.equals(soundData, typedObject.soundData);
+			result = equals(soundData, typedObject.soundData);
 		}
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamHead.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamHead.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamHead.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -150,26 +150,18 @@
  */
 public class FSSoundStreamHead extends FSMovieObject
 {
-	private int format = FSSound.ADPCM;
+	private int format;
+	private int playbackRate;
+	private int playbackChannels;
+	private int playbackSampleSize;
+	private int streamRate;
+	private int streamChannels;
+	private int streamSampleSize;
+	private int streamSampleCount;
+	private int latency;
 
-	private int playbackRate = 5512;
-
-	private int playbackChannels = 1;
-
-	private int playbackSampleSize = 16;
-
-	private int streamRate = 5512;
-
-	private int streamChannels = 1;
-
-	private int streamSampleSize = 16;
-
-	private int streamSampleCount = 0;
-
-	private int latency = 0;
-
 	/**
-	 * Construct an FSSoundStreamHead object, initalizing it with values decoded
+	 * Construct an FSSoundStreamHead object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -204,14 +196,18 @@
 	 * @param streamingCount
 	 *            the number of samples in each subsequent FSSoundStreamBlock
 	 *            object.
-	 * @param latency
-	 *            defines the number of samples to skip only when playing sounds
-	 *            encoded with the MP3 format.
+	 *           
+	 * @throws IllegalArgumentException if the play back rate is not either 5512, 11025, 22050 or 44100.
+	 * @throws IllegalArgumentException if the number of play back channels is not 1 or 2.
+	 * @throws IllegalArgumentexception if the play back sample size is not either 1 or 2.
+	 * @throws IllegalArgumentException if the stream rate is not either 5512, 11025, 22050 or 44100.
+	 * @throws IllegalArgumentException if the number of stream channels is not 1 or 2.
+	 * @throws IllegalArgumentexception if the stream sample size is not either 1 or 2.
+	 * @throws IllegalArgumentException if the number of sound samples &lt; 0.
 	 */
 	public FSSoundStreamHead(int playRate, int playChannels, int playSize,
 								int streamingRate, int streamingChannels,
-								int streamingSize, int streamingCount,
-								int latency)
+								int streamingSize, int streamingCount)
 	{
 		super(FSMovieObject.SoundStreamHead);
 
@@ -223,7 +219,6 @@
 		setStreamChannels(streamingChannels);
 		setStreamSampleSize(streamingSize);
 		setStreamSampleCount(streamingCount);
-		setLatency(latency);
 	}
 
 	/**
@@ -347,23 +342,33 @@
 	 * Sets the recommended playback rate in Hz. Must be either: 5512, 11025,
 	 * 22050 or 44100.
 	 * 
-	 * @param playRate
+	 * @param rate
 	 *            the recommended rate for playing the sound.
+	 *           
+	 * @throws IllegalArgumentException if the rate is not either 5512, 11025, 22050 or 44100.
 	 */
-	public void setPlaybackRate(int playRate)
+	public void setPlaybackRate(int rate)
 	{
-		playbackRate = playRate;
+		if (rate != 5512 &amp;&amp; rate != 11025 &amp;&amp; rate != 22050 &amp;&amp; rate != 44100) {
+			throw new IllegalArgumentException(&quot;Rate must be one of: 5512, 11025, 22050 or 44100 Hertz.&quot;);
+		}
+		playbackRate = rate;
 	}
 
 	/**
 	 * Sets the recommended number of playback channels = 1 = mono 2 = stereo.
 	 * 
-	 * @param aNumber
+	 * @param channels
 	 *            the recommended number of playback channels.
+	 *           
+	 * @throws IllegalArgumentException if the number of channels is not 1 or 2.
 	 */
-	public void setPlaybackChannels(int aNumber)
+	public void setPlaybackChannels(int channels)
 	{
-		playbackChannels = aNumber;
+		if (channels &lt; 1 || channels &gt; 2) {
+			throw new IllegalArgumentException(&quot;Number of channels must be 1 or 2.&quot;);
+		}
+		playbackChannels = channels;
 	}
 
 	/**
@@ -372,9 +377,14 @@
 	 * 
 	 * @param playSize
 	 *            the recommended sample size for playing the sound.
+	 *           
+	 * @throws IllegalArgumentException if the sample size is not either 1 or 2.
 	 */
 	public void setPlaybackSampleSize(int playSize)
 	{
+		if (playSize &lt; 1 || playSize &gt; 2) {
+			throw new IllegalArgumentException(&quot;Sample size must be 1 or 2 bytes.&quot;);
+		}
 		playbackSampleSize = playSize;
 	}
 
@@ -382,46 +392,66 @@
 	 * Sets the sample rate in Hz for the streaming sound. Must be either: 5512,
 	 * 11025, 22050 or 44100.
 	 * 
-	 * @param streamingRate
+	 * @param rate
 	 *            the rate at which the streaming sound was sampled.
+	 *           
+	 * @throws IllegalArgumentException if the rate is not either 5512, 11025, 22050 or 44100.
 	 */
-	public void setStreamRate(int streamingRate)
+	public void setStreamRate(int rate)
 	{
-		streamRate = streamingRate;
+		if (rate != 5512 &amp;&amp; rate != 11025 &amp;&amp; rate != 22050 &amp;&amp; rate != 44100) {
+			throw new IllegalArgumentException(&quot;Rate must be one of: 5512, 11025, 22050 or 44100 Hertz.&quot;);
+		}
+		streamRate = rate;
 	}
 
 	/**
 	 * Sets the number of channels in the streaming sound: 1 = mono 2 = stereo.
 	 * 
-	 * @param streamingChannels
+	 * @param channels
 	 *            the number of channels in the streaming sound.
+	 *           
+	 * @throws IllegalArgumentException if the number of channels is not 1 or 2.
 	 */
-	public void setStreamChannels(int streamingChannels)
+	public void setStreamChannels(int channels)
 	{
-		streamChannels = streamingChannels;
+		if (channels &lt; 1 || channels &gt; 2) {
+			throw new IllegalArgumentException(&quot;Number of channels must be 1 or 2.&quot;);
+		}
+		streamChannels = channels;
 	}
 
 	/**
 	 * Sets the sample size in bytes for the streaming sound. Must be 1 or 2.
 	 * 
-	 * @param streamingSize
+	 * @param size
 	 *            the sample size for the sound.
+	 *           
+	 * @throws IllegalArgumentException if the sample size is not either 1 or 2.
 	 */
-	public void setStreamSampleSize(int streamingSize)
+	public void setStreamSampleSize(int size)
 	{
-		streamSampleSize = streamingSize;
+		if (size &lt; 1 || size &gt; 2) {
+			throw new IllegalArgumentException(&quot;Sample size must be 1 or 2 bytes.&quot;);
+		}
+		streamSampleSize = size;
 	}
 
 	/**
 	 * Sets the number of samples in each stream block.
 	 * 
-	 * @param streamingCount
+	 * @param count
 	 *            the number of samples in each subsequent FSSoundStreamBlock
 	 *            object.
+	 *            
+	 * @throws IllegalArgumentException if the number of samples is negative.
 	 */
-	public void setStreamSampleCount(int streamingCount)
+	public void setStreamSampleCount(int count)
 	{
-		streamSampleCount = streamingCount;
+		if (count &lt; 0) {
+			throw new IllegalArgumentException(&quot;Number of samples cannot be negative.&quot;);
+		}
+		streamSampleCount = count;
 	}
 
 	/**
@@ -485,7 +515,10 @@
 		buffer.append(&quot;streamChannels = &quot;).append(streamChannels).append(&quot;;&quot;);
 		buffer.append(&quot;streamSampleSize = &quot;).append(streamSampleSize).append(&quot;; &quot;);
 		buffer.append(&quot;streamSampleCount = &quot;).append(streamSampleCount).append(&quot;; &quot;);
-		buffer.append(&quot;latency = &quot;).append(latency).append(&quot;; &quot;);
+		
+		if (format == FSSound.MP3) {
+			buffer.append(&quot;latency = &quot;).append(latency).append(&quot;; &quot;);
+		}
 		buffer.append(&quot;}&quot;);
 		
 		return buffer.toString();

Modified: dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamHead2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamHead2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSSoundStreamHead2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -133,24 +133,16 @@
  */
 public class FSSoundStreamHead2 extends FSMovieObject
 {
-	private int format = FSSound.ADPCM;
+	private int format;
+	private int playbackRate;
+	private int playbackChannels;
+	private int playbackSampleSize;
+	private int streamRate;
+	private int streamChannels;
+	private int streamSampleSize;
+	private int streamSampleCount;
+	private int latency;
 
-	private int playbackRate = 5512;
-
-	private int playbackChannels = 1;
-
-	private int playbackSampleSize = 16;
-
-	private int streamRate = 5512;
-
-	private int streamChannels = 1;
-
-	private int streamSampleSize = 16;
-
-	private int streamSampleCount = 0;
-
-	private int latency = 0;
-
 	/*
 	 * The following variable is used to preserve the value of a reserved field
 	 * when decoding then encoding an existing Flash file. Macromedia's file
@@ -161,7 +153,7 @@
 	private int _reserved = 0;
 
 	/**
-	 * Construct an FSSoundStreamHead2 object, initalizing it with values
+	 * Construct an FSSoundStreamHead2 object, initialising it with values
 	 * decoded from an encoded object.
 	 * 
 	 * @param coder
@@ -200,28 +192,30 @@
 	 * @param streamingCount
 	 *            the number of samples in each subsequent FSSoundStreamBlock
 	 *            object.
-	 * @param latency
-	 *            defines the number of samples to skip only when playing sounds
-	 *            encoded with the MP3 format.
+	 *           
+	 * @throws IllegalArgumentException if the play back rate is not either 5512, 11025, 22050 or 44100.
+	 * @throws IllegalArgumentException if the number of play back channels is not 1 or 2.
+	 * @throws IllegalArgumentexception if the play back sample size is not either 1 or 2.
+	 * @throws IllegalArgumentException if the stream rate is not either 5512, 11025, 22050 or 44100.
+	 * @throws IllegalArgumentException if the number of stream channels is not 1 or 2.
+	 * @throws IllegalArgumentexception if the stream sample size is not either 1 or 2.
+	 * @throws IllegalArgumentException if the number of sound samples &lt; 0.
 	 */
 	public FSSoundStreamHead2(int encoding, int playRate, int playChannels,
 								int playSize, int streamingRate,
 								int streamingChannels, int streamingSize,
-								int streamingCount, int latency)
+								int streamingCount)
 	{
 		super(SoundStreamHead2);
 
 		setFormat(encoding);
-
 		setPlaybackRate(playRate);
 		setPlaybackChannels(playChannels);
 		setPlaybackSampleSize(playSize);
-
 		setStreamRate(streamingRate);
 		setStreamChannels(streamingChannels);
 		setStreamSampleSize(streamingSize);
 		setStreamSampleCount(streamingCount);
-		setLatency(latency);
 	}
 
 	/**
@@ -347,23 +341,33 @@
 	 * Sets the recommended playback rate in Hz. Must be either: 5512, 11025,
 	 * 22050 or 44100.
 	 * 
-	 * @param playRate
+	 * @param rate
 	 *            the recommended rate for playing the sound.
+	 *           
+	 * @throws IllegalArgumentException if the rate is not either 5512, 11025, 22050 or 44100.
 	 */
-	public void setPlaybackRate(int playRate)
+	public void setPlaybackRate(int rate)
 	{
-		playbackRate = playRate;
+		if (rate != 5512 &amp;&amp; rate != 11025 &amp;&amp; rate != 22050 &amp;&amp; rate != 44100) {
+			throw new IllegalArgumentException(&quot;Rate must be one of: 5512, 11025, 22050 or 44100 Hertz.&quot;);
+		}
+		playbackRate = rate;
 	}
 
 	/**
 	 * Sets the recommended number of playback channels = 1 = mono 2 = stereo.
 	 * 
-	 * @param aNumber
+	 * @param channels
 	 *            the recommended number of playback channels.
+	 *           
+	 * @throws IllegalArgumentException if the number of channels is not 1 or 2.
 	 */
-	public void setPlaybackChannels(int aNumber)
+	public void setPlaybackChannels(int channels)
 	{
-		playbackChannels = aNumber;
+		if (channels &lt; 1 || channels &gt; 2) {
+			throw new IllegalArgumentException(&quot;Number of channels must be 1 or 2.&quot;);
+		}
+		playbackChannels = channels;
 	}
 
 	/**
@@ -372,9 +376,14 @@
 	 * 
 	 * @param playSize
 	 *            the recommended sample size for playing the sound.
+	 *           
+	 * @throws IllegalArgumentException if the sample size is not either 1 or 2.
 	 */
 	public void setPlaybackSampleSize(int playSize)
 	{
+		if (playSize &lt; 1 || playSize &gt; 2) {
+			throw new IllegalArgumentException(&quot;Sample size must be 1 or 2 bytes.&quot;);
+		}
 		playbackSampleSize = playSize;
 	}
 
@@ -382,46 +391,66 @@
 	 * Sets the sample rate in Hz for the streaming sound. Must be either: 5512,
 	 * 11025, 22050 or 44100.
 	 * 
-	 * @param streamingRate
+	 * @param rate
 	 *            the rate at which the streaming sound was sampled.
+	 *           
+	 * @throws IllegalArgumentException if the rate is not either 5512, 11025, 22050 or 44100.
 	 */
-	public void setStreamRate(int streamingRate)
+	public void setStreamRate(int rate)
 	{
-		streamRate = streamingRate;
+		if (rate != 5512 &amp;&amp; rate != 11025 &amp;&amp; rate != 22050 &amp;&amp; rate != 44100) {
+			throw new IllegalArgumentException(&quot;Rate must be one of: 5512, 11025, 22050 or 44100 Hertz.&quot;);
+		}
+		streamRate = rate;
 	}
 
 	/**
 	 * Sets the number of channels in the streaming sound: 1 = mono 2 = stereo.
 	 * 
-	 * @param streamingChannels
+	 * @param channels
 	 *            the number of channels in the streaming sound.
+	 *           
+	 * @throws IllegalArgumentException if the number of channels is not 1 or 2.
 	 */
-	public void setStreamChannels(int streamingChannels)
+	public void setStreamChannels(int channels)
 	{
-		streamChannels = streamingChannels;
+		if (channels &lt; 1 || channels &gt; 2) {
+			throw new IllegalArgumentException(&quot;Number of channels must be 1 or 2.&quot;);
+		}
+		streamChannels = channels;
 	}
 
 	/**
 	 * Sets the sample size in bytes for the streaming sound. Must be 1 or 2.
 	 * 
-	 * @param streamingSize
+	 * @param size
 	 *            the sample size for the sound.
+	 *           
+	 * @throws IllegalArgumentException if the sample size is not either 1 or 2.
 	 */
-	public void setStreamSampleSize(int streamingSize)
+	public void setStreamSampleSize(int size)
 	{
-		streamSampleSize = streamingSize;
+		if (size &lt; 1 || size &gt; 2) {
+			throw new IllegalArgumentException(&quot;Sample size must be 1 or 2 bytes.&quot;);
+		}
+		streamSampleSize = size;
 	}
 
 	/**
 	 * Sets the number of samples in each stream block.
 	 * 
-	 * @param streamingCount
+	 * @param count
 	 *            the number of samples in each subsequent FSSoundStreamBlock
 	 *            object.
+	 *            
+	 * @throws IllegalArgumentException if the number of samples is negative.
 	 */
-	public void setStreamSampleCount(int streamingCount)
+	public void setStreamSampleCount(int count)
 	{
-		streamSampleCount = streamingCount;
+		if (count &lt; 0) {
+			throw new IllegalArgumentException(&quot;Number of samples cannot be negative.&quot;);
+		}
+		streamSampleCount = count;
 	}
 
 	/**
@@ -465,8 +494,7 @@
 			result = result &amp;&amp; streamRate == typedObject.streamRate;
 			result = result &amp;&amp; streamChannels == typedObject.streamChannels;
 			result = result &amp;&amp; streamSampleSize == typedObject.streamSampleSize;
-			result = result
-							&amp;&amp; streamSampleCount == typedObject.streamSampleCount;
+			result = result &amp;&amp; streamSampleCount == typedObject.streamSampleCount;
 			result = result &amp;&amp; latency == typedObject.latency;
 		}
 		return result;
@@ -485,7 +513,10 @@
 		buffer.append(&quot;streamChannels = &quot;).append(streamChannels).append(&quot;;&quot;);
 		buffer.append(&quot;streamSampleSize = &quot;).append(streamSampleSize).append(&quot;; &quot;);
 		buffer.append(&quot;streamSampleCount = &quot;).append(streamSampleCount).append(&quot;; &quot;);
-		buffer.append(&quot;latency = &quot;).append(latency).append(&quot;; &quot;);
+
+		if (format == FSSound.MP3) {
+			buffer.append(&quot;latency = &quot;).append(latency).append(&quot;; &quot;);
+		}
 		buffer.append(&quot;}&quot;);
 
 		return buffer.toString();

Modified: dev/dev-2-4/src/com/flagstone/transform/FSStartSound.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSStartSound.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSStartSound.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -67,10 +67,10 @@
  */
 public class FSStartSound extends FSMovieObject
 {
-	private FSSound sound = null;
+	private FSSound sound;
 
 	/**
-	 * Construct an FSStartSound object, initalizing it with values decoded from
+	 * Construct an FSStartSound object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -88,6 +88,8 @@
 	 * 
 	 * @param aSound
 	 *            the FSSound object.
+	 * 
+	 * @throws NullPointerException if the sound is null.
 	 */
 	public FSStartSound(FSSound aSound)
 	{
@@ -123,9 +125,14 @@
 	 * 
 	 * @param aSound
 	 *            the FSSound object that controls how the sound is played.
+	 * 
+	 * @throws NullPointerException if the sound is null.
 	 */
 	public void setSound(FSSound aSound)
 	{
+		if (aSound == null) {
+			throw new NullPointerException(&quot;Sound cannot be null.&quot;);
+		}
 		sound = aSound;
 	}
 
@@ -133,7 +140,7 @@
 	{
 		FSStartSound anObject = (FSStartSound) super.clone();
 
-		anObject.sound = (sound != null) ? (FSSound) sound.clone() : null;
+		anObject.sound = (FSSound) sound.clone();
 
 		return anObject;
 	}
@@ -146,10 +153,7 @@
 		{
 			FSStartSound typedObject = (FSStartSound) anObject;
 
-			if (sound != null)
-				result = sound.equals(typedObject.sound);
-			else
-				result = sound == typedObject.sound;
+			result = sound.equals(typedObject.sound);
 		}
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSTabOrder.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSTabOrder.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSTabOrder.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -67,8 +67,8 @@
  */
 public class FSTabOrder extends FSMovieObject
 {
-	private int layer = 0;
-	private int index = 0;
+	private int layer;
+	private int index;
 
 	/**
 	 * Construct an FSTabOrder object, initializing it with values decoded from
@@ -92,6 +92,9 @@
 	 *            tabbing order.
 	 * @param index
 	 *            the index of the object in the tabbing order.
+	 *            
+	 * @throws IllegalArgumentException if the layer is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the index is not in the range 0..65535.
 	 */
 	public FSTabOrder(int layer, int index)
 	{
@@ -132,9 +135,14 @@
 	 * 
 	 * @param layer
 	 *            the layer number.
+	 *            
+	 * @throws IllegalArgumentException if the layer number is not in the range 1..65535.
 	 */
 	public void setLayer(int layer)
 	{
+		if (layer &lt; 1 || layer &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Layer must be in the range 1..65535.&quot;);
+		}
 		this.layer = layer;
 	}
 
@@ -153,9 +161,14 @@
 	 * 
 	 * @param index
 	 *            the index in the tabbing order.
+	 *            
+	 * @throws IllegalArgumentException if the index is not in the range 1..65535.
 	 */
 	public void setIndex(int index)
 	{
+		if (index &lt; 0 || index &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Index must be in the range 0..65535.&quot;);
+		}
 		this.index = index;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSTable.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSTable.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSTable.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -121,10 +121,10 @@
  */
 public class FSTable extends FSActionObject
 {
-	private ArrayList values = null;
+	private ArrayList&lt;String&gt; values;
 
 	/**
-	 * Construct an FSTable object, initalizing it with values decoded from an
+	 * Construct an FSTable object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -136,7 +136,9 @@
 		decode(coder, context);
 	}
 
-	/** Constructs an empty table. */
+	/** 
+	 * Constructs an empty table. 
+	 */
 	public FSTable()
 	{
 		super(Table);
@@ -147,8 +149,10 @@
 	 * 
 	 * @param anArray
 	 *            of Strings that will be added to the table.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public FSTable(ArrayList anArray)
+	public FSTable(ArrayList&lt;String&gt; anArray)
 	{
 		super(Table);
 		setValues(anArray);
@@ -162,11 +166,11 @@
 	 */
 	public FSTable(FSTable obj)
 	{
-		super(obj);
+		super(Table);
 
-		values = new ArrayList(obj.values.size());
+		values = new ArrayList&lt;String&gt;(obj.values.size());
 
-		for (Iterator i = obj.values.iterator(); i.hasNext();)
+		for (Iterator&lt;String&gt; i = obj.values.iterator(); i.hasNext();)
 			values.add(new String((String) i.next()));
 	}
 
@@ -175,6 +179,8 @@
 	 * 
 	 * @param aString
 	 *            a String that will be added to the end of the table.
+	 * 
+	 * @throws NullPointerException if the string is null.
 	 */
 	public void add(String aString)
 	{
@@ -186,7 +192,7 @@
 	 * 
 	 * @return the array of string literals.
 	 */
-	public ArrayList getValues()
+	public ArrayList&lt;String&gt; getValues()
 	{
 		return values;
 	}
@@ -196,9 +202,14 @@
 	 * 
 	 * @param anArray
 	 *            of Strings that will replaces the existing literal table.
+	 * 
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setValues(ArrayList anArray)
+	public void setValues(ArrayList&lt;String&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array cannot be null.&quot;);
+		}
 		values = anArray;
 	}
 
@@ -206,9 +217,9 @@
 	{
 		FSTable anObject = (FSTable) super.clone();
 
-		anObject.values = new ArrayList();
+		anObject.values = new ArrayList&lt;String&gt;();
 
-		for (Iterator i = values.iterator(); i.hasNext();)
+		for (Iterator&lt;String&gt; i = values.iterator(); i.hasNext();)
 			anObject.values.add(new String((String) i.next()));
 
 		return anObject;
@@ -241,7 +252,7 @@
 
 		length += 2;
 
-		for (Iterator i = values.iterator(); i.hasNext();)
+		for (Iterator&lt;String&gt; i = values.iterator(); i.hasNext();)
 			length += FSCoder.strlen((String) i.next(), true);
 
 		return length;
@@ -255,7 +266,7 @@
 
 		if (values.size() &gt; 0)
 		{
-			for (Iterator i = values.iterator(); i.hasNext();)
+			for (Iterator&lt;String&gt; i = values.iterator(); i.hasNext();)
 			{
 				coder.writeString((String) i.next());
 				coder.writeWord(0, 1);
@@ -271,18 +282,19 @@
 
 		if (attributeCount &gt; 0)
 		{
-			values = new ArrayList();
+			values = new ArrayList&lt;String&gt;();
 
 			for (int i = 0; i &lt; attributeCount; i++)
 				values.add(coder.readString());
-		} else
+		} 
+		else
 		{
 			/*
 			 * Reset the length as Macromedia is using the length of a table to
 			 * hide coded following an empty table.
 			 */
 			length = 2;
-			values = new ArrayList();
+			values = new ArrayList&lt;String&gt;();
 		}
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/FSTableIndex.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSTableIndex.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSTableIndex.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -90,7 +90,7 @@
  */
 public class FSTableIndex
 {
-	private int index = 0;
+	private int index;
 
 	/**
 	 * Constructs an FSTableIndex object referencing the value stored in the
@@ -98,6 +98,8 @@
 	 * 
 	 * @param anIndex
 	 *            the index into the literal table.
+	 *            
+	 * @throws IllegalArgumentException if the index is not in the range 0..65535.
 	 */
 	public FSTableIndex(int anIndex)
 	{
@@ -131,9 +133,14 @@
 	 * 
 	 * @param anIndex
 	 *            the index into the literal table.
+	 *            
+	 * @throws IllegalArgumentException if the index is not in the range 0..65535.
 	 */
 	public void setIndex(int anIndex)
 	{
+		if (anIndex &lt; 0 || anIndex &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Index must be in the range 0..65535&quot;);
+		}
 		index = anIndex;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSText.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSText.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSText.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -243,20 +243,16 @@
 
 	// End Flash 6
 
-	private int identifier = 0;
+	private int identifier;
+	private FSColor color;
+	private int offsetX;
+	private int offsetY;
+	private int height;
 
-	private FSColor color = null;
+	private ArrayList&lt;FSCharacter&gt; characters;
 
-	private int offsetX = Transform.VALUE_NOT_SET;
-
-	private int offsetY = Transform.VALUE_NOT_SET;
-
-	private int height = 0;
-
-	private ArrayList characters = new ArrayList();
-
 	/**
-	 * Construct an FSText object, initalizing it with values decoded from an
+	 * Construct an FSText object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -267,6 +263,7 @@
 		decode(coder, context);
 	}
 
+	// TODO check constructors to see if any can be removed or restructured.
 	/**
 	 * Constructs an FSText object specifying the array of characters to be
 	 * displayed and their relative placement within a block of text. The
@@ -281,8 +278,12 @@
 	 *            bounding rectangle enclosing the block of text.
 	 * @param anArray
 	 *            an array of FSCharacter objects.
+	 *  
+	 * @throws IllegalArgumentException if the x and y offsets are outside the 
+	 * range -32768..32767.
+	 * @throws NullPointerException if the character array is null.
 	 */
-	public FSText(int xOffset, int yOffset, ArrayList anArray)
+	public FSText(int xOffset, int yOffset, ArrayList&lt;FSCharacter&gt; anArray)
 	{
 		setOffsetX(xOffset);
 		setOffsetY(yOffset);
@@ -307,9 +308,15 @@
 	 *            the height of the text in the chosen font.
 	 * @param anArray
 	 *            an array of FSCharacter objects.
+	 *            
+	 * @throws IllegalArgumentException if the font identifier is outside the range 1..65535.
+	 * @throws IllegalArgumentException if the x and y offsets are outside the 
+	 * range -32768..32767.
+	 * @throws IllegalArgumentException if the font height is outside the range 0..65535.
+	 * @throws NullPointerException if the character array is null.
 	 */
 	public FSText(int anIdentifier, FSColor aColor, int xOffset, int yOffset,
-					int aHeight, ArrayList anArray)
+					int aHeight, ArrayList&lt;FSCharacter&gt; anArray)
 	{
 		setIdentifier(anIdentifier);
 		setColor(aColor);
@@ -333,10 +340,11 @@
 		offsetY = obj.offsetY;
 		height = obj.height;
 
-		characters = new ArrayList(obj.characters.size());
+		characters = new ArrayList&lt;FSCharacter&gt;(obj.characters.size());
 
-		for (Iterator&lt;FSCharacter&gt; i = obj.characters.iterator(); i.hasNext();)
-			characters.add(i.next().clone());
+		for (Iterator&lt;FSCharacter&gt; i = obj.characters.iterator(); i.hasNext();) {
+			characters.add((FSCharacter)i.next().clone());			
+		}
 	}
 
 	/**
@@ -397,9 +405,14 @@
 	 * 
 	 * @param anIdentifier
 	 *            the identifier of the font that the text will be rendered in.
+	 *            
+	 * @throws IllegalArgumentException if the font identifier is outside the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier for font must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -418,26 +431,36 @@
 	 * Sets the location of the start of the text relative to the left edge of
 	 * the bounding rectangle in twips.
 	 * 
-	 * @param xOffset
+	 * @param offset
 	 *            the location of the text relative to the left edge of the
 	 *            bounding rectangle enclosing the text.
+	 *  
+	 * @throws IllegalArgumentException if the offset is outside the range -32768..32767.
 	 */
-	public void setOffsetX(int xOffset)
+	public void setOffsetX(int offset)
 	{
-		offsetX = xOffset;
+		if (offset &lt; -32768 || offset &gt; 32767) {
+			throw new IllegalArgumentException(&quot;Offset must be in the range -32768..32767.&quot;);
+		}
+		offsetX = offset;
 	}
 
 	/**
 	 * Sets the location of the start of the text relative to the bottom edge of
 	 * the bounding rectangle in twips.
 	 * 
-	 * @param yOffset
+	 * @param offset
 	 *            the location of the text relative to the bottom edge of the
 	 *            bounding rectangle enclosing the text.
+	 *  
+	 * @throws IllegalArgumentException if the offset is outside the range -32768..32767.
 	 */
-	public void setOffsetY(int yOffset)
+	public void setOffsetY(int offset)
 	{
-		offsetY = yOffset;
+		if (offset &lt; -32768 || offset &gt; 32767) {
+			throw new IllegalArgumentException(&quot;Offset must be in the range -32768..32767.&quot;);
+		}
+		offsetY = offset;
 	}
 
 	/**
@@ -445,9 +468,14 @@
 	 * 
 	 * @param aHeight
 	 *            the height of the text in the chosen font.
+	 *            
+	 * @throws IllegalArgumentException if the font height is outside the range 0..65535.
 	 */
 	public void setHeight(int aHeight)
 	{
+		if (aHeight &lt; 0 || aHeight &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Offset must be in the range 0..65535.&quot;);
+		}
 		height = aHeight;
 	}
 
@@ -467,7 +495,7 @@
 	 * 
 	 * @return the array of FSCharacter objects.
 	 */
-	public ArrayList getCharacters()
+	public ArrayList&lt;FSCharacter&gt; getCharacters()
 	{
 		return characters;
 	}
@@ -477,9 +505,14 @@
 	 * 
 	 * @param anArray
 	 *            an array of FSCharacter objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setCharacters(ArrayList anArray)
+	public void setCharacters(ArrayList&lt;FSCharacter&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array of characters cannot be null.&quot;);
+		}
 		characters = anArray;
 	}
 
@@ -487,10 +520,8 @@
 	{
 		int numberOfBits = 0;
 
-		for (Iterator charIter = characters.iterator(); charIter.hasNext();)
-			numberOfBits = Math.max(numberOfBits, FSCoder.size(
-							((FSCharacter) charIter.next()).getGlyphIndex(),
-							false));
+		for (Iterator&lt;FSCharacter&gt; i = characters.iterator(); i.hasNext();)
+			numberOfBits = Math.max(numberOfBits, FSCoder.size(i.next().getGlyphIndex(), false));
 
 		return numberOfBits;
 	}
@@ -499,16 +530,8 @@
 	{
 		int numberOfBits = 0;
 
-		for (Iterator charIter = characters.iterator(); charIter.hasNext();)
-			numberOfBits = Math
-							.max(
-											numberOfBits,
-											FSCoder
-															.size(
-																			((FSCharacter) charIter
-																							.next())
-																							.getAdvance(),
-																			true));
+		for (Iterator&lt;FSCharacter&gt; i = characters.iterator(); i.hasNext();)
+			numberOfBits = Math.max(numberOfBits, FSCoder.size(i.next().getAdvance(),true));
 
 		return numberOfBits;
 	}
@@ -521,11 +544,10 @@
 			anObject = (FSText) super.clone();
 
 			anObject.color = (color != null) ? (FSColor) color.clone() : null;
+			anObject.characters = new ArrayList&lt;FSCharacter&gt;();
 
-			anObject.characters = new ArrayList();
-
-			for (Iterator i = characters.iterator(); i.hasNext();)
-				anObject.characters.add(((FSCharacter) i.next()).clone());
+			for (Iterator&lt;FSCharacter&gt; i = characters.iterator(); i.hasNext();)
+				anObject.characters.add((FSCharacter) i.next().clone());
 		} 
 		catch (CloneNotSupportedException e) {
 			throw new InternalError();
@@ -551,11 +573,7 @@
 			result = result &amp;&amp; offsetX == typedObject.offsetX;
 			result = result &amp;&amp; offsetY == typedObject.offsetY;
 			result = result &amp;&amp; height == typedObject.height;
-
-			if (characters != null)
-				result = characters.equals(typedObject.characters);
-			else
-				result = characters == typedObject.characters;
+			result = characters.equals(typedObject.characters);
 		}
 		return result;
 	}
@@ -566,7 +584,10 @@
 
 		buffer.append(&quot;FSText: { &quot;);
 		buffer.append(&quot;identifier = &quot;).append(identifier).append(&quot;; &quot;);
-		buffer.append(&quot;color = &quot;).append(color.toString()).append(&quot;; &quot;);
+		
+		if (color != null) {
+			buffer.append(&quot;color = &quot;).append(color.toString()).append(&quot;; &quot;);
+		}
 		buffer.append(&quot;offsetX = &quot;).append(offsetX).append(&quot;; &quot;);
 		buffer.append(&quot;offsetY = &quot;).append(offsetY).append(&quot;; &quot;);
 		buffer.append(&quot;height = &quot;).append(height).append(&quot;; &quot;);
@@ -676,7 +697,7 @@
 
 		int charCount = coder.readByte();
 
-		characters = new ArrayList(charCount);
+		characters = new ArrayList&lt;FSCharacter&gt;(charCount);
 
 		for (int i = 0; i &lt; charCount; i++)
 			characters.add(new FSCharacter(coder, context));

Modified: dev/dev-2-4/src/com/flagstone/transform/FSUnknownAction.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSUnknownAction.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSUnknownAction.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -68,7 +68,7 @@
 	private byte[] data;
 
 	/**
-	 * Construct an FSUnknownAction object, initalising it with values decoded
+	 * Construct an FSUnknownAction object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder

Modified: dev/dev-2-4/src/com/flagstone/transform/FSUnknownObject.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSUnknownObject.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSUnknownObject.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -68,7 +68,7 @@
 	private byte[] data;
 
 	/**
-	 * Construct an FSUnknownObject object, initalising it with values decoded
+	 * Construct an FSUnknownObject object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder

Modified: dev/dev-2-4/src/com/flagstone/transform/FSVideo.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSVideo.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSVideo.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -121,17 +121,18 @@
 		return currentObject;
 	}
 
-	private String signature = &quot;FLV&quot;;
+	private String signature;
+	private int version;
+	private ArrayList&lt;FSVideoObject&gt; objects;
 
-	private int version = 1;
-
-	private ArrayList objects = new ArrayList();
-
 	/**
 	 * Constructs an FSVideo object with no objects.
 	 */
 	public FSVideo()
 	{
+		signature = &quot;FLV&quot;;
+		version = 1;
+		objects = new ArrayList&lt;FSVideoObject&gt;();
 	}
 
 	/**
@@ -201,7 +202,7 @@
 	 * 
 	 * @return the array of objects.
 	 */
-	public ArrayList getObjects()
+	public ArrayList&lt;FSVideoObject&gt; getObjects()
 	{
 		return objects;
 	}
@@ -211,9 +212,14 @@
 	 * 
 	 * @param anArray
 	 *            the array of objects that describe a coder.
+	 *          
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setObjects(ArrayList anArray)
+	public void setObjects(ArrayList&lt;FSVideoObject&gt; anArray)
 	{
+		if (anArray == null) {
+			throw new NullPointerException(&quot;Array cannot be null.&quot;);
+		}
 		objects = anArray;
 	}
 
@@ -222,9 +228,14 @@
 	 * 
 	 * @param anObject
 	 *            the object to be added to the coder.
+	 *          
+	 * @throws NullPointerException if the object is null.
 	 */
 	public void add(FSVideoObject anObject)
 	{
+		if (anObject == null) {
+			throw new NullPointerException(&quot;Object cannot be null.&quot;);
+		}
 		objects.add(anObject);
 	}
 
@@ -234,9 +245,14 @@
 	 * @param array
 	 *            an array of FSVideoObjects that will be added to the video in
 	 *            the order they are in the array.
+	 *          
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void add(ArrayList array)
+	public void add(ArrayList&lt;FSVideoObject&gt; array)
 	{
+		if (array == null) {
+			throw new NullPointerException(&quot;Array cannot be null.&quot;);
+		}
 		objects.addAll(array);
 	}
 
@@ -291,23 +307,21 @@
 	{
 		FSCoder coder = new FSCoder(FSCoder.BIG_ENDIAN, bytes);
 		FSContext context = new FSContext();
-		FSVideoObject object = null;
 
-		boolean containsAudio = false;
-		boolean containsVideo = false;
-
 		isFlashVideo(bytes);
 
 		signature = coder.readString(3, &quot;UTF8&quot;);
 		version = coder.readByte();
 		coder.readBits(5, false);
-		containsAudio = coder.readBits(1, false) != 0;
+		coder.readBits(1, false); // contains audio
 		coder.readBits(1, false);
-		containsVideo = coder.readBits(1, false) != 0;
+		coder.readBits(1, false); // contains videos
+		
+		coder.readWord(4, false); // header length always 9
+		coder.readWord(4, false); // previous length
 
-		int offset = coder.readWord(4, false);
-		offset = coder.readWord(4, false);
-
+		objects = new ArrayList&lt;FSVideoObject&gt;();
+		
 		do
 		{
 			objects.add(decodeObject(coder, context));
@@ -315,7 +329,7 @@
 			if (context.delta != 0)
 				throw new IOException();
 
-			offset = coder.readWord(4, false);
+			coder.readWord(4, false); // previous length
 
 		} while (!coder.eof());
 	}
@@ -366,7 +380,7 @@
 		boolean containsAudio = false;
 		boolean containsVideo = false;
 
-		for (Iterator i = objects.iterator(); i.hasNext();)
+		for (Iterator&lt;FSVideoObject&gt; i = objects.iterator(); i.hasNext();)
 		{
 			int type = ((FSVideoObject) (i.next())).getType();
 
@@ -404,11 +418,12 @@
 		{
 			anObject = (FSVideo) super.clone();
 
-			anObject.objects = new ArrayList();
+			anObject.objects = new ArrayList&lt;FSVideoObject&gt;();
 
-			for (Iterator i = objects.iterator(); i.hasNext();)
-				anObject.objects.add(((FSVideoObject) i.next()).clone());
-		} catch (CloneNotSupportedException e)
+			for (Iterator&lt;FSVideoObject&gt; i = objects.iterator(); i.hasNext();)
+				anObject.objects.add((FSVideoObject) i.next().clone());
+		} 
+		catch (CloneNotSupportedException e)
 		{
 			throw new InternalError();
 		}
@@ -433,34 +448,11 @@
 			FSVideo typedObject = (FSVideo) anObject;
 
 			result = version == typedObject.version;
-			result = result
-							&amp;&amp; objects
-											.equals(((FSVideo) anObject)
-															.getObjects());
+			result = result &amp;&amp; objects.equals(typedObject.getObjects());
 		}
 		return result;
 	}
 
-	/**
-	 * AppendDescription is used to present a string description of the object
-	 * including all nested objects up to a specified depth.
-	 * 
-	 * The representation of the object is appended to the StringBuffer, showing
-	 * the name of the class and values of the attributes it contains. If the
-	 * object contains any attributes that are objects then the object graph
-	 * will be traversed up to the specified depth. If objects are nested at a
-	 * level less than specified depth then the full string representation of
-	 * the object is displayed. For objects at the specified depth only the name
-	 * of the class is displayed. Any objects below this depth are not
-	 * displayed.
-	 * 
-	 * @param buffer
-	 *            a StringBuffer to which the description of each object is
-	 *            appended.
-	 * @param depth
-	 *            the maximum level of nesting up to which objects will be
-	 *            displayed.
-	 */
 	public String toString()
 	{
 		StringBuffer buffer = new StringBuffer();
@@ -478,9 +470,8 @@
 	{
 		int length = 13;
 
-		for (Iterator i = objects.iterator(); i.hasNext();)
-		{
-			length += 4 + ((FSVideoObject) (i.next())).length(context);
+		for (Iterator&lt;FSVideoObject&gt; i=objects.iterator(); i.hasNext();) {
+			length += 4 + i.next().length(context);
 		}
 		return length;
 	}
@@ -490,8 +481,7 @@
 		if (bytes == null || bytes.length &lt; 8)
 			throw new DataFormatException();
 
-		boolean isFlashVideo = bytes[0] == 0x46 &amp;&amp; bytes[1] == 0x4C
-						&amp;&amp; bytes[2] == 0x56;
+		boolean isFlashVideo = bytes[0] == 0x46 &amp;&amp; bytes[1] == 0x4C &amp;&amp; bytes[2] == 0x56;
 
 		if (isFlashVideo == false)
 			throw new DataFormatException();

Modified: dev/dev-2-4/src/com/flagstone/transform/FSVideoData.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSVideoData.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSVideoData.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -75,12 +75,10 @@
  */
 public final class FSVideoData extends FSVideoObject
 {
-	private int codec = 0;
+	private int codec;
+	private int frameType;
+	private byte[] data;
 
-	private int frameType = 0;
-
-	private byte[] data = null;
-
 	FSVideoData(FSCoder coder, FSContext context)
 	{
 		super(FSVideoObject.VideoData, 0);
@@ -200,7 +198,7 @@
 	{
 		FSVideoData anObject = (FSVideoData) super.clone();
 
-		anObject.data = Transform.clone(data);
+		anObject.data = FSMovieObject.copy(data);
 
 		return anObject;
 	}
@@ -217,7 +215,7 @@
 			result = result &amp;&amp; frameType == typedObject.frameType;
 
 			if (data != null)
-				result = result &amp;&amp; Transform.equals(data, typedObject.data);
+				result = result &amp;&amp; equals(data, typedObject.data);
 			else
 				result = result &amp;&amp; typedObject.data == null;
 		}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSVideoFrame.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSVideoFrame.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSVideoFrame.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -83,14 +83,12 @@
  */
 public class FSVideoFrame extends FSMovieObject
 {
-	private int identifier = 0;
+	private int identifier;
+	private int frameNumber;
+	private byte[] data;
 
-	private int frameNumber = 0;
-
-	private byte[] data = null;
-
 	/**
-	 * Construct an FSVideoFrame object, initalizing it with values decoded from
+	 * Construct an FSVideoFrame object, initialising it with values decoded from
 	 * an encoded object.
 	 * 
 	 * @param coder
@@ -114,6 +112,10 @@
 	 * @param data
 	 *            the encoded video data. For Flash 6 this is encoded in the
 	 *            H263 format. In Flash 7 H263 and ScreenVideo is supported.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is outside the range 1..65535.
+	 * @throws IllegalArgumentException if the frame number is outside the range 1..65535.
+	 * @throw NullPointerException if the video data is null.
 	 */
 	public FSVideoFrame(int anIdentifier, int frameNumber, byte[] data)
 	{
@@ -136,7 +138,7 @@
 		identifier = obj.identifier;
 		frameNumber = obj.frameNumber;
 
-		data = Transform.clone(obj.data);
+		data = FSMovieObject.copy(obj.data);
 	}
 
 	/**
@@ -156,9 +158,14 @@
 	 * 
 	 * @param anIdentifier
 	 *            the unique identifier of the FSDefineVideo object.
+	 *            
+	 * @throws IllegalArgumentException if the identifier is outside the range 1..65535.
 	 */
 	public void setIdentifier(int anIdentifier)
 	{
+		if (anIdentifier &lt; 1 || anIdentifier &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Identifier for video must be in the range 1..65535.&quot;);
+		}
 		identifier = anIdentifier;
 	}
 
@@ -177,9 +184,14 @@
 	 * 
 	 * @param number
 	 *            the frame number.
+	 *
+	 * @throws IllegalArgumentException if the frame number is outside the range 1..65535.
 	 */
 	public void setFrameNumber(int number)
 	{
+		if (number &lt; 1 || number &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Frame number must be in the range 1..65535.&quot;);
+		}
 		frameNumber = number;
 	}
 
@@ -200,16 +212,21 @@
 	 * 
 	 * @param data
 	 *            the encoded video data.
+	 *            
+	 * @throw NullPointerException if the video data is null.
 	 */
 	public void setData(byte[] data)
 	{
+		if (data == null) {
+			throw new NullPointerException(&quot;Video data cannot be null.&quot;);
+		}
 		this.data = data;
 	}
 
 	public Object clone()
 	{
 		FSVideoFrame anObject = (FSVideoFrame) super.clone();
-
+		anObject.data = FSMovieObject.copy(data);
 		return anObject;
 	}
 
@@ -223,11 +240,7 @@
 
 			result = identifier == typedObject.identifier;
 			result = result &amp;&amp; frameNumber == typedObject.frameNumber;
-
-			if (data != null)
-				result = result &amp;&amp; Transform.equals(data, typedObject.data);
-			else
-				result = result &amp;&amp; typedObject.data == null;
+			result = result &amp;&amp; equals(data, typedObject.data);
 		}
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSVideoMetaData.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSVideoMetaData.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSVideoMetaData.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -30,7 +30,7 @@
 package com.flagstone.transform;
 
 /**
- * The FSVideoMetaData class is used to store infromation on how the video
+ * The FSVideoMetaData class is used to store information on how the video
  * stream should be displayed.
  * 
  * Although meta-data can be found in all flash Video files there is no
@@ -48,6 +48,20 @@
 	}
 
 	/**
+	 * Constructs a new FSVideoMetaData object with the encoded data).
+	 * 
+	 * @param data
+	 *            an array of bytes containing the encoded meta-data.
+	 *            
+	 * @throws NullPointerException if the encoded meta-data is null.
+	 */
+	public FSVideoMetaData(byte[] data)
+	{
+		super(FSVideoObject.MetaData, 0);
+		setData(data);
+	}
+
+	/**
 	 * Get the encoded meta data that describes how the video stream should be
 	 * played.
 	 * 
@@ -64,16 +78,21 @@
 	 * 
 	 * @param data
 	 *            an array of bytes containing the encoded meta-data.
+	 *            
+	 * @throws NullPointerException if the encoded meta-data is null.
 	 */
 	public void setData(byte[] data)
 	{
+		if (data == null) {
+			throw new NullPointerException(&quot;Encoded meta-data cannot be null.&quot;);
+		}
 		this.data = data;
 	}
 
 	public Object clone()
 	{
 		FSVideoMetaData anObject = (FSVideoMetaData) super.clone();
-
+		anObject.data = FSMovieObject.copy(data);
 		return anObject;
 	}
 
@@ -84,11 +103,7 @@
 		if (super.equals(anObject))
 		{
 			FSVideoMetaData typedObject = (FSVideoMetaData) anObject;
-
-			if (data != null)
-				result = result &amp;&amp; Transform.equals(data, typedObject.data);
-			else
-				result = result &amp;&amp; typedObject.data == null;
+			result = result &amp;&amp; equals(data, typedObject.data);
 		}
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSVideoObject.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSVideoObject.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSVideoObject.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -73,6 +73,54 @@
 		coder.writeWord(length + 11, 4);
 	}
 
+	/**
+	 * Compares two arrays of bytes. The arrays are considered equal if 
+	 * both are null, both are references to the same array or if both arrays
+	 * are the same length and contain the same binary data.
+	 * 
+	 * @param a the first array
+	 * @param b the second array
+	 * @return true if a equals b, false otherwise.  
+	 */
+	public static boolean equals(byte[] a, byte[] b)
+	{
+		boolean result = false;
+
+		if (a == b)
+			return true;
+
+		if (a != null &amp;&amp; b != null)
+		{
+			result = a.length == b.length;
+
+			if (result)
+				for (int i = 0; i &lt; a.length; i++)
+					if (a[i] != b[i])
+						result = false;
+		}
+		return result;
+	}
+
+	/**
+	 * Creates a copy of an array of bytes.
+	 * 
+	 * @param data the array to be copied
+	 * @return a copy of the array.
+	 */
+	public static byte[] copy(byte[] data)
+	{
+		byte[] newData = null;
+
+		if (data != null)
+		{
+			newData = new byte[data.length];
+
+			for (int i = 0; i &lt; data.length; i++)
+				newData[i] = data[i];
+		}
+		return newData;
+	}
+
 	protected int type;
 	protected int length;
 	protected int timestamp;

Modified: dev/dev-2-4/src/com/flagstone/transform/FSWaitForFrame.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSWaitForFrame.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSWaitForFrame.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -104,12 +104,11 @@
  */
 public class FSWaitForFrame extends FSActionObject
 {
-	private int frameNumber = 1;
+	private int frameNumber;
+	private int actionCount;
 
-	private int actionCount = 0;
-
 	/**
-	 * Construct an FSWaitForFrame object, initalizing it with values decoded
+	 * Construct an FSWaitForFrame object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -129,6 +128,9 @@
 	 *            the number of the frame to wait for.
 	 * @param anActionCount
 	 *            the number of actions to execute.
+	 *            
+	 * @throws IllegalArgumentException if the frame number is not in the range 1..65535.
+	 * @throws IllegalArgumentException if the number of actions to execute is not in the range 0..255.
 	 */
 	public FSWaitForFrame(int aFrameNumber, int anActionCount)
 	{
@@ -146,7 +148,7 @@
 	 */
 	public FSWaitForFrame(FSWaitForFrame obj)
 	{
-		super(obj);
+		super(WaitForFrame);
 		frameNumber = obj.frameNumber;
 		actionCount = obj.actionCount;
 	}
@@ -177,9 +179,14 @@
 	 * 
 	 * @param aNumber
 	 *            the number of the frame to wait for.
+	 *            
+	 * @throws IllegalArgumentException if the frame number is not in the range 1..65535.
 	 */
 	public void setFrameNumber(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 65535) {
+			throw new IllegalArgumentException(&quot;Frame number must be in the range 1..65535.&quot;);
+		}
 		frameNumber = aNumber;
 	}
 
@@ -190,9 +197,14 @@
 	 * 
 	 * @param aNumber
 	 *            the number of actions to execute.
+	 *            
+	 * @throws IllegalArgumentException if the number of actions to execute is not in the range 01..255.
 	 */
 	public void setActionCount(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 255) {
+			throw new IllegalArgumentException(&quot;Number of actions must be in the range 0..255.&quot;);
+		}
 		actionCount = aNumber;
 	}
 

Modified: dev/dev-2-4/src/com/flagstone/transform/FSWaitForFrame2.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSWaitForFrame2.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSWaitForFrame2.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -105,10 +105,10 @@
  */
 public class FSWaitForFrame2 extends FSActionObject
 {
-	private int actionCount = 0;
+	private int actionCount;
 
 	/**
-	 * Construct an FSWaitForFrame2 object, initalizing it with values decoded
+	 * Construct an FSWaitForFrame2 object, initialising it with values decoded
 	 * from an encoded object.
 	 * 
 	 * @param coder
@@ -126,6 +126,8 @@
 	 * 
 	 * @param aNumber
 	 *            the number of actions to execute.
+	 *            
+	 * @throws IllegalArgumentException if the number of actions to execute is not in the range 0..255.
 	 */
 	public FSWaitForFrame2(int aNumber)
 	{
@@ -142,7 +144,7 @@
 	 */
 	public FSWaitForFrame2(FSWaitForFrame2 obj)
 	{
-		super(obj);
+		super(WaitForFrame2);
 		actionCount = obj.actionCount;
 	}
 
@@ -157,13 +159,20 @@
 	}
 
 	/**
-	 * Sets the number of actions to execute.
+	 * Sets the number of actions to execute if the frame has been loaded.
+	 * Unlike other actions it is the number of actions that are specified not
+	 * the number of bytes in memory they occupy.
 	 * 
 	 * @param aNumber
 	 *            the number of actions to execute.
+	 *            
+	 * @throws IllegalArgumentException if the number of actions to execute is not in the range 01..255.
 	 */
 	public void setActionCount(int aNumber)
 	{
+		if (aNumber &lt; 0 || aNumber &gt; 255) {
+			throw new IllegalArgumentException(&quot;Number of actions must be in the range 0..255.&quot;);
+		}
 		actionCount = aNumber;
 	}
 
@@ -172,8 +181,7 @@
 		boolean result = false;
 
 		if (super.equals(anObject))
-			result = actionCount == ((FSWaitForFrame2) anObject)
-							.getActionCount();
+			result = actionCount == ((FSWaitForFrame2) anObject).getActionCount();
 
 		return result;
 	}

Modified: dev/dev-2-4/src/com/flagstone/transform/FSWith.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/FSWith.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/FSWith.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -97,7 +97,7 @@
  */
 public class FSWith extends FSActionObject
 {
-	private ArrayList actions = null;
+	private ArrayList&lt;FSActionObject&gt; actions;
 
 	/*
 	 * Variables used when encoding.
@@ -105,7 +105,7 @@
 	private int actionsLength = 0;
 
 	/**
-	 * Construct an FSWith object, initalizing it with values decoded from an
+	 * Construct an FSWith object, initialising it with values decoded from an
 	 * encoded object.
 	 * 
 	 * @param coder
@@ -122,8 +122,10 @@
 	 * 
 	 * @param anArray
 	 *            the array of action objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public FSWith(ArrayList anArray)
+	public FSWith(ArrayList&lt;FSActionObject&gt; anArray)
 	{
 		super(With);
 		setActions(anArray);
@@ -133,16 +135,16 @@
 	 * Constructs an FSWith object by copying values from an existing object.
 	 * 
 	 * @param obj
-	 *            an FSGotoFrame object.
+	 *            an FSWith object.
 	 */
 	public FSWith(FSWith obj)
 	{
-		super(obj);
+		super(With);
 
-		actions = new ArrayList(obj.actions.size());
+		actions = new ArrayList&lt;FSActionObject&gt;(obj.actions.size());
 
-		for (Iterator i = obj.actions.iterator(); i.hasNext();)
-			actions.add(((FSActionObject) i.next()).clone());
+		for (Iterator&lt;FSActionObject&gt; i = obj.actions.iterator(); i.hasNext();)
+			actions.add((FSActionObject) i.next().clone());
 	}
 
 	/**
@@ -150,9 +152,14 @@
 	 * 
 	 * @param anAction
 	 *            an object belonging to a class derived from FSActionObject.
+	 *            
+	 * @throws NullPointerException if the action is null.
 	 */
 	public void add(FSActionObject anAction)
 	{
+		if (anAction == null) {
+			throw new NullPointerException(&quot;Action caanot be null.&quot;);
+		}
 		actions.add(anAction);
 	}
 
@@ -161,7 +168,7 @@
 	 * 
 	 * @return the array of action objects.
 	 */
-	public ArrayList getActions()
+	public ArrayList&lt;FSActionObject&gt; getActions()
 	{
 		return actions;
 	}
@@ -171,8 +178,10 @@
 	 * 
 	 * @param anArray
 	 *            the array of action objects.
+	 *            
+	 * @throws NullPointerException if the array is null.
 	 */
-	public void setActions(ArrayList anArray)
+	public void setActions(ArrayList&lt;FSActionObject&gt; anArray)
 	{
 		actions = anArray;
 	}
@@ -181,10 +190,10 @@
 	{
 		FSWith anObject = (FSWith) super.clone();
 
-		anObject.actions = new ArrayList();
+		anObject.actions = new ArrayList&lt;FSActionObject&gt;();
 
-		for (Iterator i = actions.iterator(); i.hasNext();)
-			anObject.actions.add(((FSActionObject) i.next()).clone());
+		for (Iterator&lt;FSActionObject&gt; i = actions.iterator(); i.hasNext();)
+			anObject.actions.add((FSActionObject) i.next().clone());
 
 		return anObject;
 	}
@@ -216,15 +225,7 @@
 
 		length += 2;
 
-		actionsLength = 0;
-
-		for (Iterator i = actions.iterator(); i.hasNext();)
-		{
-			FSActionObject currentAction = (FSActionObject) i.next();
-
-			actionsLength += currentAction.length(context);
-			actionsLength += (currentAction.getType() &gt; 128) ? 3 : 1;
-		}
+		actionsLength = FSActionObject.length(context, actions);
 		length += actionsLength;
 
 		return length;
@@ -236,50 +237,18 @@
 		coder.writeWord(length - actionsLength, 2);
 		coder.writeWord(actionsLength, 2);
 
-		for (Iterator i = actions.iterator(); i.hasNext();)
+		for (Iterator&lt;FSActionObject&gt; i = actions.iterator(); i.hasNext();)
 		{
-			FSActionObject action = (FSActionObject) i.next();
-
-			int objStart = coder.getPointer();
-			int start = coder.getPointer()
-							+ ((action.getType() &gt; 128) ? 24 : 8);
-			int next = start + (action.getLength() &lt;&lt; 3);
-
-			action.encode(coder, context);
-			coder.setPointer(next);
-
-			int delta = (coder.getPointer() - next) &gt;&gt; 3;
-
-			if (delta != 0)
-			{
-				context.codingError = true;
-				context.typeInError = action.getType();
-				context.startOfError = objStart &gt;&gt;&gt; 3;
-				context.expectedLength = (next - objStart) &gt;&gt;&gt; 3;
-				context.delta = delta;
-			}
+			FSActionObject.encode(coder, context, i.next());
 		}
 	}
 
 	public void decode(FSCoder coder, FSContext context)
 	{
-		int bytesRead = 0;
-
 		super.decode(coder, context);
 
 		actionsLength = coder.readWord(2, false);
-
+		actions = FSActionObject.decodeActions(coder, context, actionsLength);
 		length += actionsLength;
-
-		actions = new ArrayList();
-
-		while (bytesRead &lt; actionsLength)
-		{
-			FSActionObject anAction = FSActionObject.decodeAction(coder, context);
-
-			bytesRead += anAction.getLength()
-							+ ((anAction.getType() &gt;= 128) ? 3 : 1);
-			actions.add(anAction);
-		}
 	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/Transform.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/Transform.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/Transform.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -30,8 +30,6 @@
 
 package com.flagstone.transform;
 
-import java.util.*;
-
 /**
  * The %Transform class defines constants and methods used throughout the
  * %Transform package.
@@ -74,6 +72,7 @@
 	 * integer - since the largest optional field is 16-bits in length and thus
 	 * no confusion will result.
 	 */
+	// TODO get rid of this.
 	public static final int VALUE_NOT_SET = Integer.MIN_VALUE;
 
 	/**
@@ -101,37 +100,4 @@
 		System.out.println(&quot; * &quot;);
 		System.out.println(&quot; */&quot;);
 	}
-
-	static boolean equals(byte[] b1, byte[] b2)
-	{
-		boolean result = false;
-
-		if (b1 == null &amp;&amp; b2 == null)
-			return true;
-
-		if (b1 != null &amp;&amp; b2 != null)
-		{
-			result = b1.length == b2.length;
-
-			if (result)
-				for (int i = 0; i &lt; b1.length; i++)
-					if (b1[i] != b2[i])
-						result = false;
-		}
-		return result;
-	}
-
-	static byte[] clone(byte[] data)
-	{
-		byte[] newData = null;
-
-		if (data != null)
-		{
-			newData = new byte[data.length];
-
-			for (int i = 0; i &lt; data.length; i++)
-				newData[i] = data[i];
-		}
-		return newData;
-	}
 }

Modified: dev/dev-2-4/src/com/flagstone/transform/test/FSColorTest.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/test/FSColorTest.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/test/FSColorTest.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -31,9 +31,9 @@
 
 import com.flagstone.transform.FSColor;
 import com.flagstone.transform.FSCoder;
+import com.flagstone.transform.FSContext;
 
 import junit.framework.TestCase;
-import junit.framework.Assert;
 
 public class FSColorTest extends TestCase
 {
@@ -54,6 +54,8 @@
         { 0x33, 0x66, 0x99, 0x44},
         { 0x33, 0x66, 0x99, 0x88},
     };
+    
+    private FSContext context = new FSContext();
 
     public void testConstructors()
     {
@@ -147,10 +149,11 @@
             checkColours(colour, rgb[i]);
         }
 
+        context.transparent = true;
+
         for (int i=0; i&lt;rgba.length; i++)
         {
         	coder = new FSCoder(FSCoder.LITTLE_ENDIAN, 0);
-            coder.setContext(FSCoder.TransparentColors, 1);
 
             colour = new FSColor(rgba[i][0], rgba[i][1], rgba[i][2], rgba[i][3]);
             colour.encode(coder, context);
@@ -171,10 +174,11 @@
             checkColours(colour, rgb[i]);
         }
 
+        context.transparent = true;
+
         for (int i=0; i&lt;rgba.length; i++)
         {
             FSCoder coder = initCoder(rgba[i], false);
-            coder.setContext(FSCoder.TransparentColors, 1);
             FSColor colour = new FSColor(coder, context);
 
             assertEquals(coder.getPointer() &gt;&gt; 3, rgba[i].length);

Modified: dev/dev-2-4/src/com/flagstone/transform/test/FSProtectTest.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/test/FSProtectTest.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/test/FSProtectTest.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -29,6 +29,7 @@
  */
 package com.flagstone.transform.test;
 
+import com.flagstone.transform.FSContext;
 import com.flagstone.transform.FSMovieObject;
 import com.flagstone.transform.FSProtect;
 import com.flagstone.transform.FSCoder;
@@ -54,6 +55,8 @@
           0x42, 0x38, 0x38, 0x32, 0x43, 0x46, 0x39, 0x39, 0x00},
     };
 
+    private FSContext context = new FSContext();
+
     public void testConstructors()
     {
         for (int i=0; i&lt;passwords.length; i++)

Modified: dev/dev-2-4/src/com/flagstone/transform/test/FSScreenVideoPacketTest.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/test/FSScreenVideoPacketTest.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/test/FSScreenVideoPacketTest.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -147,6 +147,8 @@
             movie.add(new FSVideoFrame(identifier, 0, packet.encode()));
             movie.add(new FSShowFrame());
   
+        	FSPlaceObject2 place; 
+
         	for (int i=1; i&lt;numberOfFrames; i++)
 	    	{
                 File srcFile = new File(sourceDir, files[i]);
@@ -167,8 +169,10 @@
         		}
                 
             	packet = new FSScreenVideoPacket(false, codec, screenWidth, screenHeight, blockWidth, blockHeight, delta);
+                place = new FSPlaceObject2(1, 0, 0);
+                place.setRatio(i/65535.0f);
                 
-            	movie.add(new FSPlaceObject2(1, i/65535.0f, 0,0));
+            	movie.add(place);
                 movie.add(new FSVideoFrame(identifier, i, packet.encode()));
                 movie.add(new FSShowFrame());
 	    	}

Modified: dev/dev-2-4/src/com/flagstone/transform/test/FSSetBackgroundColorTest.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/test/FSSetBackgroundColorTest.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/test/FSSetBackgroundColorTest.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -29,6 +29,7 @@
  */
 package com.flagstone.transform.test;
 
+import com.flagstone.transform.FSContext;
 import com.flagstone.transform.FSMovieObject;
 import com.flagstone.transform.FSSetBackgroundColor;
 import com.flagstone.transform.FSColor;
@@ -60,6 +61,8 @@
         { 0x43, 0x02, 0xFF, 0xFF, 0xFF },
     };
 
+    private FSContext context = new FSContext();
+
     public void testConstructors()
     {
         for (int i=0; i&lt;colours.length; i++)

Modified: dev/dev-2-4/src/com/flagstone/transform/test/FSShapeConstructorTest.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/test/FSShapeConstructorTest.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/test/FSShapeConstructorTest.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -60,7 +60,7 @@
             path.selectStyle(0, 0);
             path.rect(width/2, height/2, width, height, cornerRadius);
             movie.add(path.defineShape(identifier));
-            movie.add(new FSPlaceObject2(identifier, 1));
+            movie.add(new FSPlaceObject2(identifier, 1, 0, 0));
             movie.add(new FSShowFrame());
 
             /*
@@ -72,7 +72,7 @@
             path.selectStyle(0, 0);
             path.circle(-width/2, height/2, height/2);
             movie.add(path.defineShape(identifier));
-            movie.add(new FSPlaceObject2(identifier, 1));
+            movie.add(new FSPlaceObject2(identifier, 1, 0, 0));
             movie.add(new FSShowFrame());
 
             /*
@@ -84,7 +84,7 @@
             path.selectStyle(0, 0);
             path.ellipse(-width/2, -height/2, width/2, height/2);
             movie.add(path.defineShape(identifier));
-            movie.add(new FSPlaceObject2(identifier, 1));
+            movie.add(new FSPlaceObject2(identifier, 1, 0, 0));
             movie.add(new FSShowFrame());
 
             /*
@@ -113,7 +113,7 @@
             path.selectStyle(0, 0);
             path.polygon(points);
             movie.add(path.defineShape(identifier));
-            movie.add(new FSPlaceObject2(identifier, 1));
+            movie.add(new FSPlaceObject2(identifier, 1, 0, 0));
             movie.add(new FSShowFrame());
 
             /*
@@ -126,7 +126,7 @@
             path.curve(0, -100, 150, -100, 150, 0);
             path.closePath();
             movie.add(path.defineShape(identifier));
-            movie.add(new FSPlaceObject2(identifier, 1));
+            movie.add(new FSPlaceObject2(identifier, 1, 0, 0));
             movie.add(new FSShowFrame());
 
             movie.encodeToFile(dstFile.getPath());

Modified: dev/dev-2-4/src/com/flagstone/transform/test/FSShowFrameTest.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/test/FSShowFrameTest.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/test/FSShowFrameTest.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -29,6 +29,7 @@
  */
 package com.flagstone.transform.test;
 
+import com.flagstone.transform.FSContext;
 import com.flagstone.transform.FSMovieObject;
 import com.flagstone.transform.FSProtect;
 import com.flagstone.transform.FSShowFrame;
@@ -43,6 +44,8 @@
         { 0x40, 0x00 },
     };
 
+    private FSContext context = new FSContext();
+
     public void testConstructors()
     {
         FSShowFrame obj = new FSShowFrame();

Modified: dev/dev-2-4/src/com/flagstone/transform/test/FSSoundConstructorTest.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/test/FSSoundConstructorTest.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/test/FSSoundConstructorTest.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -129,7 +129,7 @@
         FSDefineSound sound = soundGenerator.defineSound(soundId);
 
         movie.add(sound);
-        movie.add(new FSStartSound(new FSSound(soundId, FSSound.Start)));
+        movie.add(new FSStartSound(new FSSound(soundId, FSSound.Start, 0)));
 
         /*
          * Add frames to give the sound time to play.

Modified: dev/dev-2-4/src/com/flagstone/transform/util/FSImageConstructor.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/util/FSImageConstructor.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/util/FSImageConstructor.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -1049,9 +1049,9 @@
 
             switch (attributes[COMPRESSION_METHOD])
             {
-                case BI_RGB:  decodeIDX8(coder, context); break;
-                case BI_RLE8: decodeRLE8(coder, context); break;
-                case BI_RLE4: decodeRLE4(coder, context); break;
+                case BI_RGB:  decodeIDX8(coder); break;
+                case BI_RLE8: decodeRLE8(coder); break;
+                case BI_RLE4: decodeRLE4(coder); break;
             }
         }
         else
@@ -1062,14 +1062,14 @@
 
             switch (format)
             {
-                case RGB5: decodeRGB5(coder, context); break;
-                case RGB8: decodeRGB8(coder, context); break;
-                case RGBA: decodeRGBA(coder, context); break;
+                case RGB5: decodeRGB5(coder); break;
+                case RGB8: decodeRGB8(coder); break;
+                case RGBA: decodeRGBA(coder); break;
             }
         }
     }
 
-    private void decodeIDX8(FSCoder coder, FSContext context)
+    private void decodeIDX8(FSCoder coder)
     {
         int h = 0;
         int w = 0;
@@ -1087,7 +1087,7 @@
         }
     }
 
-    private void decodeRLE4(FSCoder coder, FSContext context)
+    private void decodeRLE4(FSCoder coder)
     {
         int row = height-1;
         int col = 0;
@@ -1136,7 +1136,7 @@
         }
     }
     
-    private void decodeRLE8(FSCoder coder, FSContext context)
+    private void decodeRLE8(FSCoder coder)
     {
         int row = height-1;
         int col = 0;
@@ -1181,7 +1181,7 @@
         }
     }
     
-    private void decodeRGB5(FSCoder coder, FSContext context)
+    private void decodeRGB5(FSCoder coder)
     {
         int h = 0;
         int w = 0;
@@ -1237,7 +1237,7 @@
         
     }
 
-    private void decodeRGB8(FSCoder coder, FSContext context)
+    private void decodeRGB8(FSCoder coder)
     {
         int h = 0;
         int w = 0;
@@ -1259,7 +1259,7 @@
         }
     }
 
-    private void decodeRGBA(FSCoder coder, FSContext context)
+    private void decodeRGBA(FSCoder coder)
     {
         int h = 0;
         int w = 0;

Modified: dev/dev-2-4/src/com/flagstone/transform/util/FSShapeConstructor.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/util/FSShapeConstructor.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/util/FSShapeConstructor.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -435,7 +435,7 @@
         x = COORDINATES_ARE_PIXELS ? x * 20 : x;
         y = COORDINATES_ARE_PIXELS ? y * 20 : y;
         
-        objects.add(new FSShapeStyle(1, Transform.VALUE_NOT_SET, 1, x, y));
+        objects.add(new FSShapeStyle(1, -1, 1, x, y));
 
         setControl((currentX+x)/2, (currentY+y)/2);
         setCurrent(x, y);

Modified: dev/dev-2-4/src/com/flagstone/transform/util/FSSoundConstructor.java
===================================================================
--- dev/dev-2-4/src/com/flagstone/transform/util/FSSoundConstructor.java	2008-03-19 12:16:57 UTC (rev 384)
+++ dev/dev-2-4/src/com/flagstone/transform/util/FSSoundConstructor.java	2008-03-26 15:26:42 UTC (rev 385)
@@ -357,7 +357,7 @@
      */
     public FSSoundStreamHead2 streamHeader(int samplesPerBlock)
     {
-       return new FSSoundStreamHead2(format, sampleRate, numberOfChannels, sampleSize, sampleRate, numberOfChannels, sampleSize, samplesPerBlock, 0);
+       return new FSSoundStreamHead2(format, sampleRate, numberOfChannels, sampleSize, sampleRate, numberOfChannels, sampleSize, samplesPerBlock);
    }
 
     /** 
@@ -474,7 +474,7 @@
             switch (chunkType)
             {
                 case FMT: 
-                	decodeFMT(coder, context); 
+                	decodeFMT(coder); 
                 	break;
                 case DATA: 
                 	decodeDATA(coder, length); 
@@ -499,7 +499,7 @@
         }
     }
 
-    private void decodeFMT(FSCoder coder, FSContext context) throws DataFormatException
+    private void decodeFMT(FSCoder coder) throws DataFormatException
     {
         format = FSSound.PCM;
         
@@ -564,7 +564,7 @@
                 if (numberOfFrames == 0)
                     frameStart = coder.getPointer();
                 
-                coder.adjustPointer(MP3FrameSize(coder, context) &lt;&lt; 3);
+                coder.adjustPointer(MP3FrameSize(coder) &lt;&lt; 3);
                 numberOfFrames++;
             }
             else
@@ -664,7 +664,7 @@
         
         while (coder.findBits(0x7FF, 11, 8))
         {
-            coder.adjustPointer(MP3FrameSize(coder, context) &lt;&lt; 3);
+            coder.adjustPointer(MP3FrameSize(coder) &lt;&lt; 3);
             numberOfFrames++;
         }
         
@@ -690,11 +690,11 @@
 
             frameTable[frameNumber++][1] = 4 + (((version == MPEG1) ? 144 : 72) * bitRate*1000 / samplingRate + padding) - 4;
     
-            coder.adjustPointer((MP3FrameSize(coder, context) &lt;&lt; 3)-23);
+            coder.adjustPointer((MP3FrameSize(coder) &lt;&lt; 3)-23);
         }
     }
     
-    private int MP3FrameSize(FSCoder coder, FSContext context)
+    private int MP3FrameSize(FSCoder coder)
     {
         int frameSize = 4;
         


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000320.html">[Transform-svn] r384 - in dev/dev-2-4/src/com/flagstone/transform:	. test util
</A></li>
	<LI>Next message: <A HREF="000321.html">[Transform-svn] r386 - dev/dev-2-4/src/com/flagstone/transform/util
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#329">[ date ]</a>
              <a href="thread.html#329">[ thread ]</a>
              <a href="subject.html#329">[ subject ]</a>
              <a href="author.html#329">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/transform-svn">More information about the Transform-svn
mailing list</a><br>
</body></html>
